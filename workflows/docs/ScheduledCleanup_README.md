# 定时清理任务 - 项目说明

## 概述

本项目创建一个 **n8n 自动化工作流**，实现每天凌晨 3 点自动清理服务器临时文件，并通过飞书机器人发送执行结果通知。

## 快速信息

| 字段 | 值 |
|------|-----|
| **Workflow ID** | `GVzOCR4c1MRpcZkO` |
| **创建日期** | 2025-12-26 |
| **状态** | ✅ 已部署 |
| **执行频率** | 每天 03:00 (UTC) |
| **节点数** | 5 个 |
| **创建方法** | Template-based |

## 工作流功能

### 核心功能

1. **定时执行** (Schedule Trigger)
   - Cron 表达式: `0 3 * * *`
   - 每天凌晨 3 点自动执行一次

2. **临时文件清理** (Execute Command)
   - 执行清理命令: `find /tmp -type f -mtime +7 -delete`
   - 删除 7 天以上未修改的临时文件
   - 自动生成清理统计

3. **飞书通知** (Feishu Webhook)
   - 清理完成后发送飞书群消息
   - 通知包含: 清理时间、删除文件数、执行状态

## 工作流架构

```
Schedule Trigger
    ↓
    │ Cron: 0 3 * * *
    ↓
Execute Command
    ↓
    │ find /tmp -type f -mtime +7 -delete
    ↓
Feishu Notification
    ↓
    │ 发送清理结果到飞书群
    ↓
完成
```

## 配置参数

### 清理配置

| 参数 | 值 | 说明 |
|------|-----|------|
| 清理目录 | `/tmp` | 服务器临时文件目录 |
| 文件年龄 | 7 天 | 只删除 7 天以上未修改的文件 |
| 执行时间 | 03:00 UTC | 凌晨 3 点执行（可根据服务器时区调整） |

### 通知配置

| 参数 | 类型 | 说明 |
|------|------|------|
| Webhook URL | 字符串 | 飞书群组机器人 Webhook 地址 |
| 通知内容 | 卡片 | 包含清理统计和状态的消息卡片 |

## 环境要求

### 系统要求
- **操作系统**: Linux/Unix
- **find 命令**: 必须支持 `-mtime` 参数
- **文件权限**: n8n 进程用户需要 `/tmp` 目录的读写权限

### n8n 要求
- **n8n 版本**: >= 1.0.0
- **执行模式**: Push / Pull (任一均可)
- **网络**: 需要访问飞书 API 服务

### 飞书要求
- **群组**: 需要有可用的飞书工作群
- **机器人**: 已在群组中添加定时清理通知机器人
- **Webhook URL**: 已配置且有效

## 部署状态

✅ **已成功部署** - 所有节点创建完成

```
总计任务: 1
成功: 1
失败: 0
跳过: 0
```

## 使用场景

- 定期清理服务器 `/tmp` 目录，释放磁盘空间
- 自动化维护任务，减少人工干预
- 通过飞书通知及时了解清理执行情况
- 防止临时文件积累导致磁盘满

## 安全考虑

⚠️ **重要提示**:

1. **权限检查**: 确保 n8n 进程用户有 `/tmp` 删除权限
2. **备份数据**: 确保 `/tmp` 中没有重要业务数据
3. **测试模式**: 首次部署建议先在测试环境验证
4. **监控日志**: 保持飞书通知打开，及时发现异常

## 下一步

部署完成后，请参考以下文档：

- **[ScheduledCleanup_DEPLOY.md](./ScheduledCleanup_DEPLOY.md)** - 详细部署步骤和配置
- **[ScheduledCleanup_API.md](./ScheduledCleanup_API.md)** - n8n API 集成文档

## 支持

遇到问题？

1. 检查 n8n 日志: n8n 控制台 → Executions
2. 验证飞书 Webhook: 测试群组机器人
3. 测试清理命令: `find /tmp -type f -mtime +7` (不带 -delete)

---

**最后更新**: 2025-12-26
**创建者**: Claude Code
**文档版本**: 1.0.0
