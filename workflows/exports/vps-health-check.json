{
  "name": "VPS å¥åº·æ£€æŸ¥",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "0 * * * *"
            }
          ]
        }
      },
      "id": "schedule-trigger",
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [240, 300]
    },
    {
      "parameters": {
        "authentication": "privateKey",
        "command": "df -h | grep -E '^/dev/' | awk '{print $1, $5, $6}'",
        "host": "={{ $env.VPS_HOST }}",
        "user": "={{ $env.VPS_USER }}",
        "privateKey": "={{ $env.VPS_SSH_KEY }}"
      },
      "id": "ssh-disk-check",
      "name": "SSH ç£ç›˜æ£€æŸ¥",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [460, 300]
    },
    {
      "parameters": {
        "jsCode": "const output = $input.item.json.stdout;\nconst lines = output.trim().split('\\n');\n\nconst disks = lines.map(line => {\n  const [device, usage, mount] = line.trim().split(/\\s+/);\n  const usagePercent = parseInt(usage.replace('%', ''));\n  return {\n    device,\n    usage: usagePercent,\n    mount,\n    alert: usagePercent > 80\n  };\n});\n\nconst needsAlert = disks.some(d => d.alert);\nconst alertDisks = disks.filter(d => d.alert);\n\nreturn {\n  json: {\n    timestamp: new Date().toISOString(),\n    host: $env.VPS_HOST,\n    disks,\n    needsAlert,\n    alertDisks\n  }\n};"
      },
      "id": "parse-disk-usage",
      "name": "è§£æç£ç›˜ä½¿ç”¨ç‡",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [680, 300]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.needsAlert }}",
              "value2": true
            }
          ]
        }
      },
      "id": "if-need-alert",
      "name": "æ˜¯å¦éœ€è¦å‘Šè­¦",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [900, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $env.FEISHU_BOT_WEBHOOK }}",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "msg_type",
              "value": "text"
            },
            {
              "name": "content",
              "value": "={{ JSON.stringify({\n  text: `ğŸš¨ VPS ç£ç›˜ç©ºé—´å‘Šè­¦\\n\\næœåŠ¡å™¨: ${$json.host}\\næ—¶é—´: ${$json.timestamp}\\n\\nè¶…æ ‡ç£ç›˜:\\n${$json.alertDisks.map(d => `â€¢ ${d.device} (${d.mount}): ${d.usage}%`).join('\\n')}\\n\\nè¯·åŠæ—¶å¤„ç†ï¼`\n}) }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "id": "send-feishu-alert",
      "name": "å‘é€é£ä¹¦å‘Šè­¦",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1120, 200]
    },
    {
      "parameters": {},
      "id": "error-trigger",
      "name": "Error Trigger",
      "type": "n8n-nodes-base.errorTrigger",
      "typeVersion": 1,
      "position": [240, 500]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $env.FEISHU_BOT_WEBHOOK }}",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "msg_type",
              "value": "text"
            },
            {
              "name": "content",
              "value": "={{ JSON.stringify({\n  text: `âŒ VPS å¥åº·æ£€æŸ¥å¼‚å¸¸\\n\\nworkflow: ${$workflow.name}\\nèŠ‚ç‚¹: ${$('Error Trigger').item.json.node?.name || 'Unknown'}\\né”™è¯¯: ${$('Error Trigger').item.json.error?.message || 'Unknown error'}\\næ—¶é—´: ${new Date().toISOString()}`\n}) }}"
            }
          ]
        },
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          }
        }
      },
      "id": "send-error-alert",
      "name": "å‘é€é”™è¯¯å‘Šè­¦",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [460, 500]
    }
  ],
  "connections": {
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "SSH ç£ç›˜æ£€æŸ¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SSH ç£ç›˜æ£€æŸ¥": {
      "main": [
        [
          {
            "node": "è§£æç£ç›˜ä½¿ç”¨ç‡",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è§£æç£ç›˜ä½¿ç”¨ç‡": {
      "main": [
        [
          {
            "node": "æ˜¯å¦éœ€è¦å‘Šè­¦",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ˜¯å¦éœ€è¦å‘Šè­¦": {
      "main": [
        [
          {
            "node": "å‘é€é£ä¹¦å‘Šè­¦",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Error Trigger": {
      "main": [
        [
          {
            "node": "å‘é€é”™è¯¯å‘Šè­¦",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [],
  "triggerCount": 1,
  "updatedAt": "2025-12-26T00:00:00.000Z",
  "versionId": "1"
}
