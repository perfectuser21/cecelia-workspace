{
  "name": "Execution Callback v1.0",
  "nodes": [
    {
      "id": "webhook-trigger",
      "name": "Webhook æ¥æ”¶",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [240, 400],
      "webhookId": "execution-callback",
      "parameters": {
        "path": "execution-callback",
        "httpMethod": "POST",
        "responseMode": "onReceived",
        "responseData": "allEntries",
        "options": {}
      }
    },
    {
      "id": "parse-callback",
      "name": "è§£æå›è°ƒæ•°æ®",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [500, 400],
      "parameters": {
        "jsCode": "const body = $input.first().json.body || $input.first().json;\n\n// cleanup.sh å‘é€çš„æ•°æ®æ ¼å¼:\n// {\n//   task_id: string,\n//   status: \"AI Done\" | \"AI Failed\",\n//   run_id: string,\n//   coding_type: string,\n//   task_name?: string,\n//   quality_score?: number,\n//   is_feature_check?: boolean\n// }\n\nconst taskId = body.task_id || '';\nconst status = body.status || 'unknown';\nconst runId = body.run_id || '';\nconst codingType = body.coding_type || 'unknown';\nconst taskName = body.task_name || 'Unknown Task';\nconst qualityScore = body.quality_score || 0;\nconst isFeatureCheck = body.is_feature_check || false;\n\nconst isSuccess = status === 'AI Done';\n\nreturn {\n  task_id: taskId,\n  status: status,\n  run_id: runId,\n  coding_type: codingType,\n  task_name: taskName,\n  quality_score: qualityScore,\n  is_feature_check: isFeatureCheck,\n  is_success: isSuccess,\n  timestamp: new Date().toISOString()\n};"
      }
    },
    {
      "id": "trigger-dispatcher",
      "name": "è§¦å‘ Task Dispatcher",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [760, 400],
      "parameters": {
        "method": "POST",
        "url": "http://localhost:5679/webhook/task-dispatcher",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"trigger\": \"execution-callback\",\n  \"completed_task_id\": \"{{ $json.task_id }}\",\n  \"status\": \"{{ $json.status }}\"\n}",
        "options": {
          "timeout": 10000
        }
      }
    },
    {
      "id": "check-success",
      "name": "æ‰§è¡ŒæˆåŠŸ?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1020, 400],
      "parameters": {
        "conditions": {
          "options": {
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "is-success",
              "operator": {
                "type": "boolean",
                "operation": "true"
              },
              "leftValue": "={{ $('è§£æå›è°ƒæ•°æ®').first().json.is_success }}"
            }
          ]
        },
        "options": {}
      }
    },
    {
      "id": "notify-success",
      "name": "é€šçŸ¥: æˆåŠŸ",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1280, 300],
      "parameters": {
        "method": "POST",
        "url": "https://open.feishu.cn/open-apis/bot/v2/hook/5bde68e0-9879-4a45-88ed-461a88229136",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"msg_type\": \"interactive\",\n  \"card\": {\n    \"header\": {\n      \"title\": {\n        \"tag\": \"plain_text\",\n        \"content\": \"âœ… AI Task å®Œæˆ\"\n      },\n      \"template\": \"green\"\n    },\n    \"elements\": [\n      {\n        \"tag\": \"div\",\n        \"text\": {\n          \"tag\": \"lark_md\",\n          \"content\": \"**ä»»åŠ¡**: {{ $('è§£æå›è°ƒæ•°æ®').first().json.task_name }}\\n**ç±»å‹**: {{ $('è§£æå›è°ƒæ•°æ®').first().json.coding_type }}\\n**è´¨é‡åˆ†**: {{ $('è§£æå›è°ƒæ•°æ®').first().json.quality_score }}/100\\n**Run ID**: {{ $('è§£æå›è°ƒæ•°æ®').first().json.run_id }}\"\n        }\n      }\n    ]\n  }\n}",
        "options": {}
      }
    },
    {
      "id": "notify-failure",
      "name": "é€šçŸ¥: å¤±è´¥",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1280, 500],
      "parameters": {
        "method": "POST",
        "url": "https://open.feishu.cn/open-apis/bot/v2/hook/5bde68e0-9879-4a45-88ed-461a88229136",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"msg_type\": \"interactive\",\n  \"card\": {\n    \"header\": {\n      \"title\": {\n        \"tag\": \"plain_text\",\n        \"content\": \"âŒ AI Task å¤±è´¥\"\n      },\n      \"template\": \"red\"\n    },\n    \"elements\": [\n      {\n        \"tag\": \"div\",\n        \"text\": {\n          \"tag\": \"lark_md\",\n          \"content\": \"**ä»»åŠ¡**: {{ $('è§£æå›è°ƒæ•°æ®').first().json.task_name }}\\n**ç±»å‹**: {{ $('è§£æå›è°ƒæ•°æ®').first().json.coding_type }}\\n**çŠ¶æ€**: {{ $('è§£æå›è°ƒæ•°æ®').first().json.status }}\\n**Run ID**: {{ $('è§£æå›è°ƒæ•°æ®').first().json.run_id }}\"\n        }\n      }\n    ]\n  }\n}",
        "options": {}
      }
    },
    {
      "id": "check-feature",
      "name": "æ˜¯ Feature Check?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1540, 300],
      "parameters": {
        "conditions": {
          "options": {
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "is-feature",
              "operator": {
                "type": "boolean",
                "operation": "true"
              },
              "leftValue": "={{ $('è§£æå›è°ƒæ•°æ®').first().json.is_feature_check }}"
            }
          ]
        },
        "options": {}
      }
    },
    {
      "id": "notify-feature",
      "name": "é€šçŸ¥: Feature å¾…éªŒæ”¶",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1800, 200],
      "parameters": {
        "method": "POST",
        "url": "https://open.feishu.cn/open-apis/bot/v2/hook/5bde68e0-9879-4a45-88ed-461a88229136",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"msg_type\": \"interactive\",\n  \"card\": {\n    \"header\": {\n      \"title\": {\n        \"tag\": \"plain_text\",\n        \"content\": \"ğŸ¯ Feature ç­‰å¾…éªŒæ”¶\"\n      },\n      \"template\": \"purple\"\n    },\n    \"elements\": [\n      {\n        \"tag\": \"div\",\n        \"text\": {\n          \"tag\": \"lark_md\",\n          \"content\": \"**Feature**: {{ $('è§£æå›è°ƒæ•°æ®').first().json.task_name }}\\n\\næ‰€æœ‰å­ä»»åŠ¡å·²å®Œæˆï¼Œè¯·éªŒæ”¶åæ ‡è®°ä¸º Completed\"\n        }\n      }\n    ]\n  }\n}",
        "options": {}
      }
    },
    {
      "id": "done",
      "name": "å®Œæˆ",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [1800, 400]
    }
  ],
  "connections": {
    "Webhook æ¥æ”¶": {
      "main": [[{"node": "è§£æå›è°ƒæ•°æ®", "type": "main", "index": 0}]]
    },
    "è§£æå›è°ƒæ•°æ®": {
      "main": [[{"node": "è§¦å‘ Task Dispatcher", "type": "main", "index": 0}]]
    },
    "è§¦å‘ Task Dispatcher": {
      "main": [[{"node": "æ‰§è¡ŒæˆåŠŸ?", "type": "main", "index": 0}]]
    },
    "æ‰§è¡ŒæˆåŠŸ?": {
      "main": [
        [{"node": "é€šçŸ¥: æˆåŠŸ", "type": "main", "index": 0}],
        [{"node": "é€šçŸ¥: å¤±è´¥", "type": "main", "index": 0}]
      ]
    },
    "é€šçŸ¥: æˆåŠŸ": {
      "main": [[{"node": "æ˜¯ Feature Check?", "type": "main", "index": 0}]]
    },
    "é€šçŸ¥: å¤±è´¥": {
      "main": [[{"node": "å®Œæˆ", "type": "main", "index": 0}]]
    },
    "æ˜¯ Feature Check?": {
      "main": [
        [{"node": "é€šçŸ¥: Feature å¾…éªŒæ”¶", "type": "main", "index": 0}],
        [{"node": "å®Œæˆ", "type": "main", "index": 0}]
      ]
    },
    "é€šçŸ¥: Feature å¾…éªŒæ”¶": {
      "main": [[{"node": "å®Œæˆ", "type": "main", "index": 0}]]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true,
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": true
  }
}
