---
id: prd-kr1-advance
version: 1.0.0
created: 2026-02-01
updated: 2026-02-01
changelog:
  - 1.0.0: 初始版本
---

# PRD - [Retry] Advance "KR1: 意图识别 - 自然语言→OKR/Project/Task" for Cecelia Workspace

## 需求来源

任务来自 Brain 自动调度。根据 Brain status，KR1 (意图识别 - 自然语言→OKR/Project/Task) 当前进度为 0%，需要推进该关键结果的实现。

当前状态：
- Objective: O1: Cecelia 自驱进化 - 从被动执行器到自驱数字生命体 (P0)
- KR1: 意图识别 - 自然语言→OKR/Project/Task, progress: 0%
- 系统健康：task_system_ok: true

## 功能描述

实现自然语言意图识别系统，将用户的自然语言输入转换为结构化的 OKR/Project/Task 实体。这是 Task Intelligence 系统的核心能力之一。

核心功能：
1. **意图分类**：识别用户输入是要创建 Task、Goal 还是 Project
2. **实体提取**：从自然语言中提取关键信息（标题、描述、优先级、时间范围等）
3. **API 端点**：提供 REST API 供前端和其他服务调用
4. **置信度评估**：对识别结果给出置信度分数

## 影响范围

### 涉及的文件
- `apps/core/src/brain/intent.js` - 已存在基础实现，需增强
- `apps/core/src/brain/__tests__/intent.test.js` - 单元测试
- `apps/core/src/routes/api/intent.ts` - 新建 API 路由
- `apps/core/src/routes/api/intent.test.ts` - API 集成测试

### 涉及的 API
- `POST /api/intent/parse` - 解析自然语言输入并返回结构化结果

### 技术栈
- Node.js + Express
- 基于规则的意图识别（不使用复杂 NLP 模型）
- SQLite (如需持久化识别历史)

## 非目标

明确说明本次 **不做** 的事情：

- ❌ 不实现复杂的机器学习 NLP 模型
- ❌ 不处理多轮对话（只处理单次输入）
- ❌ 不实现意图识别的前端 UI 界面（只提供 API）
- ❌ 不支持中文以外的语言
- ❌ 不自动执行创建操作（只返回识别结果，由调用方决定是否创建）
- ❌ 不处理复杂的上下文依赖（如代词消解）
- ❌ 不集成第三方 AI 服务（如 OpenAI）

## 成功标准

### 1. 意图分类功能
- [ ] 能够识别创建任务的意图（例如："帮我做个登录功能"、"写一个 API 接口"）
- [ ] 能够识别创建目标的意图（例如："我想完成用户认证系统"、"目标是提升性能"）
- [ ] 能够识别创建项目的意图（例如："开始一个新的电商项目"、"创建博客系统项目"）
- [ ] 分类准确率：在测试集上达到 80% 以上

### 2. 实体提取功能
- [ ] 能够提取标题：从自然语言中提取任务/目标/项目的核心标题
- [ ] 能够提取描述：提取详细描述信息
- [ ] 能够提取优先级：识别 P0/P1/P2 优先级关键词
- [ ] 能够提取时间范围：识别"今天"、"本周"、"紧急"等时间相关信息
- [ ] 实体提取覆盖率：至少 70% 的输入能成功提取标题

### 3. API 端点实现
- [ ] `POST /api/intent/parse` 端点正常响应
- [ ] 返回格式包含：`{ type: 'task'|'goal'|'project', entities: {...}, confidence: 0-1 }`
- [ ] 错误情况返回合理的错误信息和状态码
- [ ] API 响应时间 < 500ms (p95)

### 4. 测试覆盖
- [ ] `apps/core/src/brain/intent.js` 单元测试通过率 > 90%
- [ ] `apps/core/src/routes/api/intent.test.ts` 集成测试覆盖主要场景
- [ ] 至少包含 10 个真实场景的测试用例

### 5. 文档完善
- [ ] 在 `docs/` 目录创建 `INTENT-RECOGNITION.md` 文档
- [ ] 文档包含：功能说明、API 使用示例、支持的短语模式、扩展方法
- [ ] 代码中关键函数有清晰的 JSDoc 注释

## 技术方案

### 1. 增强现有 intent.js
- 扩展 INTENT_PHRASES 匹配模式
- 增强 ENTITY_PATTERNS 实体提取
- 改进置信度计算逻辑

### 2. 创建 API 路由
- 新建 `/api/intent/parse` 端点
- 调用 intent.js 的核心功能
- 返回标准化的 JSON 响应

### 3. 编写测试
- 单元测试：测试各个函数的正确性
- 集成测试：测试 API 端到端流程
- 边界测试：测试空输入、超长输入等边界情况

### 4. 文档编写
- 记录设计决策
- 提供使用示例
- 说明扩展方法

## 依赖

- Brain API (http://localhost:5212/api/brain/*)
- Task System API
- 现有 intent.js 基础实现
