---
id: prd-core-restructure
version: 2.0.0
created: 2026-01-31
updated: 2026-01-31
changelog:
  - 1.0.0: 初始版本
  - 2.0.0: 补充完整模块清单、页面处理方案、文件树、ops 拆分方案
---

# PRD - Core Features 前端重构：21 碎片合并为 5 域

## 背景

`apps/core/features/` 下有 21 个独立模块目录，很多只有 1-2 个文件。ops 模块注册了 35 个路由把其他模块全部吞掉，路由大量重复。

## 目标

21 个碎片 → 5 个域 + shared。只移文件改 import，不改业务逻辑。

## 完整模块分配表

| 旧模块 | 新域 | 页面数 |
|--------|------|--------|
| brain | planning | 1 (BrainDashboard) |
| okr | planning | 1 (OKRPage) |
| tasks | planning | 1 (Tasks) |
| projects | planning | 2 (ProjectsDashboard, ProjectDetail) |
| planner | planning | 4 (PlannerOverview, PlanningDashboard, Scheduler, TodayPlan) |
| canvas | planning | 3 (Canvas, Whiteboard, ProjectPanorama) |
| dev-panorama | planning | 2 (DevPanorama, RepoDetail) |
| company | planning | 11 (CompanyOverview + 子页面) |
| portfolio | planning | 1 (PortfolioOverview) |
| cecelia | execution | 4 (CeceliaOverview, AgentDetail, CeceliaRuns, RunDetail) |
| engine | execution | 5 (EngineDashboard, Capabilities, DevTasks, TaskMonitor, SessionMonitor) |
| n8n | execution | 4 (Workflows, WorkflowDetail, LiveStatus, LiveStatusDetail) |
| workers | execution | 1 (WorkersOverview) |
| orchestrator | execution | 1 (OrchestratorPage) |
| ops | system | 2 (OpsOverview, LiveDashboard) — 其余路由引用其他模块的组件，随模块迁移 |
| vps-monitor | system | 1 (VpsMonitor) |
| claude-monitor | system | 2 (ClaudeMonitor, ClaudeStats) |
| quality | system | 1 (QualityMonitorPage) |
| devgate | system | 1 (DevGateMetrics) |
| panorama | business | 5 (CommandCenter, AIDetail, MediaDetail, ClientsDetail, PortfolioDetail) |
| shared | shared（保留） | 工具函数和共享组件 |

**knowledge** 域新建空骨架，后续对接。

## Dashboard pages 处理方案

| 文件 | 处理 | 说明 |
|------|------|------|
| CommandCenter.tsx | → business 域 | Core 专属 |
| FeatureDashboard.tsx | → business 域 | Core 专属 |
| PerformanceMonitoring.tsx | → system 域 | Core 专属 |
| ProjectsPage.tsx | → planning 域 | Core 专属 |
| Dashboard.tsx | 留在 Autopilot | 业务工作台 |
| ContentPublish.tsx | 留在 Autopilot | 业务 |
| ContentData.tsx | 留在 Autopilot | 业务 |
| MediaScenarioPage.tsx | 留在 Autopilot | 业务 |
| AiEmployeesPage.tsx | 留在 Autopilot | 业务 |
| AiEmployeeDetailPage.tsx | 留在 Autopilot | 业务 |
| AiAbilityDetailPage.tsx | 留在 Autopilot | 业务 |
| ScrapingPage.tsx | 留在 Autopilot | 业务 |
| PublishStats.tsx | 留在 Autopilot | 业务 |
| ExecutionStatus.tsx | 留在 Autopilot | 业务 |
| RawDataTable.tsx | 留在 Autopilot | 业务 |
| RawScrapingData.tsx | 留在 Autopilot | 业务 |
| LoginPage.tsx | 留在 Autopilot | 通用 |
| FeishuLogin.tsx | 留在 Autopilot | 通用 |
| AdminSettingsPage.tsx | 留在 Autopilot | 通用 |
| NotFound.tsx | 留在 Autopilot | 通用 |
| accounts/ | 留在 Autopilot | 业务 |

## Ops 模块拆分方案

ops 的 35 个路由大部分是其他模块的路由加了 `/ops/` 前缀。拆分后：

- `/ops`, `/ops/features` → system 域的 OpsOverview
- `/ops/live` → system 域的 LiveDashboard
- `/ops/system/*` → system 域（VpsMonitor, Engine 等组件引用 system 域内的页面）
- `/ops/claude/*` → system 域
- `/ops/devgate` → system 域
- `/ops/panorama/*` → planning 域
- `/ops/cecelia/*` → execution 域
- `/ops/planner`, `/ops/planning`, `/ops/scheduler`, `/ops/roadmap` → planning 域

所有 `/ops/*` 路由保留为 redirect 指向新路径。

## Shared 模块处理

shared/ **保持独立不变**。它包含工具函数（formatters, status helpers）、hooks 和共享组件（CeceliaChat），被所有域引用。跨域共享组件也放在 shared/ 中。

## 目标文件树

```
apps/core/features/
├── planning/
│   ├── index.ts                 ← FeatureManifest
│   ├── pages/
│   │   ├── BrainDashboard.tsx
│   │   ├── OKRPage.tsx
│   │   ├── Tasks.tsx
│   │   ├── ProjectsDashboard.tsx
│   │   ├── ProjectDetail.tsx
│   │   ├── ProjectsPage.tsx       (从 dashboard 迁入)
│   │   ├── PlannerOverview.tsx
│   │   ├── PlanningDashboard.tsx
│   │   ├── Scheduler.tsx
│   │   ├── TodayPlan.tsx
│   │   ├── Canvas.tsx
│   │   ├── Whiteboard.tsx
│   │   ├── ProjectPanorama.tsx
│   │   ├── DevPanorama.tsx
│   │   ├── RepoDetail.tsx
│   │   ├── CompanyOverview.tsx
│   │   ├── CompanyAITeam.tsx
│   │   ├── CompanyWorkers.tsx
│   │   ├── CompanyTasks.tsx
│   │   ├── CompanyMedia.tsx
│   │   ├── CompanyTeam.tsx
│   │   ├── CompanyFinance.tsx
│   │   ├── PortfolioOverview.tsx
│   │   └── RoadmapView.tsx
│   └── components/              ← 域专用组件（从旧模块移入）
│
├── execution/
│   ├── index.ts
│   ├── pages/
│   │   ├── CeceliaOverview.tsx
│   │   ├── AgentDetail.tsx
│   │   ├── CeceliaRuns.tsx
│   │   ├── RunDetail.tsx
│   │   ├── EngineDashboard.tsx
│   │   ├── EngineCapabilities.tsx
│   │   ├── DevTasks.tsx
│   │   ├── TaskMonitor.tsx
│   │   ├── SessionMonitor.tsx
│   │   ├── N8nWorkflows.tsx
│   │   ├── N8nWorkflowDetail.tsx
│   │   ├── N8nLiveStatus.tsx
│   │   ├── N8nLiveStatusDetail.tsx
│   │   ├── WorkersOverview.tsx
│   │   └── OrchestratorPage.tsx
│   └── components/
│
├── business/
│   ├── index.ts
│   ├── pages/
│   │   ├── CommandCenter.tsx      (从 dashboard 迁入)
│   │   ├── FeatureDashboard.tsx   (从 dashboard 迁入)
│   │   ├── AIDetail.tsx
│   │   ├── MediaDetail.tsx
│   │   ├── ClientsDetail.tsx
│   │   └── PortfolioDetail.tsx
│   └── components/
│
├── system/
│   ├── index.ts
│   ├── pages/
│   │   ├── OpsOverview.tsx
│   │   ├── LiveDashboard.tsx
│   │   ├── VpsMonitor.tsx
│   │   ├── ClaudeMonitor.tsx
│   │   ├── ClaudeStats.tsx
│   │   ├── QualityMonitorPage.tsx
│   │   ├── DevGateMetrics.tsx
│   │   ├── PerformanceMonitoring.tsx  (从 dashboard 迁入)
│   │   └── SystemOverview.tsx
│   └── components/
│
├── knowledge/
│   ├── index.ts                 ← 空骨架
│   └── pages/
│       └── KnowledgeDashboard.tsx  ← placeholder
│
├── shared/                      ← 保留不变
│   ├── index.ts
│   ├── components/
│   ├── hooks/
│   └── utils/
│
├── index.ts                     ← 只注册 5 个域
├── registry.ts                  ← 保留不变
├── config.ts                    ← 保留不变
└── types.ts                     ← 保留不变
```

## 路由映射（旧 → 新 + redirect）

### 保持不变的路由
所有非 /ops/ 前缀的路由保持原路径不变：
/brain, /okr, /tasks, /projects, /portfolio, /canvas, /whiteboard, /cecelia/*, /engine/*, /n8n/*, /workers, /orchestrator, /vps-monitor, /claude-monitor, /claude-stats, /devgate, /quality, /command/*, /panorama/*

### /ops/* 路由处理
/ops/* 路由全部用 redirect 指向对应域的直接路径：
- /ops/system/vps → redirect /vps-monitor
- /ops/claude → redirect /claude-monitor
- /ops/claude/stats → redirect /claude-stats
- /ops/devgate → redirect /devgate
- /ops/panorama → redirect /panorama
- /ops/cecelia → redirect /cecelia
- /ops/planner → redirect /planner
- /ops/planning → redirect /planning
- /ops/scheduler → redirect /scheduler
- /ops 和 /ops/features → 保持，指向 system 域的 OpsOverview

## 技术方案

### 不做的事
- 不改业务逻辑，只移文件 + 改 import
- 不改后端 API
- 不改 Autopilot 页面（除迁出 4 个 Core 专属页面）
- 不删除任何功能
- 不改 shared/ 目录

### 做的事
1. 创建 5 个域目录（planning, execution, business, system, knowledge）
2. 移动页面文件到对应域的 pages/
3. 每个域写一个 index.ts（FeatureManifest）
4. 更新 features/index.ts：coreFeatures 从 21 改为 5
5. 从 dashboard/pages 迁出 4 个 Core 页面，更新 navigation.config.ts
6. 添加 /ops/* redirect 路由
7. 删除旧的 21 个碎片目录
8. 确保 npm run build 通过

## 验收标准

- [ ] `apps/core/features/` 下只有 planning, execution, business, system, knowledge, shared 六个目录 + 入口文件（index.ts, registry.ts, config.ts, types.ts, tsconfig.json）
- [ ] `npm run build` 成功，无 TypeScript 错误
- [ ] 所有现有页面仍可通过原路径访问（直接或通过 redirect）
- [ ] `apps/dashboard/frontend/src/pages/` 不再包含 CommandCenter, FeatureDashboard, PerformanceMonitoring, ProjectsPage
- [ ] features/index.ts 中 coreFeatures 只注册 5 个域
- [ ] navigation.config.ts 中 autopilotPageComponents 不再引用已迁出的页面
