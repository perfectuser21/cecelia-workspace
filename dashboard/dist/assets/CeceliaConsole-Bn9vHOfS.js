import{r as n,j as e}from"./index-B6elV0yr.js";function S(c){const{url:r,onEvent:a,autoReconnect:l=!0,reconnectDelay:u=3e3}=c,[s,o]=n.useState("disconnected"),[f,t]=n.useState(null),[p,x]=n.useState(null),i=n.useRef(null),m=n.useRef(null),d=n.useRef(!0),j=n.useCallback(()=>{if(i.current)return;o("connecting"),x(null);const g=new EventSource(r);i.current=g,g.onopen=()=>{d.current&&(console.log("SSE: Connected"),o("connected"),x(null))},g.onerror=()=>{d.current&&(console.error("SSE: Connection error"),o("error"),x("Connection failed"),g.close(),i.current=null,l&&d.current&&(m.current=window.setTimeout(()=>{d.current&&(console.log("SSE: Reconnecting..."),j())},u)))},g.onmessage=h=>{if(d.current)try{const y=JSON.parse(h.data),b={type:h.type||"message",data:y,timestamp:new Date().toISOString()};t(b),a==null||a(b)}catch(y){console.error("SSE: Error parsing event data:",y)}},["task.created","task.started","task.checkpoint","task.completed","task.failed","system.status"].forEach(h=>{g.addEventListener(h,y=>{if(d.current)try{const w=JSON.parse(y.data),v={type:h,data:w,timestamp:new Date().toISOString()};t(v),a==null||a(v)}catch(b){console.error(`SSE: Error parsing ${h} event:`,b)}})})},[r,a,l,u]),N=n.useCallback(()=>{m.current&&(clearTimeout(m.current),m.current=null),i.current&&(i.current.close(),i.current=null),o("disconnected")},[]);return n.useEffect(()=>(d.current=!0,j(),()=>{d.current=!1,N()}),[j,N]),{connectionState:s,lastEvent:f,error:p,connect:j,disconnect:N}}function E({onSendMessage:c,messages:r=[],isLoading:a=!1}){const[l,u]=n.useState(""),s=n.useRef(null);n.useEffect(()=>{var t;(t=s.current)==null||t.scrollIntoView({behavior:"smooth"})},[r]);const o=t=>{t.preventDefault(),l.trim()&&c&&(c(l.trim()),u(""))},f=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),o(t))};return e.jsxs("div",{className:"flex flex-col h-full bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 bg-white rounded-t-lg",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Chat with Cecelia"}),e.jsx("p",{className:"text-sm text-gray-500",children:"AI-powered development assistant"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-4",children:[r.length===0&&e.jsxs("div",{className:"text-center text-gray-400 mt-8",children:[e.jsx("p",{children:"Start a conversation with Cecelia"}),e.jsx("p",{className:"text-sm mt-2",children:'Try: "system check" or "帮我实现用户登录"'})]}),r.map(t=>e.jsx("div",{className:`flex ${t.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[80%] px-4 py-2 rounded-lg ${t.role==="user"?"bg-blue-600 text-white":"bg-white text-gray-800 border border-gray-200"}`,children:[e.jsx("p",{className:"whitespace-pre-wrap",children:t.content}),e.jsx("p",{className:`text-xs mt-1 ${t.role==="user"?"text-blue-200":"text-gray-400"}`,children:new Date(t.timestamp).toLocaleTimeString()})]})},t.id)),a&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-white text-gray-800 border border-gray-200 px-4 py-2 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-100"}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce delay-200"})]})})}),e.jsx("div",{ref:s})]}),e.jsx("form",{onSubmit:o,className:"px-4 py-3 border-t border-gray-200 bg-white rounded-b-lg",children:e.jsxs("div",{className:"flex items-end space-x-2",children:[e.jsx("textarea",{value:l,onChange:t=>u(t.target.value),onKeyDown:f,placeholder:"Type your message... (Shift+Enter for new line)",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none",rows:2,disabled:a}),e.jsx("button",{type:"submit",disabled:!l.trim()||a,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Send"})]})})]})}function C({tasks:c=[],connectionState:r}){const a=()=>{switch(r){case"connected":return"bg-green-500";case"connecting":return"bg-yellow-500 animate-pulse";case"error":return"bg-red-500";default:return"bg-gray-400"}};return e.jsxs("div",{className:"flex flex-col h-full bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-200 bg-white rounded-t-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Status"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full "+a()}),e.jsx("span",{className:"text-sm text-gray-600 capitalize",children:r})]})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-3",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700",children:["Running Tasks (",c.length,")"]}),c.length===0&&e.jsx("div",{className:"text-center text-gray-400 mt-8",children:e.jsx("p",{className:"text-sm",children:"No running tasks"})}),c.map(l=>e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"font-medium text-gray-800 text-sm",children:l.name}),e.jsx("span",{className:"text-xs text-gray-500",children:l.status})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:l.progress+"%"}})})]},l.id))]})]})}function D({events:c}){const[r,a]=n.useState(!1),l=n.useRef(null);n.useEffect(()=>{var s;r||(s=l.current)==null||s.scrollIntoView({behavior:"smooth"})},[c,r]);const u=s=>s.includes("completed")?"text-green-600":s.includes("failed")||s.includes("error")?"text-red-600":s.includes("started")||s.includes("created")?"text-blue-600":"text-gray-600";return e.jsxs("div",{className:"bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("div",{className:"px-4 py-2 border-b border-gray-200 bg-white rounded-t-lg cursor-pointer hover:bg-gray-50",onClick:()=>a(!r),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700",children:["Event Feed (",c.length,")"]}),e.jsx("button",{className:"text-gray-500 hover:text-gray-700",children:r?"▼":"▲"})]})}),!r&&e.jsxs("div",{className:"px-4 py-2 max-h-48 overflow-y-auto space-y-2",children:[c.length===0&&e.jsx("p",{className:"text-sm text-gray-400 text-center py-4",children:"No events yet"}),c.map((s,o)=>e.jsxs("div",{className:"text-xs font-mono",children:[e.jsxs("span",{className:"text-gray-400",children:["[",s.timestamp?new Date(s.timestamp).toLocaleTimeString():"now","]"]}),e.jsx("span",{className:"ml-2 font-semibold "+u(s.type),children:s.type}),e.jsx("span",{className:"ml-2 text-gray-600",children:JSON.stringify(s.data).substring(0,100)})]},o)),e.jsx("div",{ref:l})]})]})}function T(){const[c,r]=n.useState([]),[a,l]=n.useState([]),[u,s]=n.useState(!1),{connectionState:o}=S({url:"/api/cecelia/stream",onEvent:n.useCallback(t=>{l(p=>[...p,t].slice(-100))},[])}),f=async t=>{const p={id:Date.now().toString(),role:"user",content:t,timestamp:new Date().toISOString()};r(x=>[...x,p]),s(!0);try{const i=await(await fetch("/api/cecelia/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:t})})).json(),m={id:(Date.now()+1).toString(),role:"assistant",content:i.response||"No response",timestamp:new Date().toISOString()};r(d=>[...d,m])}catch(x){console.error("Error sending message:",x);const i={id:(Date.now()+1).toString(),role:"assistant",content:"Sorry, there was an error processing your message.",timestamp:new Date().toISOString()};r(m=>[...m,i])}finally{s(!1)}};return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-100",children:[e.jsxs("header",{className:"bg-white border-b border-gray-200 px-6 py-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Cecelia Console"}),e.jsx("p",{className:"text-sm text-gray-500",children:"AI-powered development assistant"})]}),e.jsxs("div",{className:"flex-1 overflow-hidden p-6 space-y-4",children:[e.jsxs("div",{className:"flex gap-4 h-[calc(100%-12rem)]",children:[e.jsx("div",{className:"w-[60%]",children:e.jsx(E,{messages:c,onSendMessage:f,isLoading:u})}),e.jsx("div",{className:"w-[40%]",children:e.jsx(C,{tasks:[],connectionState:o})})]}),e.jsx("div",{className:"h-auto",children:e.jsx(D,{events:a})})]})]})}export{T as CeceliaConsole};
