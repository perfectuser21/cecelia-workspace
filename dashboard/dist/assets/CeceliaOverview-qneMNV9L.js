import{r as c,j as e,R as u,Z as I,a as N,e as f,b as w,T as P,aj as M,ak as A,q as b,s as F,l as H}from"./index-B6elV0yr.js";const J=.015;function O(){const[h,v]=c.useState([]),[y,k]=c.useState([]),[j,R]=c.useState(!0),[p,_]=c.useState("7d"),x=async()=>{try{const[s,t]=await Promise.all([fetch("/api/cecelia/overview?limit=200"),fetch("/api/cecelia/projects")]),n=await s.json(),l=await t.json();n.success&&v(n.recent_runs||[]),l.success&&k(l.projects||[])}catch(s){console.error(s)}finally{R(!1)}};c.useEffect(()=>{x();const s=setInterval(x,15e3);return()=>clearInterval(s)},[]);const T=s=>{switch(s){case"24h":return 24;case"72h":return 72;case"7d":return 168;case"30d":return 720}},a=h.filter(s=>{const t=Date.now()-T(p)*60*60*1e3;return new Date(s.started_at).getTime()>=t}),S=a.filter(s=>s.status==="running"),d=a.filter(s=>s.status==="completed"),g=a.filter(s=>s.status==="failed"),D=a.length>0?Math.round(d.length/a.length*100):0,o=a.reduce((s,t)=>s+(t.token_usage||0),0),C=a.length*5e4,$=(o>0?o:C)/1e3*J,i=new Map;y.forEach(s=>i.set(s.name,{info:s,running:0,completed:0,failed:0,total:0})),a.forEach(s=>{let t=i.get(s.project);t||(t={running:0,completed:0,failed:0,total:0},i.set(s.project,t)),t.total++,s.status==="running"&&t.running++,s.status==="completed"&&t.completed++,s.status==="failed"&&t.failed++});const E=Array.from(i.entries()).filter(([,s])=>s.total>0).sort((s,t)=>t[1].total-s[1].total).slice(0,6);return[...d].sort((s,t)=>new Date(t.started_at).getTime()-new Date(s.started_at).getTime()).slice(0,3),[...g].sort((s,t)=>new Date(t.started_at).getTime()-new Date(s.started_at).getTime()).slice(0,2),j&&!h.length?e.jsx("div",{className:"min-h-screen bg-[#191919] flex items-center justify-center",children:e.jsx(u,{className:"w-5 h-5 text-gray-400 animate-spin"})}):e.jsx("div",{className:"min-h-screen bg-[#191919]",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-6 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-white tracking-tight",children:"Engine"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"自动化开发工作流"})]}),e.jsx("button",{onClick:x,className:"p-3 text-gray-500 hover:text-white rounded-xl hover:bg-white/5 transition",children:e.jsx(u,{className:`w-5 h-5 ${j?"animate-spin":""}`})})]}),e.jsxs("div",{className:"bg-gradient-to-r from-[#1a1a2e] to-[#16213e] rounded-2xl p-5 border border-[#2a2a4a] mb-8",children:[e.jsx("div",{className:"flex items-center gap-2 mb-5",children:["24h","72h","7d","30d"].map(s=>e.jsx("button",{onClick:()=>_(s),className:`px-4 py-2 rounded-xl text-sm font-medium transition ${p===s?"bg-blue-500 text-white shadow-lg shadow-blue-500/25":"bg-white/5 text-gray-400 hover:text-white hover:bg-white/10"}`,children:s==="24h"?"24h":s==="72h"?"72h":s==="7d"?"7 天":"30 天"},s))}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5 text-white"}),e.jsx("span",{className:"text-white font-bold text-2xl",children:a.length}),e.jsx("span",{className:"text-gray-400 text-sm",children:"任务"})]}),e.jsx("div",{className:"h-8 w-px bg-[#303030]"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{className:"w-5 h-5 text-blue-400"}),e.jsx("span",{className:"text-blue-400 font-bold text-2xl",children:S.length}),e.jsx("span",{className:"text-gray-400 text-sm",children:"运行中"})]}),e.jsx("div",{className:"h-8 w-px bg-[#303030]"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5 text-green-400"}),e.jsx("span",{className:"text-green-400 font-bold text-2xl",children:d.length}),e.jsx("span",{className:"text-gray-400 text-sm",children:"完成"})]}),e.jsx("div",{className:"h-8 w-px bg-[#303030]"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5 text-red-400"}),e.jsx("span",{className:"text-red-400 font-bold text-2xl",children:g.length}),e.jsx("span",{className:"text-gray-400 text-sm",children:"失败"})]}),e.jsx("div",{className:"h-8 w-px bg-[#303030]"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 text-purple-400"}),e.jsxs("span",{className:"text-purple-400 font-bold text-2xl",children:[D,"%"]}),e.jsx("span",{className:"text-gray-400 text-sm",children:"成功率"})]}),e.jsx("div",{className:"h-8 w-px bg-[#303030]"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5 text-yellow-400"}),e.jsxs("span",{className:"text-yellow-400 font-bold text-xl",children:["$",$.toFixed(2)]}),e.jsx("span",{className:"text-gray-400 text-sm",children:o>0?"":"估算"})]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(A,{className:"w-5 h-5 text-orange-400"}),e.jsx("h2",{className:"text-xl font-semibold text-white",children:"热门项目"})]}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:E.map(([s,{info:t,running:n,completed:l,failed:r,total:m}])=>e.jsxs(b,{to:`/cecelia/project/${encodeURIComponent(s)}`,className:"bg-[#202020] rounded-2xl border border-[#303030] p-5 hover:border-[#404040] transition group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-white font-semibold text-lg truncate",children:s}),e.jsx(F,{className:"w-5 h-5 text-gray-600 group-hover:text-white transition"})]}),(t==null?void 0:t.description)&&e.jsx("p",{className:"text-xs text-gray-500 mb-4 line-clamp-2",children:t.description}),e.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-white font-bold text-xl",children:m}),e.jsx("span",{className:"text-gray-500 ml-1 text-xs",children:"任务"})]}),n>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-blue-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-blue-400 font-medium",children:n}),e.jsx("span",{className:"text-gray-500 text-xs",children:"进行中"})]}),l>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-green-400 font-medium",children:l}),e.jsx("span",{className:"text-gray-500 ml-1 text-xs",children:"完成"})]}),r>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-red-400 font-medium",children:r}),e.jsx("span",{className:"text-gray-500 ml-1 text-xs",children:"失败"})]})]})]},s))})]}),a.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(H,{className:"w-5 h-5 text-blue-400"}),e.jsx("h2",{className:"text-xl font-semibold text-white",children:"关键进展"})]}),e.jsx("div",{className:"bg-[#202020] rounded-2xl border border-[#303030] overflow-hidden",children:[...a].sort((s,t)=>new Date(t.started_at).getTime()-new Date(s.started_at).getTime()).slice(0,10).map((s,t,n)=>{const l=new Date(s.started_at),r=`${l.getMonth()+1}/${l.getDate()}`,m=`${l.getHours().toString().padStart(2,"0")}:${l.getMinutes().toString().padStart(2,"0")}`;return e.jsxs(b,{to:`/cecelia/runs/${s.id}`,className:`flex items-center gap-4 px-5 py-3 hover:bg-white/5 transition ${t<n.length-1?"border-b border-[#303030]":""}`,children:[e.jsxs("div",{className:"flex-shrink-0 w-20 text-sm",children:[e.jsx("span",{className:"text-gray-400",children:r}),e.jsx("span",{className:"text-gray-600 ml-1",children:m})]}),e.jsxs("div",{className:"flex-shrink-0",children:[s.status==="running"&&e.jsx("span",{className:"w-2 h-2 bg-blue-400 rounded-full animate-pulse inline-block"}),s.status==="completed"&&e.jsx(f,{className:"w-4 h-4 text-green-400"}),s.status==="failed"&&e.jsx(w,{className:"w-4 h-4 text-red-400"}),s.status==="pending"&&e.jsx(N,{className:"w-4 h-4 text-gray-500"})]}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("span",{className:`truncate ${s.status==="completed"?"text-gray-400":"text-white"}`,children:s.prd_title||s.feature_branch})}),e.jsx("div",{className:"flex-shrink-0 text-xs text-gray-500",children:s.project}),s.status==="running"&&s.current_step&&e.jsxs("div",{className:"flex-shrink-0 text-xs text-blue-400 font-mono",children:["S",s.current_step]})]},s.id)})})]})]})})}export{O as default};
