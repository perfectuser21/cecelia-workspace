---
id: cp-dashboard-realtime-refresh
version: 1.1.0
created: 2026-01-31
updated: 2026-01-31
changelog:
  - 1.1.0: 修正现状描述，补充 timeRange 重置轮询细节
  - 1.0.0: 初始版本
---

## PRD - Dashboard 实时更新：Seats + Timeline + Task Chain 自动刷新

**需求来源**: Brain 自动调度任务 — OrchestratorPage 只在 mount 时加载一次数据，不会自动刷新；CeceliaOverview 和 CeceliaRuns 已有 setInterval 轮询，但未使用统一的 usePolling hook。

**功能描述**: 为 Dashboard 三个核心视图统一使用 `usePolling` hook 管理自动刷新：
1. **OrchestratorPage** — 当前只在 mount 时 fetchData 一次（`useEffect(() => { fetchData(); }, [fetchData])`），无自动刷新。添加 `usePolling(fetchData, { interval: 10000 })` 实现 10s 轮询。OrchestratorPage 不涉及 timeRange 过滤，这是预期行为。
2. **CeceliaOverview** — 当前已有 `setInterval(loadData, 30000)` 轮询且 useEffect 依赖 `[timeRange]` 正确重新加载。替换为 `usePolling` hook 保持一致性，切换 timeRange 时自动重新加载数据并重置轮询计时器。
3. **CeceliaRuns** — 当前已有 `setInterval(fetchOverview, 5000)` 轮询。替换为 `usePolling` hook 保持一致性。

**涉及文件**:
- `apps/core/features/execution/pages/OrchestratorPage.tsx` — 添加 usePolling 实现 10s 自动刷新
- `apps/core/features/execution/pages/CeceliaOverview.tsx` — 替换手动 setInterval 为 usePolling
- `apps/core/features/execution/pages/CeceliaRuns.tsx` — 替换手动 setInterval 为 usePolling

**成功标准**:
- [ ] OrchestratorPage 使用 usePolling hook，每 10 秒自动刷新 Seats、OKR、Projects、Tasks 数据
- [ ] CeceliaOverview 使用 usePolling hook 替代手动 setInterval，30s 刷新间隔不变
- [ ] CeceliaRuns 使用 usePolling hook 替代手动 setInterval，5s 刷新间隔不变
- [ ] 切换 timeRange 时 CeceliaOverview 立即重新加载数据并重置轮询计时器（usePolling 的 enabled/interval 随 timeRange 变化重新初始化）
- [ ] 所有页面卸载时正确清理轮询（usePolling 内部 useEffect cleanup 清除 interval）

**非目标**:
- 不实现 SSE/WebSocket 推送（轮询已满足需求）
- 不修改 API 端点
- 不改变 UI 布局或样式
