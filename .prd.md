---
id: prd-swr-loading
version: 1.0.0
created: 2026-02-06
updated: 2026-02-06
changelog:
  - 1.0.0: 初始版本
---

# PRD: 前端加载体验优化（SWR + 骨架屏）

## 背景

当前页面切换体验差：切换 tab 时全屏转圈 4-8 秒。原因：
1. 每次切页面都重新请求所有 API（无缓存）
2. 等全部 API 返回才显示内容（all-or-nothing）
3. 等待时显示空白 + 转圈（无骨架屏）

国内主流应用（飞书、美团、掘金）使用 SWR（stale-while-revalidate）模式：
- 先显示缓存数据，后台静默刷新
- 骨架屏替代空白转圈
- 数据到一个渲染一个

## 目标

| 指标 | 现状 | 目标 |
|------|------|------|
| 首次页面切换 | 4-8s 转圈 | <1s 骨架屏 + 渐进加载 |
| 切回已访问页 | 3-5s 重新加载 | <300ms 秒开（缓存） |
| 感知等待 | 空白 + spinner | 骨架屏 + 渐进渲染 |

## 功能需求

### F1: 轻量 SWR 缓存 Hook

创建 `useApi` hook，实现：
- 内存缓存 + 可配置 staleTime（默认 60s）
- 首次请求：返回 loading + 发请求
- 再次请求（缓存未过期）：立即返回缓存数据 + 后台刷新
- 多组件调用同一 API 时自动去重
- 不引入新依赖（自研轻量方案）

### F2: 骨架屏组件

为主要页面创建骨架屏：
- CommandCenter 骨架屏（状态卡片 + OKR 列表 + 集群状态）
- 通用卡片骨架屏（复用现有 SkeletonCard）
- 列表骨架屏

### F3: 渐进式渲染

CommandCenter 改为数据到一个渲染一个：
- 不再 Promise.all 等全部
- 每个数据区块独立 loading 状态
- 快的先显示，慢的后显示

## 非功能需求

- 不引入新 npm 依赖
- 不改变 API 接口
- 向后兼容：不影响现有功能

## 影响范围

- `features/shared/hooks/useApi.ts`（新建）
- `features/shared/components/Skeleton.tsx`（新建）
- `features/business/pages/CommandCenter.tsx`（重构加载逻辑）
- `features/daily/pages/TodayView.tsx`（接入 useApi）
- `features/execution/pages/CeceliaOverview.tsx`（接入 useApi）

## 验收标准

1. 切到已访问页面时，缓存数据立即显示，无 spinner
2. 首次访问页面时，骨架屏在 200ms 内出现
3. CommandCenter 的数据区块独立加载，快的先显示
4. 构建通过（npm run build）
