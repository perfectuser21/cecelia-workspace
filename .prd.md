---
id: prd-project-state-machine
version: 1.0.0
created: 2026-01-31
updated: 2026-01-31
changelog:
  - 1.0.0: 初始版本
---

## PRD - 项目状态机

**需求来源**: Milestone 3: 项目生命周期管理 (KR3) - 第1项需求

**功能描述**:
为项目添加状态机，定义4个有效状态（planning → active → reviewing → completed）及合法状态转换。在 PATCH 更新 status 时验证转换合法性，新增 `POST /api/tasks/projects/:id/transition` 端点执行状态转换并记录历史。新建项目默认状态从 `active` 改为 `planning`。

**状态转换规则**:
- planning → active
- active → reviewing
- active → planning（回退）
- reviewing → completed
- reviewing → active（回退）

**涉及文件**:
- `apps/core/src/task-system/projects.js` — 添加状态机验证和 transition 端点
- `apps/core/src/task-system/__tests__/project-state-machine.test.js` — 新增测试

**成功标准**:
- [ ] PATCH status 时验证状态转换合法性，非法转换返回 400
- [ ] `POST /:id/transition` 端点执行状态转换，body 含 `{ status: "active" }`
- [ ] 新建项目默认状态为 `planning`
- [ ] 非法状态值返回 400
- [ ] 项目不存在返回 404
- [ ] 所有测试通过

**非目标**:
- 不创建 status_history 表（状态变更记录留给后续）
- 不修改已有端点的其他逻辑
