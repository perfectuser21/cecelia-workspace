---
id: prd-trd-template-engine
version: 1.0.0
created: 2026-01-31
updated: 2026-01-31
changelog:
  - 1.0.0: 初始版本
---

# PRD - TRD 模板引擎升级

## 需求来源

KR: PRD/TRD 自动生成与模板标准化 (Planner V3 auto-generated)
Project: cecelia-workspace

当前 `templates.js` 中的 TRD 模板引擎与标准模板 (`prds/templates/TRD-TEMPLATE.md`) 不一致：
- `TRD_TEMPLATE` 常量只有 5 个 section，标准模板有 8 个 section
- `renderTrd()` 生成的 TRD 缺少"PRD 拆解"、"技术决策"、"验收标准"等关键 section
- `validateTrd()` 只校验 5 个旧 section
- 缺少 `generateTrdFromGoalKR()` — KR 上下文感知的 TRD 生成器

## 功能描述

对齐 `templates.js` 中的 TRD 引擎与 `prds/templates/TRD-TEMPLATE.md` 标准：

### 1. 升级 TRD_TEMPLATE 常量

从 5 section 扩展到 8 section：
- overview（概述）— required
- system_architecture（系统架构）— required
- data_model（数据模型）— required
- prd_decomposition（PRD 拆解）— optional
- api_design（接口设计）— required
- technical_decisions（技术决策）— optional
- acceptance_criteria（验收标准）— required
- appendix（附录）— optional

### 2. 升级 renderTrd()

生成完整 8 section TRD markdown，包含：
- 概述（目标、背景、范围）
- 系统架构（架构图、组件说明表）
- 数据模型（SQL schema、数据流图）
- PRD 拆解（依赖图、PRD 清单表）
- 接口设计（API 端点表、请求/响应示例）
- 技术决策（决策记录表、风险表）
- 验收标准（功能/技术/集成三类检查清单）
- 附录（相关文档、变更日志表）

### 3. 升级 validateTrd()

校验新增 required section：概述、系统架构、接口设计、验收标准。保留原有 API 设计 → 接口设计、技术背景 → 概述的兼容映射。

### 4. 新增 generateTrdFromGoalKR()

接收 `{ title, description, kr, project, milestones }` 参数，生成包含 KR 元数据的 TRD。类似 `generatePrdFromGoalKR()` 的模式。

### 5. 更新 trdToJson()

解析新的 8 section 结构到 JSON。

## 涉及文件

- `apps/core/src/brain/templates.js` — 主要修改
- `apps/core/src/brain/__tests__/templates.test.js` — 测试更新

## 成功标准

- [ ] `TRD_TEMPLATE` 包含 8 个 section 定义
- [ ] `renderTrd()` 生成的 TRD 包含全部 8 个 section 且通过 `validateTrd()` 校验
- [ ] `validateTrd()` 检查新的 5 个 required section（概述、系统架构、数据模型、接口设计、验收标准）
- [ ] `generateTrdFromGoalKR({ title, kr, project })` 生成包含 KR 元数据的 TRD
- [ ] `trdToJson()` 能解析 8 section TRD 返回完整 JSON
- [ ] 所有既有测试继续通过（或适配更新）
- [ ] 新功能有对应的单元测试覆盖

## 非目标

- 不修改 PRD 相关函数（renderPrd, validatePrd, generatePrdFromGoalKR 等）
- 不修改 decomposer.js
- 不修改 planner.js
- 不新增 API 端点
