---
id: prd-kr2-prd-trd-validation
version: 1.0.0
created: 2026-01-31
updated: 2026-01-31
changelog:
  - 1.0.0: 初始版本
---

## PRD - PRD/TRD 验证功能（KR2 标准化补全）

**需求来源**: Nightly Planner 自动生成任务，推进 KR2: PRD/TRD 自动生成（标准化）。当前模板生成已完成，缺少验证环节。

**功能描述**: 为 Brain 模块添加 PRD/TRD 文档验证功能，检查生成的文档是否符合标准模板的必填字段和结构要求。包括：
1. `validatePrd(content)` - 验证 PRD 内容是否包含所有必需 section（背景、目标、功能需求、非功能需求、验收标准、里程碑）
2. `validateTrd(content)` - 验证 TRD 内容是否包含所有必需 section（技术背景、架构设计、API 设计、数据模型、测试策略）
3. `POST /api/brain/validate/prd` - PRD 验证 API 端点
4. `POST /api/brain/validate/trd` - TRD 验证 API 端点

**涉及文件**:
- `apps/core/src/brain/templates.js` - 添加 validatePrd、validateTrd 函数
- `apps/core/src/brain/routes.js` - 添加 validate API 端点
- `apps/core/src/brain/__tests__/templates.test.js` - 添加验证函数测试

**成功标准**:
- validatePrd 对包含所有 6 个 section 的 PRD 返回 `{ valid: true, errors: [] }`
- validatePrd 对缺少 section 的 PRD 返回 `{ valid: false, errors: ["Missing section: 背景"] }`
- validateTrd 对包含所有 5 个 section 的 TRD 返回 `{ valid: true, errors: [] }`
- POST /api/brain/validate/prd 返回 200 + 验证结果
- POST /api/brain/validate/trd 返回 200 + 验证结果
- 缺少 content 参数时返回 400
- 现有测试继续通过

**非目标**:
- 不做 AI 辅助的内容质量评分
- 不修改现有的 generate 端点
- 不添加 PRD/TRD 持久化存储
