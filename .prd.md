# PRD - OKR ä¸‰å±‚æ¶æ„å‰ç«¯ UI (Phase 2)

## 1. æ¦‚è¿°

**ç›®æ ‡**ï¼šä¸º Phase 1 å·²å®Œæˆçš„ OKR ä¸‰å±‚æ¶æ„æä¾›å®Œæ•´çš„å‰ç«¯äº¤äº’ç•Œé¢ã€‚

**Phase 1 æˆæœ**ï¼š
- âœ… æ•°æ®åº“è¡¨ï¼šbusinesses, departments, goals (å¢å¼º)
- âœ… åç«¯ APIï¼šå®Œæ•´ CRUD for businesses/departments/goals
- âœ… ä¸‰å±‚æ¶æ„ï¼šPersonal OKR (3æœˆ) â†’ Business OKR (1æœˆ) â†’ Department OKR (2å‘¨)
- âœ… æ—¶é—´è¿½è¸ªï¼šexpected_start_date, expected_end_date, actual_start_date, actual_end_date

**Phase 2 ç›®æ ‡**ï¼š
- Business/Department ç®¡ç†ç•Œé¢ï¼ˆCRUDï¼‰
- OKR ä¸‰å±‚è§†å›¾ï¼ˆæ ‘å½¢/çœ‹æ¿ï¼‰
- æ—¶é—´è¿½è¸ªå¯è§†åŒ–
- é›†æˆåˆ° /work è·¯ç”±

---

## 2. åŠŸèƒ½éœ€æ±‚

### 2.1 Business ç®¡ç†é¡µé¢

**è·¯ç”±**: `/work/businesses`

**åŠŸèƒ½**ï¼š
- è¡¨æ ¼å±•ç¤ºæ‰€æœ‰ Businessï¼ˆStock, ZenithJoyï¼‰
- åˆ—ï¼šName, Owner, Description, Status, Departments Count, Created
- CRUD æ“ä½œï¼š
  - Createï¼šå¼¹çª—è¡¨å•ï¼ˆname, description, owner, statusï¼‰
  - Editï¼šå†…è”ç¼–è¾‘æˆ–å¼¹çª—
  - Deleteï¼šå¸¦ç¡®è®¤æç¤º
- ç‚¹å‡» Business â†’ è·³è½¬åˆ°è¯¥ Business çš„ Departments åˆ—è¡¨

**API**ï¼š
- `GET /api/tasks/businesses` - åˆ—è¡¨
- `POST /api/tasks/businesses` - åˆ›å»º
- `PATCH /api/tasks/businesses/:id` - æ›´æ–°
- `DELETE /api/tasks/businesses/:id` - åˆ é™¤

---

### 2.2 Department ç®¡ç†é¡µé¢

**è·¯ç”±**: `/work/departments` æˆ– `/work/businesses/:id/departments`

**åŠŸèƒ½**ï¼š
- æŒ‰ Business åˆ†ç»„å±•ç¤ºæ‰€æœ‰ Departments
- åˆ—ï¼šName, Business, Lead, Description, OKRs Count, Created
- CRUD æ“ä½œï¼š
  - Createï¼šé€‰æ‹© Businessï¼Œå¡«å†™ name/lead/description
  - Editï¼šå†…è”æˆ–å¼¹çª—
  - Deleteï¼šå¸¦ç¡®è®¤
- ç­›é€‰ï¼šæŒ‰ Business è¿‡æ»¤

**API**ï¼š
- `GET /api/tasks/departments?business_id=xxx` - åˆ—è¡¨ï¼ˆæ”¯æŒè¿‡æ»¤ï¼‰
- `POST /api/tasks/departments` - åˆ›å»º
- `PATCH /api/tasks/departments/:id` - æ›´æ–°
- `DELETE /api/tasks/departments/:id` - åˆ é™¤

---

### 2.3 OKR ä¸‰å±‚è§†å›¾

**è·¯ç”±**: `/work/okr-hierarchy` (æ–°å¢)

**è§†å›¾æ¨¡å¼**ï¼š
1. **æ ‘å½¢è§†å›¾**ï¼ˆé»˜è®¤ï¼‰
   - å±•ç¤º Personal O â†’ Business O â†’ Department O å±‚çº§
   - å¯æŠ˜å /å±•å¼€æ¯ä¸€å±‚
   - æ˜¾ç¤ºè¿›åº¦æ¡ã€ä¼˜å…ˆçº§ã€çŠ¶æ€
   - ç‚¹å‡»èŠ‚ç‚¹ â†’ æŸ¥çœ‹/ç¼–è¾‘è¯¦æƒ…

2. **çœ‹æ¿è§†å›¾**
   - ä¸‰åˆ—ï¼šPersonal | Business | Department
   - æ¯åˆ—æŒ‰ scope è¿‡æ»¤ goals
   - æ‹–æ‹½è·¨åˆ— = æ”¹å˜ scopeï¼ˆå¦‚æœéœ€è¦ï¼‰

**æ•°æ®æ¥æº**ï¼š
- `GET /api/tasks/goals?scope=personal` - Personal OKRs
- `GET /api/tasks/goals?scope=business` - Business OKRs
- `GET /api/tasks/goals?scope=department` - Department OKRs
- é€šè¿‡ `parent_id` å»ºç«‹å±‚çº§å…³ç³»

**æ˜¾ç¤ºå­—æ®µ**ï¼š
- Title, Progress, Status, Priority
- Business/Department åç§°ï¼ˆåµŒå¥—å¯¹è±¡ï¼‰
- Cycle (3months/1month/2weeks)
- æ—¶é—´èŒƒå›´ï¼ˆexpected_start_date ~ expected_end_dateï¼‰

---

### 2.4 æ—¶é—´è¿½è¸ªå¯è§†åŒ–

**é›†æˆä½ç½®**: OKR è¯¦æƒ…é¡µ / OKR ä¸‰å±‚è§†å›¾ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹

**æ˜¾ç¤ºå†…å®¹**ï¼š
- **é¢„æœŸæ—¶é—´çº¿**ï¼šexpected_start_date â†’ expected_end_dateï¼ˆç°è‰²åº•è‰²ï¼‰
- **å®é™…æ—¶é—´çº¿**ï¼šactual_start_date â†’ actual_end_dateï¼ˆå½©è‰²è¦†ç›–ï¼‰
- **æ—¶é—´åå·®æŒ‡ç¤º**ï¼š
  - æå‰å®Œæˆï¼šç»¿è‰²
  - å»¶æœŸï¼šçº¢è‰²
  - è¿›è¡Œä¸­ï¼šè“è‰²

**å¯è§†åŒ–ç»„ä»¶**ï¼š
- ç”˜ç‰¹å›¾æ ·å¼çš„æ—¶é—´æ¡
- æˆ– ç®€å•çš„æ—¥æœŸå¯¹æ¯”è¡¨æ ¼ï¼š
  ```
  | ç±»å‹ | é¢„æœŸå¼€å§‹ | é¢„æœŸç»“æŸ | å®é™…å¼€å§‹ | å®é™…ç»“æŸ | åå·® |
  |------|----------|----------|----------|----------|------|
  | Personal O | 2026-01-01 | 2026-03-31 | 2026-01-02 | - | +1å¤© |
  ```

---

### 2.5 é›†æˆåˆ° /work è·¯ç”±

**ç°æœ‰ WorkTabbed.tsx tabs**ï¼š
- Projects (`/work`)
- OKR (`/work/okr`)
- Roadmap (`/work/roadmap`)
- Features (`/work/features`)
- **Tasks** (`/work/tasks`)

**æ–°å¢ tabs**ï¼ˆä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼‰ï¼š

**æ–¹æ¡ˆ Aï¼šæ›¿æ¢ç°æœ‰ OKR tab**
- `/work/okr` â†’ æ›¿æ¢ä¸º OKR ä¸‰å±‚è§†å›¾
- ä¿ç•™ Businesses/Departments ä½œä¸ºç‹¬ç«‹ tab

**æ–¹æ¡ˆ Bï¼šæ–°å¢ç‹¬ç«‹ tabs**
- OKR (ä¿æŒç°çŠ¶)
- **OKR Hierarchy** (`/work/okr-hierarchy`) - ä¸‰å±‚è§†å›¾
- **Businesses** (`/work/businesses`)
- **Departments** (`/work/departments`)

**æ¨è**ï¼šæ–¹æ¡ˆ Aï¼ˆæ›¿æ¢ç°æœ‰ OKR tabï¼‰ï¼Œå› ä¸ºä¸‰å±‚è§†å›¾æ›´ç¬¦åˆç”¨æˆ·éœ€æ±‚ã€‚

---

## 3. æŠ€æœ¯å®ç°

### 3.1 æ–°å»ºæ–‡ä»¶

```
apps/core/features/
â”œâ”€â”€ planning/
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ BusinessManagement.tsx        # Business CRUD é¡µé¢
â”‚   â”‚   â”œâ”€â”€ DepartmentManagement.tsx      # Department CRUD é¡µé¢
â”‚   â”‚   â””â”€â”€ OKRHierarchyView.tsx         # OKR ä¸‰å±‚è§†å›¾
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ BusinessForm.tsx             # Business è¡¨å•å¼¹çª—
â”‚   â”‚   â”œâ”€â”€ DepartmentForm.tsx           # Department è¡¨å•å¼¹çª—
â”‚   â”‚   â”œâ”€â”€ OKRTreeView.tsx              # æ ‘å½¢è§†å›¾ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ OKRBoardView.tsx             # çœ‹æ¿è§†å›¾ç»„ä»¶
â”‚   â”‚   â””â”€â”€ TimeTrackingView.tsx         # æ—¶é—´è¿½è¸ªç»„ä»¶
â”‚   â””â”€â”€ api/
â”‚       â”œâ”€â”€ businesses.api.ts            # Business API è°ƒç”¨
â”‚       â””â”€â”€ departments.api.ts           # Department API è°ƒç”¨
â””â”€â”€ work/
    â””â”€â”€ pages/
        â””â”€â”€ WorkTabbed.tsx               # ä¿®æ”¹ï¼šæ–°å¢ tabs
```

### 3.2 API å°è£…

**`businesses.api.ts`**:
```typescript
export const fetchBusinesses = () => fetch('/api/tasks/businesses').then(r => r.json());
export const createBusiness = (data) => fetch('/api/tasks/businesses', { method: 'POST', body: JSON.stringify(data) });
export const updateBusiness = (id, data) => fetch(`/api/tasks/businesses/${id}`, { method: 'PATCH', body: JSON.stringify(data) });
export const deleteBusiness = (id) => fetch(`/api/tasks/businesses/${id}`, { method: 'DELETE' });
```

**`departments.api.ts`**: åŒä¸Š

### 3.3 å¤ç”¨ç°æœ‰ç»„ä»¶

- `shared/components/TabbedPage.tsx` - tab å¯¼èˆª
- `shared/components/LoadingState.tsx` - éª¨æ¶å±
- `shared/hooks/useApi.ts` - SWR-like ç¼“å­˜
- Notion-style è‰²å½©ç³»ç»Ÿï¼ˆPR #272ï¼‰
- æ‹–æ‹½ï¼š`@hello-pangea/dnd`ï¼ˆTaskDatabase å·²ä½¿ç”¨ï¼‰

---

## 4. UI/UX è®¾è®¡

### 4.1 Business ç®¡ç†é¡µé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Businesses                                  [+ New]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Name       â”‚ Owner    â”‚ Depts â”‚ Status â”‚ Created       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Stock      â”‚ Alex Xu  â”‚ 0     â”‚ Active â”‚ 2026-02-07   â”‚
â”‚ ZenithJoy  â”‚ Alex Xu  â”‚ 2     â”‚ Active â”‚ 2026-02-07   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 OKR ä¸‰å±‚è§†å›¾ï¼ˆæ ‘å½¢ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OKR Hierarchy             [Tree View] [Board View]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“‹ Personal OKR (3 months)                                 â”‚
â”‚   â”œâ”€ ğŸ¯ Q1 2026 ä¸ªäººæˆé•¿ç›®æ ‡ [20%] P0                      â”‚
â”‚   â”‚   â”œâ”€ ğŸ“Š å®Œæˆ Stock é€‰è‚¡ç³»ç»Ÿ MVP [30%] â†’ Stock         â”‚
â”‚   â”‚       â””â”€ ğŸ¢ 2æœˆä»½ Stock æ ¸å¿ƒåŠŸèƒ½ [15%] â†’ (Business)   â”‚
â”‚   â”‚           â””â”€ ğŸ‘¥ Tech Team 2æœˆä¸Šæ—¬å†²åˆº [40%] (Dept)    â”‚
â”‚   â””â”€ ğŸ¯ æå‡æŠ€æœ¯èƒ½åŠ› [10%] P1                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 æ—¶é—´è¿½è¸ª

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Time Tracking: Q1 2026 ä¸ªäººæˆé•¿ç›®æ ‡        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Expected: 2026-01-01 â†’ 2026-03-31 (90å¤©) â”‚
â”‚ Actual:   2026-01-02 â†’ (è¿›è¡Œä¸­)          â”‚
â”‚ Deviation: +1å¤© (å»¶è¿Ÿå¯åŠ¨)                â”‚
â”‚                                          â”‚
â”‚ Timeline:                                â”‚
â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ (Expected)         â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ (Actual 20%)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. éªŒæ”¶æ ‡å‡† (DoD)

### 5.1 Business ç®¡ç†

- [ ] èƒ½æŸ¥çœ‹æ‰€æœ‰ Business åˆ—è¡¨
- [ ] èƒ½åˆ›å»ºæ–° Businessï¼ˆå¿…å¡«ï¼šnameï¼Œé€‰å¡«ï¼šowner, description, statusï¼‰
- [ ] èƒ½ç¼–è¾‘ Business ä¿¡æ¯
- [ ] èƒ½åˆ é™¤ Businessï¼ˆå¸¦ç¡®è®¤æç¤ºï¼‰
- [ ] åˆ é™¤ Business æ—¶ï¼Œå…³è” Departments çš„ business_id è‡ªåŠ¨è®¾ä¸º NULLï¼ˆæ•°æ®åº“ CASCADEï¼‰

### 5.2 Department ç®¡ç†

- [ ] èƒ½æŸ¥çœ‹æ‰€æœ‰ Department åˆ—è¡¨
- [ ] èƒ½æŒ‰ Business è¿‡æ»¤ Departments
- [ ] èƒ½åˆ›å»ºæ–° Departmentï¼ˆå¿…å¡«ï¼šname, business_idï¼Œé€‰å¡«ï¼šlead, descriptionï¼‰
- [ ] èƒ½ç¼–è¾‘ Department ä¿¡æ¯
- [ ] èƒ½åˆ é™¤ Departmentï¼ˆå¸¦ç¡®è®¤æç¤ºï¼‰

### 5.3 OKR ä¸‰å±‚è§†å›¾

- [ ] æ ‘å½¢è§†å›¾èƒ½æ­£ç¡®å±•ç¤º Personal â†’ Business â†’ Department å±‚çº§
- [ ] èƒ½æŠ˜å /å±•å¼€æ¯ä¸€å±‚
- [ ] æ˜¾ç¤ºè¿›åº¦æ¡ã€çŠ¶æ€ã€ä¼˜å…ˆçº§ã€Business/Department åç§°
- [ ] çœ‹æ¿è§†å›¾æŒ‰ scope åˆ†ä¸‰åˆ—
- [ ] ç‚¹å‡» OKR èŠ‚ç‚¹èƒ½æŸ¥çœ‹è¯¦æƒ…ï¼ˆåŒ…å«æ—¶é—´è¿½è¸ªï¼‰

### 5.4 æ—¶é—´è¿½è¸ª

- [ ] æ˜¾ç¤ºé¢„æœŸå¼€å§‹/ç»“æŸæ—¥æœŸ
- [ ] æ˜¾ç¤ºå®é™…å¼€å§‹/ç»“æŸæ—¥æœŸ
- [ ] è®¡ç®—æ—¶é—´åå·®ï¼ˆæå‰/å»¶æœŸå¤©æ•°ï¼‰
- [ ] ç”¨é¢œè‰²åŒºåˆ†çŠ¶æ€ï¼ˆç»¿è‰²=æå‰ï¼Œçº¢è‰²=å»¶æœŸï¼Œè“è‰²=è¿›è¡Œä¸­ï¼‰

### 5.5 é›†æˆ

- [ ] æ–°å¢ tabs é›†æˆåˆ° `/work` è·¯ç”±
- [ ] URL æ­£ç¡®åŒæ­¥ï¼ˆuseLocation/useNavigateï¼‰
- [ ] é¡µé¢é—´å¯¼èˆªæµç•…ï¼ˆBusiness â†’ Departments, OKR è¯¦æƒ…ï¼‰

### 5.6 å‰ç«¯æ„å»º

- [ ] `npm run build` é€šè¿‡
- [ ] æ—  TypeScript é”™è¯¯
- [ ] æ—  ESLint è­¦å‘Š
- [ ] é¡µé¢åŠ è½½æ­£å¸¸ï¼Œæ— ç™½å±

---

## 6. éåŠŸèƒ½éœ€æ±‚

- **æ€§èƒ½**ï¼šuseApi hook ç¼“å­˜ï¼Œé¿å…é‡å¤è¯·æ±‚
- **UX**ï¼šNotion-style è‰²å½©ï¼Œå¹³æ»‘è¿‡æ¸¡åŠ¨ç”»ï¼ˆ20msï¼‰
- **å“åº”å¼**ï¼šæ”¯æŒ 1440px+ å®½å±æ˜¾ç¤º
- **å¯è®¿é—®æ€§**ï¼šè¯­ä¹‰åŒ– HTMLï¼ŒARIA labels
- **é”™è¯¯å¤„ç†**ï¼šAPI å¤±è´¥æ—¶æ˜¾ç¤ºé”™è¯¯æç¤º

---

## 7. åç»­ä¼˜åŒ–ï¼ˆä¸åœ¨æœ¬æ¬¡èŒƒå›´ï¼‰

- ç”˜ç‰¹å›¾è§†å›¾ï¼ˆTimelineï¼‰
- æ—¥å†è§†å›¾ï¼ˆCalendarï¼‰
- OKR è¿›åº¦ä»ªè¡¨ç›˜
- æ‰¹é‡æ“ä½œï¼ˆæ‰¹é‡åˆ›å»º Departmentsï¼‰
- å¯¼å‡ºåŠŸèƒ½ï¼ˆExcel/PDFï¼‰
