# PRD: Notion 风格 Block 编辑器

## 需求来源

用户需求：为 OKR 系统添加 Notion 风格的富文本编辑能力，让 Goal/Task/Project 可以包含结构化内容。

## 功能描述

在 cecelia-workspace 前端实现 Block 编辑器组件，支持：
- 5 种 block 类型（text/heading/list/code/callout）
- 拖拽排序
- 与后端 Blocks API 完整对接

## 影响范围

新增文件：
- `src/components/blocks/BlockEditor.tsx` - 主编辑器
- `src/components/blocks/Block.tsx` - 单个 block
- `src/components/blocks/BlockMenu.tsx` - 命令菜单
- `src/components/blocks/blocks/*.tsx` - 各类型 block 组件
- `src/components/blocks/hooks/useBlocks.ts` - API hooks
- `src/components/blocks/types.ts` - 类型定义

修改文件：
- Goal 详情页组件
- Task 详情页组件
- Project 详情页组件

## 非目标

- 不实现协同编辑（多人同时编辑）
- 不实现 @ 提及功能
- 不实现图片/附件上传
- 不实现嵌套 block（block 内嵌 block）

## 背景

后端 Blocks API 已就绪（`/api/brain/blocks/*`），支持：
- GET `/api/brain/blocks/:parentType/:parentId` - 获取 blocks
- POST `/api/brain/blocks` - 创建 block
- PUT `/api/brain/blocks/:id` - 更新 block
- PUT `/api/brain/blocks/reorder` - 批量排序
- DELETE `/api/brain/blocks/:id` - 删除 block

## 功能需求

### 1. Block 类型

| 类型 | 说明 | 样式 |
|------|------|------|
| text | 普通文本 | 默认段落 |
| heading | 标题 | h1/h2/h3 |
| list | 列表 | 有序/无序 |
| code | 代码块 | 等宽字体 + 语法高亮 |
| callout | 提示框 | 带图标的醒目区块 |

### 2. 核心交互

- **添加 Block**：点击 "+" 按钮或在空行回车
- **编辑 Block**：点击 block 进入编辑模式
- **删除 Block**：hover 显示删除按钮，或 Backspace 删除空 block
- **拖拽排序**：拖动 handle 调整顺序
- **类型切换**：输入 "/" 触发命令面板

### 3. 集成位置

- Goal 详情页：展示/编辑 Goal 描述
- Task 详情页：展示/编辑 Task 详情
- Project 详情页：展示/编辑 Project 文档

## 技术方案

### 组件结构

```
src/components/blocks/
├── BlockEditor.tsx      # 主编辑器容器
├── Block.tsx            # 单个 block 组件
├── BlockMenu.tsx        # "/" 命令菜单
├── blocks/
│   ├── TextBlock.tsx
│   ├── HeadingBlock.tsx
│   ├── ListBlock.tsx
│   ├── CodeBlock.tsx
│   └── CalloutBlock.tsx
├── hooks/
│   └── useBlocks.ts     # blocks CRUD + 排序
└── types.ts             # TypeScript 类型
```

### 依赖

- `@dnd-kit/core` + `@dnd-kit/sortable` - 拖拽排序
- `prismjs` 或内置语法高亮 - 代码块

### API 对接

```typescript
// hooks/useBlocks.ts
const useBlocks = (parentType: string, parentId: string) => {
  // GET blocks
  // POST create
  // PUT update
  // PUT reorder
  // DELETE block
}
```

## 成功标准

1. **Block 创建**：点击 "+" 按钮可选择并创建 5 种类型 block
2. **Block 编辑**：点击 block 可编辑内容，blur 时自动保存
3. **Block 删除**：点击删除按钮移除 block，API 同步删除
4. **拖拽排序**：拖动 handle 可调整顺序，松开时 API 同步
5. **API 同步**：所有操作实时同步到后端，刷新页面数据不丢失
6. **集成验证**：在 Goal 详情页展示并可编辑 blocks
7. **响应式**：移动端（< 768px）布局正常，可操作
