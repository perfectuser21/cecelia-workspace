---
id: prd-kr2-prd-standardization
version: 1.0.0
created: 2026-01-31
updated: 2026-01-31
changelog:
  - 1.0.0: 初始版本
---

## PRD - PRD/TRD 自动生成标准化：验证端点 + 类型模板

**需求来源**: KR2 目标 (277ef562) "PRD/TRD 自动生成（标准化）"，当前进度 30%。已有模板引擎和基础生成，缺少验证端点暴露和类型区分。

**功能描述**:

1. **实现 PRD 验证函数并暴露 API 端点**: 在 `templates.js` 中实现 `validatePrd(content, type)` 函数，检查 frontmatter 和必需 sections。在 `routes.js` 中添加 `POST /api/brain/validate/prd` 端点。

2. **类型特定 PRD 模板**: 当前 `renderPrd()` 不区分类型，对所有 PRD 使用同一模板。修改 `renderPrd()` 根据 `type` 参数生成不同 sections：
   - `feature`: 添加用户故事(User Stories)和影响分析(Impact Analysis)
   - `bugfix`: 添加复现步骤(Reproduction Steps)和根因分析(Root Cause)
   - `refactor`: 添加变更范围(Scope of Changes)和回滚计划(Rollback Plan)

3. **增强验证评分**: `validatePrd(content, type)` 验证规则：
   - **通用必需 sections**（所有类型）: 需求来源, 功能描述, 成功标准, 非目标
   - **feature 额外必需**: 用户故事, 影响分析
   - **bugfix 额外必需**: 复现步骤, 根因分析
   - **refactor 额外必需**: 变更范围, 回滚计划
   - **评分算法**: `score = 存在的必需sections / 该类型总必需sections`，`valid = score >= 0.6 且 frontmatter 完整`
   - **向后兼容**: `type` 参数可选，不传则只检查通用 sections

**涉及文件**:
- `apps/core/src/brain/templates.js` — 模板函数和验证逻辑
- `apps/core/src/brain/routes.js` — 添加验证路由

**成功标准**:
- `POST /api/brain/validate/prd` 端点可用，接收 `{ content: "..." }` 返回 `{ valid, score, missing_fields }`
- `POST /api/brain/generate/prd` 传入 `type: "bugfix"` 时，生成的 PRD 包含"复现步骤"和"根因分析" section
- `POST /api/brain/generate/prd` 传入 `type: "refactor"` 时，生成的 PRD 包含"变更范围"和"回滚计划" section
- `validatePrd()` 对 bugfix 类型 PRD 缺少"复现步骤"时返回 `valid: false`
- 现有 feature 类型 PRD 生成不受影响（向后兼容）

**非目标**:
- 不做 AI/NLP 模糊检测（如歧义检测、scope creep 检测）
- 不做 TRD 验证端点（后续任务）
- 不修改数据库 schema
- 不做前端界面
