# PRD - Platform Data Feature 架构迁移

## 需求来源

用户需求："创建 platform-data Feature 架构：在 cecelia-workspace 的 apps/features/ 下创建 platform-data 目录结构，实现 Feature-level Skill 入口，并迁移 scraper/analyzer/publisher 三个 workflows"

## 问题背景

当前状态（混乱）：
1. platform-scrapers 是独立 repo (`/home/xx/platform-scrapers/`)
2. social-media-analysis skill 在 `~/.claude/skills/` 实体目录
3. toutiao-publisher skill 在 `~/.claude/skills/` 实体目录
4. 三个 workflows 分散，没有统一管理

痛点：
- 修改一个 feature 要跨多个 repo
- 没有 feature 层级的统一入口
- skills 分散，不易管理

## 功能描述

创建 Feature-based 架构：

**目标结构**：
```
apps/features/platform-data/
├── skill/                          # Feature-level Skill 统一入口
│   ├── SKILL.md                    # Skill 文档
│   ├── command.sh                  # 路由脚本（scrape/analyze/publish子命令）
│   └── subcommands/
│       ├── scrape.sh
│       ├── analyze.sh
│       └── publish.sh
│
├── workflows/                      # 三个 workflows
│   ├── scraper/
│   │   ├── scripts/                # 从 /home/xx/platform-scrapers/ 迁移
│   │   │   ├── scraper-douyin-v3.js
│   │   │   ├── scraper-kuaishou-v3.js
│   │   │   └── ... (8个平台)
│   │   └── README.md
│   │
│   ├── analyzer/
│   │   ├── scripts/                # 从 ~/.claude/skills/social-media-analysis/ 迁移
│   │   │   └── analyze.js
│   │   └── README.md
│   │
│   └── publisher/
│       ├── scripts/                # 从 ~/.claude/skills/toutiao-publisher/ 迁移
│       │   └── publish.js
│       └── README.md
│
├── shared/                         # 共享代码（将来）
│   ├── types/
│   ├── utils/
│   └── config/
│
└── README.md                       # Feature 总览
```

**调用方式**：
```bash
/platform-data scrape douyin    # 采集抖音数据
/platform-data analyze          # 分析数据
/platform-data publish          # 发布内容
```

## 涉及文件

### 创建的目录和文件

1. `apps/features/` 目录（如不存在）
2. `apps/features/platform-data/` 目录结构
3. `apps/features/platform-data/skill/SKILL.md` - Skill 文档
4. `apps/features/platform-data/skill/command.sh` - 路由脚本
5. `apps/features/platform-data/skill/subcommands/*.sh` - 子命令脚本
6. `apps/features/platform-data/README.md` - Feature 总览
7. workflows 目录和迁移的脚本文件

### 迁移的文件

**Scraper workflow**：
- 源：`/home/xx/platform-scrapers/scraper-*.js` (8个平台)
- 目标：`apps/features/platform-data/workflows/scraper/scripts/`

**Analyzer workflow**：
- 源：`~/.claude/skills/social-media-analysis/scripts/`
- 目标：`apps/features/platform-data/workflows/analyzer/scripts/`

**Publisher workflow**：
- 源：`~/.claude/skills/toutiao-publisher/scripts/`
- 目标：`apps/features/platform-data/workflows/publisher/scripts/`

### 修改的文件

**不在此 PR 修改**（单独处理）：
- `cecelia-engine/skills-registry.json` - 注册 platform-data skill
- 删除旧的独立 skills 软链接

## 成功标准

1. ✅ 目录结构创建完成
2. ✅ Feature-level skill 入口可用（command.sh 能路由到子命令）
3. ✅ 三个 workflows 的脚本文件迁移完成
4. ✅ 每个 workflow 有 README.md 说明
5. ✅ Feature 总览 README.md 编写完成
6. ✅ 代码可以正常运行（保持原有功能）

## 非目标

**不在此次 PR 做的事**：
1. ❌ 不修改 scraper/analyzer/publisher 的实现逻辑
2. ❌ 不更新 cecelia-engine/skills-registry.json（单独 PR）
3. ❌ 不实现 shared/ 共享代码（将来）
4. ❌ 不删除旧的独立 repo（迁移完成后手动清理）
5. ❌ 不在此 PR 测试 skill-loader（单独验证）

## 技术细节

### command.sh 路由逻辑

```bash
#!/bin/bash
FEATURE_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"

case "$1" in
  scrape)
    shift
    exec "$FEATURE_DIR/workflows/scraper/scripts/run.sh" "$@"
    ;;
  analyze)
    shift
    exec "$FEATURE_DIR/workflows/analyzer/scripts/analyze.js" "$@"
    ;;
  publish)
    shift
    exec "$FEATURE_DIR/workflows/publisher/scripts/publish.js" "$@"
    ;;
  *)
    cat "$FEATURE_DIR/skill/SKILL.md"
    ;;
esac
```

### 迁移策略

**复制而非移动**（保留原文件，确保不丢失）：
- 使用 `cp -r` 复制文件
- 验证新位置功能正常后，单独清理旧文件

## 风险控制

1. **数据安全**：不删除原文件，先复制再验证
2. **功能验证**：迁移后测试基本功能能否运行
3. **版本管理**：使用 git 跟踪所有变更，可随时回滚
