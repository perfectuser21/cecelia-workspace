---
id: prd-inbox-ui
version: 1.0.0
created: 2026-02-22
updated: 2026-02-22
changelog:
  - 1.0.0: ä» .prd-inbox-heartbeat.md Phase 3 æå–
---

# PRD: Dashboard æ”¶ä»¶ç®± UIï¼ˆPhase 3ï¼‰

## èƒŒæ™¯

Phase 1ï¼ˆææ¡ˆç³»ç»Ÿæ‰©å±• + WebSocketï¼‰å’Œ Phase 2ï¼ˆHEARTBEAT.md å·¡æ£€ï¼‰å·²å®Œæˆåç«¯ã€‚
æœ¬ Phase åœ¨ Dashboard å‰ç«¯å±•ç¤ºæ”¶ä»¶ç®±ï¼Œè®©ç”¨æˆ·å¯ä»¥æ‰¹å‡†/æ‹’ç»/è¿½é—®/é€‰æ‹©ææ¡ˆã€‚

## ç›®æ ‡

åœ¨ Dashboard ä¸Šå±•ç¤ºæ”¶ä»¶ç®±ï¼Œç”¨æˆ·å¯ä»¥æ‰¹å‡†/æ‹’ç»/è¿½é—®/é€‰æ‹©ã€‚

## 3.1 æ–°å»º Feature: inbox

**ä½ç½®**ï¼š`apps/core/features/inbox/`

```
apps/core/features/inbox/
â”œâ”€â”€ index.ts                    # Feature manifest
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ InboxPage.tsx           # æ”¶ä»¶ç®±ä¸»é¡µé¢
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ProposalCard.tsx        # å•ä¸ªææ¡ˆå¡ç‰‡
â”‚   â”œâ”€â”€ ProposalChat.tsx        # ææ¡ˆå¯¹è¯åŒº
â”‚   â”œâ”€â”€ ProposalOptions.tsx     # é€‰é¡¹é€‰æ‹©ï¼ˆå¼‚å¸¸å¤„ç†ï¼‰
â”‚   â””â”€â”€ InboxBadge.tsx          # å¯¼èˆªæ æœªè¯»æ•°è§’æ ‡
â””â”€â”€ hooks/
    â””â”€â”€ useProposals.ts         # ææ¡ˆæ•°æ® hookï¼ˆWebSocket + è½®è¯¢ fallbackï¼‰
```

## 3.2 WebSocket é›†æˆ

**æ–°å»º**ï¼š`apps/core/features/shared/hooks/useWebSocket.ts`

- è‡ªåŠ¨é‡è¿ï¼ˆæŒ‡æ•°é€€é¿ï¼Œæœ€å¤§ 30sï¼‰
- è¿”å› { socket, connected }

## 3.3 useProposals Hook

- åˆå§‹åŠ è½½ï¼š`GET /api/brain/pending-actions`
- WebSocket å®æ—¶æ›´æ–°ï¼šproposal:created / proposal:comment / proposal:resolved
- Fallbackï¼šWebSocket æ–­å¼€æ—¶æ¯ 10s è½®è¯¢
- è¿”å› { proposals, pendingCount }

## 3.4 InboxPage å¸ƒå±€

- å¾…å¤„ç†åŒºï¼šæ˜¾ç¤ºæ‰€æœ‰ pending_approval ææ¡ˆ
- å·²å¤„ç†åŒºï¼šå¯æŠ˜å å±•ç¤º
- ç­›é€‰ï¼šå…¨éƒ¨ / æŒ‰ç±»å‹
- æ¯ä¸ªææ¡ˆå¡ç‰‡æ˜¾ç¤ºï¼šç±»å‹å›¾æ ‡ã€æ ‡é¢˜ã€æ—¶é—´ã€å†…å®¹æ‘˜è¦ã€æ“ä½œæŒ‰é’®

## 3.5 ProposalChat å¯¹è¯ç»„ä»¶

- ç‚¹å‡»"è¿½é—®"å±•å¼€å¯¹è¯åŒº
- æ˜¾ç¤ºå®Œæ•´å¯¹è¯å†å²ï¼ˆğŸ¤– Cecelia / ğŸ‘¤ ç”¨æˆ·ï¼‰
- è¾“å…¥æ¡† + å‘é€æŒ‰é’®
- å‘é€åè°ƒç”¨ `POST /api/brain/pending-actions/:id/comment`
- æ˜¾ç¤º Haiku å›å¤

## 3.6 å¯¼èˆªæ è§’æ ‡

- å¯¼èˆªé…ç½®æ–°å¢"æ”¶ä»¶ç®±"å…¥å£
- InboxBadge ç»„ä»¶æ˜¾ç¤ºæœªè¯»æ•°
- pendingCount === 0 æ—¶éšè—

## 3.7 HEARTBEAT.md ç¼–è¾‘å™¨

- è·¯å¾„ï¼š`/settings/heartbeat`ï¼ˆæˆ–é›†æˆåˆ° inbox é¡µé¢çš„ tabï¼‰
- Markdown ç¼–è¾‘å™¨
- ä¿å­˜ï¼š`PUT /api/brain/heartbeat`
- è¯»å–ï¼š`GET /api/brain/heartbeat`
- æ˜¾ç¤ºå·¡æ£€æ—¥å¿—

## åç«¯ APIï¼ˆPhase 1/2 å·²å®ç°ï¼‰

| ç«¯ç‚¹ | æ–¹æ³• | ç”¨é€” |
|------|------|------|
| `/api/brain/pending-actions` | GET | è·å–ææ¡ˆåˆ—è¡¨ |
| `/api/brain/pending-actions/:id/approve` | POST | æ‰¹å‡†ææ¡ˆ |
| `/api/brain/pending-actions/:id/reject` | POST | æ‹’ç»ææ¡ˆ |
| `/api/brain/pending-actions/:id/comment` | POST | è¿½é—®å¯¹è¯ |
| `/api/brain/pending-actions/:id/select` | POST | é€‰æ‹©é€‰é¡¹ |
| `/api/brain/heartbeat` | GET/PUT | è¯»å†™ HEARTBEAT.md |
| WebSocket `ws://localhost:5221/ws` | - | å®æ—¶æ¨é€ |

## éªŒæ”¶æ ‡å‡†

- [ ] æ”¶ä»¶ç®±é¡µé¢å±•ç¤ºæ‰€æœ‰ pending_approval ææ¡ˆ
- [ ] ææ¡ˆå¡ç‰‡æ˜¾ç¤ºç±»å‹ã€æ—¶é—´ã€å†…å®¹æ‘˜è¦
- [ ] æ‰¹å‡†/æ‹’ç»/é€‰æ‹©æ“ä½œå¯ç”¨
- [ ] è¿½é—®å¯¹è¯å¯ç”¨ï¼ˆå‘é€ â†’ Haiku å›å¤ â†’ æ˜¾ç¤ºï¼‰
- [ ] WebSocket å®æ—¶æ›´æ–°ï¼ˆæ–°ææ¡ˆã€æ–°è¯„è®ºã€å·²å¤„ç†ï¼‰
- [ ] WebSocket æ–­å¼€æ—¶è‡ªåŠ¨ fallback åˆ° 10s è½®è¯¢
- [ ] å¯¼èˆªæ æœªè¯»æ•°è§’æ ‡
- [ ] HEARTBEAT.md ç¼–è¾‘å™¨å¯ä¿å­˜
- [ ] å·¡æ£€æ—¥å¿—å¯æŸ¥çœ‹
- [ ] æ‰‹æœº PWA è®¿é—®æ­£å¸¸
