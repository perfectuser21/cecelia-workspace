---
id: prd-kr2-prd-trd-validation
version: 1.0.0
created: 2026-01-31
updated: 2026-01-31
changelog:
  - 1.0.0: 初始版本
---

## PRD - PRD/TRD 验证层与标准化度量

**需求来源**: KR2: PRD/TRD 自动生成（标准化） — 模板引擎和生成函数已完成，但缺少验证层（validatePrd/validateTrd）、质量评分和 Decomposer 与标准模板的统一调用。

**功能描述**:

1. **PRD 验证函数** (`validatePrd`): 在 `templates.js` 中添加验证逻辑，检查必填 section（需求来源、功能描述、成功标准、非目标）是否存在且内容有效（非空、非模糊词）。返回 `{ valid: boolean, score: number, errors: string[] }`.

2. **TRD 验证函数** (`validateTrd`): 同上，检查 TRD 的 5 个必需 section（技术背景、架构设计、API 设计、数据模型、测试策略）。

3. **验证 API 端点**: `POST /api/brain/validate/prd` 和 `POST /api/brain/validate/trd`，接收 markdown 内容，返回验证结果。

4. **Decomposer 统一调用**: 让 `decomposer.js` 的 `generatePRD()` 调用 `renderPrd()` 而不是硬编码 markdown，确保所有 PRD 输出格式一致。

**涉及文件**:
- `apps/core/src/brain/templates.js` — 添加 validatePrd, validateTrd
- `apps/core/src/brain/routes.js` — 添加验证端点
- `apps/core/src/brain/decomposer.js` — 改用 renderPrd()
- `apps/core/src/brain/__tests__/templates.test.js` — 添加验证测试

**成功标准**:
- `validatePrd()` 对完整 PRD 返回 `{ valid: true, score >= 80 }`
- `validatePrd()` 对缺少"成功标准"的 PRD 返回 `{ valid: false }` 并包含具体错误
- `validateTrd()` 对完整 TRD 返回 `{ valid: true }`
- `POST /api/brain/validate/prd` 返回 200 + 验证结果 JSON
- Decomposer 生成的 PRD 包含标准 frontmatter
- 所有新增代码有测试覆盖

**非目标**:
- 不做 AI 驱动的内容质量评估（纯规则校验即可）
- 不做 auto-remediation（自动修复不合格 PRD）
- 不新增数据库表
- 不改动 Planner V3 的任务生成逻辑
