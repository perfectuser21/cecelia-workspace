---
id: prd-kr2-prd-trd-standardization
version: 1.0.0
created: 2026-01-31
updated: 2026-01-31
changelog:
  - 1.0.0: 初始版本
---

## PRD - PRD/TRD 自动生成标准化：TRD 验证 + 生成质量门控

**需求来源**: Nightly Planner 自动任务 - KR2: PRD/TRD 自动生成（标准化）进度 0%

**功能描述**:
完善 Brain API 的 PRD/TRD 标准化体系，具体包括三个子功能：

1. **TRD 验证函数** (`validateTrd`): 在 `templates.js` 中实现 TRD 文档验证，检查必要章节（技术背景、架构设计、API 设计、数据模型、测试策略、实施计划），返回 `{ valid, score, missing_fields }` 格式，与现有 `validatePrd` 保持一致
2. **PRD 生成时自动验证**: 在 `generateTaskPRD()` (planner.js) 中调用 `validatePrd()` 对生成的 PRD 进行质量检查，score < 60 时记录警告日志
3. **TRD 验证 API 端点**: 在 routes.js 添加 `POST /api/brain/validate/trd` 端点，与现有 `POST /api/brain/validate/prd` 对称

**涉及文件**:
- `apps/core/src/brain/templates.js` - 添加 `validateTrd()` 函数
- `apps/core/src/brain/planner.js` - `generateTaskPRD()` 中集成验证
- `apps/core/src/brain/routes.js` - 添加 TRD 验证端点
- `apps/core/src/brain/__tests__/templates.test.js` - 添加 TRD 验证测试

**成功标准**:
- `validateTrd(content)` 对完整 TRD 返回 `{ valid: true, score: >= 80 }`
- `validateTrd("")` 对空内容返回 `{ valid: false, score: 0 }`
- `POST /api/brain/validate/trd` 返回 200 + 验证结果 JSON
- `generateTaskPRD()` 在生成 PRD 后调用 `validatePrd()` 并在 score < 60 时输出 console.warn
- 所有新增和现有测试通过

**非目标**:
- 不做 PRD 数据库持久化（scope 太大，下次迭代）
- 不做 TRD decomposer 重构
- 不做质量 dashboard UI
