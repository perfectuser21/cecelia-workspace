---
id: prd-cecelia-front-desk-chat-api
version: 1.2.0
created: 2026-01-31
updated: 2026-01-31
changelog:
  - 1.0.0: 初始版本
  - 1.1.0: 修正文件路径、明确意图范围
  - 1.2.0: 澄清与现有 parse-intent/intent-to-tasks 的关系，新增 API schema
---

# PRD - Cecelia 前台对话 API

## 背景

**需求来源**: Brain 自动调度任务。Core 已有两个底层 intent 端点：
- `POST /api/brain/parse-intent` — 纯解析，不执行
- `POST /api/brain/intent-to-tasks` — 解析 + 创建任务/项目

这两个端点面向程序调用，缺少"对话"语义：无 reply 文本、无 query_status 查询能力、无统一会话入口。需要一个面向前台的 `/api/cecelia/chat` 端点，作为对话 facade，统一调用底层能力并返回人类可读的 reply。

## 功能描述

新增 `POST /api/cecelia/chat`，作为统一对话入口：

1. **接收** 自然语言 message
2. **解析** 调用 `parseIntent()` 获取意图
3. **分发执行**：
   - 创建类（create_task/goal/project/feature）→ 调用 `parseAndCreate()` 写入数据库
   - 查询类（query_status）→ 查询数据库返回任务/目标列表
   - 其他（fix_bug/refactor/explore/question/unknown）→ 仅返回解析结果
4. **生成 reply** 中文自然语言回复

## API 规范

### Request
```
POST /api/cecelia/chat
Content-Type: application/json
{ "message": "string" }
```

### Response (200) - 创建类
```json
{
  "success": true,
  "reply": "已创建任务「修复登录页超时」，优先级 P1",
  "intent": { "type": "create_task", "confidence": 0.85, "entities": {} },
  "action_result": { "type": "created", "data": { "id": "uuid", "title": "..." } }
}
```

### Response (200) - 查询类
```json
{
  "success": true,
  "reply": "当前有 3 个进行中的任务",
  "intent": { "type": "query_status", "confidence": 0.7, "entities": {} },
  "action_result": { "type": "query", "data": [{ "id": "uuid", "title": "...", "status": "..." }] }
}
```

### Response (200) - 未知/仅解析
```json
{
  "success": true,
  "reply": "我不太理解你的意思，可以换个方式描述吗？",
  "intent": { "type": "unknown", "confidence": 0.1, "entities": {} },
  "action_result": null
}
```

### Error (400)
```json
{ "success": false, "error": "message is required and must be a string" }
```

## 与现有端点的关系

| 端点 | 角色 | 本 PRD 是否修改 |
|------|------|----------------|
| `/api/brain/parse-intent` | 底层：纯解析 | 不修改 |
| `/api/brain/intent-to-tasks` | 底层：解析+创建 | 不修改 |
| `/api/orchestrator/chat` | 代理到外部 brain(5220) | 不修改 |
| `/api/cecelia/chat` | **本 PRD**：对话 facade | 新建 |

## 涉及文件

- `apps/core/src/dashboard/server.ts` — 注册路由（import + app.use）
- `apps/core/src/cecelia/chat-router.ts` — **新建**：Express Router
- `apps/core/src/brain/intent.js` — 已有：import parseIntent/parseAndCreate，不修改

## 成功标准

- [ ] `POST /api/cecelia/chat` 带 `{"message":"创建任务：测试"}` 返回 200，body 含 success/reply/intent/action_result
- [ ] 创建类意图执行后数据库新增记录，action_result.data 含 id
- [ ] `{"message":"当前有哪些任务"}` 返回 query_status，action_result.data 为数组
- [ ] `{"message":"asdfghjkl"}` 返回 200 + intent.type="unknown" + 中文 reply
- [ ] 缺少 message 或非字符串返回 400
- [ ] 现有 `/api/brain/parse-intent` 和 `/api/brain/intent-to-tasks` 行为不变

## 非目标

- 不修改 intent.js、routes.js、数据库 schema
- 不替换 /api/orchestrator/chat 代理
- 不涉及流式响应 / WebSocket / AI 大模型调用
- 不修改前端组件
- 不涉及认证鉴权
