---
id: prd-standardize-prd-trd-generation
version: 1.0.0
created: 2026-01-31
updated: 2026-01-31
changelog:
  - 1.0.0: 初始版本
---

## PRD - 标准化 PRD/TRD 自动生成系统

**需求来源**: KR2: PRD/TRD 自动生成（标准化）- Nightly Planner 自动任务
**功能描述**: 统一 decomposer 和 planner 的 PRD 生成路径，使用 templates.js 的高级模板系统；添加 PRD 验证函数和 API；使 TRD decompose 生成的 milestone PRD 使用标准模板。
**涉及文件**:
- `apps/core/src/brain/decomposer.js` - 替换简单 generatePRD 为 templates 调用
- `apps/core/src/brain/routes.js` - 添加 PRD 验证端点
- `apps/core/src/brain/templates.js` - 添加 validatePrd 函数
- `apps/core/src/brain/__tests__/decomposer.test.js` - 更新测试
- `apps/core/src/brain/__tests__/templates.test.js` - 添加验证测试

**成功标准**:
- [ ] decomposer.generatePRD() 调用 templates.renderPrd() 生成标准格式 PRD（包含 frontmatter、6 个 section）
- [ ] POST /api/brain/validate/prd 端点返回 {valid, errors[]} 检查必填字段（background, objectives, acceptance_criteria）
- [ ] TRD decompose 后每个 milestone PRD 包含完整的标准模板结构
- [ ] 现有 templates.test.js 和 decomposer.test.js 全部通过
- [ ] 新增验证函数的单元测试覆盖：有效 PRD、缺失字段、空内容 3 种场景

**非目标**:
- 不做 PRD 持久化到数据库（后续任务）
- 不做 PRD-to-TRD 反向生成
- 不改动 planner.js 的 generateTaskPRD 流程（已在用 templates）
- 不做前端 UI
