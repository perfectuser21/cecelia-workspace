---
id: cecelia-orchestrator-integration
version: 1.0.0
created: 2026-01-29
updated: 2026-01-29
changelog:
  - 1.0.0: 初始版本
---

# PRD: Cecelia 前端连接 Orchestrator

## 需求来源

Cecelia 作为信息输入端口（语音或文字），需要能调用 Brain 的 run_orchestrator tool 来触发 Claude Code 无头模式执行任务。

## 功能描述

在 Orchestrator 页面集成 Cecelia：
1. **语音输入**：通过 Brain 的 WebSocket 代理连接 OpenAI Realtime API
2. **文字输入**：直接调用 Brain 的 chat API
3. **触发 Orchestrator**：当用户说"执行任务 XXX"时，调用 `run_orchestrator` tool

## 架构

```
┌─────────────────────────────────────────────────────────────┐
│                    Workspace 前端                           │
│  OrchestratorPage.tsx                                       │
│    - 语音按钮 → WebSocket → Brain → OpenAI Realtime        │
│    - 文字输入 → POST /orchestrator/chat                     │
│    - Cecelia 说"执行任务" → run_orchestrator tool          │
└─────────────────────────────────────────────────────────────┘
                           ↓
┌─────────────────────────────────────────────────────────────┐
│                    Brain API (5220)                         │
│  /orchestrator/realtime/ws     - WebSocket 代理            │
│  /orchestrator/realtime/config - 获取 tools 配置           │
│  /orchestrator/realtime/tool   - 执行 tool                 │
│    - run_orchestrator → claude -p "/orchestrator ..."      │
└─────────────────────────────────────────────────────────────┘
```

## 成功标准

1. 点击麦克风按钮，可以和 Cecelia 语音对话
2. 在文字框输入，可以和 Cecelia 文字对话
3. 说"帮我执行一个任务：XXX"，Cecelia 调用 run_orchestrator
4. 显示 Orchestrator 执行结果

## 技术方案

### Brain API 端点（已完成）
- `ws://brain:5220/orchestrator/realtime/ws` - WebSocket 代理
- `GET /orchestrator/realtime/config` - 获取 tools 配置
- `POST /orchestrator/realtime/tool` - 执行 tool

### 前端需要做
1. 连接 Brain WebSocket 而不是直接连 OpenAI
2. 处理 tool 调用回调
3. 显示执行结果

## 修改文件

- `apps/core/features/orchestrator/pages/OrchestratorPage.tsx`
- `apps/core/features/orchestrator/hooks/useRealtimeChat.ts`（新建）
