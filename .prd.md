---
id: prd-kr1-intent-recognition
version: 1.0.0
created: 2026-02-01
updated: 2026-02-01
changelog:
  - 1.0.0: 初始版本
---

# PRD - [Retry] Advance "KR1: 意图识别 - 自然语言→OKR/Project/Task" for Cecelia Workspace

## 需求来源

任务来自 Brain 自动调度系统。根据 Brain status，KR1 (意图识别 - 自然语言→OKR/Project/Task) 当前进度为 0%，gap 为 100%，是 P0 优先级任务。

当前状态：
- Objective: O1: Cecelia 自驱进化 - 从被动执行器到自驱数字生命体 (P0)
- KR1: 意图识别 - 自然语言→OKR/Project/Task
- progress: 0%
- gap: 100%

## 功能描述

实现一个意图识别系统，能够将用户的自然语言输入解析为结构化的 OKR/Project/Task 数据。

### 核心功能

1. **意图分类**
   - 识别用户输入是否在创建 Objective、Key Result、Project 或 Task
   - 区分创建、更新、查询等不同操作类型
   - 处理模糊或复合意图（如"创建一个登录功能的任务"）

2. **实体提取**
   - 从自然语言中提取关键信息：
     - 标题/名称
     - 描述内容
     - 优先级 (P0/P1/P2)
     - 状态 (pending/in_progress/completed)
     - 关联关系 (属于哪个 Project/Goal)

3. **结构化输出**
   - 将识别结果转换为可直接调用 Brain API 的格式
   - 支持批量创建（如"创建3个任务"）
   - 提供置信度评分和歧义提示

### 示例场景

**输入**: "我想做一个用户登录功能，优先级很高"

**输出**:
```json
{
  "intent": "create_task",
  "confidence": 0.95,
  "entities": {
    "title": "实现用户登录功能",
    "type": "task",
    "priority": "P0",
    "project_id": null,
    "goal_id": null
  },
  "suggested_action": {
    "api": "POST /api/brain/action/create-task",
    "payload": {
      "title": "实现用户登录功能",
      "priority": "P0"
    }
  }
}
```

## 影响范围

### 涉及的文件

新建文件：
- `apps/core/src/brain/intent-recognition.js` - 意图识别核心逻辑
- `apps/core/src/brain/nlp-parser.js` - NLP 解析工具
- `apps/core/src/brain/__tests__/intent-recognition.test.js` - 单元测试

修改文件：
- `apps/core/src/brain/routes.js` - 添加意图识别 API 端点
- `apps/core/src/brain/index.js` - 集成意图识别模块

### 涉及的 API

新建 API：
- `POST /api/brain/recognize-intent` - 意图识别主接口

可能使用的 API：
- `GET /api/brain/status` - 获取当前 context (活跃的 projects/goals)
- `POST /api/brain/action/create-task` - 创建任务
- `POST /api/brain/action/create-goal` - 创建目标
- `POST /api/tasks/projects` - 创建项目

### 数据库表

读取：
- `projects` - 查询已有项目
- `goals` - 查询已有目标
- `tasks` - 查询已有任务

写入：
- 无（意图识别不直接写数据库，只返回建议的 action）

## 非目标

明确说明本次 **不做** 的事情：

- ❌ 不实现多轮对话（只处理单次输入）
- ❌ 不做语音识别（只处理文本）
- ❌ 不训练自定义 NLP 模型（使用现有工具或 API）
- ❌ 不处理复杂的上下文记忆（不记录历史对话）
- ❌ 不实现自动执行（只识别意图并返回建议，不自动调用 action API）
- ❌ 不处理非任务相关的自然语言（如闲聊、查询天气等）

## 成功标准

### 1. 基础意图识别功能

- [ ] 实现 `POST /api/brain/recognize-intent` API，接受 `text` 参数
- [ ] 能够识别至少 5 种意图类型：
  - create_objective (创建目标)
  - create_key_result (创建关键结果)
  - create_project (创建项目)
  - create_task (创建任务)
  - query_status (查询状态)

### 2. 实体提取准确性

- [ ] 从"我想做一个登录功能，优先级很高"中提取：
  - title: "实现用户登录功能" 或类似
  - priority: "P0"
  - type: "task"
- [ ] 从"创建一个提升用户体验的 OKR，包含3个 KR"中提取：
  - intent: "create_objective"
  - 识别出需要创建多个 KR
- [ ] 置信度 < 0.6 时，提示用户输入不够明确

### 3. 结构化输出

- [ ] 返回 JSON 格式包含：
  - `intent`: 意图类型
  - `confidence`: 置信度 (0-1)
  - `entities`: 提取的实体
  - `suggested_action`: 建议的 API 调用
- [ ] 如果有歧义，返回 `ambiguities` 字段列出可能的解释

### 4. 集成测试

- [ ] 单元测试覆盖率 > 80%: `npm test -- apps/core/src/brain/__tests__/intent-recognition.test.js`
- [ ] 手动测试至少 10 个不同的自然语言输入，8 个以上识别正确
- [ ] CI 通过: GitHub Actions 运行成功

### 5. 文档完整性

- [ ] 在 `docs/KR1-INTENT-RECOGNITION.md` 中记录：
  - 支持的意图类型列表
  - 实体提取的规则
  - API 使用示例
  - 已知限制和未来改进方向

## 技术方案

### 1. 技术选型

**方案 A: 使用规则引擎 + 关键词匹配**
- 优点：轻量、快速、可控
- 缺点：覆盖率有限，需要大量规则

**方案 B: 使用 LLM API (如 Claude API)**
- 优点：理解能力强、开发快
- 缺点：依赖外部服务、有成本

**方案 C: 混合方案**
- 简单意图用规则 (如明确包含"创建任务"关键词)
- 复杂意图调用 LLM
- 平衡性能和准确性

**推荐**: 方案 C

### 2. 实现步骤

**Phase 1: 规则引擎基础**
- 关键词匹配 (创建、任务、项目、目标、OKR 等)
- 优先级识别 (P0/高/紧急 → P0)
- 状态识别 (待办/进行中 → pending/in_progress)

**Phase 2: LLM 增强**
- 对模糊输入调用 Claude API
- 使用 structured output 返回 JSON
- 设置 fallback 机制

**Phase 3: Context 集成**
- 查询当前活跃的 projects/goals
- 自动关联到相关 project

### 3. API 设计

```javascript
POST /api/brain/recognize-intent

Request:
{
  "text": "我想做一个登录功能，优先级很高",
  "context": {
    "current_project": "cecelia-workspace" // 可选
  }
}

Response:
{
  "intent": "create_task",
  "confidence": 0.95,
  "entities": {
    "title": "实现用户登录功能",
    "type": "task",
    "priority": "P0",
    "project_id": null
  },
  "suggested_action": {
    "api": "POST /api/brain/action/create-task",
    "payload": {
      "title": "实现用户登录功能",
      "priority": "P0"
    }
  },
  "ambiguities": []
}
```

## 依赖

- Brain API (http://localhost:5212/api/brain/*)
- Task System API
- 可能需要 Claude API 凭据（如果使用 LLM 方案）

## 风险与挑战

1. **自然语言的多样性**: 同一意图有无数种表达方式
   - 缓解：从简单场景开始，逐步扩展规则库

2. **中英文混合**: 用户可能中英文混用
   - 缓解：同时支持中英文关键词

3. **上下文依赖**: "再创建一个"需要知道"上一个"是什么
   - 缓解：第一版不支持，明确告知用户输入完整信息
