---
id: brain-mvp
version: 1.0.0
created: 2026-01-28
priority: P0
---

# PRD: Brain MVP - Cecelia 大脑系统

## 目标

实现 Cecelia 大脑系统的 MVP 版本，让 Claude Code 能够读取系统状态并执行可控的 Actions。

**核心架构**：
```
Brain API = 状态与动作服务
Orchestrator = 大脑本体（常驻调度器）
Claude Code / Cecelia = 皮层（按需推理）
```

## 背景

目前 Cecelia 有很多子系统（Task System、Quality Monitor、N8N 等），但缺乏统一的状态感知和决策中心。

**问题**：
- 没有统一的地方查看系统全貌
- Claude Code 每次都要手动查询多个 API
- 没有决策审计日志

## 功能设计

### 1. 状态读取 API

| 端点 | 说明 |
|------|------|
| `GET /api/brain/status` | 精简决策包（给 LLM/皮层用，固定 schema）|
| `GET /api/brain/status/full` | 完整状态（给人 debug 用）|
| `GET /api/brain/tasks` | 优先级排序的任务列表 |
| `GET /api/brain/memory` | 工作记忆 |
| `GET /api/brain/policy` | 当前策略 |
| `GET /api/brain/decisions` | 历史决策记录（只读审计）|

### 2. 动作执行 API（白名单 + 幂等）

| Action | 必填参数 | 说明 |
|--------|---------|------|
| `create-task` | title | 创建任务 |
| `update-task` | task_id | 更新任务状态/优先级 |
| `batch-update-tasks` | filter, update | 批量更新 |
| `create-goal` | title | 创建目标 |
| `update-goal` | goal_id | 更新目标 |
| `set-memory` | key, value | 设置工作记忆 |
| `trigger-n8n` | webhook_path | 触发 N8N |

### 3. 决策包 Schema

`GET /api/brain/status` 返回固定格式：

```json
{
  "policy_version": 1,
  "policy_rules": {
    "priority_order": ["P0", "P1", "P2"],
    "confidence_threshold": 0.6,
    "allowed_actions": ["create-task", "update-task", ...]
  },
  "memory": {
    "current_focus": { "project": "xxx", "goal": "xxx" },
    "today_intent": { "description": "今日目标" },
    "blocked_by": { "items": [] }
  },
  "recent_decisions": [
    { "ts": "...", "action": "create-task", "status": "success" }
  ],
  "system_health": {
    "n8n_ok": true,
    "n8n_failures_1h": 0,
    "task_system_ok": true
  },
  "tasks": {
    "p0": [...],
    "p1": [...],
    "stats": { "open_p0": 1, "open_p1": 2, "in_progress": 1, "queued": 3 }
  }
}
```

### 4. 安全机制

- **白名单**：只允许 7 个预定义 Action
- **幂等性**：5 分钟 TTL 防止重复执行
- **内部审计**：`log-decision` 不对外暴露，由系统自动记录

## 技术实现

### 数据库表（已创建）

- `policy` - 策略配置
- `system_snapshot` - 系统快照
- `decision_log` - 决策日志
- `working_memory` - 工作记忆

### Brain 模块

```
apps/core/src/brain/
├── actions.js      # Action 执行
├── orchestrator.js # 状态查询
├── perception.js   # 系统感知
└── routes.js       # API 路由
```

### 集成到 Core

修改 `apps/core/src/dashboard/server.ts`，添加：
```typescript
import brainRoutes from '../brain/routes.js';
app.use('/api/brain', brainRoutes);
```

## 验收标准

见 .dod.md

## 参考

- 详细架构文档：docs/BRAIN-SKILL.md
- 项目规则：CLAUDE.md
