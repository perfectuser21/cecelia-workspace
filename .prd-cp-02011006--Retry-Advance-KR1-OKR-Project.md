---
id: prd-kr1-intent-recognition
version: 1.0.0
created: 2026-02-01
updated: 2026-02-01
changelog:
  - 1.0.0: 初始版本 - KR1 意图识别功能
---

# PRD - KR1: 意图识别 - 自然语言→OKR/Project/Task

## 需求来源

任务来自 Brain 自动调度，针对 Cecelia Workspace 的 KR1 目标：实现自然语言到 OKR/Project/Task 的意图识别和映射能力。

当前进度：0%，需要完整实现该功能。

## 功能描述

实现一个意图识别系统，能够：

1. **解析自然语言输入**：接收用户的自然语言描述（如"我想做一个用户登录功能"）
2. **识别意图类型**：判断用户意图属于以下哪一类：
   - 创建 OKR Goal（如"我要完成用户认证系统"）
   - 创建 Project（如"新建一个电商项目"）
   - 创建 Task（如"实现登录接口"）
   - 查询现有任务（如"我的待办任务有哪些"）
   - 更新任务状态（如"把登录功能标记为完成"）

3. **实体提取**：从自然语言中提取关键信息：
   - 标题/名称
   - 优先级（P0/P1/P2）
   - 时间范围（如果提到）
   - 关联关系（属于哪个 Project/Goal）
   - 状态（pending/in_progress/completed）

4. **生成结构化数据**：将识别结果转换为标准的 API 请求格式
5. **提供确认机制**：在执行操作前向用户展示理解的内容，确认无误后执行

## 涉及文件

### 新建文件
- `apps/core/src/services/intent-recognition.service.ts` - 核心意图识别服务
- `apps/core/src/controllers/intent.controller.ts` - API 控制器
- `apps/core/src/types/intent.types.ts` - TypeScript 类型定义
- `apps/core/src/utils/nlp-parser.ts` - 自然语言解析工具
- `apps/core/src/__tests__/intent-recognition.test.ts` - 单元测试

### 修改文件
- `apps/core/src/app.ts` - 注册新的路由
- `apps/core/package.json` - 添加必要的依赖（如有需要）

## 成功标准

### 功能完整性
- [ ] API 端点 `POST /api/intent/recognize` 可以接收自然语言输入
- [ ] 能够正确识别至少 5 种意图类型（创建 Goal/Project/Task、查询、更新）
- [ ] 从自然语言中提取标题、优先级、关联关系等关键信息
- [ ] 返回结构化的 JSON 响应，包含识别的意图类型和提取的实体

### 准确性
- [ ] 对于明确的创建类请求（如"创建一个任务：实现登录"），准确率 100%
- [ ] 对于模糊的请求（如"搞一个登录"），能够识别为创建任务并提示用户确认
- [ ] 能够区分 Goal（宏观目标）、Project（项目）和 Task（具体任务）的语义差异

### 集成
- [ ] 与现有的 Brain API 集成，可以通过 `/api/brain/action/*` 执行识别出的操作
- [ ] 与现有的 Task Management API 集成，支持任务的 CRUD 操作
- [ ] 提供完整的 TypeScript 类型支持

### 测试覆盖
- [ ] 单元测试覆盖核心识别逻辑
- [ ] 集成测试验证完整的识别→执行流程
- [ ] 至少 10 个真实场景的测试用例

### 文档
- [ ] API 文档说明接口使用方法
- [ ] 代码注释解释关键算法逻辑

## 非目标

本次实现**不包括**以下功能：

- ❌ 多轮对话（只处理单次输入）
- ❌ 复杂的上下文记忆（不记住之前的对话）
- ❌ 高级 NLP 技术（不使用机器学习模型，基于规则即可）
- ❌ 前端界面（只实现后端 API）
- ❌ 语音输入支持
- ❌ 多语言支持（仅支持中文和英文）
- ❌ 智能推荐（不主动建议相关任务）

## 技术约束

- 使用 TypeScript 编写
- 遵循现有的代码风格和架构
- 不引入重量级 NLP 库（如 TensorFlow、spaCy），使用轻量级规则匹配
- API 响应时间 < 500ms
- 兼容现有的数据库 schema

## 验收场景

### 场景 1：创建 Task
```
输入："实现用户登录接口"
期望输出：
{
  "intent": "CREATE_TASK",
  "entities": {
    "title": "实现用户登录接口",
    "type": "task",
    "priority": "P1" // 默认
  }
}
```

### 场景 2：创建 Goal
```
输入："完成整个用户认证系统作为 P0 目标"
期望输出：
{
  "intent": "CREATE_GOAL",
  "entities": {
    "title": "完成整个用户认证系统",
    "priority": "P0"
  }
}
```

### 场景 3：查询任务
```
输入："我有哪些待办任务"
期望输出：
{
  "intent": "QUERY_TASKS",
  "entities": {
    "status": "pending"
  }
}
```

### 场景 4：更新状态
```
输入："把登录功能标记为完成"
期望输出：
{
  "intent": "UPDATE_TASK",
  "entities": {
    "title": "登录功能", // 模糊匹配
    "status": "completed"
  }
}
```

## 实现优先级

### P0（必须完成）
- 创建 Task 意图识别
- 基本实体提取（标题、优先级）
- API 端点实现
- 与 Brain API 集成

### P1（重要）
- 创建 Goal/Project 意图识别
- 查询和更新意图识别
- 关联关系提取
- 单元测试

### P2（可选）
- 模糊匹配优化
- 错误处理和用户友好的提示
- 性能优化
