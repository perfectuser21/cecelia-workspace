---
id: task-system-api-v1
version: 1.0.0
created: 2026-01-28
---

# PRD: Task System REST API

## ğŸ¯ ç›®æ ‡

ä¸º Task Management System æ„å»ºå®Œæ•´çš„ REST APIï¼Œè¿æ¥ PostgreSQL æ•°æ®åº“ï¼ˆcecelia_tasksï¼‰ã€‚

## ğŸ“‹ åŠŸèƒ½éœ€æ±‚

### 1. Projects API

```
GET    /api/projects              # åˆ—è¡¨
GET    /api/projects/:id          # è¯¦æƒ…
POST   /api/projects              # åˆ›å»º
PATCH  /api/projects/:id          # æ›´æ–°
DELETE /api/projects/:id          # åˆ é™¤
GET    /api/projects/:id/goals    # é¡¹ç›®çš„ç›®æ ‡
GET    /api/projects/:id/tasks    # é¡¹ç›®çš„ä»»åŠ¡
GET    /api/projects/:id/stats    # é¡¹ç›®ç»Ÿè®¡
```

### 2. Goals API

```
GET    /api/goals                 # åˆ—è¡¨
GET    /api/goals/:id             # è¯¦æƒ…
POST   /api/goals                 # åˆ›å»º
PATCH  /api/goals/:id             # æ›´æ–°
DELETE /api/goals/:id             # åˆ é™¤
GET    /api/goals/:id/tasks       # ç›®æ ‡çš„ä»»åŠ¡
```

### 3. Tasks API

```
GET    /api/tasks                 # åˆ—è¡¨ï¼ˆæ”¯æŒç­›é€‰ï¼‰
GET    /api/tasks/:id             # è¯¦æƒ…
POST   /api/tasks                 # åˆ›å»º
PATCH  /api/tasks/:id             # æ›´æ–°
DELETE /api/tasks/:id             # åˆ é™¤
GET    /api/tasks/:id/backlinks   # åå‘é“¾æ¥
GET    /api/tasks/:id/runs        # æ‰§è¡Œè®°å½•
```

### 4. Task Links APIï¼ˆåŒå‘é“¾æ¥ï¼‰

```
POST   /api/tasks/:id/links       # åˆ›å»ºé“¾æ¥
  body: { targetTaskId, linkType: 'blocks' | 'relates_to' | 'duplicates' }
  
DELETE /api/tasks/:id/links/:linkId  # åˆ é™¤é“¾æ¥
GET    /api/tasks/:id/links          # è·å–æ‰€æœ‰é“¾æ¥
```

### 5. Runs API

```
GET    /api/runs                  # åˆ—è¡¨
GET    /api/runs/:id              # è¯¦æƒ…
POST   /api/tasks/:id/runs        # åˆ›å»ºè¿è¡Œè®°å½•
```

## ğŸ”§ æŠ€æœ¯å®ç°

### æ•°æ®åº“è¿æ¥

```javascript
// db.js
const { Pool } = require('pg');

const pool = new Pool({
  host: 'localhost',
  port: 5432,
  database: 'cecelia_tasks',
  user: 'n8n_user',
  password: 'n8n_password_2025'
});

module.exports = pool;
```

### API ç¤ºä¾‹

```javascript
// GET /api/projects
app.get('/api/projects', async (req, res) => {
  const { workspace_id } = req.query;
  const result = await pool.query(
    'SELECT * FROM projects WHERE workspace_id = $1 ORDER BY created_at DESC',
    [workspace_id]
  );
  res.json(result.rows);
});

// GET /api/tasks/:id/backlinksï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
app.get('/api/tasks/:id/backlinks', async (req, res) => {
  const result = await pool.query(`
    SELECT 
      t.id, t.title, t.status, t.priority,
      tl.link_type,
      p.name as project_name
    FROM task_links tl
    JOIN tasks t ON tl.source_task_id = t.id
    JOIN projects p ON t.project_id = p.id
    WHERE tl.target_task_id = $1
  `, [req.params.id]);
  res.json(result.rows);
});
```

## ğŸ“Š æ•°æ®æ ¼å¼

### Project

```json
{
  "id": "uuid",
  "workspace_id": "uuid",
  "name": "Cecelia Workspace",
  "description": "Main development workspace",
  "repo_path": "/home/xx/dev/cecelia-workspace",
  "icon": "ğŸ“¦",
  "color": "#3b82f6",
  "status": "active",
  "metadata": {},
  "created_at": "2026-01-28T00:00:00Z",
  "updated_at": "2026-01-28T00:00:00Z"
}
```

### Task

```json
{
  "id": "uuid",
  "project_id": "uuid",
  "goal_id": "uuid",
  "title": "åˆ›å»º Database Schema",
  "description": "Design and implement PostgreSQL schema",
  "intent": "infrastructure",
  "priority": "P0",
  "status": "completed",
  "payload": {},
  "created_at": "2026-01-28T00:00:00Z",
  "started_at": "2026-01-28T00:00:00Z",
  "completed_at": "2026-01-28T01:00:00Z",
  "duration": 3600,
  "tags": ["database", "backend"]
}
```

### Backlinksï¼ˆåå‘é“¾æ¥ï¼‰

```json
{
  "backlinks": [
    {
      "id": "task-uuid",
      "title": "åˆ›å»º Database Schema",
      "status": "completed",
      "priority": "P0",
      "link_type": "blocks",
      "project_name": "Cecelia Workspace"
    }
  ]
}
```

## ğŸ¯ éªŒæ”¶æ ‡å‡†ï¼ˆDoDï¼‰

### Phase 1: åŸºç¡€ CRUD
- [ ] Projects CRUD API
- [ ] Goals CRUD API
- [ ] Tasks CRUD API
- [ ] è¿æ¥åˆ° PostgreSQL
- [ ] é”™è¯¯å¤„ç†

### Phase 2: åŒå‘é“¾æ¥
- [ ] POST /api/tasks/:id/linksï¼ˆåˆ›å»ºé“¾æ¥ï¼‰
- [ ] GET /api/tasks/:id/backlinksï¼ˆæŸ¥è¯¢åå‘é“¾æ¥ï¼‰
- [ ] DELETE /api/tasks/:id/links/:linkIdï¼ˆåˆ é™¤é“¾æ¥ï¼‰

### Phase 3: ç»Ÿè®¡å’ŒæŸ¥è¯¢
- [ ] GET /api/projects/:id/statsï¼ˆé¡¹ç›®ç»Ÿè®¡ï¼‰
- [ ] GET /api/tasks?status=queued&priority=P0ï¼ˆç­›é€‰ï¼‰
- [ ] GET /api/goals/:id/tasksï¼ˆç›®æ ‡çš„ä»»åŠ¡ï¼‰

### Phase 4: æµ‹è¯•
- [ ] API é›†æˆæµ‹è¯•
- [ ] é”™è¯¯åœºæ™¯æµ‹è¯•
- [ ] åŒå‘é“¾æ¥æ­£ç¡®æ€§æµ‹è¯•

## ğŸ“ å®ç°ä½ç½®

```
cecelia-workspace/apps/core/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ api/
â”‚       â”œâ”€â”€ db.ts              # æ•°æ®åº“è¿æ¥
â”‚       â”œâ”€â”€ projects.ts        # Projects API
â”‚       â”œâ”€â”€ goals.ts           # Goals API
â”‚       â”œâ”€â”€ tasks.ts           # Tasks API
â”‚       â””â”€â”€ links.ts           # Links API
â””â”€â”€ tests/
    â””â”€â”€ api/
        â”œâ”€â”€ projects.test.ts
        â”œâ”€â”€ tasks.test.ts
        â””â”€â”€ links.test.ts
```

## ğŸš€ ä¸‹ä¸€æ­¥

1. åˆ›å»º db.tsï¼ˆæ•°æ®åº“è¿æ¥ï¼‰
2. å®ç° Projects API
3. å®ç° Tasks APIï¼ˆå« Backlinksï¼‰
4. å®ç° Links API
5. æ·»åŠ åˆ° Core server.ts
6. æµ‹è¯•æ‰€æœ‰ç«¯ç‚¹

---

**æ€»ç»“**ï¼šå®ç°å®Œæ•´çš„ REST APIï¼Œè®©å‰ç«¯å¯ä»¥é€šè¿‡ HTTP è¯·æ±‚æ“ä½œæ•°æ®åº“ä¸­çš„ Projectsã€Goalsã€Tasksï¼Œå¹¶æ”¯æŒåŒå‘é“¾æ¥æŸ¥è¯¢ã€‚
