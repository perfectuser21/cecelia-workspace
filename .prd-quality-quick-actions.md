---
id: quality-quick-actions
version: 1.0.0
created: 2026-01-28
priority: P1
---

# PRD: Quality Monitor v2.1 - Quick Actions (æ§åˆ¶å±‚)

## ç›®æ ‡

ä¸º Quality Monitor æ·»åŠ å¿«é€Ÿæ“ä½œèƒ½åŠ›ï¼Œä»"çœ‹ + ç®¡"å‡çº§ä¸º"çœ‹ + ç®¡ + æ§"ã€‚

**æ ¸å¿ƒè½¬å˜**ï¼š
- âŒ Before: åªèƒ½æŸ¥çœ‹çŠ¶æ€ï¼Œä¸èƒ½ä¸»åŠ¨å¹²é¢„
- âœ… After: å¯ä»¥æ‰‹åŠ¨è§¦å‘è´¨æ£€ã€æ¸…ç©ºé˜Ÿåˆ—ã€åŒæ­¥ Notion

## èƒŒæ™¯

v2.0 å·²å®Œæˆï¼š
- âœ… Run Detail é¡µé¢ï¼ˆæŸ¥çœ‹è¯¦æƒ…ï¼‰
- âœ… Task System Surfaceï¼ˆæŸ¥çœ‹é˜Ÿåˆ—ï¼‰
- âœ… Worker/Queue çŠ¶æ€å¡ç‰‡

**ç”¨æˆ·åé¦ˆ**ï¼š
> "æˆ‘èƒ½çœ‹åˆ°é˜Ÿåˆ—å †ç§¯äº† 10 ä¸ªä»»åŠ¡ï¼Œä½†æˆ‘æƒ³ç«‹å³è§¦å‘ä¸€æ¬¡ QAï¼Œæˆ–è€…æ¸…ç©ºé˜Ÿåˆ—é‡æ¥ï¼Œç°åœ¨åšä¸åˆ°"

## éœ€æ±‚åˆ†æ

### ä½¿ç”¨åœºæ™¯

| åœºæ™¯ | å½“å‰æ“ä½œ | ç—›ç‚¹ | æœŸæœ› |
|------|---------|------|------|
| ä»£ç æ”¹å®Œæƒ³ç«‹å³æµ‹è¯• | ç­‰å¾… Heartbeat è‡ªåŠ¨è§¦å‘ | æœ€é•¿ç­‰ 5 åˆ†é’Ÿ | ç‚¹æŒ‰é’®ç«‹å³è§¦å‘ |
| é˜Ÿåˆ—å †ç§¯äº†è¿‡æœŸä»»åŠ¡ | æ‰‹åŠ¨åˆ é™¤ queue.jsonl | éœ€è¦ SSH åˆ°æœåŠ¡å™¨ | ç‚¹æŒ‰é’®æ¸…ç©ºé˜Ÿåˆ— |
| Worker å¡ä½äº† | é‡å¯ worker è¿›ç¨‹ | éœ€è¦è¿ç»´ä»‹å…¥ | ç‚¹æŒ‰é’®é‡å¯ Worker |
| Notion æ•°æ®ä¸åŒæ­¥ | æ‰‹åŠ¨è°ƒç”¨ API | éœ€è¦çŸ¥é“æ¥å£åœ°å€ | ç‚¹æŒ‰é’®åŒæ­¥ Notion |

### ä¼˜å…ˆçº§åˆ’åˆ†

**P1.0 - æœ¬æ¬¡å¿…åš**ï¼ˆå±é™©æ“ä½œ + å¸¸ç”¨æ“ä½œï¼‰
- [ ] "Run QA Now" æŒ‰é’® - ç«‹å³è§¦å‘è´¨æ£€
- [ ] "Clear Queue" æŒ‰é’®ï¼ˆå¸¦ç¡®è®¤å¼¹çª—ï¼‰- æ¸…ç©ºä»»åŠ¡é˜Ÿåˆ—
- [ ] "Restart Worker" æŒ‰é’®ï¼ˆå¸¦ç¡®è®¤å¼¹çª—ï¼‰- é‡å¯ Worker

**P1.1 - æ¬¡ä¼˜å…ˆçº§**ï¼ˆä½é¢‘æ“ä½œï¼‰
- [ ] "Sync Notion" æŒ‰é’® - æ‰‹åŠ¨åŒæ­¥æ•°æ®åˆ° Notion
- [ ] "Health Check" æŒ‰é’® - æ‰‹åŠ¨è§¦å‘å¥åº·æ£€æŸ¥

---

## åŠŸèƒ½è®¾è®¡

### 1. Quick Actions Bar

**ä½ç½®**ï¼šé¡µé¢é¡¶éƒ¨ï¼Œæ ‡é¢˜ä¸‹æ–¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cecelia Quality Monitor                       â”‚
â”‚                                                 â”‚
â”‚  [â–¶ Run QA Now] [ğŸ”„ Sync Notion] [ğŸ©º Health]   â”‚
â”‚  [ğŸ—‘ï¸ Clear Queue] [ğŸ”„ Restart Worker]          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  (Health cards...)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æŒ‰é’®è®¾è®¡**ï¼š
- ä¸»è¦æ“ä½œï¼ˆç»¿è‰²ï¼‰ï¼šRun QA Now
- æ¬¡è¦æ“ä½œï¼ˆè“è‰²ï¼‰ï¼šSync Notion, Health Check
- å±é™©æ“ä½œï¼ˆçº¢è‰²ï¼‰ï¼šClear Queue, Restart Worker

### 2. Run QA Now

**åŠŸèƒ½**ï¼šæ‰‹åŠ¨è§¦å‘ä¸€æ¬¡ QA æ£€æŸ¥

**äº¤äº’æµç¨‹**ï¼š
1. ç‚¹å‡»æŒ‰é’® â†’ æ˜¾ç¤º Loading çŠ¶æ€
2. è°ƒç”¨ `POST /api/quality/trigger/runQA`
3. æˆåŠŸ â†’ Toast æç¤º "QA task queued: {taskId}"
4. å¤±è´¥ â†’ Toast é”™è¯¯ä¿¡æ¯

**Payload**ï¼š
```json
{
  "source": "manual",
  "priority": "P1",
  "payload": {
    "project": "cecelia-workspace",
    "branch": "develop",
    "triggeredBy": "user"
  }
}
```

**API éœ€æ±‚**ï¼š
```
POST /api/quality/trigger/runQA
Body: { priority, payload }
Response: { taskId, message, queuePosition }
```

---

### 3. Clear Queue

**åŠŸèƒ½**ï¼šæ¸…ç©ºæ‰€æœ‰å¾…å¤„ç†ä»»åŠ¡

**äº¤äº’æµç¨‹**ï¼š
1. ç‚¹å‡»æŒ‰é’® â†’ å¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†
   ```
   âš ï¸ Clear Queue

   This will delete all pending tasks.
   Current queue: 12 tasks

   [Cancel]  [Clear Queue]
   ```
2. ç¡®è®¤ â†’ æ˜¾ç¤º Loading
3. è°ƒç”¨ `DELETE /api/quality/queue/clear`
4. æˆåŠŸ â†’ Toast "Queue cleared (12 tasks deleted)"
5. åˆ·æ–°é˜Ÿåˆ—æ˜¾ç¤º

**API éœ€æ±‚**ï¼š
```
DELETE /api/quality/queue/clear
Response: { cleared: 12, message: "Queue cleared" }
```

---

### 4. Restart Worker

**åŠŸèƒ½**ï¼šé‡å¯ Worker è¿›ç¨‹

**äº¤äº’æµç¨‹**ï¼š
1. ç‚¹å‡»æŒ‰é’® â†’ å¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†
   ```
   âš ï¸ Restart Worker

   This will restart the worker process.
   Current status: Running
   Current task: abc123 (runQA)

   [Cancel]  [Restart]
   ```
2. ç¡®è®¤ â†’ æ˜¾ç¤º Loading
3. è°ƒç”¨ `POST /api/quality/worker/restart`
4. æˆåŠŸ â†’ Toast "Worker restarted"
5. åˆ·æ–° Worker çŠ¶æ€

**API éœ€æ±‚**ï¼š
```
POST /api/quality/worker/restart
Response: { status: "restarted", pid: 12345 }
```

---

### 5. Sync Notion

**åŠŸèƒ½**ï¼šæ‰‹åŠ¨è§¦å‘ Notion æ•°æ®åŒæ­¥

**äº¤äº’æµç¨‹**ï¼š
1. ç‚¹å‡»æŒ‰é’® â†’ æ˜¾ç¤º Loading
2. è°ƒç”¨ `POST /api/quality/trigger/syncNotion`
3. æˆåŠŸ â†’ Toast "Sync task queued"
4. å¤±è´¥ â†’ Toast é”™è¯¯ä¿¡æ¯

**API éœ€æ±‚**ï¼š
```
POST /api/quality/trigger/syncNotion
Response: { taskId, message }
```

---

### 6. Health Check

**åŠŸèƒ½**ï¼šæ‰‹åŠ¨è§¦å‘å¥åº·æ£€æŸ¥

**äº¤äº’æµç¨‹**ï¼š
1. ç‚¹å‡»æŒ‰é’® â†’ æ˜¾ç¤º Loading
2. è°ƒç”¨ `POST /api/quality/trigger/healthCheck`
3. æˆåŠŸ â†’ æ˜¾ç¤ºå¥åº·æ£€æŸ¥ç»“æœå¯¹è¯æ¡†
   ```
   âœ… Health Check Results

   - Worker: âœ… Running (PID 12345)
   - Queue: âœ… 3 tasks pending
   - Heartbeat: âœ… Last run 2m ago
   - Disk: âœ… 45% used
   - Memory: âš ï¸ 82% used

   [Close]
   ```

**API éœ€æ±‚**ï¼š
```
POST /api/quality/trigger/healthCheck
Response: {
  worker: { status: "running", pid: 12345 },
  queue: { length: 3 },
  heartbeat: { lastRun: "2024-01-28T12:00:00Z" },
  disk: { used: 45 },
  memory: { used: 82 }
}
```

---

## æŠ€æœ¯å®ç°

### å‰ç«¯æ¶æ„

```
QualityMonitorPage
â”œâ”€â”€ QuickActionsBar (æ–°å¢)
â”‚   â”œâ”€â”€ RunQAButton
â”‚   â”œâ”€â”€ SyncNotionButton
â”‚   â”œâ”€â”€ HealthCheckButton
â”‚   â”œâ”€â”€ ClearQueueButton (with confirmation)
â”‚   â””â”€â”€ RestartWorkerButton (with confirmation)
â”œâ”€â”€ ConfirmDialog (æ–°å¢)
â””â”€â”€ (existing components...)
```

### API æ–°å¢ç«¯ç‚¹

**Quality API (cecelia-quality/api/server.js)**ï¼š

```javascript
// Trigger QA
POST /api/trigger/runQA
Body: { priority: "P0|P1|P2", payload: {...} }
è¿”å›: { taskId, message, queuePosition }

// Sync Notion
POST /api/trigger/syncNotion
è¿”å›: { taskId, message }

// Health Check
POST /api/trigger/healthCheck
è¿”å›: { worker, queue, heartbeat, disk, memory }

// Clear Queue
DELETE /api/queue/clear
è¿”å›: { cleared: 12, message }

// Restart Worker
POST /api/worker/restart
è¿”å›: { status: "restarted", pid: 12345 }
```

---

## æ•°æ®ç»“æ„

### Trigger Response
```json
{
  "taskId": "uuid",
  "message": "Task queued successfully",
  "queuePosition": 3
}
```

### Health Check Response
```json
{
  "worker": {
    "status": "running",
    "pid": 12345,
    "uptime": 86400
  },
  "queue": {
    "length": 3,
    "oldestAge": 120
  },
  "heartbeat": {
    "lastRun": "2024-01-28T12:00:00Z",
    "nextRun": "2024-01-28T12:05:00Z"
  },
  "disk": {
    "total": 100,
    "used": 45,
    "free": 55
  },
  "memory": {
    "total": 16,
    "used": 82,
    "free": 18
  }
}
```

---

## UI/UX è®¾è®¡

### Quick Actions Bar

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Quick Actions                                  â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ â–¶ Run QA Now â”‚ â”‚ ğŸ”„ Sync      â”‚ â”‚ ğŸ©º Healthâ”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ ğŸ—‘ï¸ Clear     â”‚ â”‚ ğŸ”„ Restart   â”‚             â”‚
â”‚  â”‚   Queue      â”‚ â”‚   Worker     â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Confirmation Dialog

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸  Clear Queue                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                  â”‚
â”‚ This will delete all pending    â”‚
â”‚ tasks in the queue.              â”‚
â”‚                                  â”‚
â”‚ Current queue: 12 tasks          â”‚
â”‚                                  â”‚
â”‚ This action cannot be undone.    â”‚
â”‚                                  â”‚
â”‚  [Cancel]      [Clear Queue]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Toast Notifications

```
âœ… QA task queued (Task ID: abc123)
âœ… Queue cleared (12 tasks deleted)
âœ… Worker restarted (PID: 12345)
âš ï¸ Failed to trigger QA: Worker busy
âŒ Error: API unavailable
```

---

## éªŒæ”¶æ ‡å‡†

è§ .dod.md

---

## å®‰å…¨è€ƒè™‘

### å±é™©æ“ä½œä¿æŠ¤

1. **Clear Queue**:
   - å¿…é¡»äºŒæ¬¡ç¡®è®¤
   - æ˜¾ç¤ºå½“å‰é˜Ÿåˆ—é•¿åº¦
   - è®°å½•æ“ä½œæ—¥å¿—

2. **Restart Worker**:
   - å¿…é¡»äºŒæ¬¡ç¡®è®¤
   - æ˜¾ç¤ºå½“å‰ä»»åŠ¡ä¿¡æ¯
   - ç­‰å¾…å½“å‰ä»»åŠ¡å®Œæˆåé‡å¯ï¼ˆgracefulï¼‰

3. **Rate Limiting**:
   - æ¯ä¸ªæ“ä½œ 5 ç§’å†…åªèƒ½è§¦å‘ 1 æ¬¡
   - å‰ç«¯ç¦ç”¨æŒ‰é’® + åç«¯æ£€æŸ¥

### æƒé™æ§åˆ¶

- æ‰€æœ‰æ“ä½œéƒ½åº”è®°å½•åˆ°æ—¥å¿—ï¼ˆè°ã€ä½•æ—¶ã€åšäº†ä»€ä¹ˆï¼‰
- æœªæ¥å¯æ‰©å±•ï¼šéœ€è¦ admin è§’è‰²æ‰èƒ½æ‰§è¡Œå±é™©æ“ä½œ

---

## é£é™©ä¸ä¾èµ–

### æŠ€æœ¯é£é™©

1. **Worker Restart**:
   - å¦‚æœ Worker æ­£åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œéœ€è¦ graceful shutdown
   - éœ€è¦ Worker æ”¯æŒä¿¡å·å¤„ç†

2. **Queue Clear**:
   - å¦‚æœ Worker æ­£åœ¨å¤„ç†ä»»åŠ¡ï¼Œæ¸…ç©ºé˜Ÿåˆ—ä¸å½±å“æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡
   - éœ€è¦ç¡®ä¿ queue.jsonl æ–‡ä»¶é”

### ä¾èµ–

- cecelia-quality Gateway ç³»ç»Ÿæ­£å¸¸è¿è¡Œ
- Worker æ”¯æŒä¿¡å·å¤„ç†ï¼ˆSIGTERMï¼‰
- æ–‡ä»¶ç³»ç»Ÿæƒé™ï¼ˆè¯»å†™ queue.jsonlï¼‰

---

## å®ç°è®¡åˆ’

**Phase 1: åŸºç¡€æŒ‰é’®**ï¼ˆ2 å°æ—¶ï¼‰
1. åˆ›å»º QuickActionsBar ç»„ä»¶
2. å®ç° "Run QA Now" æŒ‰é’®
3. å®ç° "Sync Notion" æŒ‰é’®

**Phase 2: å±é™©æ“ä½œ**ï¼ˆ2 å°æ—¶ï¼‰
4. åˆ›å»º ConfirmDialog ç»„ä»¶
5. å®ç° "Clear Queue" æŒ‰é’®ï¼ˆå¸¦ç¡®è®¤ï¼‰
6. å®ç° "Restart Worker" æŒ‰é’®ï¼ˆå¸¦ç¡®è®¤ï¼‰

**Phase 3: å¥åº·æ£€æŸ¥**ï¼ˆ1 å°æ—¶ï¼‰
7. å®ç° "Health Check" æŒ‰é’®
8. åˆ›å»º HealthCheckResultDialog ç»„ä»¶

**Phase 4: API å®ç°**ï¼ˆ2 å°æ—¶ï¼‰
9. cecelia-quality æ·»åŠ  5 ä¸ªæ–°ç«¯ç‚¹
10. å®ç° rate limiting
11. æ·»åŠ æ“ä½œæ—¥å¿—

**æ€»è®¡**: çº¦ 7 å°æ—¶

---

## ä¸‹ä¸€æ­¥è®¡åˆ’

**P1.0 å®Œæˆå**ï¼š
- P1.1: æ·»åŠ æ“ä½œå†å²è®°å½•ï¼ˆAudit Logï¼‰
- P2: æ·»åŠ ç»Ÿè®¡å›¾è¡¨ï¼ˆIntent åˆ†å¸ƒã€æˆåŠŸç‡æ›²çº¿ç­‰ï¼‰

---

## å‚è€ƒ

- å½“å‰ Quality Monitor v2.0: apps/core/features/quality/pages/QualityMonitorPage.tsx
- Gateway API: cecelia-quality/gateway/gateway.sh
- Worker API: cecelia-quality/worker/worker.sh
