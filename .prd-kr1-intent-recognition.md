---
id: prd-kr1-intent-recognition
version: 1.0.0
created: 2026-02-01
updated: 2026-02-01
changelog:
  - 1.0.0: 初始版本
---

# PRD - [Retry] Advance "KR1: 意图识别 - 自然语言→OKR/Project/Task" for Cecelia Workspace

## 背景

任务来自 Brain 自动调度系统。根据 Brain status，KR1 (意图识别 - 自然语言→OKR/Project/Task) 当前进度为 0%，需要推进此关键结果以支持 Cecelia 的自然语言交互能力。

当前状态：
- Objective: O1: Cecelia 自驱进化 - 从被动执行器到自驱数字生命体 (P0)
- KR1: 意图识别 - 自然语言→OKR/Project/Task, progress: 0%, gap: 100%
- 系统健康：task_system_ok: true

## 需求来源

Brain 自动调度 - 检测到 KR1 进度为 0%，自动创建推进任务

## 功能描述

本任务需要实现自然语言意图识别功能，将用户的自然语言输入映射到系统的 OKR/Project/Task 结构。

核心能力：
1. **意图分类**：识别用户输入属于哪种操作类型（创建、查询、更新、删除）
2. **实体提取**：从自然语言中提取关键信息（目标、项目名、优先级、截止日期等）
3. **结构化转换**：将提取的信息映射到系统数据模型（Goal、Project、Task）
4. **上下文理解**：支持省略信息的补全和引用解析

### 示例场景

**场景 1：创建目标**
```
用户: "我想在本月完成用户认证系统的重构，这个很重要"
系统识别:
  - 操作: create_goal
  - title: "用户认证系统重构"
  - priority: P0 (从"很重要"推断)
  - deadline: 2026-02-28 (从"本月"推断)
```

**场景 2：创建任务并关联**
```
用户: "添加一个任务：优化登录 API 性能，属于认证系统那个目标"
系统识别:
  - 操作: create_task
  - title: "优化登录 API 性能"
  - goal_id: <从上下文找到"认证系统"对应的 goal>
```

**场景 3：查询状态**
```
用户: "认证系统目标进展怎么样？"
系统识别:
  - 操作: query_goal
  - filter: { title: "认证系统" }
```

## 影响范围

### 涉及的文件
- `apps/core/src/brain/intent-recognizer.js` - 意图识别核心逻辑（新建）
- `apps/core/src/brain/entity-extractor.js` - 实体提取工具（新建）
- `apps/core/src/brain/context-manager.js` - 上下文管理器（新建）
- `apps/core/src/routes/brain.js` - Brain API 路由（添加新端点）
- `apps/core/src/brain/__tests__/intent-recognizer.test.js` - 单元测试（新建）

### 涉及的 API
- `POST /api/brain/intent` - 意图识别端点（新建）
  - 输入: { text: "自然语言", context: { ... } }
  - 输出: { intent: "create_goal", entities: { ... }, confidence: 0.95 }

### 依赖
- Brain 现有的 status API 和 action API
- Task/Goal/Project 数据模型
- 可能需要简单的 NLP 工具（如关键词匹配、模板匹配）

## 非目标

明确说明本次 **不做** 的事情：

- ❌ 不集成大型 NLP 模型（如 GPT、BERT）- 使用简单的规则和模板匹配
- ❌ 不支持复杂的多轮对话管理 - 只处理单次输入
- ❌ 不做多语言支持 - 只支持中文和英文基本识别
- ❌ 不实现语音识别 - 只处理文本输入
- ❌ 不优化性能到 ms 级 - 只要响应时间 < 2s 即可
- ❌ 不处理歧义消解 - 如果识别不确定，返回多个候选让用户选择

## 成功标准

### 1. 意图分类功能
- [ ] 实现至少 5 种基本意图识别：create_goal, create_task, query_goal, update_task, query_status
- [ ] 单元测试：准备 20 个测试用例，覆盖 5 种意图，识别准确率 >= 85%
- [ ] 可通过 API 调用：`curl -X POST /api/brain/intent -d '{"text":"创建一个高优先级目标：完成用户系统"}' | jq .intent` 返回 "create_goal"

### 2. 实体提取功能
- [ ] 能从自然语言中提取 title、priority、deadline、status 等关键字段
- [ ] 测试用例：给定 "本月完成 P0 的认证重构"，能提取 { title: "认证重构", priority: "P0", deadline: "2026-02-28" }
- [ ] 优先级识别：支持 "重要/紧急" → P0, "普通" → P1, "不急" → P2 的映射

### 3. 上下文管理
- [ ] 实现简单的上下文存储：保存最近提到的 goal/task ID
- [ ] 代词解析：用户说 "那个目标" 时，能从上下文找到最近提到的 goal_id
- [ ] 测试：连续两次调用 API，第二次输入 "给它加个任务" 能正确关联第一次创建的 goal

### 4. API 集成
- [ ] POST /api/brain/intent 端点实现并通过手动测试
- [ ] 返回格式包含 intent、entities、confidence 字段
- [ ] 错误处理：无法识别时返回 { intent: "unknown", confidence: 0, suggestions: [...] }

### 5. 文档和测试
- [ ] 添加 `docs/KR1-INTENT-RECOGNITION.md` 说明设计和使用方法
- [ ] 单元测试覆盖率 >= 80%（运行 `npm test -- apps/core/src/brain/__tests__/intent-recognizer.test.js`）
- [ ] 在 Brain status 中更新 KR1 progress 到 >= 50%

## 技术方案

### 1. 意图分类
使用规则匹配 + 关键词识别：
- 创建类：包含 "创建/添加/新建/做一个"
- 查询类：包含 "查看/怎么样/进展/状态"
- 更新类：包含 "更新/修改/改成"

### 2. 实体提取
- 时间解析：识别 "本月/本周/明天" → 具体日期
- 优先级映射：关键词 → P0/P1/P2
- 标题提取：去除意图词后的主要名词短语

### 3. 上下文管理
- 使用 LRU cache 存储最近 10 次对话的实体
- session_id 标识同一会话

### 4. 实现步骤
1. 创建 intent-recognizer.js，实现基本分类
2. 创建 entity-extractor.js，实现关键字段提取
3. 创建 context-manager.js，实现简单上下文
4. 在 brain.js 路由中添加 /api/brain/intent 端点
5. 编写单元测试验证功能
6. 更新文档和 Brain status

## 验收流程

1. 运行单元测试：`npm test -- apps/core/src/brain/__tests__/intent-recognizer.test.js`
2. 手动测试 5 种意图各 2 个用例（共 10 个）
3. 验证 API 响应格式正确
4. 检查文档完整性
5. 更新 Brain KR1 progress
