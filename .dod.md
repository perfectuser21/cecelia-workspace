# DoD - TRD 模板引擎（KR 上下文增强）

QA: docs/QA-DECISION.md

## 验收标准

### 功能验收
- [ ] generateTrdFromGoalKR({ title, kr: { title: 'KR2', progress: 50, priority: 'P0' } }) 返回 markdown 包含 "KR2" 和 "50%"
      Test: apps/core/src/brain/__tests__/templates.test.js
- [ ] 生成的 TRD 通过 validateTrd() 返回 valid: true
      Test: apps/core/src/brain/__tests__/templates.test.js
- [ ] POST /api/brain/generate/trd 传入 { title, kr, project } 返回 200 且 trd 包含 KR 信息
      Test: apps/core/src/brain/__tests__/templates.test.js
- [ ] generateTaskTRD() 写入文件到 PRD_DIR 并返回 { path, validation }
      Test: apps/core/src/brain/__tests__/templates.test.js
- [ ] 无 KR 参数时退化为基础 TRD 模板
      Test: apps/core/src/brain/__tests__/templates.test.js

### 测试验收
- [ ] 所有现有测试通过: npm test (apps/core)
      Test: contract:C2-001
- [ ] 新增至少 5 个测试用例
      Test: apps/core/src/brain/__tests__/templates.test.js
