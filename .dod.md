# DoD - OKR 系统重构为单层 Area OKR 架构 (Hotfix: 修复语法错误)

## 验收标准

### Hotfix 验收 (2026-02-07)
- [ ] 删除 routes.js 第 378-696 行的旧代码
      Test: manual:文件检查
- [ ] routes.js 语法检查通过：`node -c apps/core/dist/okr/routes.js`
      Test: contract:语法检查
- [ ] 服务正常启动：`pm2 restart cecelia-core` 无错误
      Test: manual:服务健康检查
- [ ] OKR API 端点正常：`curl http://localhost:5211/api/okr/areas` 返回数据
      Test: manual:API 测试

### 数据库验收
- [ ] key_results 表创建成功，包含所有必要字段
      Test: manual:数据库表结构验证
- [ ] goals 表修改成功，只保留 business_id，删除 project_id/department_id/parent_id
      Test: manual:数据库表结构验证
- [ ] projects 表添加 contributes_to_kr_id 字段
      Test: manual:数据库表结构验证

### 后端 API 验收
- [ ] GET /api/okr/areas 返回所有 Area + OKR 统计
      Test: manual:API 测试
- [ ] GET /api/okr/areas/:areaId 返回单个 Area 的完整 OKR（O + KRs）
      Test: manual:API 测试
- [ ] GET /api/okr/objectives/:id 返回单个 Objective + 所有 KR
      Test: manual:API 测试
- [ ] GET /api/okr/key-results/:id 返回单个 KR + 贡献的 Projects
      Test: manual:API 测试
- [ ] POST /api/okr/objectives 创建 Objective 成功
      Test: manual:API 测试
- [ ] POST /api/okr/key-results 创建 Key Result 成功
      Test: manual:API 测试
- [ ] PATCH /api/okr/key-results/:id 更新 KR 进度成功
      Test: manual:API 测试

### 前端功能验收
- [ ] OKRDashboard 显示季度选择器（2026 Q1）
      Test: manual:浏览器访问 /work/okr
- [ ] OKRDashboard 显示整体统计（Areas 数量、平均进度）
      Test: manual:浏览器访问 /work/okr
- [ ] OKRDashboard 显示 Areas 卡片网格
      Test: manual:浏览器访问 /work/okr
- [ ] 点击 Area 卡片进入 AreaOKRDetail 页面
      Test: manual:点击测试
- [ ] AreaOKRDetail 显示 Area 的所有 Objectives
      Test: manual:浏览器访问 /work/okr/area/:id
- [ ] AreaOKRDetail 显示每个 O 的所有 KR
      Test: manual:浏览器访问 /work/okr/area/:id
- [ ] KR 显示标题、目标值、当前值、进度条、状态
      Test: manual:UI 验证
- [ ] KR 显示贡献该 KR 的 Projects 列表
      Test: manual:UI 验证
- [ ] 页面无 emoji，设计简洁
      Test: manual:UI 验证

### 数据验收
- [ ] 测试数据生成：ZenithJoy 2 个 Objectives
      Test: manual:数据库查询验证
- [ ] 测试数据生成：每个 O 有 3-5 个 KR
      Test: manual:数据库查询验证
- [ ] 测试数据生成：Stock 1 个 Objective 有 3 个 KR
      Test: manual:数据库查询验证
- [ ] 旧的 3 层测试数据清理完成
      Test: manual:数据库查询验证

### 构建验收
- [ ] npm run build 成功（无错误）
      Test: contract:C2-001
- [ ] 前端访问 /work/okr 正常显示
      Test: manual:浏览器访问测试
