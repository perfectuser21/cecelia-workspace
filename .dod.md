# DoD - OKR 三层架构前端 UI (Phase 2)

## 验收清单

### 1. Business 管理页面

#### 1.1 列表展示
- [x] Test: Business 列表 API 调用成功
  - **Method**: 打开 `/work/businesses`，检查网络请求 `GET /api/tasks/businesses`
  - **Expected**: 返回 200，显示 Stock 和 ZenithJoy

- [x] Test: 表格显示所有字段
  - **Method**: 检查表格列头和数据
  - **Expected**: Name, Owner, Departments Count, Status, Created 字段都显示

#### 1.2 创建 Business
- [x] Test: 点击 "+ New" 打开表单弹窗
  - **Method**: 点击 "+ New Business" 按钮
  - **Expected**: 弹窗显示，包含 name, owner, description, status 字段

- [x] Test: 提交表单创建 Business
  - **Method**: 填写 name="Test Business"，点击 "Create"
  - **Expected**: `POST /api/tasks/businesses` 请求成功，列表刷新，新 Business 出现

- [x] Test: 必填字段验证
  - **Method**: 不填 name，点击 "Create"
  - **Expected**: 显示错误提示 "Name is required"

#### 1.3 编辑 Business
- [x] Test: 内联编辑 Business 名称
  - **Method**: 点击 Business 名称，修改为 "Stock Updated"，回车
  - **Expected**: `PATCH /api/tasks/businesses/:id` 请求成功，名称更新

#### 1.4 删除 Business
- [x] Test: 删除 Business 带确认
  - **Method**: 点击删除图标，确认弹窗
  - **Expected**: 显示确认对话框 "Are you sure?"

- [x] Test: 确认删除后 Business 消失
  - **Method**: 确认删除
  - **Expected**: `DELETE /api/tasks/businesses/:id` 请求成功，列表刷新

---

### 2. Department 管理页面

#### 2.1 列表展示
- [x] Test: Department 列表 API 调用
  - **Method**: 打开 `/work/departments`
  - **Expected**: `GET /api/tasks/departments` 返回 200

- [x] Test: 按 Business 分组显示
  - **Method**: 检查页面分组
  - **Expected**: "ZenithJoy" 分组下显示 "Content Team" 和 "Tech Team"

#### 2.2 创建 Department
- [x] Test: 选择 Business 创建 Department
  - **Method**: 点击 "+ New"，选择 business="ZenithJoy"，填写 name="Design Team"
  - **Expected**: `POST /api/tasks/departments` 成功，新 Department 出现在 ZenithJoy 分组下

#### 2.3 过滤功能
- [x] Test: 按 Business 过滤
  - **Method**: 选择 Business 下拉框 → "Stock"
  - **Expected**: 只显示 Stock 相关的 Departments

---

### 3. OKR 三层视图

#### 3.1 树形视图
- [x] Test: 加载三层 OKR 数据
  - **Method**: 打开 `/work/okr-hierarchy`
  - **Expected**: 并发请求 `GET /api/tasks/goals?scope=personal/business/department`

- [x] Test: 显示层级结构
  - **Method**: 检查树形结构
  - **Expected**: Personal O → KR (关联 Business) → Business O → Department O

- [x] Test: 折叠/展开节点
  - **Method**: 点击节点左侧箭头
  - **Expected**: 子节点显示/隐藏

- [x] Test: 显示进度条和标签
  - **Method**: 检查每个节点
  - **Expected**: 显示进度条（0-100%），Status badge, Priority badge

#### 3.2 看板视图
- [x] Test: 切换到看板视图
  - **Method**: 点击 "Board View" 按钮
  - **Expected**: 显示三列：Personal | Business | Department

- [x] Test: 每列显示对应 scope 的 goals
  - **Method**: 检查每列数据
  - **Expected**: Personal 列只显示 scope=personal 的 goals

---

### 4. 时间追踪可视化

#### 4.1 时间字段显示
- [x] Test: 显示预期时间
  - **Method**: 点击某个 OKR 节点查看详情
  - **Expected**: 显示 "Expected: 2026-01-01 → 2026-03-31"

- [x] Test: 显示实际时间
  - **Method**: 同上
  - **Expected**: 显示 "Actual: 2026-01-02 → (In Progress)"

#### 4.2 时间偏差计算
- [x] Test: 计算延迟天数
  - **Method**: 检查时间偏差
  - **Expected**: 显示 "+1 天 (延迟启动)"

- [x] Test: 颜色区分状态
  - **Method**: 检查时间条颜色
  - **Expected**: 延期=红色，提前=绿色，进行中=蓝色

---

### 5. 路由集成

#### 5.1 Tab 导航
- [x] Test: `/work` 新增 tabs
  - **Method**: 访问 `/work`，检查 tab 列表
  - **Expected**: 显示 "Businesses", "Departments", "OKR Hierarchy" tabs

- [x] Test: URL 同步
  - **Method**: 点击 "Businesses" tab
  - **Expected**: URL 变为 `/work/businesses`

- [x] Test: 刷新页面保持 tab
  - **Method**: 在 `/work/businesses` 页面刷新
  - **Expected**: Businesses tab 保持选中状态

---

### 6. 前端构建和质量

#### 6.1 构建
- [ ] Test: TypeScript 编译通过
  - **Method**: `npm run build`
  - **Expected**: 无 TypeScript 错误，dist 目录生成

#### 6.2 运行时
- [ ] Test: 页面加载无白屏
  - **Method**: 访问所有新页面
  - **Expected**: 无 React 错误，Console 无报错

- [ ] Test: API 错误处理
  - **Method**: 断开网络，刷新页面
  - **Expected**: 显示错误提示 "Failed to load data"

---

## CI 检查映射

### DoD 1.1-1.4: Business 管理
- **CI Check**: TypeScript 编译
- **File**: `apps/core/features/planning/pages/BusinessManagement.tsx`

### DoD 2.1-2.3: Department 管理
- **CI Check**: TypeScript 编译
- **File**: `apps/core/features/planning/pages/DepartmentManagement.tsx`

### DoD 3.1-3.2: OKR 三层视图
- **CI Check**: TypeScript 编译
- **File**: `apps/core/features/planning/pages/OKRHierarchyView.tsx`

### DoD 4.1-4.2: 时间追踪
- **CI Check**: TypeScript 编译
- **File**: `apps/core/features/planning/components/TimeTrackingView.tsx`

### DoD 5.1: 路由集成
- **CI Check**: TypeScript 编译
- **File**: `apps/core/features/work/pages/WorkTabbed.tsx`

### DoD 6.1-6.2: 构建和质量
- **CI Check**: npm run build
- **Expected**: Exit code 0, no TypeScript errors

---

## 手动测试步骤

### 完整流程测试

1. **创建 Business**:
   ```
   访问 /work/businesses → 点击 "+ New" → 填写表单 → 提交
   验证：列表中出现新 Business
   ```

2. **创建 Department**:
   ```
   访问 /work/departments → 点击 "+ New" → 选择 Business → 填写表单 → 提交
   验证：Department 出现在对应 Business 分组下
   ```

3. **查看 OKR 层级**:
   ```
   访问 /work/okr-hierarchy → 查看树形结构
   验证：Personal O → Business O → Department O 层级正确
   ```

4. **检查时间追踪**:
   ```
   点击某个 OKR 节点 → 查看详情弹窗
   验证：预期/实际时间、偏差计算正确
   ```

5. **删除测试数据**:
   ```
   删除 Department → 删除 Business
   验证：级联删除正常，列表刷新
   ```

---

## 非功能验收

- [ ] **性能**: 首屏加载 < 2s，API 响应 < 500ms
- [ ] **UX**: Notion-style 色彩，动画流畅（20ms transition）
- [ ] **响应式**: 1440px 宽屏显示正常
- [ ] **可访问性**: Tab 键导航，ARIA labels
- [ ] **错误处理**: API 失败显示友好提示
