# DoD: 模仿 Notion Database 丝滑体验改进 TaskDatabase

## 改动清单

### 1. 超快速过渡动画
- [ ] 所有交互元素使用 `transition: background 0.02s ease-in`
- [ ] 移除 `transition: all` 宽泛过渡
- [ ] 表格行 hover: `background 0.02s ease-in`
- [ ] 按钮 hover: `background 0.02s ease-in`
- [ ] Priority/Status 标签: `background 0.02s ease-in`
- **Test**: Hover 表格行，背景色几乎即时变化，无延迟感

### 2. 分组折叠结构
- [ ] 添加 `expandedGroups: Set<string>` state
- [ ] 实现 `toggleGroup(groupKey)` 函数
- [ ] 按 groupBy 值对任务分组（Object.entries(groupedTasks)）
- [ ] 渲染分组头部：折叠按钮 + Chevron icon + 分组名 + 任务数
- [ ] 渲染独立表头（每个分组）
- [ ] 渲染分组内任务列表
- [ ] Chevron icon 旋转动画（transform: rotate(90deg)）
- **Test**: 切换 GroupBy 后看到分组结构，点击分组头可折叠/展开

### 3. Notion 风格 Priority 标签
- [ ] P0: `background: rgba(212, 76, 71, 0.1)`, `color: rgb(212, 76, 71)`
- [ ] P1: `background: rgba(233, 168, 0, 0.1)`, `color: rgb(233, 168, 0)`
- [ ] P2: `background: rgba(0, 135, 107, 0.1)`, `color: rgb(0, 135, 107)`
- [ ] padding: `2px 6px`, borderRadius: `3px`, fontSize: `14px`
- **Test**: Priority 标签显示正确颜色（红/黄/绿半透明背景）

### 4. Notion 风格 Status 标签
- [ ] pending: `background: rgba(206, 205, 202, 0.5)`, `color: rgba(55, 53, 47, 0.6)`
- [ ] in_progress: `background: rgba(35, 131, 226, 0.1)`, `color: rgb(35, 131, 226)`
- [ ] completed: `background: rgba(0, 135, 107, 0.1)`, `color: rgb(0, 135, 107)`
- [ ] padding: `2px 6px`, borderRadius: `3px`, fontSize: `14px`
- **Test**: Status 标签显示正确颜色

### 5. 表格行 Hover
- [ ] 默认背景 `transparent`
- [ ] Hover 背景 `rgba(0, 0, 0, 0.03)`
- [ ] transition: `background 0.02s ease-in`
- [ ] cursor: `pointer`
- **Test**: Hover 行时背景快速变浅灰色

### 6. GroupBy 选择器
- [ ] padding: `6px 12px`
- [ ] fontWeight: `500`
- [ ] borderRadius: `4px`
- [ ] transition: `background 0.02s ease-in`
- **Test**: 选择器样式符合 Notion 风格

## 验收标准

### 构建
- [ ] `npm run build` 通过（无 TypeScript/ESLint 错误）

### 功能测试
- [ ] GroupBy 为 "none" 时显示平铺列表
- [ ] GroupBy 为 "status/priority/project" 时显示分组结构
- [ ] 点击分组头部可折叠/展开
- [ ] Chevron icon 正确旋转
- [ ] 分页功能正常
- [ ] 排序功能正常
- [ ] 内联编辑 Priority/Status 正常

### 视觉测试
- [ ] Priority 标签颜色正确（P0红/P1黄/P2绿）
- [ ] Status 标签颜色正确
- [ ] Hover 表格行背景色快速变化（20ms，无延迟感）
- [ ] Hover 按钮背景色快速变化
- [ ] 所有交互感觉"即时但不生硬"

### 兼容性
- [ ] localStorage 持久化正常（pageSize, sortBy, groupBy）
- [ ] 原有功能不受影响
- [ ] 无 console 错误

## RCI (Regression Critical Items)

由于这是视觉/交互改进，主要关注：

1. **分组逻辑**
   - RCI: 分组计算逻辑正确，任务不丢失
   - Test: 验证所有任务都出现在正确的分组中

2. **状态管理**
   - RCI: expandedGroups state 正确更新
   - Test: 折叠/展开状态持久化（刷新后保持）

3. **性能**
   - RCI: 大量任务时（100+）不卡顿
   - Test: 渲染 100 个任务，Hover 仍然流畅

## 文件影响范围

- `apps/core/features/planning/pages/TaskDatabase.tsx` (主要改动)

## 风险评估

- **低风险**：纯视觉/CSS 改动，不改变业务逻辑
- **中风险**：分组折叠结构改动较大，需要仔细测试
- **缓解措施**：保留原有数据处理逻辑，只改变渲染方式
