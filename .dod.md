---
id: dod-failed-task-retry
version: 1.1.0
created: 2026-01-31
updated: 2026-01-31
changelog:
  - 1.1.0: 修正验收结构，对齐 PRD 5 条成功标准
  - 1.0.0: 初始版本
---

# DoD - 失败任务智能重试

QA: docs/QA-DECISION.md

## 验收标准（对应 PRD 5 条成功标准）

### SC1: 失败任务分类
- [ ] analyzeFailure(task) 将失败归类为 timeout / code_error / infra_error / prd_unclear
      Test: unit:retry-analyzer.test.js — 4 种 error 模式各至少 1 个用例

### SC2: 不同类别不同策略
- [ ] timeout → dispatch_timeout * 1.5
- [ ] infra_error → retry_delay_ms = 600000
- [ ] prd_unclear → should_retry = false（不重试，标记 abandoned）
      Test: unit:retry-analyzer.test.js — 验证 adjustments 对象各字段

### SC3: retry payload 含 failure_analysis
- [ ] 新建的 retry 任务 payload 包含 `{ failure_analysis: { category, reason, adjustments } }`
      Test: unit:验证 planner retryFailedTasks 生成的任务 payload 结构

### SC4: max_retries 限制
- [ ] retry_count >= 2 的任务不创建重试，状态更新为 abandoned
- [ ] prd_unclear 类任务直接 abandoned，不重试
      Test: unit:传入 retry_count=2 的任务验证不入队

### SC5: brain/status 含 retry_summary
- [ ] GET /api/brain/status 返回 task_digest.retry_summary = { failed_count, retrying_count, abandoned_count }
      Test: manual:curl localhost:5212/api/brain/status | jq .task_digest.retry_summary

## 关联 PRD

.prd.md
