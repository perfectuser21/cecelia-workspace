# DoD - 失败任务自动重试

QA: docs/QA-DECISION.md

## 验收标准

### 功能验收 - analyzeFailure()
- [ ] 输入 status="timeout" → failureType="timeout", retryable=true
      Test: tests/brain/retry-analyzer.test.js
- [ ] 输入 result_summary="CI check failed" → failureType="ci_failure", retryable=true
      Test: tests/brain/retry-analyzer.test.js
- [ ] 输入 result_summary="npm ERR" → failureType="env_error", retryable=false
      Test: tests/brain/retry-analyzer.test.js
- [ ] 输入 result_summary="something" → failureType 为 code_error 或 unknown, retryable=true
      Test: tests/brain/retry-analyzer.test.js

### 功能验收 - 自动重试入队
- [ ] execution-callback 失败且 retry_count=0 时创建重试任务 (status=queued, retry_count=1)
      Test: tests/brain/retry-analyzer.test.js
- [ ] execution-callback 失败且 retry_count>=2 时不创建重试任务
      Test: tests/brain/retry-analyzer.test.js
- [ ] autoFailTimedOutTasks 超时时分析并创建重试任务
      Test: tests/brain/retry-analyzer.test.js
- [ ] 重试时 EventBus emit task_retried 事件
      Test: tests/brain/retry-analyzer.test.js

### 功能验收 - API
- [ ] GET /api/brain/retry-policy 返回 max_retries, retryable_types, non_retryable_types
      Test: manual:curl localhost:5212/api/brain/retry-policy
- [ ] POST /api/brain/tasks/:id/retry 创建重试任务并返回新任务
      Test: manual:curl -X POST localhost:5212/api/brain/tasks/test-id/retry

### 测试验收
- [ ] 所有单元测试通过
      Test: tests/brain/retry-analyzer.test.js
