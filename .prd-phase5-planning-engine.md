---
id: prd-phase5-planning-engine
version: 1.0.0
created: 2026-01-30
---

# PRD: Phase 5.2 - Planning Engine

## 背景

Memory Schema 已就绪，现在需要 Planning Engine 来：
- 从 OKR/Goals 生成可执行任务
- 根据优先级和依赖自动排序
- 支持 Daily/Weekly 计划生成

## 目标

让 Cecelia 能够"自己想下一步干什么"，而不是等人喂任务。

## 核心流程

```
Goals/OKR → Planning Engine → Tasks → Autumnrice 执行
     ↑                              ↓
  Memory ←────── 反馈/学习 ←────── Evidence
```

## 功能设计

### 1. Plan Generation API

```
POST /api/brain/plan/generate
{
  "scope": "daily" | "weekly",
  "context": {
    "current_focus": "...",     // 从 working memory 读取
    "preferences": {...}         // 从 longterm memory 读取
  }
}

Response:
{
  "plan_id": "plan_20260130_daily",
  "scope": "daily",
  "tasks": [
    {
      "title": "完成 Memory Schema 测试",
      "priority": "P0",
      "estimated_hours": 2,
      "depends_on": [],
      "goal_id": "xxx"
    },
    ...
  ],
  "reasoning": "基于当前 OKR 进度和 P0 任务..."
}
```

### 2. Plan 存储

计划存储在 Memory 的 working layer：
- key: `plan_daily_20260130`
- category: `state`
- value: 计划内容 + 状态

### 3. Plan Execution Tracking

```
GET /api/brain/plan/status
{
  "active_plan": "plan_daily_20260130",
  "progress": {
    "total": 5,
    "completed": 2,
    "in_progress": 1,
    "blocked": 0
  },
  "next_task": {...}
}
```

### 4. Nightly Review (自动触发)

每天 23:00 自动运行：
1. 统计今日完成情况
2. 分析未完成原因
3. 生成 lesson 存入 longterm memory
4. 预生成明日计划

## 实现范围

### Phase 5.2a: 基础计划生成
- [ ] POST /api/brain/plan/generate（daily scope）
- [ ] GET /api/brain/plan/status
- [ ] 计划存储到 Memory

### Phase 5.2b: 智能排序 + Review
- [ ] 任务依赖分析
- [ ] 优先级自动调整
- [ ] Nightly Review 自动任务

## 成功标准

1. 调用 plan/generate 能生成合理的日计划
2. 计划基于当前 OKR 和任务状态
3. 计划存储在 working memory，可查询

## 依赖

- Memory Schema (Phase 5.1) ✅
- OKR/Goals API (已有)
- Tasks API (已有)

## 技术方案

Planning Engine 不需要 LLM，使用规则引擎：
1. 读取所有 P0/P1 未完成任务
2. 按 goal 优先级排序
3. 按 deadline 排序
4. 考虑 estimated_hours 和可用时间
5. 输出排序后的任务列表
