---
id: quality-control-hub
version: 2.0.0
created: 2026-01-28
priority: P0
---

# PRD: Quality Monitor v2 - Decision + Execution Hub

## ç›®æ ‡

å°† Quality Monitor ä» **"è§‚å¯Ÿé¢æ¿"** å‡çº§ä¸º **"å†³ç­–+æ‰§è¡Œä¸­æ¢"**ã€‚

**æ ¸å¿ƒè½¬å˜**ï¼š
- âŒ Before: åªèƒ½"çœ‹"ï¼ˆ4 ä¸ªå¡ç‰‡ + 1 ä¸ªè¡¨æ ¼ï¼‰
- âœ… After: èƒ½"çœ‹ + ç®¡ + æ§"ï¼ˆç”Ÿå‘½ä½“çš„å‰é¢å¶ï¼‰

## èƒŒæ™¯

å½“å‰ v1.0 æ˜¯æœ€ç®€åŒ– MVPï¼š
- âœ… æ˜¾ç¤ºå¥åº·çŠ¶æ€ï¼ˆderivedHealthï¼‰
- âœ… æ˜¾ç¤ºç»Ÿè®¡æ•°å­—ï¼ˆtotal/succeeded/failedï¼‰
- âœ… æ˜¾ç¤ºæœ€è¿‘ runs åˆ—è¡¨
- âŒ ç¼ºå°‘ Run è¯¦æƒ…ï¼ˆæ— æ³•çœ‹åˆ° tests/evidenceï¼‰
- âŒ ç¼ºå°‘ Task System å¯è§†åŒ–ï¼ˆçœ‹ä¸åˆ°é˜Ÿåˆ—ï¼‰
- âŒ ç¼ºå°‘æ§åˆ¶èƒ½åŠ›ï¼ˆæ— æ³•è§¦å‘æ“ä½œï¼‰

**ç”¨æˆ·åé¦ˆ**ï¼š
> "ä½ å·²ç»æœ‰äº†'ç”Ÿå‘½ä½“çš„çœ¼ç›'ï¼Œç°åœ¨è¯¥åšçš„æ˜¯è®©å®ƒå˜æˆ'ç”Ÿå‘½ä½“çš„å¤§è„‘å‰é¢å¶'"

## ç³»ç»Ÿçš„ 3 æ¡æ ¸å¿ƒç”Ÿå‘½çº¿

### ğŸ§  1. ç³»ç»Ÿå¥åº·ï¼ˆHealth Surfaceï¼‰

**è®©ä½ ä¸€çœ¼çŸ¥é“ç³»ç»Ÿæ˜¯ä¸æ˜¯"æ´»ç€ + è‡ªé©±"**

å¿…éœ€å±•ç¤ºï¼š
- `derivedHealth`ï¼ˆgreen/yellow/redï¼‰ä¸‰æ€
- æœ€æ–° run çŠ¶æ€ï¼ˆsuccess/failed/skippedï¼‰
- Heartbeat æœ€è¿‘æ‰§è¡Œæ—¶é—´
- Worker çŠ¶æ€ï¼ˆIdle/Running/Failedï¼‰
- é”™è¯¯æ±‡æ€»ï¼ˆlastErrorï¼‰
- Queue/Pending length + æœ€è€ä»»åŠ¡å¹´é¾„

**è§†è§‰è®¾è®¡**ï¼š
- Health å¤§å¡ç‰‡ï¼ˆå¸¦è„‰åŠ¨åŠ¨ç”»ï¼‰
- Worker çŠ¶æ€æŒ‡ç¤ºå™¨
- Heartbeat å€’è®¡æ—¶
- Queue é˜Ÿåˆ—é•¿åº¦ï¼ˆçº¢è‰²é¢„è­¦ > 5ï¼‰

---

### ğŸ”§ 2. ä»»åŠ¡ç³»ç»Ÿï¼ˆTask System Surfaceï¼‰

**è¿™æ˜¯ç³»ç»Ÿçš„"è¡€æ¶²å¾ªç¯ç³»ç»Ÿ"**

å¿…éœ€å±•ç¤ºï¼š
- **Pending Tasks** é˜Ÿåˆ—é•¿åº¦
- æ¯ä¸ªä»»åŠ¡çš„ intentï¼ˆrunQA/fixBug/refactor/optimizeSelfï¼‰
- Sourceï¼ˆcloudcode/notion/n8n/heartbeatï¼‰
- ä»»åŠ¡å¹´é¾„ï¼ˆå…¥é˜Ÿå¤šä¹…äº†ï¼‰
- ä¼˜å…ˆçº§ï¼ˆP0/P1/P2ï¼‰
- Worker å½“å‰å¤„ç†çš„ä»»åŠ¡ ID

**äº¤äº’**ï¼š
- ç‚¹å‡»ä»»åŠ¡ â†’ æŸ¥çœ‹ payload
- åˆ é™¤ä»»åŠ¡æŒ‰é’®ï¼ˆå±é™©æ“ä½œï¼‰
- ä¼˜å…ˆçº§æ’åº
- Source ç­›é€‰

**API éœ€æ±‚**ï¼š
```
GET /api/quality/queue      # è·å–é˜Ÿåˆ—
GET /api/quality/worker     # Worker çŠ¶æ€
DELETE /api/quality/queue/:taskId  # åˆ é™¤ä»»åŠ¡
POST /api/quality/enqueue   # æ‰‹åŠ¨å…¥é˜Ÿ
```

---

### ğŸ“¦ 3. è¿è¡Œäº§ç‰©ï¼ˆExecution Surface / Runsï¼‰

**æ¯ä¸€ä¸ª run æ˜¯ç”Ÿå‘½ä½“ä¸€æ¬¡"å†³ç­– â†’ è¡ŒåŠ¨ â†’ ç»“æœ"çš„å‘¨æœŸ**

#### 3.1 Runs åˆ—è¡¨ï¼ˆå·²å®Œæˆ âœ…ï¼‰
- runId / intent / duration / completedAt
- Status badgeï¼ˆcompleted/failedï¼‰

#### 3.2 Run Detailï¼ˆP0 ä¼˜å…ˆçº§ï¼‰
ç‚¹å‡» Run ID â†’ å±•å¼€è¯¦æƒ…é¢æ¿ï¼š

**å¿…é¡»å±•ç¤º**ï¼š
- Summary æ¦‚è§ˆ
  - taskId, intent, source, priority
  - startedAt, completedAt, duration
  - statusï¼ˆcompleted/failedï¼‰
  - errorï¼ˆå¦‚æœæœ‰ï¼‰

- Tests ç»“æœ
  - total / passed / failed / skipped
  - Skipped details åˆ—è¡¨ï¼ˆid + reasonï¼‰
  - æ¯ä¸ª test çš„æ‰§è¡Œæ—¥å¿—

- Evidence æ–‡ä»¶
  - æ–‡ä»¶åˆ—è¡¨ï¼ˆqa-output.log, result.json, task.json...ï¼‰
  - ç‚¹å‡»ä¸‹è½½/æŸ¥çœ‹

**API éœ€æ±‚**ï¼š
```
GET /api/quality/runs/:runId          # å·²æœ‰
GET /api/quality/runs/:runId/result   # å·²æœ‰
GET /api/quality/runs/:runId/evidence # æ–°å¢
GET /api/quality/runs/:runId/logs/:filename  # æ–°å¢
```

---

## ä¼˜å…ˆçº§åˆ’åˆ†

### ğŸ”¥ P0 - æœ¬æ¬¡å¿…åšï¼ˆRun Detail + Task Systemï¼‰

**é˜¶æ®µ 1ï¼šRun Detail é¡µé¢**
- [ ] åˆ›å»º RunDetailPanel ç»„ä»¶ï¼ˆå³ä¾§æŠ½å±‰å¼ï¼‰
- [ ] æ˜¾ç¤º summary ä¿¡æ¯
- [ ] æ˜¾ç¤º tests ç»“æœï¼ˆé¥¼å›¾ + åˆ—è¡¨ï¼‰
- [ ] æ˜¾ç¤º skipped_detailsï¼ˆå¯å±•å¼€ï¼‰
- [ ] æ˜¾ç¤º evidence æ–‡ä»¶åˆ—è¡¨
- [ ] ç‚¹å‡» Run ID è§¦å‘æŠ½å±‰æ‰“å¼€

**é˜¶æ®µ 2ï¼šTask System Surface**
- [ ] æ·»åŠ  Queue å¡ç‰‡ï¼ˆæ˜¾ç¤º pending lengthï¼‰
- [ ] åˆ›å»º Task Queue åˆ—è¡¨ç»„ä»¶
- [ ] æ˜¾ç¤ºæ¯ä¸ªä»»åŠ¡çš„è¯¦ç»†ä¿¡æ¯
- [ ] æ·»åŠ  Worker Status æŒ‡ç¤ºå™¨
- [ ] API: GET /api/quality/queue
- [ ] API: GET /api/quality/worker

**ä¼°ç®—æ—¶é—´**ï¼š2-3 å°æ—¶

---

### âš¡ P1 - æ§åˆ¶å±‚ï¼ˆQuick Actionsï¼‰

**å¿«é€Ÿæ“ä½œæŒ‰é’®**ï¼š
- [ ] "Run QA Now" æŒ‰é’®
- [ ] "Sync Notion" æŒ‰é’®
- [ ] "Health Check" æŒ‰é’®
- [ ] "Clear Queue" æŒ‰é’®ï¼ˆå¸¦ç¡®è®¤ï¼‰

**API éœ€æ±‚**ï¼š
```
POST /api/quality/trigger/runQA
POST /api/quality/trigger/healthCheck
POST /api/quality/trigger/syncNotion
DELETE /api/quality/queue/clear
```

---

### ğŸ“Š P2 - å¢å¼ºå¯è§†åŒ–

**ç»Ÿè®¡å›¾è¡¨**ï¼š
- [ ] Intent åˆ†å¸ƒé¥¼å›¾
- [ ] Source åˆ†å¸ƒé¥¼å›¾
- [ ] 24h æˆåŠŸç‡æ›²çº¿
- [ ] å¹³å‡æ‰§è¡Œæ—¶é—´è¶‹åŠ¿

---

## æŠ€æœ¯å®ç°

### å‰ç«¯æ¶æ„

```
QualityMonitorPage (ä¸»é¡µé¢)
â”œâ”€â”€ HealthSection (å¥åº·å¡ç‰‡åŒº)
â”‚   â”œâ”€â”€ SystemHealthCard
â”‚   â”œâ”€â”€ WorkerStatusCard
â”‚   â”œâ”€â”€ HeartbeatCard
â”‚   â””â”€â”€ QueueCard
â”œâ”€â”€ TaskSystemSection (ä»»åŠ¡ç³»ç»ŸåŒº)
â”‚   â”œâ”€â”€ QueueOverview
â”‚   â””â”€â”€ TaskList
â”œâ”€â”€ RunsSection (è¿è¡Œå†å²åŒº)
â”‚   â””â”€â”€ RunsTable (å·²æœ‰)
â””â”€â”€ RunDetailPanel (ä¾§è¾¹æŠ½å±‰ - æ–°å¢)
    â”œâ”€â”€ SummaryTab
    â”œâ”€â”€ TestsTab
    â””â”€â”€ EvidenceTab
```

### API æ–°å¢ç«¯ç‚¹

**Quality API (cecelia-quality/api/server.js)**ï¼š

```javascript
// Worker çŠ¶æ€
GET /api/worker
è¿”å›: { status: "idle|running", currentTask: {...}, uptime: 123 }

// Queue çŠ¶æ€
GET /api/queue
è¿”å›: [{ taskId, intent, source, priority, createdAt, age }]

// Evidence æ–‡ä»¶åˆ—è¡¨
GET /api/runs/:runId/evidence
è¿”å›: ["qa-output.log", "result.json", ...]

// ä¸‹è½½ Evidence æ–‡ä»¶
GET /api/runs/:runId/logs/:filename
è¿”å›: æ–‡ä»¶å†…å®¹ï¼ˆtext/plainï¼‰

// è§¦å‘æ“ä½œ
POST /api/trigger/:intent
Body: { priority: "P0", payload: {...} }
è¿”å›: { taskId, message }

// åˆ é™¤é˜Ÿåˆ—ä»»åŠ¡
DELETE /api/queue/:taskId
è¿”å›: { success: true }
```

---

## æ•°æ®ç»“æ„

### Worker State
```json
{
  "status": "idle|running",
  "currentTask": {
    "taskId": "uuid",
    "intent": "runQA",
    "startedAt": "2026-01-28T00:00:00Z"
  },
  "uptime": 86400,
  "lastCrash": null
}
```

### Queue Item
```json
{
  "taskId": "uuid",
  "source": "cloudcode",
  "intent": "runQA",
  "priority": "P1",
  "payload": {...},
  "createdAt": "2026-01-28T00:00:00Z",
  "age": 120
}
```

---

## UI/UX è®¾è®¡

### å¸ƒå±€ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cecelia Quality Monitor                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚Healthâ”‚ â”‚Workerâ”‚ â”‚Heart â”‚ â”‚Queue â”‚          â”‚
â”‚  â”‚green â”‚ â”‚Idle  â”‚ â”‚2m agoâ”‚ â”‚  3   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Task Queue (3 pending)          [+Add] â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ P0  runQA      cloudcode    2m ago   [x]â”‚   â”‚
â”‚  â”‚ P1  fixBug     n8n          5m ago   [x]â”‚   â”‚
â”‚  â”‚ P2  refactor   notion       1h ago   [x]â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Recent Runs (10)                        â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ abc123  runQA  âœ“  17s  10:19 PM    [>] â”‚â—„â”€â”€ ç‚¹å‡»å±•å¼€
â”‚  â”‚ def456  runQA  âœ—  23s  09:45 PM    [>] â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Run Detail æŠ½å±‰ï¼ˆå³ä¾§æ»‘å‡ºï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Run Detail: abc123          [Ã—] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                  â”‚
â”‚ [Summary] [Tests] [Evidence]    â”‚
â”‚                                  â”‚
â”‚ Intent: runQA                    â”‚
â”‚ Source: cloudcode                â”‚
â”‚ Duration: 17s                    â”‚
â”‚ Status: âœ“ Completed              â”‚
â”‚                                  â”‚
â”‚ Tests (6 total)                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚  âœ“ Passed: 2             â”‚    â”‚
â”‚ â”‚  âœ— Failed: 2             â”‚    â”‚
â”‚ â”‚  â­  Skipped: 2           â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                  â”‚
â”‚ Skipped Details:                 â”‚
â”‚  â€¢ test-heartbeat               â”‚
â”‚    Reason: Worker running...     â”‚
â”‚  â€¢ test-notion-sync             â”‚
â”‚    Reason: API key not set       â”‚
â”‚                                  â”‚
â”‚ Evidence Files (9):              â”‚
â”‚  ğŸ“„ qa-output.log    [View]     â”‚
â”‚  ğŸ“„ result.json      [View]     â”‚
â”‚  ğŸ“„ summary.json     [View]     â”‚
â”‚                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## éªŒæ”¶æ ‡å‡†

è§ .dod.md

---

## é£é™©ä¸ä¾èµ–

### æŠ€æœ¯é£é™©
- Queue API éœ€è¦è¯»å– `queue.jsonl`ï¼ˆå¯èƒ½ä¸å­˜åœ¨ï¼‰
- Worker status éœ€è¦æ£€æµ‹è¿›ç¨‹ï¼ˆå¯èƒ½éœ€è¦ PID æ–‡ä»¶ï¼‰

### ä¾èµ–
- Quality API è¿è¡Œåœ¨ port 5220
- Core backend proxy æ­£å¸¸å·¥ä½œ
- cecelia-quality runs/ ç›®å½•æœ‰æ•°æ®

---

## ä¸‹ä¸€æ­¥è®¡åˆ’

**P0 é˜¶æ®µ**ï¼ˆä»Šå¤©å®Œæˆï¼‰ï¼š
1. å®ç° Run Detail æŠ½å±‰
2. å®ç° Task Queue å¯è§†åŒ–
3. æ·»åŠ  Worker/Heartbeat/Queue å¡ç‰‡

**P1 é˜¶æ®µ**ï¼ˆæ˜å¤©ï¼‰ï¼š
4. æ·»åŠ å¿«é€Ÿæ“ä½œæŒ‰é’®
5. å®ç°è§¦å‘ API

**P2 é˜¶æ®µ**ï¼ˆæœ¬å‘¨æœ«ï¼‰ï¼š
6. æ·»åŠ ç»Ÿè®¡å›¾è¡¨
7. æ·»åŠ è¶‹åŠ¿åˆ†æ

---

## å‚è€ƒ

- å½“å‰ Quality Monitor: apps/core/features/quality/pages/QualityMonitorPage.tsx
- Quality API: cecelia-quality/api/server.js
- State æ•°æ®: cecelia-quality/state/state.json
- Runs æ•°æ®: cecelia-quality/runs/*/
