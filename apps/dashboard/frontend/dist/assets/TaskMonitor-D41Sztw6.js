import{r as n,j as e,A as k,C}from"./index-CWtkuk4d.js";import{R as p}from"./refresh-cw-Dh0Ajffi.js";import{C as h}from"./check-circle-2-C-P5os1Y.js";import{X as g}from"./x-circle-D67IbPvU.js";import{S as D}from"./server-CH0r10Fk.js";import{T as I}from"./terminal-bMtJXZsg.js";import{G as T}from"./git-branch-BaYnb-to.js";import{C as A}from"./clock-Cc5D9t81.js";const R="";function X(){const[l,i]=n.useState([]),[a,c]=n.useState(null),[u,j]=n.useState(!0),[r,f]=n.useState(null),o=async()=>{try{const s=await(await fetch(`${R}/api/tasks/monitor`)).json();s.success?(i(s.tasks),c(s.server)):(i(m()),c(x()))}catch{i(m()),c(x())}finally{j(!1)}};n.useEffect(()=>{o();const t=setInterval(o,3e3);return()=>clearInterval(t)},[]);const m=()=>[{id:"1",name:"cp-feature-auth",project:"zenithjoy-autopilot",branch:"cp-feature-auth",status:"running",progress:65,currentStep:"Step 4: 代码编写",startedAt:new Date(Date.now()-18e5).toISOString(),duration:"30m",logs:["[10:00:15] 开始执行任务","[10:05:23] Step 1: 创建分支完成","[10:10:45] Step 2: PRD 确认完成","[10:25:30] Step 3: 环境检查完成","[10:30:00] Step 4: 开始编写代码..."]},{id:"2",name:"cp-fix-login-bug",project:"zenithjoy-core",branch:"cp-fix-login-bug",status:"running",progress:40,currentStep:"Step 3: 环境检查",startedAt:new Date(Date.now()-9e5).toISOString(),duration:"15m",logs:["[10:15:00] 开始执行任务","[10:18:30] Step 1: 创建分支完成","[10:22:15] Step 2: PRD 确认完成","[10:30:00] Step 3: 环境检查中..."]},{id:"3",name:"cp-add-dashboard",project:"zenithjoy-engine",branch:"cp-add-dashboard",status:"completed",progress:100,currentStep:"已完成",startedAt:new Date(Date.now()-72e5).toISOString(),duration:"1h 20m",logs:["[08:00:00] 开始执行任务","[08:45:00] 代码编写完成","[09:00:00] 测试通过","[09:15:00] PR 已合并","[09:20:00] 任务完成"]},{id:"4",name:"cp-refactor-api",project:"zenithjoy-autopilot",branch:"cp-refactor-api",status:"failed",progress:75,currentStep:"Step 5: CI 失败",startedAt:new Date(Date.now()-36e5).toISOString(),duration:"45m",logs:["[09:00:00] 开始执行任务","[09:30:00] 代码编写完成","[09:35:00] 测试运行中","[09:45:00] ❌ CI 检查失败：类型错误"]}],x=()=>({cpu:45,memory:62,activeTasks:2,queuedTasks:0}),N=t=>{switch(t){case"completed":return e.jsx(h,{className:"w-5 h-5 text-emerald-500"});case"running":return e.jsx(p,{className:"w-5 h-5 text-cyan-500 animate-spin"});case"failed":return e.jsx(g,{className:"w-5 h-5 text-red-500"});default:return e.jsx(A,{className:"w-5 h-5 text-gray-400"})}},b=t=>{switch(t){case"completed":return"bg-emerald-500";case"running":return"bg-cyan-500";case"failed":return"bg-red-500";default:return"bg-gray-400"}},v=t=>{const s={completed:"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400",running:"bg-cyan-100 text-cyan-700 dark:bg-cyan-900/30 dark:text-cyan-400",failed:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400",pending:"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400"},d={completed:"已完成",running:"运行中",failed:"失败",pending:"等待中"};return e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${s[t]||s.pending}`,children:d[t]||t})};if(u)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(p,{className:"w-8 h-8 text-cyan-500 animate-spin"})});const y=l.filter(t=>t.status==="running"),w=l.filter(t=>t.status==="completed"),S=l.filter(t=>t.status==="failed");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-gradient-to-br from-cyan-500 to-blue-600 rounded-xl p-5 text-white",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(k,{className:"w-8 h-8 opacity-80"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm opacity-80",children:"运行中"}),e.jsx("p",{className:"text-3xl font-bold",children:y.length})]})]})}),e.jsx("div",{className:"bg-gradient-to-br from-emerald-500 to-green-600 rounded-xl p-5 text-white",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(h,{className:"w-8 h-8 opacity-80"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm opacity-80",children:"已完成"}),e.jsx("p",{className:"text-3xl font-bold",children:w.length})]})]})}),e.jsx("div",{className:"bg-gradient-to-br from-red-500 to-rose-600 rounded-xl p-5 text-white",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(g,{className:"w-8 h-8 opacity-80"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm opacity-80",children:"失败"}),e.jsx("p",{className:"text-3xl font-bold",children:S.length})]})]})}),e.jsx("div",{className:"bg-gradient-to-br from-slate-700 to-slate-800 rounded-xl p-5 text-white",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(D,{className:"w-8 h-8 opacity-80"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm opacity-80",children:"服务器"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(C,{className:"w-4 h-4"}),e.jsxs("span",{children:[a==null?void 0:a.cpu,"%"]}),e.jsx("span",{className:"opacity-50",children:"|"}),e.jsxs("span",{children:[a==null?void 0:a.memory,"% RAM"]})]})]})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700",children:e.jsxs("h2",{className:"text-lg font-semibold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5 text-cyan-500"}),"任务列表"]})}),e.jsx("div",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:l.map(t=>e.jsxs("div",{className:"p-4 hover:bg-slate-50 dark:hover:bg-slate-700/50 cursor-pointer transition-colors",onClick:()=>f((r==null?void 0:r.id)===t.id?null:t),children:[e.jsxs("div",{className:"flex items-center gap-4",children:[N(t.status),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx("span",{className:"font-mono text-sm font-medium text-slate-900 dark:text-white truncate",children:t.name}),v(t.status)]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-slate-500 dark:text-slate-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(T,{className:"w-4 h-4"}),t.project]}),e.jsx("span",{children:t.currentStep})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:t.duration}),t.status==="running"&&e.jsx("div",{className:"w-24 h-2 bg-slate-200 dark:bg-slate-700 rounded-full mt-2 overflow-hidden",children:e.jsx("div",{className:`h-full ${b(t.status)} transition-all`,style:{width:`${t.progress}%`}})})]})]}),(r==null?void 0:r.id)===t.id&&e.jsxs("div",{className:"mt-4 p-4 bg-slate-900 rounded-lg",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-2 font-mono",children:"执行日志"}),e.jsx("div",{className:"space-y-1 font-mono text-sm",children:t.logs.map((s,d)=>e.jsx("p",{className:`${s.includes("❌")?"text-red-400":s.includes("完成")?"text-emerald-400":"text-slate-300"}`,children:s},d))})]})]},t.id))})]})]})}export{X as default};
