import{a8 as T,r as d,j as e,L as z,a4 as k,A as x,W as M,R as U,ar as O,a as Z,a1 as v,a0 as C,Z as S,l as W,C as X}from"./index-BTTUiRJR.js";import{n as $}from"./n8n-live-status.api-CpQNSwcV.js";function G(){const n=T(),[l,c]=d.useState("local"),[a,o]=d.useState(null),[s,b]=d.useState(null),[m,h]=d.useState(!0),[p,f]=d.useState(null),[L,E]=d.useState("");d.useEffect(()=>{$.getInstancesStatus().then(o).catch(()=>{o({cloud:{available:!1,name:"Cloud"},local:{available:!0,name:"Local"}})})},[]);const g=async()=>{try{const t=await $.getLiveStatusOverview(l);b(t),E(new Date().toLocaleTimeString("zh-CN")),f(null)}catch(t){f(t instanceof Error?t.message:"获取数据失败")}finally{h(!1)}},j=()=>{h(!0),g()};d.useEffect(()=>{h(!0),b(null),g();const t=setInterval(g,1e4);return()=>clearInterval(t)},[l]);const y=t=>{n(`/n8n/live-status/${l}/${t}`)},N=t=>t<60?`${t}秒`:t<3600?`${Math.floor(t/60)}分${t%60}秒`:`${Math.floor(t/3600)}时${Math.floor(t%3600/60)}分`,A=t=>new Date(t).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}),I=t=>{switch(t){case"success":return"text-green-600 bg-green-100 dark:bg-green-900/30 dark:text-green-400";case"error":case"crashed":return"text-red-600 bg-red-100 dark:bg-red-900/30 dark:text-red-400";case"running":case"waiting":return"text-blue-600 bg-blue-100 dark:bg-blue-900/30 dark:text-blue-400";default:return"text-gray-600 bg-gray-100 dark:bg-gray-900/30 dark:text-gray-400"}},R=t=>{switch(t){case"success":return e.jsx(v,{className:"w-4 h-4"});case"error":case"crashed":return e.jsx(C,{className:"w-4 h-4"});case"running":case"waiting":return e.jsx(x,{className:"w-4 h-4 animate-pulse"});default:return e.jsx(k,{className:"w-4 h-4"})}},D=t=>{switch(t){case"success":return"成功";case"error":return"失败";case"crashed":return"崩溃";case"running":return"运行中";case"waiting":return"等待中";default:return t}};if(m&&!s)return e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(z,{className:"w-8 h-8 animate-spin text-blue-500"})});if(p&&!s)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-96",children:[e.jsx(k,{className:"w-12 h-12 text-red-500 dark:text-red-400 mb-4"}),e.jsx("p",{className:"text-red-600 dark:text-red-400 mb-3",children:p}),e.jsx("button",{onClick:j,className:"px-4 py-2 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-xl hover:from-blue-700 hover:to-blue-800 shadow-lg shadow-blue-500/25",children:"重试"})]});const r=s==null?void 0:s.todayStats,u=(s==null?void 0:s.runningExecutions)||[],w=(s==null?void 0:s.recentCompleted)||[];return e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-cyan-600 rounded-xl flex items-center justify-center shadow-lg shadow-blue-500/25",children:e.jsx(x,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"n8n 实时状态"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:["工作流执行监控 · 更新于 ",L]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("a",{href:l==="local"?"http://localhost:5679":"#",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-4 py-2 border border-gray-200 dark:border-slate-600 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-50 dark:hover:bg-slate-700 transition",children:[e.jsx(M,{className:"w-4 h-4"}),"打开 n8n"]}),e.jsxs("button",{onClick:j,disabled:m,className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-xl hover:from-blue-700 hover:to-blue-800 disabled:opacity-50 shadow-lg shadow-blue-500/25",children:[e.jsx(U,{className:`w-4 h-4 ${m?"animate-spin":""}`}),"刷新"]})]})]}),e.jsxs("div",{className:"flex bg-gray-100 dark:bg-slate-700 rounded-xl p-1 w-fit",children:[e.jsxs("button",{onClick:()=>c("local"),disabled:!(a!=null&&a.local.available),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${l==="local"?"bg-white dark:bg-slate-600 text-blue-600 dark:text-blue-400 shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"} ${a!=null&&a.local.available?"":"opacity-50 cursor-not-allowed"}`,children:[e.jsx(O,{className:"w-4 h-4"}),"Local",!(a!=null&&a.local.available)&&e.jsx("span",{className:"text-xs text-red-500",children:"(未配置)"})]}),e.jsxs("button",{onClick:()=>c("cloud"),disabled:!(a!=null&&a.cloud.available),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${l==="cloud"?"bg-white dark:bg-slate-600 text-blue-600 dark:text-blue-400 shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"} ${a!=null&&a.cloud.available?"":"opacity-50 cursor-not-allowed"}`,children:[e.jsx(Z,{className:"w-4 h-4"}),"Cloud",!(a!=null&&a.cloud.available)&&e.jsx("span",{className:"text-xs text-red-500",children:"(未配置)"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsx(i,{icon:e.jsx(x,{className:"w-4 h-4 text-white"}),label:"运行中",value:(r==null?void 0:r.running)||0,color:"from-blue-500 to-cyan-600",animate:r&&r.running>0}),e.jsx(i,{icon:e.jsx(v,{className:"w-4 h-4 text-white"}),label:"成功",value:(r==null?void 0:r.success)||0,color:"from-green-500 to-emerald-600"}),e.jsx(i,{icon:e.jsx(C,{className:"w-4 h-4 text-white"}),label:"失败",value:(r==null?void 0:r.error)||0,color:"from-red-500 to-rose-600"}),e.jsx(i,{icon:e.jsx(S,{className:"w-4 h-4 text-white"}),label:"总数",value:(r==null?void 0:r.total)||0,color:"from-purple-500 to-violet-600"}),e.jsx(i,{icon:e.jsx(W,{className:"w-4 h-4 text-white"}),label:"成功率",value:`${(r==null?void 0:r.successRate)||0}%`,color:"from-emerald-500 to-teal-600"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-gray-200 dark:border-slate-700 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-slate-700 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"w-5 h-5 text-blue-600 dark:text-blue-400 animate-pulse"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"正在运行"}),e.jsxs("span",{className:"text-sm text-gray-400 dark:text-gray-500",children:["(",u.length," 个)"]})]})}),e.jsx("div",{className:"p-6",children:u.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:"暂无运行中的工作流"}):e.jsx("div",{className:"space-y-3",children:u.map(t=>e.jsx(_,{execution:t,formatDuration:N,onClick:()=>y(t.id)},t.id))})})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-gray-200 dark:border-slate-700 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-gray-700 dark:text-gray-300"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"最近完成"}),e.jsx("span",{className:"text-sm text-gray-400 dark:text-gray-500",children:"(最近 10 条)"})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-slate-700/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"工作流"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"状态"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"耗时"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"完成时间"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-slate-700",children:w.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-6 py-12 text-center text-gray-500 dark:text-gray-400",children:"暂无执行记录"})}):w.map(t=>e.jsxs("tr",{onClick:()=>y(t.id),className:"hover:bg-gray-50 dark:hover:bg-slate-700/50 transition-colors cursor-pointer",children:[e.jsx("td",{className:"px-6 py-3 text-sm font-medium text-gray-900 dark:text-white",children:t.workflowName||t.workflowId}),e.jsx("td",{className:"px-6 py-3",children:e.jsxs("span",{className:`px-2.5 py-1 rounded-lg text-xs font-medium flex items-center gap-1 w-fit ${I(t.status)}`,children:[R(t.status),D(t.status)]})}),e.jsx("td",{className:"px-6 py-3 text-sm text-gray-500 dark:text-gray-400 font-mono",children:t.duration?N(t.duration):"-"}),e.jsx("td",{className:"px-6 py-3 text-sm text-gray-500 dark:text-gray-400",children:t.stoppedAt?A(t.stoppedAt):"-"})]},t.id))})]})})]})]})}function i({icon:n,label:l,value:c,color:a,animate:o}){return e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-gray-200 dark:border-slate-700 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-9 h-9 bg-gradient-to-br ${a} rounded-xl flex items-center justify-center shadow-lg ${o?"animate-pulse":""}`,children:n}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:l}),e.jsx("div",{className:"text-xl font-bold text-gray-900 dark:text-white",children:c})]})]})})}function _({execution:n,formatDuration:l,onClick:c}){return e.jsx("div",{onClick:c,className:"border border-blue-300 dark:border-blue-600 bg-blue-50/50 dark:bg-blue-900/20 rounded-xl p-4 hover:shadow-md transition-all cursor-pointer",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white text-sm",children:n.workflowName}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["开始于 ",new Date(n.startedAt).toLocaleTimeString("zh-CN")]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-blue-100 dark:bg-blue-900/50 text-blue-600 dark:text-blue-400 flex items-center gap-2",children:[e.jsx(x,{className:"w-4 h-4 animate-pulse"}),"已耗时 ",l(n.duration)]})})]})})}export{G as default};
