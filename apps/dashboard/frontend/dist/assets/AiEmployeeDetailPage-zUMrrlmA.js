import{a9 as y,aa as C,r as x,j as e,y as D,R as j,ar as S,e as $,d as f,_ as v,m as k,C as w}from"./index-COSEfhnc.js";import{D as N}from"./DynamicIcon-eIt3a1dp.js";import{g as T,a as E,b as I}from"./ai-employees.api-DCgx3ksA.js";function B(){const{employeeId:t}=y(),n=C(),[a,o]=x.useState([]),[r,i]=x.useState(!0),[m,u]=x.useState(null),[d,c]=x.useState(null),l=t?T(t):null,g=t?E(t):null,p=async()=>{if(t){i(!0),u(null);try{const s=await I(t);o(s),c(new Date)}catch(s){u("加载任务数据失败，请稍后重试"),console.error("Failed to load employee tasks:",s)}finally{i(!1)}}};if(x.useEffect(()=>{p();const s=setInterval(p,3e4);return()=>clearInterval(s)},[t]),!l)return e.jsx("div",{className:"px-4 sm:px-0 pb-8",children:e.jsxs("div",{className:"text-center py-20",children:[e.jsx("p",{className:"text-slate-500 dark:text-slate-400 mb-4",children:"员工不存在"}),e.jsx("button",{onClick:()=>n("/ai-employees"),className:"px-4 py-2 bg-blue-500 text-white rounded-xl hover:bg-blue-600 transition-colors",children:"返回员工列表"})]})});const h={total:a.length,success:a.filter(s=>s.status==="success").length,error:a.filter(s=>s.status==="error").length,running:a.filter(s=>s.status==="running"||s.status==="waiting").length,successRate:a.length>0?Math.round(a.filter(s=>s.status==="success").length/a.length*100):0};return e.jsxs("div",{className:"px-4 sm:px-0 pb-8",children:[e.jsxs("button",{onClick:()=>n("/ai-employees"),className:"flex items-center gap-2 mb-6 text-slate-600 dark:text-slate-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:[e.jsx(D,{className:"w-5 h-5"}),"返回员工列表"]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-sm p-6 mb-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-800/30 flex items-center justify-center shadow-inner",children:e.jsx(N,{name:l.icon,className:"w-8 h-8 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-slate-800 dark:text-white mb-1",children:l.name}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400 mb-1",children:l.role}),g&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-400 dark:text-slate-500",children:[e.jsx(N,{name:g.icon,className:"w-4 h-4"}),g.name]})]})]}),e.jsxs("button",{onClick:p,disabled:r,className:"flex items-center gap-2 px-4 py-2 bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-xl text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-600 transition-colors disabled:opacity-50",children:[e.jsx(j,{className:`w-4 h-4 ${r?"animate-spin":""}`}),"刷新"]})]}),l.description&&e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-6",children:l.description}),e.jsxs("div",{children:[e.jsxs("h3",{className:"flex items-center gap-2 text-sm font-medium text-slate-700 dark:text-slate-300 mb-3",children:[e.jsx(S,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"}),"职能范围"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:l.abilities.map(s=>e.jsx("button",{onClick:()=>n(`/ai-employees/${l.id}/abilities/${s.id}`),className:"text-sm px-3 py-1.5 bg-blue-50 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-800 rounded-lg text-blue-700 dark:text-blue-300 hover:bg-blue-100 dark:hover:bg-blue-900/50 transition-colors",title:s.description,children:s.name},s.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(b,{icon:e.jsx($,{className:"w-5 h-5"}),label:"今日任务",value:h.total,color:"blue"}),e.jsx(b,{icon:e.jsx(f,{className:"w-5 h-5"}),label:"成功",value:h.success,color:"green"}),e.jsx(b,{icon:e.jsx(v,{className:"w-5 h-5"}),label:"失败",value:h.error,color:"red"}),e.jsx(b,{icon:e.jsx(k,{className:"w-5 h-5"}),label:"成功率",value:`${h.successRate}%`,color:"blue"})]}),m&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl text-red-600 dark:text-red-400",children:m}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-800 dark:text-white",children:"最近任务"}),d&&e.jsxs("p",{className:"text-xs text-slate-400 dark:text-slate-500 mt-1",children:["最后更新: ",d.toLocaleTimeString("zh-CN")]})]}),r&&a.length===0&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(j,{className:"w-8 h-8 text-blue-500 animate-spin"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"加载中..."})]})}),!r||a.length>0?e.jsx("div",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:a.length>0?a.map(s=>e.jsx(L,{task:s},s.id)):e.jsxs("div",{className:"px-6 py-12 text-center",children:[e.jsx(w,{className:"w-12 h-12 text-slate-300 dark:text-slate-600 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-400 dark:text-slate-500",children:"今日暂无任务记录"})]})}):null]})]})}function b({icon:t,label:n,value:a,color:o}){const r={blue:"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400",green:"bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-400",red:"bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400"};return e.jsxs("div",{className:`${r[o]} rounded-xl p-4`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t,e.jsx("span",{className:"text-sm font-medium",children:n})]}),e.jsx("div",{className:"text-2xl font-bold",children:a})]})}function L({task:t}){const n=()=>{switch(t.status){case"success":return e.jsx(f,{className:"w-5 h-5 text-green-500"});case"error":return e.jsx(v,{className:"w-5 h-5 text-red-500"});case"running":case"waiting":return e.jsx(k,{className:"w-5 h-5 text-blue-500 animate-spin"});default:return e.jsx(w,{className:"w-5 h-5 text-slate-400"})}},a=()=>{switch(t.status){case"success":return"成功";case"error":return"失败";case"running":return"运行中";case"waiting":return"等待中";default:return"未知"}},o=i=>new Date(i).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),r=()=>{if(!t.stoppedAt)return null;const i=new Date(t.startedAt).getTime(),u=new Date(t.stoppedAt).getTime()-i,d=Math.floor(u/1e3);if(d<60)return`${d}秒`;const c=Math.floor(d/60);return c<60?`${c}分${d%60}秒`:`${Math.floor(c/60)}小时${c%60}分`};return e.jsx("div",{className:"px-6 py-4 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"mt-1",children:n()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-base font-medium text-slate-800 dark:text-white truncate",children:t.workflowName||t.abilityName}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:t.abilityName})]}),e.jsx("span",{className:"text-sm text-slate-400 dark:text-slate-500 whitespace-nowrap",children:o(t.startedAt)})]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsxs("span",{className:"text-slate-600 dark:text-slate-400",children:["状态: ",e.jsx("span",{className:"font-medium",children:a()})]}),r()&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-slate-300 dark:text-slate-600",children:"|"}),e.jsxs("span",{className:"text-slate-600 dark:text-slate-400",children:["耗时: ",e.jsx("span",{className:"font-medium",children:r()})]})]})]})]})]})})}export{B as default};
