import{aR as P,R as h,Z as _,j as e,x as M,a6 as S,r as m,_ as w,aE as L,A as D,$ as k,e as A,aq as O,aC as C,C as $,as as G,aS as U,aT as z,K as B,F,aj as Z}from"./index-VpQ83PAe.js";import{f as q}from"./agents.api-BFL0_4gZ.js";const H={Zap:_,RefreshCw:h,Diamond:P};function K({agent:s,onClick:l}){const i=H[s.icon]||_,c=s.status==="planned",n=s.stats.todayRunning>0;return e.jsxs("button",{onClick:l,disabled:c,className:`
        w-full text-left p-5 rounded-xl border transition-all duration-200
        ${c?"bg-slate-800/50 border-slate-700 opacity-60 cursor-not-allowed":`bg-gradient-to-br ${s.gradient.from} ${s.gradient.to} bg-opacity-10
             dark:bg-slate-800 hover:scale-[1.02] hover:shadow-lg ${s.gradient.border}`}
      `,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:`
          p-3 rounded-xl
          ${c?"bg-slate-700":`bg-gradient-to-br ${s.gradient.from} ${s.gradient.to}`}
        `,children:e.jsx(i,{className:"w-6 h-6 text-white"})}),!c&&e.jsx(M,{className:"w-5 h-5 text-gray-400"})]}),e.jsx("h3",{className:"text-lg font-bold text-white mb-1",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-400 mb-1",children:[s.role," · ",s.codename]}),c?e.jsx("div",{className:"mt-4 pt-4 border-t border-slate-700",children:e.jsx("span",{className:"text-sm text-gray-500",children:"待激活"})}):e.jsx("div",{className:"mt-4 pt-4 border-t border-white/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-2xl font-bold text-white",children:s.stats.todayTotal}),e.jsx("span",{className:"text-sm text-gray-400 ml-1",children:"今日"})]}),s.stats.todaySuccess>0&&e.jsxs("div",{className:"text-emerald-400 text-sm",children:[s.stats.todaySuccess," 成功"]}),s.stats.todayError>0&&e.jsxs("div",{className:"text-red-400 text-sm",children:[s.stats.todayError," 失败"]})]}),n&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-blue-500/20 rounded-full",children:[e.jsx(h,{className:"w-3 h-3 text-blue-400 animate-spin"}),e.jsx("span",{className:"text-xs text-blue-400",children:"工作中"})]})]})})]})}const W=[{value:"24h",label:"24时"},{value:"72h",label:"72时"},{value:"7d",label:"7天"}];function X({value:s,onChange:l}){return e.jsx("div",{className:"flex bg-slate-700 rounded-lg p-1",children:W.map(i=>e.jsx("button",{onClick:()=>l(i.value),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-all ${s===i.value?"bg-blue-600 text-white shadow-sm":"text-gray-400 hover:text-white hover:bg-slate-600"}`,children:i.label},i.value))})}function Y(){const s=S(),[l,i]=m.useState(null),[c,n]=m.useState(!0),[g,b]=m.useState(null),[u,N]=m.useState(null),[x,f]=m.useState("24h"),a=async()=>{try{const t=await q(x);i(t),b(null),N(new Date)}catch(t){b(t.message)}finally{n(!1)}};m.useEffect(()=>{n(!0),a();const t=setInterval(a,3e4);return()=>clearInterval(t)},[x]);const p=t=>{switch(t){case"completed":return e.jsx(k,{className:"w-4 h-4 text-emerald-500"});case"running":return e.jsx(h,{className:"w-4 h-4 text-blue-500 animate-spin"});case"failed":return e.jsx(w,{className:"w-4 h-4 text-red-500"});case"pending":return e.jsx($,{className:"w-4 h-4 text-yellow-500"});default:return e.jsx($,{className:"w-4 h-4 text-gray-400"})}},v=t=>new Date(t).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),o=t=>{const d=Math.floor((Date.now()-new Date(t).getTime())/1e3);return d<60?`${d}秒`:d<3600?`${Math.floor(d/60)}分${d%60}秒`:`${Math.floor(d/3600)}时${Math.floor(d%3600/60)}分`},I=t=>{switch(t){case"24h":return"过去 24 小时";case"72h":return"过去 72 小时";case"7d":return"过去 7 天"}},R=t=>t==="headless"?e.jsx(G,{className:"w-4 h-4 text-purple-400",title:"无头模式"}):e.jsx(U,{className:"w-4 h-4 text-cyan-400",title:"交互模式"}),T=t=>t==="headless"?"无头":"交互";if(c&&!l)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(h,{className:"w-8 h-8 text-blue-500 animate-spin"})});if(g&&!l)return e.jsxs("div",{className:"bg-red-900/20 border border-red-800 rounded-xl p-6 text-center",children:[e.jsx(w,{className:"w-12 h-12 text-red-500 mx-auto mb-3"}),e.jsxs("p",{className:"text-red-400",children:["加载失败: ",g]}),e.jsx("button",{onClick:a,className:"mt-4 px-4 py-2 bg-red-900/30 text-red-400 rounded-lg hover:bg-red-900/50 transition-colors",children:"重试"})]});const r=l==null?void 0:l.periodStats,y=(l==null?void 0:l.runningTasks)||[],E=(l==null?void 0:l.recentRuns)||[];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-violet-500 to-purple-600 rounded-xl",children:e.jsx(L,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Cecelia"}),e.jsxs("p",{className:"text-gray-400",children:["无头 Claude Code · ",y.length," 个运行中 · ",I(x)," ",(r==null?void 0:r.total)||0," 次任务"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(X,{value:x,onChange:f}),u&&e.jsx("span",{className:"text-sm text-gray-500",children:u.toLocaleTimeString("zh-CN")}),e.jsx("button",{onClick:a,disabled:c,className:"p-2 text-gray-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors disabled:opacity-50",children:e.jsx(h,{className:`w-5 h-5 ${c?"animate-spin":""}`})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsx(j,{icon:e.jsx(D,{className:"w-4 h-4 text-white"}),label:"运行中",value:(r==null?void 0:r.running)||0,color:"from-blue-500 to-cyan-600",animate:r&&r.running>0}),e.jsx(j,{icon:e.jsx(k,{className:"w-4 h-4 text-white"}),label:"成功",value:(r==null?void 0:r.success)||0,color:"from-green-500 to-emerald-600"}),e.jsx(j,{icon:e.jsx(w,{className:"w-4 h-4 text-white"}),label:"失败",value:(r==null?void 0:r.error)||0,color:"from-red-500 to-rose-600"}),e.jsx(j,{icon:e.jsx(_,{className:"w-4 h-4 text-white"}),label:"总数",value:(r==null?void 0:r.total)||0,color:"from-purple-500 to-violet-600"}),e.jsx(j,{icon:e.jsx(A,{className:"w-4 h-4 text-white"}),label:"成功率",value:`${(r==null?void 0:r.successRate)||0}%`,color:"from-emerald-500 to-teal-600"})]}),y.length>0&&e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-700 flex items-center gap-2",children:[e.jsx(O,{className:"w-5 h-5 text-blue-400 animate-pulse"}),e.jsx("h2",{className:"font-semibold text-white",children:"正在运行的 Claude Code"}),e.jsxs("span",{className:"text-sm text-gray-400",children:["(",y.length," 个)"]})]}),e.jsx("div",{className:"p-4 space-y-4",children:y.map(t=>e.jsx(J,{run:t,formatDuration:o,getModeIcon:R,getModeLabel:T},t.id))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("h2",{className:"font-semibold text-white",children:"Agent 状态"}),e.jsxs("span",{className:"text-sm text-gray-400",children:["(",l==null?void 0:l.agents.length," 个)"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:l==null?void 0:l.agents.map(t=>e.jsx(K,{agent:t,onClick:()=>s(`/cecelia/agents/${t.id}`)},t.id))})]}),e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-700 flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold text-white",children:"最近任务"}),e.jsx("button",{onClick:()=>s("/cecelia/runs"),className:"text-sm text-blue-400 hover:text-blue-300",children:"查看全部 →"})]}),E.length>0?e.jsx("div",{className:"divide-y divide-slate-700",children:E.map(t=>e.jsxs("div",{className:"px-6 py-4 flex items-center justify-between hover:bg-slate-700/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[p(t.status),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[R(t.mode),e.jsx("span",{className:"text-white",children:t.project}),e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-slate-700 text-gray-300",children:T(t.mode)})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-500",children:[e.jsx(C,{className:"w-3 h-3"}),e.jsx("span",{children:t.feature_branch}),e.jsx("span",{className:"text-gray-600",children:"·"}),e.jsxs("span",{children:[t.completed_checkpoints,"/",t.total_checkpoints," 步骤",t.failed_checkpoints>0&&e.jsxs("span",{className:"text-red-400 ml-1",children:["(",t.failed_checkpoints," 失败)"]})]})]})]})]}),e.jsx("span",{className:"text-sm text-gray-500",children:v(t.started_at)})]},t.id))}):e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(_,{className:"w-12 h-12 text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-400",children:"暂无任务"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"通过 N8N 工作流触发 Cecelia 执行任务"})]})]})]})}function j({icon:s,label:l,value:i,color:c,animate:n}){return e.jsx("div",{className:"bg-slate-800 rounded-xl border border-slate-700 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-9 h-9 bg-gradient-to-br ${c} rounded-xl flex items-center justify-center shadow-lg ${n?"animate-pulse":""}`,children:s}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400",children:l}),e.jsx("div",{className:"text-xl font-bold text-white",children:i})]})]})})}function J({run:s,formatDuration:l,getModeIcon:i,getModeLabel:c}){var x,f;const[n,g]=m.useState(null),b=a=>{switch(a){case"done":return e.jsx(k,{className:"w-4 h-4 text-emerald-500"});case"in_progress":return e.jsx(h,{className:"w-4 h-4 text-blue-500 animate-spin"});case"failed":return e.jsx(w,{className:"w-4 h-4 text-red-500"});default:return e.jsx($,{className:"w-4 h-4 text-gray-500"})}},u=a=>{switch(a){case"done":return"bg-emerald-500/20 text-emerald-400 border-emerald-500/30";case"in_progress":return"bg-blue-500/20 text-blue-400 border-blue-500/30 animate-pulse";case"failed":return"bg-red-500/20 text-red-400 border-red-500/30";default:return"bg-slate-700/50 text-gray-500 border-slate-600/30"}},N=(f=(x=s.checkpoints_detail)==null?void 0:x.find(a=>a.status==="in_progress"))==null?void 0:f.id;return e.jsxs("div",{className:"border border-blue-600/30 bg-blue-900/20 rounded-xl p-5 hover:bg-blue-900/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(z,{className:"w-5 h-5 text-violet-400"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-white",children:s.project}),s.repo_url&&e.jsx("a",{href:s.repo_url,target:"_blank",rel:"noopener noreferrer",className:"text-gray-500 hover:text-blue-400 transition-colors",title:"打开 GitHub",children:e.jsx(B,{className:"w-3.5 h-3.5"})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400",children:[e.jsx(C,{className:"w-3 h-3"}),e.jsx("span",{children:s.feature_branch})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[i(s.mode),e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-purple-900/50 text-purple-300",children:c(s.mode)}),e.jsxs("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-blue-900/50 text-blue-400 flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4 animate-pulse"}),l(s.started_at)]})]})]}),(s.prd_title||s.prd_summary)&&e.jsx("div",{className:"mb-4 px-4 py-3 bg-slate-700/30 border border-slate-600/30 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(F,{className:"w-4 h-4 text-amber-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[s.prd_title&&e.jsx("p",{className:"text-sm font-medium text-white",children:s.prd_title}),s.prd_summary&&e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:s.prd_summary}),s.checkpoints_detail&&s.checkpoints_detail.length>0&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Checkpoints: ",s.checkpoints_detail.filter(a=>a.status==="done").length,"/",s.checkpoints_detail.length," 完成"]})]})]})}),s.current_action&&e.jsx("div",{className:"mb-4 px-3 py-2 bg-cyan-900/30 border border-cyan-700/30 rounded-lg",children:e.jsxs("p",{className:"text-sm text-cyan-300",children:[e.jsx("span",{className:"text-cyan-500",children:"正在："})," ",s.current_action]})}),s.checkpoints_detail&&s.checkpoints_detail.length>0&&e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"Checkpoint 进度"}),s.checkpoints_detail.map(a=>{const p=n===a.id||a.id===N,v=a.id===N;return e.jsxs("div",{className:`rounded-lg border transition-all ${v?"border-blue-500/50 bg-blue-900/30":"border-slate-600/30 bg-slate-700/20"}`,children:[e.jsx("button",{onClick:()=>g(p?null:a.id),className:"w-full px-3 py-2 flex items-center justify-between hover:bg-slate-700/30 transition-colors rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[p?e.jsx(Z,{className:"w-4 h-4 text-gray-500"}):e.jsx(M,{className:"w-4 h-4 text-gray-500"}),b(a.status),e.jsx("span",{className:"text-xs font-mono text-gray-400",children:a.id}),e.jsx("span",{className:"text-sm text-white",children:a.name}),v&&e.jsx("span",{className:"px-1.5 py-0.5 text-[10px] rounded bg-blue-500/30 text-blue-300",children:"当前"})]})}),p&&e.jsx("div",{className:"px-3 pb-3 pt-1",children:e.jsx("div",{className:"flex flex-wrap gap-1.5",children:(a.dev_steps||s.steps||[]).map(o=>e.jsx("span",{className:`px-2 py-0.5 text-[10px] rounded border ${u(o.status)}`,title:`${o.name}: ${o.status}`,children:o.name},o.id))})})]},a.id)})]}),(!s.checkpoints_detail||s.checkpoints_detail.length===0)&&s.steps&&s.steps.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-400 mb-1",children:[e.jsx("span",{children:"工作流进度"}),e.jsxs("span",{children:[s.current_step||1," / ",s.steps.length]})]}),e.jsx("div",{className:"flex gap-1",children:s.steps.map(a=>e.jsxs("div",{className:"flex-1 group relative",title:`${a.name}: ${a.status}`,children:[e.jsx("div",{className:`h-2 rounded-full transition-all ${a.status==="done"?"bg-emerald-500":a.status==="in_progress"?"bg-blue-500 animate-pulse":a.status==="failed"?"bg-red-500":"bg-slate-600"}`}),e.jsx("span",{className:"absolute -bottom-5 left-1/2 -translate-x-1/2 text-[10px] text-gray-500 opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap",children:a.name})]},a.id))}),e.jsxs("div",{className:"flex justify-between text-[10px] text-gray-500 mt-1 pt-2",children:[e.jsx("span",{children:"PRD"}),e.jsx("span",{children:"Code"}),e.jsx("span",{children:"PR"}),e.jsx("span",{children:"Merge"})]})]}),(!s.checkpoints_detail||s.checkpoints_detail.length===0)&&(!s.steps||s.steps.length===0)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-2 bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-cyan-500 transition-all",style:{width:s.total_checkpoints>0?`${s.completed_checkpoints/s.total_checkpoints*100}%`:"0%"}})}),e.jsxs("span",{className:"text-xs text-gray-400",children:[s.completed_checkpoints,"/",s.total_checkpoints]})]}),s.pr_url&&e.jsx("div",{className:"mt-3 pt-3 border-t border-slate-700",children:e.jsxs("a",{href:s.pr_url,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-400 hover:text-blue-300 flex items-center gap-1",children:[e.jsx(C,{className:"w-3 h-3"}),"查看 PR →"]})})]})}export{Y as default};
