import{r as d,j as e,R as E,Z as D,T as L}from"./index-xKvQUjqn.js";import{L as m}from"./loader-2-DrkhbAx-.js";import{X as g}from"./x-circle-CuCfCMRf.js";import{C as p}from"./check-circle-2-DbKvuBX5.js";import{C as R}from"./clock-BWSjkk21.js";const h=[{id:"data-collection",name:"数据采集",color:"#3b82f6",bg:"bg-blue-50 dark:bg-blue-900/20",keywords:["采集","scrape","collect","fetch-data"]},{id:"content-publish",name:"内容发布",color:"#8b5cf6",bg:"bg-purple-50 dark:bg-purple-900/20",keywords:["发布","publish","post"]},{id:"ai-factory",name:"AI 自动化",color:"#f59e0b",bg:"bg-amber-50 dark:bg-amber-900/20",keywords:["dispatcher","claude","executor","ai"]},{id:"monitoring",name:"监控巡检",color:"#10b981",bg:"bg-emerald-50 dark:bg-emerald-900/20",keywords:["监控","monitor","patrol"]},{id:"maintenance",name:"系统维护",color:"#6b7280",bg:"bg-gray-50 dark:bg-gray-800/50",keywords:["nightly","backup","cleanup","scheduler"]}];function T(r){const i=(r||"").toLowerCase();for(const l of h)if(l.keywords.some(c=>i.includes(c)))return l;return h[4]}function $(r){return new Date(r).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})}function y(r){return r?r<60?`${r}s`:`${Math.floor(r/60)}m ${r%60}s`:"-"}function F(){const[r,i]=d.useState(null),[l,c]=d.useState(!0),[u,b]=d.useState(""),[f,N]=d.useState(""),x=async()=>{try{c(!0);const s=await fetch("/api/v1/n8n-live-status/instances/local/overview");if(!s.ok)throw new Error("API error");const t=await s.json();i(t),b(""),N(new Date().toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}))}catch{b("加载失败")}finally{c(!1)}};d.useEffect(()=>{x();const s=setInterval(x,3e4);return()=>clearInterval(s)},[]);const w=[...(r==null?void 0:r.runningExecutions)||[],...(r==null?void 0:r.recentCompleted)||[]],j=h.map(s=>{const t=w.filter(n=>T(n.workflowName).id===s.id),a=t.filter(n=>n.status==="success").length,v=t.filter(n=>n.status==="error"||n.status==="crashed").length,k=t.filter(n=>n.status==="running").length,C=t.length>0?Math.round(t.reduce((n,S)=>n+(S.duration||0),0)/t.length):0;return{...s,total:t.length,success:a,failed:v,running:k,avgDuration:C,executions:t.slice(0,5)}}).filter(s=>s.total>0),o=(r==null?void 0:r.todayStats)||{total:0,success:0,error:0,successRate:0};return l&&!r?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(m,{className:"w-6 h-6 animate-spin text-gray-400"})}):u&&!r?e.jsxs("div",{className:"flex items-center justify-center h-64 text-red-500",children:[e.jsx(g,{className:"w-5 h-5 mr-2"}),u]}):e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:"工作记录"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"今日自动化任务执行概览"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs text-gray-400",children:[f," 更新"]}),e.jsx("button",{onClick:x,disabled:l,className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:e.jsx(E,{className:`w-4 h-4 ${l?"animate-spin":""}`})})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 text-xs mb-2",children:[e.jsx(D,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"总执行"})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:o.total})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-600 text-xs mb-2",children:[e.jsx(p,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"成功"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-600",children:o.success})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-500 text-xs mb-2",children:[e.jsx(g,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"失败"})]}),e.jsx("div",{className:"text-2xl font-bold text-red-500",children:o.error})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 text-xs mb-2",children:[e.jsx(L,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"成功率"})]}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[o.successRate,"%"]})]})]}),e.jsx("div",{className:"space-y-4",children:j.length===0?e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-12 text-center text-gray-400 border border-gray-100 dark:border-gray-700",children:"今日暂无执行记录"}):j.map(s=>{const t=s.total>0?Math.round(s.success/s.total*100):0;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"px-5 py-4 flex items-center justify-between border-b border-gray-50 dark:border-gray-700/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center",style:{backgroundColor:s.color+"15"},children:e.jsx("div",{className:"w-2.5 h-2.5 rounded-full",style:{backgroundColor:s.color}})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:s.name}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center gap-3 mt-0.5",children:[e.jsxs("span",{children:[s.total," 次执行"]}),s.avgDuration>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(R,{className:"w-3 h-3"}),"平均 ",y(s.avgDuration)]}),s.running>0&&e.jsxs("span",{className:"text-blue-500 flex items-center gap-1",children:[e.jsx(m,{className:"w-3 h-3 animate-spin"}),s.running," 运行中"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-32",children:e.jsx("div",{className:"h-1.5 bg-gray-100 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-500",style:{width:`${t}%`,backgroundColor:s.color}})})}),e.jsxs("div",{className:"w-12 text-right text-sm font-medium",style:{color:s.color},children:[t,"%"]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs w-20 justify-end",children:[e.jsx("span",{className:"text-green-600 font-medium",children:s.success}),e.jsx("span",{className:"text-gray-300",children:"/"}),e.jsx("span",{className:s.failed>0?"text-red-500 font-medium":"text-gray-400",children:s.failed})]})]})]}),s.executions.length>0&&e.jsx("div",{className:"px-5 py-3 bg-gray-50/50 dark:bg-gray-900/30",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:s.executions.map(a=>e.jsxs("div",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-lg text-xs ${a.status==="success"?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400":a.status==="running"?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400"}`,children:[a.status==="success"&&e.jsx(p,{className:"w-3 h-3"}),a.status==="running"&&e.jsx(m,{className:"w-3 h-3 animate-spin"}),(a.status==="error"||a.status==="crashed")&&e.jsx(g,{className:"w-3 h-3"}),e.jsx("span",{children:$(a.startedAt)}),a.duration&&e.jsxs("span",{className:"text-gray-500",children:["· ",y(a.duration)]})]},a.id))})})]},s.id)})})]})}export{F as default};
