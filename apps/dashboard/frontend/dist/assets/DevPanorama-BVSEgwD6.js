import{r as i,j as e,C as k,R as f,a5 as v,af as p,aJ as m,aO as g,x as u,ad as w,_ as y,bg as C}from"./index-C9bL3NYN.js";import{g as P}from"./github.api-DVI63Qhl.js";import"./index-B9ygI19o.js";const o=({children:s,className:l="",delay:r=0})=>e.jsx("div",{className:`
      rounded-2xl
      bg-white dark:bg-slate-800/80
      backdrop-blur-xl
      border border-slate-200 dark:border-slate-700
      shadow-lg shadow-slate-200/50 dark:shadow-black/30
      transition-all duration-300 ease-out
      hover:shadow-xl
      animate-fade-in-up
      ${l}
    `,style:{animationDelay:`${r}ms`},children:s}),S=()=>e.jsx("div",{className:"rounded-2xl bg-white dark:bg-slate-800/80 border border-slate-200 dark:border-slate-700 p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-slate-200 dark:bg-slate-700 rounded-xl"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-5 bg-slate-200 dark:bg-slate-700 rounded w-1/3"}),e.jsx("div",{className:"h-3 bg-slate-200 dark:bg-slate-700 rounded w-1/2"})]})]}),e.jsx("div",{className:"grid grid-cols-4 gap-3",children:[1,2,3,4].map(s=>e.jsx("div",{className:"h-16 bg-slate-100 dark:bg-slate-700/50 rounded-lg"},s))})]})}),h=({name:s,type:l})=>{const r={main:"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400 border-emerald-200 dark:border-emerald-800",develop:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400 border-blue-200 dark:border-blue-800",feature:"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400 border-purple-200 dark:border-purple-800",checkpoint:"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400 border-amber-200 dark:border-amber-800",other:"bg-slate-100 text-slate-600 dark:bg-slate-700/50 dark:text-slate-400 border-slate-200 dark:border-slate-600"};return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 text-xs font-medium rounded-full border ${r[l]}`,children:[e.jsx(m,{className:"w-3 h-3"}),s]})},$=({state:s})=>{const l={merged:{icon:C,color:"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400",label:"Merged"},open:{icon:g,color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",label:"Open"},closed:{icon:y,color:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400",label:"Closed"}},{icon:r,color:x,label:d}=l[s]||l.closed;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 text-xs font-medium rounded-full ${x}`,children:[e.jsx(r,{className:"w-3 h-3"}),d]})},R=({data:s,delay:l})=>{const[r,x]=i.useState(!1),d=a=>{const n=Math.floor((Date.now()-new Date(a).getTime())/6e4);return n<1?"刚刚":n<60?`${n}分钟前`:n<1440?`${Math.floor(n/60)}小时前`:new Date(a).toLocaleDateString("zh-CN",{month:"short",day:"numeric"})};return e.jsxs(o,{className:"overflow-hidden",delay:l,children:[e.jsxs("div",{className:"p-5 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/30 transition-colors",onClick:()=>x(!r),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-slate-500 to-slate-600 rounded-xl shadow-lg",children:e.jsx(p,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-white",children:s.repo.name}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:s.repo.description||"暂无描述"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"最近更新"}),e.jsx("p",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:d(s.repo.pushedAt)})]}),e.jsx(u,{className:`w-5 h-5 text-slate-400 transition-transform ${r?"rotate-90":""}`})]})]}),e.jsxs("div",{className:"mt-4 grid grid-cols-4 gap-3",children:[e.jsxs("div",{className:"p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg border border-slate-200 dark:border-slate-600",children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:"分支总数"}),e.jsx("p",{className:"text-xl font-semibold text-slate-800 dark:text-white",children:s.branches.total})]}),e.jsxs("div",{className:"p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800/50",children:[e.jsx("p",{className:"text-xs text-purple-600 dark:text-purple-400",children:"Feature"}),e.jsx("p",{className:"text-xl font-semibold text-purple-700 dark:text-purple-300",children:s.branches.featureCount})]}),e.jsxs("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-800/50",children:[e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400",children:"Checkpoint"}),e.jsx("p",{className:"text-xl font-semibold text-amber-700 dark:text-amber-300",children:s.branches.checkpointCount})]}),e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800/50",children:[e.jsx("p",{className:"text-xs text-blue-600 dark:text-blue-400",children:"最近 PR"}),e.jsx("p",{className:"text-xl font-semibold text-blue-700 dark:text-blue-300",children:s.recentPrs.length})]})]})]}),r&&e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"p-5 border-b border-slate-200 dark:border-slate-700",children:[e.jsxs("h4",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300 mb-3 flex items-center gap-2",children:[e.jsx(m,{className:"w-4 h-4"}),"分支结构"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.branches.main&&e.jsx(h,{name:s.branches.main,type:"main"}),s.branches.develop&&e.jsx(h,{name:s.branches.develop,type:"develop"})]}),s.branches.features.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mb-2",children:"Feature 分支"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.branches.features.map(a=>e.jsx(h,{name:a,type:"feature"},a))})]}),s.branches.checkpoints.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mb-2",children:"Checkpoint 分支"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.branches.checkpoints.map(a=>e.jsx(h,{name:a,type:"checkpoint"},a))})]})]})]}),e.jsxs("div",{className:"p-5",children:[e.jsxs("h4",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300 mb-3 flex items-center gap-2",children:[e.jsx(g,{className:"w-4 h-4"}),"最近 PR"]}),e.jsx("div",{className:"space-y-2",children:s.recentPrs.length===0?e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 text-center py-4",children:"暂无 PR"}):s.recentPrs.map(a=>e.jsx("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",className:"block p-3 bg-slate-50 dark:bg-slate-700/50 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg border border-slate-200 dark:border-slate-600 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"text-xs font-mono text-slate-500 dark:text-slate-400",children:["#",a.number]}),e.jsx($,{state:a.state})]}),e.jsx("p",{className:"text-sm font-medium text-slate-800 dark:text-white truncate",children:a.title}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-xs text-slate-500 dark:text-slate-400",children:[e.jsx("span",{children:a.author}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(m,{className:"w-3 h-3"}),a.headBranch," → ",a.baseBranch]})]})]}),e.jsx("span",{className:"text-xs text-slate-400 dark:text-slate-500 whitespace-nowrap",children:d(a.mergedAt||a.createdAt)})]})},a.number))}),e.jsxs(w,{to:`/panorama/repo/${s.repo.name}`,className:"mt-3 flex items-center justify-center gap-1 text-sm text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200 transition-colors",children:["查看详情 ",e.jsx(u,{className:"w-4 h-4"})]})]})]})]})};function E(){const[s,l]=i.useState([]),[r,x]=i.useState(!0),[d,a]=i.useState(null),[n,j]=i.useState(null),b=async()=>{try{a(null);const t=await P();t.success&&t.data?(l(t.data),j(new Date)):a(t.error||"Failed to fetch data")}catch(t){a("Failed to connect to server"),console.error("Fetch error:",t)}finally{x(!1)}};return i.useEffect(()=>{b();const t=setInterval(b,5*60*1e3);return()=>clearInterval(t)},[]),r?e.jsx("div",{className:"min-h-screen -m-8 -mt-8 p-8",children:e.jsxs("div",{className:"space-y-6 p-2",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-slate-200 dark:bg-slate-700 rounded w-48 mb-2"}),e.jsx("div",{className:"h-4 bg-slate-200 dark:bg-slate-700 rounded w-32"})]})}),e.jsx("div",{className:"space-y-4",children:[1,2,3].map(t=>e.jsx(S,{},t))})]})}):e.jsx("div",{className:"min-h-screen -m-8 -mt-8 p-8",children:e.jsxs("div",{className:"space-y-6 p-2",children:[e.jsx(o,{className:"p-6",delay:0,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:"VPS 全景视图"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"跟踪所有仓库的分支结构和开发进度"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[n&&e.jsxs("span",{className:"text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1",children:[e.jsx(k,{className:"w-3 h-3"}),n.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})]}),e.jsx("button",{onClick:()=>{x(!0),b()},className:"p-2 text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",title:"刷新",children:e.jsx(f,{className:`w-5 h-5 ${r?"animate-spin":""}`})})]})]})}),d&&e.jsx(o,{className:"p-6 border-red-200 dark:border-red-800/50",delay:100,children:e.jsxs("div",{className:"flex items-center gap-3 text-red-600 dark:text-red-400",children:[e.jsx(v,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"加载失败"}),e.jsx("p",{className:"text-sm opacity-75",children:d})]})]})}),!d&&s.length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[{label:"仓库数",value:s.length,icon:p,color:"text-slate-600 dark:text-slate-400",bg:"bg-slate-500/10"},{label:"总分支",value:s.reduce((t,c)=>t+c.branches.total,0),icon:m,color:"text-blue-600 dark:text-blue-400",bg:"bg-blue-500/10"},{label:"Feature 分支",value:s.reduce((t,c)=>t+c.branches.featureCount,0),icon:m,color:"text-purple-600 dark:text-purple-400",bg:"bg-purple-500/10"},{label:"活跃 PR",value:s.reduce((t,c)=>t+c.recentPrs.filter(N=>N.state==="open").length,0),icon:g,color:"text-green-600 dark:text-green-400",bg:"bg-green-500/10"}].map((t,c)=>e.jsx(o,{className:"p-4",delay:200+c*50,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2.5 rounded-xl ${t.bg}`,children:e.jsx(t.icon,{className:`w-5 h-5 ${t.color}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:t.label}),e.jsx("p",{className:"text-xl font-semibold text-slate-800 dark:text-white",children:t.value})]})]})},t.label))}),e.jsx("div",{className:"space-y-4",children:s.map((t,c)=>e.jsx(R,{data:t,delay:400+c*100},t.repo.name))}),!d&&s.length===0&&!r&&e.jsxs(o,{className:"p-12 text-center",delay:200,children:[e.jsx(p,{className:"w-12 h-12 mx-auto mb-4 text-slate-400"}),e.jsx("h3",{className:"text-lg font-medium text-slate-700 dark:text-slate-300 mb-2",children:"暂无数据"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"无法获取仓库信息"})]})]})})}export{E as default};
