import{aa as v,r as i,j as e,a5 as b,C as u,R as N,az as k,A as w,aP as g,d as m,aK as y,bg as C}from"./index-ChgcL0jp.js";const A={high:{bg:"bg-emerald-500",text:"text-emerald-600",label:"活跃"},medium:{bg:"bg-blue-500",text:"text-blue-600",label:"正常"},low:{bg:"bg-amber-500",text:"text-amber-600",label:"低活"},inactive:{bg:"bg-slate-400",text:"text-slate-500",label:"停滞"},unknown:{bg:"bg-slate-400",text:"text-slate-500",label:"未知"}},P={merged:"text-purple-500",open:"text-green-500",closed:"text-red-500"};function p(t){const s=new Date(t),r=new Date().getTime()-s.getTime(),n=Math.floor(r/6e4),c=Math.floor(n/60),d=Math.floor(c/24);return n<60?`${n}m ago`:c<24?`${c}h ago`:d<7?`${d}d ago`:s.toLocaleDateString("zh-CN",{month:"short",day:"numeric"})}function $({project:t,onClick:s}){const l=A[t.activityLevel],r=Math.min(t.stats.prsThisMonth/20*100,100);return e.jsxs("div",{onClick:s,className:"group cursor-pointer rounded-2xl bg-white dark:bg-slate-800/80 border border-slate-200 dark:border-slate-700 p-6 hover:shadow-lg hover:border-slate-300 dark:hover:border-slate-600 transition-all duration-200",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-white",children:t.displayName}),t.description&&e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1 line-clamp-1",children:t.description})]}),e.jsxs("div",{className:`flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-medium ${l.text} bg-opacity-10 ${l.bg.replace("bg-","bg-")}/10`,children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${l.bg}`}),l.label]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-xs text-slate-500 dark:text-slate-400 mb-1",children:[e.jsxs("span",{children:[t.stats.prsThisMonth," PRs 本月"]}),e.jsxs("span",{children:[t.stats.commitsThisMonth," commits"]})]}),e.jsx("div",{className:"h-2 bg-slate-100 dark:bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${l.bg} transition-all duration-500`,style:{width:`${r}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"w-4 h-4 text-slate-400"}),e.jsxs("span",{className:"text-sm text-slate-600 dark:text-slate-300",children:[t.stats.openPrs," open PRs"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{className:"w-4 h-4 text-slate-400"}),e.jsxs("span",{className:"text-sm text-slate-600 dark:text-slate-300",children:[t.stats.mergedPrsThisMonth," merged"]})]})]}),t.latestActivity&&e.jsx("div",{className:"pt-3 border-t border-slate-100 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center gap-2 text-xs text-slate-500 dark:text-slate-400",children:[e.jsx(u,{className:"w-3 h-3"}),e.jsx("span",{children:p(t.latestActivity.date)}),e.jsxs("span",{className:"truncate flex-1",children:["#",t.latestActivity.number,": ",t.latestActivity.title]})]})}),e.jsx("div",{className:"flex justify-end mt-2 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(y,{className:"w-4 h-4 text-slate-400"})})]})}function T({activity:t}){const s=P[t.state]||"text-slate-500",l=t.state==="merged"?m:t.state==="open"?C:b;return e.jsxs("div",{className:"flex items-start gap-3 py-3 border-b border-slate-100 dark:border-slate-700 last:border-0",children:[e.jsx(l,{className:`w-4 h-4 mt-0.5 ${s}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("span",{className:"text-xs font-medium text-slate-500 dark:text-slate-400 bg-slate-100 dark:bg-slate-700 px-1.5 py-0.5 rounded",children:t.repo}),e.jsx("span",{className:"text-xs text-slate-400",children:p(t.date)})]}),e.jsxs("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-slate-700 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-400 line-clamp-1",children:["#",t.number,": ",t.title]})]})]})}function S(){const t=v(),[s,l]=i.useState(null),[r,n]=i.useState(!0),[c,d]=i.useState(null),[h,f]=i.useState(null),o=i.useCallback(async()=>{try{n(!0),d(null);const x=await(await fetch("/api/github/overview")).json();x.success?(l(x.data),f(new Date)):d(x.error||"Failed to fetch data")}catch(a){d("Failed to connect to server"),console.error("Fetch error:",a)}finally{n(!1)}},[]);i.useEffect(()=>{o()},[o]),i.useEffect(()=>{const a=setInterval(o,3e5);return()=>clearInterval(a)},[o]);const j=a=>{t(`/panorama/${a}`)};return r&&!s?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):c&&!s?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(b,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:c}),e.jsx("button",{onClick:o,className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"重试"})]})}):e.jsx("div",{className:"min-h-screen -m-8 p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:"VPS 全景视图"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"所有项目开发状态一览"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[h&&e.jsxs("span",{className:"text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1",children:[e.jsx(u,{className:"w-3 h-3"}),h.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})]}),e.jsx("button",{onClick:o,disabled:r,className:"p-2 text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors disabled:opacity-50",title:"刷新",children:e.jsx(N,{className:`w-5 h-5 ${r?"animate-spin":""}`})})]})]}),s&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[{label:"项目数",value:s.summary.totalProjects,icon:k,color:"text-slate-600 dark:text-slate-400"},{label:"活跃项目",value:s.summary.activeProjects,icon:w,color:"text-emerald-600"},{label:"本月 PRs",value:s.summary.totalPrsThisMonth,icon:g,color:"text-blue-600"},{label:"本月 Commits",value:s.summary.totalCommitsThisMonth,icon:m,color:"text-purple-600"}].map(a=>e.jsx("div",{className:"bg-white dark:bg-slate-800/80 rounded-xl border border-slate-200 dark:border-slate-700 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(a.icon,{className:`w-5 h-5 ${a.color}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:a.label}),e.jsx("p",{className:"text-xl font-semibold text-slate-800 dark:text-white",children:a.value})]})]})},a.label))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300 uppercase tracking-wide",children:"项目概览"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:s==null?void 0:s.projects.map(a=>e.jsx($,{project:a,onClick:()=>j(a.name)},a.name))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300 uppercase tracking-wide",children:"最近动态"}),e.jsxs("div",{className:"bg-white dark:bg-slate-800/80 rounded-xl border border-slate-200 dark:border-slate-700 p-4",children:[s==null?void 0:s.recentActivities.map((a,x)=>e.jsx(T,{activity:a},`${a.repo}-${a.number}-${x}`)),(!(s!=null&&s.recentActivities)||s.recentActivities.length===0)&&e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 text-center py-4",children:"暂无最近动态"})]})]})]})]})})}export{S as default};
