import{r as b,j as e,a9 as q,aa as Q,a5 as J,y as K,C as V,R as Z,ay as A,aQ as $,d as E,x as ee,bg as te}from"./index-D1JGPNRX.js";const u={main:"#059669",develop:"#2563eb",textLight:"#9ca3af",grid:"#e5e7eb"},P=["#8b5cf6","#ec4899","#f97316","#06b6d4","#84cc16","#ef4444"];function se({data:a,loading:j}){const s=b.useMemo(()=>{if(!a)return null;const{dateRange:t,features:v}=a,d=new Date(t.start),N=new Date(t.end).getTime()-d.getTime(),y=700,i={left:100,right:40,top:20,bottom:40},k=y-i.left-i.right,w=36,l=28,x=Math.min(v.length,6),F=i.top+l*2+w*x+i.bottom+20,S=n=>{const L=(new Date(n).getTime()-d.getTime())/N;return i.left+L*k},W=i.top+14,T=W+l,B=T+l+10,z=[],M=24*60*60*1e3,X=Math.ceil(N/M),U=X>14?3:X>7?2:1;for(let n=0;n<=X;n+=U){const p=new Date(d.getTime()+n*M);z.push({x:S(p.toISOString()),label:`${p.getMonth()+1}/${p.getDate()}`})}const G=v.slice(0,6).map((n,p)=>{var O;const L=S(n.startDate),H=n.endDate?S(n.endDate):i.left+k,I=!n.endDate||n.prs.some(_=>_.state==="open");return{name:n.name,y:B+p*w,startX:L,endX:H,prCount:n.prs.length,isOngoing:I,color:P[p%P.length],latestPr:((O=n.prs[0])==null?void 0:O.title)||""}});return{width:y,height:F,padding:i,graphWidth:k,mainY:W,developY:T,featureRows:G,ticks:z,timelineY:F-i.bottom}},[a]);if(j)return e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"h-[300px] bg-slate-100 dark:bg-slate-700/50 rounded-lg"})});if(!s||!a)return e.jsx("div",{className:"h-[200px] flex items-center justify-center text-slate-400 dark:text-slate-500",children:e.jsx("p",{children:"暂无数据"})});const{width:f,height:c,padding:r,graphWidth:m,mainY:o,developY:h,featureRows:C,ticks:D,timelineY:g}=s;return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("svg",{width:f,height:c,className:"font-sans",children:[e.jsx("rect",{x:0,y:0,width:f,height:c,fill:"transparent"}),D.map((t,v)=>e.jsxs("g",{children:[e.jsx("line",{x1:t.x,y1:r.top,x2:t.x,y2:g,stroke:u.grid,strokeWidth:1,strokeDasharray:"4 4"}),e.jsx("text",{x:t.x,y:g+16,fill:u.textLight,fontSize:11,textAnchor:"middle",children:t.label})]},v)),e.jsx("text",{x:r.left-12,y:o,fill:u.main,fontSize:13,fontWeight:600,textAnchor:"end",dominantBaseline:"middle",children:"main"}),e.jsx("line",{x1:r.left,y1:o,x2:r.left+m,y2:o,stroke:u.main,strokeWidth:4,strokeLinecap:"round"}),e.jsx("text",{x:r.left-12,y:h,fill:u.develop,fontSize:13,fontWeight:600,textAnchor:"end",dominantBaseline:"middle",children:"develop"}),e.jsx("line",{x1:r.left,y1:h,x2:r.left+m,y2:h,stroke:u.develop,strokeWidth:4,strokeLinecap:"round"}),C.map(t=>e.jsxs("g",{children:[e.jsx("text",{x:r.left-12,y:t.y,fill:t.color,fontSize:12,fontWeight:500,textAnchor:"end",dominantBaseline:"middle",children:t.name}),e.jsx("rect",{x:t.startX,y:t.y-10,width:Math.max(t.endX-t.startX,60),height:20,rx:4,fill:t.color,opacity:.15}),e.jsx("rect",{x:t.startX,y:t.y-10,width:Math.max(t.endX-t.startX,60),height:20,rx:4,fill:"none",stroke:t.color,strokeWidth:2}),e.jsxs("text",{x:t.startX+Math.max(t.endX-t.startX,60)+8,y:t.y,fill:t.color,fontSize:11,fontWeight:600,dominantBaseline:"middle",children:[t.prCount," PR",t.prCount>1?"s":"",t.isOngoing?" ●":""]}),e.jsx("line",{x1:t.startX,y1:h+2,x2:t.startX,y2:t.y-10,stroke:t.color,strokeWidth:1,strokeDasharray:"3 3",opacity:.5})]},t.name)),C.length===0&&e.jsx("text",{x:r.left+m/2,y:h+50,fill:u.textLight,fontSize:14,textAnchor:"middle",children:"暂无 Feature 数据"})]})})}const Y=["bg-purple-500","bg-pink-500","bg-orange-500","bg-cyan-500","bg-lime-500","bg-red-500","bg-indigo-500","bg-teal-500"];function ae({feature:a,index:j,onClick:s}){const f=Y[j%Y.length],c=a.prs.filter(o=>o.state==="merged").length,r=a.prs.filter(o=>o.state==="open").length,m=r>0;return e.jsxs("div",{onClick:s,className:"group cursor-pointer bg-white dark:bg-slate-800/80 border border-slate-200 dark:border-slate-700 rounded-xl p-4 hover:shadow-md hover:border-slate-300 dark:hover:border-slate-600 transition-all",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${f}`}),e.jsx("h3",{className:"font-semibold text-slate-800 dark:text-white capitalize",children:a.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[m&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium text-green-600 bg-green-100 dark:bg-green-900/30 dark:text-green-400 rounded-full",children:"进行中"}),e.jsx(ee,{className:"w-4 h-4 text-slate-400 group-hover:text-slate-600 transition-colors"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-slate-600 dark:text-slate-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($,{className:"w-4 h-4"}),a.prs.length," PRs"]}),c>0&&e.jsxs("span",{className:"flex items-center gap-1 text-purple-600 dark:text-purple-400",children:[e.jsx(E,{className:"w-4 h-4"}),c," merged"]}),r>0&&e.jsxs("span",{className:"flex items-center gap-1 text-green-600 dark:text-green-400",children:[e.jsx(te,{className:"w-4 h-4"}),r," open"]})]}),a.prs[0]&&e.jsx("div",{className:"mt-3 pt-3 border-t border-slate-100 dark:border-slate-700",children:e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 truncate",children:["Latest: #",a.prs[0].number," ",a.prs[0].title]})})]})}function re(){var R,N,y,i,k,w;const{repoName:a}=q(),j=Q(),[s,f]=b.useState(null),[c,r]=b.useState(!0),[m,o]=b.useState(null),[h,C]=b.useState(null),D=(a==null?void 0:a.replace("zenithjoy-",""))||"",g=b.useCallback(async()=>{if(a)try{r(!0),o(null);const x=await(await fetch(`/api/github/repos/${a}/timeline?days=30`)).json();x.success?(f(x.data),C(new Date)):o(x.error||"Failed to fetch data")}catch(l){o("Failed to connect to server"),console.error("Fetch error:",l)}finally{r(!1)}},[a]);b.useEffect(()=>{g()},[g]);const t=()=>{j("/panorama")},v=l=>{j(`/panorama/${a}/${l}`)};if(c&&!s)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})});if(m&&!s)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(J,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:m}),e.jsx("button",{onClick:g,className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"重试"})]})});const d={mainCommits:((N=(R=s==null?void 0:s.main)==null?void 0:R.commits)==null?void 0:N.length)||0,developCommits:((i=(y=s==null?void 0:s.develop)==null?void 0:y.commits)==null?void 0:i.length)||0,features:((k=s==null?void 0:s.features)==null?void 0:k.length)||0,totalPrs:((w=s==null?void 0:s.features)==null?void 0:w.reduce((l,x)=>l+x.prs.length,0))||0};return e.jsx("div",{className:"min-h-screen -m-8 p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:t,className:"p-2 text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",children:e.jsx(K,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-800 dark:text-white capitalize",children:D}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"项目详情 · 最近 30 天"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[h&&e.jsxs("span",{className:"text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1",children:[e.jsx(V,{className:"w-3 h-3"}),h.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})]}),e.jsx("button",{onClick:g,disabled:c,className:"p-2 text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors disabled:opacity-50",title:"刷新",children:e.jsx(Z,{className:`w-5 h-5 ${c?"animate-spin":""}`})})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[{label:"Main Commits",value:d.mainCommits,icon:A,color:"text-emerald-600"},{label:"Develop Commits",value:d.developCommits,icon:A,color:"text-blue-600"},{label:"Features",value:d.features,icon:$,color:"text-purple-600"},{label:"Total PRs",value:d.totalPrs,icon:E,color:"text-amber-600"}].map(l=>e.jsx("div",{className:"bg-white dark:bg-slate-800/80 rounded-xl border border-slate-200 dark:border-slate-700 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l.icon,{className:`w-5 h-5 ${l.color}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:l.label}),e.jsx("p",{className:"text-xl font-semibold text-slate-800 dark:text-white",children:l.value})]})]})},l.label))}),e.jsxs("div",{className:"bg-white dark:bg-slate-800/80 rounded-xl border border-slate-200 dark:border-slate-700 p-6",children:[e.jsx("h2",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300 uppercase tracking-wide mb-4",children:"时间轴"}),e.jsx(se,{data:s,loading:c})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300 uppercase tracking-wide mb-4",children:["Features (",d.features,")"]}),d.features>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s==null?void 0:s.features.map((l,x)=>e.jsx(ae,{feature:l,index:x,onClick:()=>v(l.name)},l.name))}):e.jsxs("div",{className:"bg-white dark:bg-slate-800/80 rounded-xl border border-slate-200 dark:border-slate-700 p-8 text-center",children:[e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"暂无 Feature 数据"}),e.jsx("p",{className:"text-sm text-slate-400 dark:text-slate-500 mt-1",children:"只有 feat: 或 feat(scope): 格式的 PR 会被识别为 Feature"})]})]})]})})}export{re as default};
