import{f as P,r as n,j as e,R as r,h as u,E as S}from"./index-BldjrbfF.js";import{a as f}from"./index-B9ygI19o.js";import{C as $}from"./clock-BVRZvMzL.js";import{A}from"./alert-circle-Rt_gnw9d.js";import{X as E}from"./x-circle-CVWjZjJ_.js";import{C as L}from"./check-circle-DYhAJvMn.js";const j="",p={douyin:{loginPath:"/douyin-login",color:"from-pink-500 to-rose-500"},xiaohongshu:{loginPath:"/xiaohongshu-login",color:"from-red-500 to-orange-500"},kuaishou:{loginPath:"/kuaishou-login",color:"from-orange-500 to-yellow-500"},bilibili:{loginPath:"/bilibili-login",color:"from-blue-500 to-cyan-500"}};function O(){const y=P(),[N,l]=n.useState([]),[b,v]=n.useState(!0),[o,d]=n.useState(!1),[c,x]=n.useState(null),m=async()=>{try{const s=await f.get(`${j}/api/douyin/platforms-status`);if(s.data.success){const t=s.data.platforms.map(i=>{var a,h;return{...i,loginPath:((a=p[i.id])==null?void 0:a.loginPath)||"#",color:((h=p[i.id])==null?void 0:h.color)||"from-gray-500 to-gray-600"}});l(t)}}catch(s){console.error("Failed to fetch platforms status:",s)}finally{v(!1),d(!1)}};n.useEffect(()=>{m()},[]);const w=()=>{d(!0),m()},C=async s=>{if(s==="douyin"){x(s);try{const t=await f.get(`${j}/api/douyin/validate`,{timeout:9e4});t.data.success&&(l(i=>i.map(a=>a.id===s?{...a,status:t.data.valid?"logged_in":"expired"}:a)),t.data.valid?alert(`Cookie 有效${t.data.nickname?`，用户: ${t.data.nickname}`:""}`):alert(`Cookie 已过期: ${t.data.message}`))}catch(t){console.error("Validate failed:",t),alert("验证失败: "+(t.message||"请稍后重试"))}finally{x(null)}}},k=s=>{switch(s){case"logged_in":return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700",children:[e.jsx(L,{className:"w-3 h-3"}),"已登录"]});case"expired":return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium bg-red-100 text-red-700",children:[e.jsx(E,{className:"w-3 h-3"}),"已过期"]});default:return e.jsxs("span",{className:"inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-700",children:[e.jsx(A,{className:"w-3 h-3"}),"未登录"]})}},g=s=>s?new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-";return b?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(r,{className:"w-8 h-8 animate-spin text-gray-400"})}):e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"平台登录管理"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"管理各平台的登录状态和 Cookie"})]}),e.jsxs("button",{onClick:w,disabled:o,className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 transition-colors",children:[e.jsx(r,{className:`w-4 h-4 ${o?"animate-spin":""}`}),"刷新状态"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:N.map(s=>e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden hover:shadow-md transition-shadow",children:[e.jsx("div",{className:`bg-gradient-to-r ${s.color} p-4`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur rounded-xl flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:s.icon})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:s.name}),e.jsx("div",{className:"mt-1",children:k(s.status)})]})]})}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx($,{className:"w-4 h-4"}),e.jsx("span",{children:"上次登录"})]}),e.jsx("div",{className:"text-gray-900 font-medium",children:g(s.lastLogin)}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx(u,{className:"w-4 h-4"}),e.jsx("span",{children:"过期时间"})]}),e.jsx("div",{className:"text-gray-900 font-medium",children:g(s.expiresAt)})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsxs("button",{onClick:()=>y(s.loginPath),className:`flex-1 inline-flex justify-center items-center gap-2 px-4 py-2.5 text-sm font-medium text-white rounded-lg bg-gradient-to-r ${s.color} hover:opacity-90 transition-opacity`,children:[s.status==="logged_in"?"重新登录":"立即登录",e.jsx(S,{className:"w-4 h-4"})]}),s.id==="douyin"&&e.jsx("button",{onClick:()=>C(s.id),disabled:c===s.id,className:"inline-flex justify-center items-center gap-2 px-4 py-2.5 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 disabled:opacity-50 transition-colors",children:c===s.id?e.jsxs(e.Fragment,{children:[e.jsx(r,{className:"w-4 h-4 animate-spin"}),"验证中"]}):e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"w-4 h-4"}),"验证"]})})]})]})]},s.id))}),e.jsxs("div",{className:"mt-8 p-4 bg-blue-50 border border-blue-200 rounded-xl",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"提示"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"• 各平台 Cookie 有效期不同，建议定期检查登录状态"}),e.jsx("li",{children:"• 登录成功后，系统会自动保存 Cookie 到服务器"}),e.jsx("li",{children:"• 如 Cookie 过期，相关的数据采集和发布功能将无法使用"}),e.jsx("li",{children:"• 系统会在 Cookie 即将过期时发送通知提醒"})]})]})]})}export{O as default};
