import{r as d,j as e,m as k,a2 as w,A as y,R as _,at as S,e as C,au as $,k as D,av as M,aw as T}from"./index-CtUv-lZj.js";import{a as E}from"./client-DSYFshK-.js";import"./index-B9ygI19o.js";const F={getStats:async(s=30)=>(await E.get("/v1/claude-stats",{params:{days:s}})).data};function i(s){return s<.01?"<$0.01":`$${s.toFixed(2)}`}function n(s){return s===0?"0":s<1e3?String(s):s<1e6?`${(s/1e3).toFixed(1)}k`:`${(s/1e6).toFixed(2)}M`}function L(s){return new Date(s).toLocaleDateString("zh-CN",{month:"short",day:"numeric"})}function A(s){return new Date(s).toLocaleString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function z(s){return s?s.split("/").slice(-2).join("/")||s:"-"}function b(s){return s.replace("claude-","").replace("-20251101","").replace("-20250929","").replace("-20250514","").replace("-20241022","").replace("-20240307","")}function j(s){return s.includes("opus")?"bg-purple-500":s.includes("sonnet")?"bg-blue-500":s.includes("haiku")?"bg-green-500":"bg-gray-500"}function J(){const[s,r]=d.useState(null),[x,h]=d.useState(!0),[g,u]=d.useState(null),[c,f]=d.useState(30),o=async()=>{h(!0),u(null);try{const t=await F.getStats(c);r(t)}catch(t){u(t instanceof Error?t.message:"Failed to load stats")}finally{h(!1)}};if(d.useEffect(()=>{o()},[c]),x&&!s)return e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(k,{className:"w-8 h-8 animate-spin text-blue-500"})});if(g)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-96",children:[e.jsx(w,{className:"w-12 h-12 text-red-500 dark:text-red-400 mb-4"}),e.jsx("p",{className:"text-red-600 dark:text-red-400 mb-3",children:g}),e.jsx("button",{onClick:o,className:"px-4 py-2 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-xl hover:from-blue-700 hover:to-blue-800 shadow-lg shadow-blue-500/25 magnetic-btn",children:"重试"})]});if(!s)return null;const{overview:a,daily:m,recent_sessions:p}=s,N=Math.max(...m.map(t=>t.total_cost),.01);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg shadow-blue-500/25",children:e.jsx(y,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Claude 使用统计"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"基于本地 JSONL 日志"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("select",{value:c,onChange:t=>f(Number(t.target.value)),className:"px-3 py-2 border border-gray-300 dark:border-slate-600 rounded-xl text-sm bg-white dark:bg-slate-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:7,children:"最近 7 天"}),e.jsx("option",{value:14,children:"最近 14 天"}),e.jsx("option",{value:30,children:"最近 30 天"}),e.jsx("option",{value:60,children:"最近 60 天"}),e.jsx("option",{value:90,children:"最近 90 天"})]}),e.jsx("button",{onClick:o,disabled:x,className:"p-2 text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded-xl transition-colors",children:e.jsx(_,{className:`w-5 h-5 ${x?"animate-spin":""}`})})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-gray-200 dark:border-slate-700 p-5 tilt-card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center shadow-lg shadow-green-500/25",children:e.jsx(S,{className:"w-5 h-5 text-white"})}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"总费用"})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:i(a.total_cost)}),e.jsxs("div",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:["平均 ",i(a.average_cost_per_session),"/会话"]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-gray-200 dark:border-slate-700 p-5 tilt-card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center shadow-lg shadow-blue-500/25",children:e.jsx(y,{className:"w-5 h-5 text-white"})}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"会话数"})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a.total_sessions}),e.jsxs("div",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:[a.total_messages," 条消息"]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-gray-200 dark:border-slate-700 p-5 tilt-card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-violet-600 rounded-xl flex items-center justify-center shadow-lg shadow-purple-500/25",children:e.jsx(C,{className:"w-5 h-5 text-white"})}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"输入 Token"})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:n(a.total_input_tokens)})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-gray-200 dark:border-slate-700 p-5 tilt-card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-orange-500 to-red-500 rounded-xl flex items-center justify-center shadow-lg shadow-orange-500/25",children:e.jsx($,{className:"w-5 h-5 text-white"})}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"输出 Token"})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:n(a.total_output_tokens)})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-6",children:[e.jsxs("div",{className:"col-span-2 bg-white dark:bg-slate-800 rounded-2xl border border-gray-200 dark:border-slate-700 p-6 shimmer-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"每日费用趋势"}),e.jsx(D,{className:"w-5 h-5 text-gray-400 dark:text-gray-500"})]}),m.length===0?e.jsx("div",{className:"h-48 flex items-center justify-center text-gray-400 dark:text-gray-500",children:"暂无数据"}):e.jsx("div",{className:"h-48 flex items-end gap-1",children:m.slice(0,30).reverse().map((t,l)=>{const v=t.total_cost/N*100;return e.jsxs("div",{className:"flex-1 flex flex-col items-center group relative",children:[e.jsx("div",{className:"w-full bg-gradient-to-t from-blue-600 to-blue-400 hover:from-blue-500 hover:to-blue-300 rounded-t transition-all cursor-pointer",style:{height:`${Math.max(v,2)}%`}}),e.jsxs("div",{className:"absolute bottom-full mb-2 hidden group-hover:block bg-gray-800 dark:bg-slate-900 text-white text-xs px-2 py-1 rounded-lg whitespace-nowrap z-10 shadow-lg",children:[t.date,": ",i(t.total_cost),e.jsx("br",{}),t.sessions," 会话"]}),l%5===0&&e.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500 mt-2 -rotate-45 origin-left",children:L(t.date)})]},t.date)})})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-gray-200 dark:border-slate-700 p-6 shimmer-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"按模型"}),e.jsx(M,{className:"w-5 h-5 text-gray-400 dark:text-gray-500"})]}),e.jsx("div",{className:"space-y-4",children:a.by_model.length===0?e.jsx("div",{className:"text-center text-gray-400 dark:text-gray-500 py-8",children:"暂无数据"}):a.by_model.sort((t,l)=>l.cost-t.cost).map(t=>{const l=a.total_cost>0?t.cost/a.total_cost*100:0;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:b(t.model)}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:i(t.cost)})]}),e.jsx("div",{className:"h-2 bg-gray-100 dark:bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full ${j(t.model)} rounded-full transition-all`,style:{width:`${l}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-400 dark:text-gray-500 mt-1",children:[e.jsxs("span",{children:[n(t.input_tokens)," 输入"]}),e.jsxs("span",{children:[n(t.output_tokens)," 输出"]})]})]},t.model)})})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-gray-200 dark:border-slate-700 overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"最近会话"}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[p.length," 个会话"]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-slate-700/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"项目"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"时间"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"模型"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"消息数"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Token"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"费用"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-slate-700",children:p.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-slate-700/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4 text-gray-400 dark:text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-900 dark:text-white font-mono",children:z(t.cwd)})]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 dark:text-gray-400",children:A(t.started_at)}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex px-2.5 py-1 text-xs rounded-lg text-white ${j(t.model)}`,children:b(t.model)})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 dark:text-white text-right",children:t.messages}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500 dark:text-gray-400 text-right font-mono",children:n(t.input_tokens+t.output_tokens)}),e.jsx("td",{className:"px-6 py-4 text-sm font-medium text-green-600 dark:text-green-400 text-right",children:i(t.cost)})]},t.session_id))})]})})]})]})}export{J as default};
