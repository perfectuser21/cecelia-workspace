import{a7 as w,r as x,j as e,R as p,ab as j,G as y,aR as R,A as _,a1 as k,a0 as C,F as A}from"./index-C6sXer-l.js";function P(){const{name:t}=w(),[a,f]=x.useState([]),[r,g]=x.useState(null),[N,v]=x.useState(!0),o=async()=>{try{const[s,i]=await Promise.all([fetch("/api/cecelia/overview?limit=50"),fetch("/api/cecelia/projects")]),c=await s.json(),l=await i.json();if(c.success){const n=c.recent_runs.filter(u=>u.project===t);f(n)}if(l.success){const n=l.projects.find(u=>u.name===t);g(n||null)}}catch(s){console.error(s)}finally{v(!1)}};if(x.useEffect(()=>{o();const s=setInterval(o,1e4);return()=>clearInterval(s)},[t]),N)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(p,{className:"w-6 h-6 text-violet-400 animate-spin"})});const m=a.filter(s=>s.status==="running"),d=a.filter(s=>s.status==="completed"),h=a.filter(s=>s.status==="failed");return e.jsxs("div",{className:"space-y-4 max-w-4xl",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(j,{to:"/cecelia",className:"p-2 text-gray-400 hover:text-white hover:bg-slate-700 rounded",children:e.jsx(y,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl font-semibold text-white",children:t}),(r==null?void 0:r.description)&&e.jsx("p",{className:"text-sm text-gray-400",children:r.description})]}),e.jsx("button",{onClick:o,className:"p-2 text-gray-400 hover:text-white hover:bg-slate-700 rounded",children:e.jsx(p,{className:"w-4 h-4"})})]}),r&&r.features.length>0&&e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-4 h-4 text-violet-400"}),e.jsx("h2",{className:"font-medium text-white",children:"Features"})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:[r.features.length," 个"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.features.sort((s,i)=>{const c=a.some(n=>n.feature_branch.includes(s.id)),l=a.some(n=>n.feature_branch.includes(i.id));return c&&!l?-1:!c&&l?1:0}).slice(0,8).map(s=>{const i=a.some(l=>l.status==="running"&&l.feature_branch.includes(s.id)),c=a.some(l=>l.feature_branch.includes(s.id));return e.jsxs("div",{className:`px-3 py-1.5 rounded text-sm border ${i?"bg-blue-500/20 border-blue-500/50 text-blue-300":c?"bg-emerald-500/10 border-emerald-500/30 text-emerald-300":"bg-slate-700/30 border-slate-600 text-gray-400"}`,children:[i&&e.jsx("span",{className:"inline-block w-1.5 h-1.5 bg-blue-400 rounded-full mr-2 animate-pulse"}),e.jsx("span",{children:s.name}),e.jsxs("span",{className:"text-gray-500 ml-1 text-xs",children:["v",s.version]})]},s.id)}),r.features.length>8&&e.jsxs("div",{className:"px-3 py-1.5 text-xs text-gray-500",children:["+",r.features.length-8," 更多"]})]})]}),m.length>0&&e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-blue-500/20",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-slate-700 flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4 text-blue-400"}),e.jsxs("h2",{className:"font-medium text-white",children:["正在执行 (",m.length,")"]})]}),e.jsx("div",{className:"p-3 space-y-2",children:m.map(s=>e.jsx(b,{run:s},s.id))})]}),d.length>0&&e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-emerald-500/20",children:[e.jsx("div",{className:"px-4 py-3 border-b border-slate-700 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-4 h-4 text-emerald-400"}),e.jsxs("h2",{className:"font-medium text-white",children:["已完成 (",d.length,")"]})]})}),e.jsxs("div",{className:"p-3 space-y-2",children:[d.slice(0,5).map(s=>e.jsx(b,{run:s},s.id)),d.length>5&&e.jsxs("p",{className:"text-xs text-gray-500 text-center py-2",children:["还有 ",d.length-5," 个已完成任务"]})]})]}),h.length>0&&e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-red-500/20",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-slate-700 flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4 text-red-400"}),e.jsxs("h2",{className:"font-medium text-white",children:["失败 (",h.length,")"]})]}),e.jsx("div",{className:"p-3 space-y-2",children:h.map(s=>e.jsx(b,{run:s},s.id))})]}),a.length===0&&(!r||r.features.length===0)&&e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700 p-8 text-center",children:[e.jsx(A,{className:"w-8 h-8 text-gray-600 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"暂无任务记录"})]})]})}function b({run:t}){const a=t.status==="running";return e.jsxs(j,{to:`/cecelia/runs/${t.id}`,className:`block p-3 rounded border transition-colors ${a?"bg-blue-900/20 border-blue-500/30 hover:border-blue-500/50":t.status==="completed"?"bg-slate-700/30 border-slate-600 hover:border-slate-500":"bg-red-900/10 border-red-500/20 hover:border-red-500/40"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[a&&e.jsx(p,{className:"w-3 h-3 text-blue-400 animate-spin"}),e.jsx("span",{className:"font-medium text-white",children:t.prd_title||t.feature_branch})]}),t.prd_summary&&e.jsx("p",{className:"text-xs text-gray-400 mt-1 line-clamp-1",children:t.prd_summary})]}),a&&t.current_step&&e.jsxs("span",{className:"text-xs text-blue-400 ml-2",children:["Step ",t.current_step,"/9"]})]}),a&&e.jsx("div",{className:"mt-2 h-1 bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 rounded-full transition-all",style:{width:`${(t.current_step||0)/9*100}%`}})})]})}export{P as default};
