const h=[{id:"spark",name:"Spark",codename:"点燃执行",icon:"Zap",role:"执行者",description:"解析 PRD 文档，拆解 Checkpoints，调用 Claude Code 执行代码任务",workflowKeywords:["PRD Executor","prd-executor","Execute","Cecelia"],status:"active",gradient:{from:"from-blue-500",to:"to-cyan-500",border:"border-blue-500/30"}},{id:"echo",name:"Echo",codename:"协调反馈",icon:"RefreshCw",role:"协调者",description:"监控执行状态，处理多阶段任务，分析结果并创建下一阶段",workflowKeywords:["Coordinator","coordinator","Multi-stage","Callback"],status:"active",gradient:{from:"from-emerald-500",to:"to-teal-500",border:"border-emerald-500/30"}},{id:"prism",name:"Prism",codename:"多维分析",icon:"Diamond",role:"分析者",description:"多维度分析执行结果，提供智能决策建议",workflowKeywords:["Analyzer","Analysis","Report"],status:"planned",gradient:{from:"from-violet-500",to:"to-purple-500",border:"border-violet-500/30"}}],C="";async function w(){try{const e=await fetch(`${C}/api/cecelia/overview?limit=20`);if(!e.ok)return null;const t=await e.json();return t.success?t:null}catch{return null}}function v(e){switch(e){case"24h":return 24*60*60*1e3;case"72h":return 72*60*60*1e3;case"7d":return 7*24*60*60*1e3}}function _(e,t){const n=Date.now(),o=v(t),s=n-o;return e.filter(a=>new Date(a.started_at).getTime()>=s)}function T(e,t){const n=_(e,t),o=n.filter(r=>r.status==="completed").length,s=n.filter(r=>r.status==="failed").length,a=n.filter(r=>r.status==="running").length,u=n.length,c=o+s;return{total:u,success:o,error:s,running:a,successRate:c>0?Math.round(o/c*100):0}}function k(e){const t=new Map;for(const n of h)t.set(n.id,[]);for(const n of e){const o=t.get("spark")||[];o.push(n),t.set("spark",o)}return t}function j(e){const t=new Date().toDateString(),n=e.filter(r=>new Date(r.started_at).toDateString()===t),o=n.filter(r=>r.status==="completed").length,s=n.filter(r=>r.status==="failed").length,a=n.filter(r=>r.status==="running").length,u=n.length,c=o+s;return{todayTotal:u,todaySuccess:o,todayError:s,todayRunning:a,successRate:c>0?Math.round(o/c*100):0}}async function M(e="24h"){const t=await w(),n=(t==null?void 0:t.recent_runs)||[],o=n.filter(r=>r.status==="running"),s=n.filter(r=>r.status!=="running").slice(0,10),a=T(n,e),u=k(n),c=h.map(r=>{const g=u.get(r.id)||[],i=j(g);return{...r,stats:i,recentRuns:g.slice(0,5)}});return{totalRuns:(t==null?void 0:t.total_runs)||0,runningRuns:(t==null?void 0:t.running)||0,completedRuns:(t==null?void 0:t.completed)||0,failedRuns:(t==null?void 0:t.failed)||0,runningTasks:o,recentRuns:s,timeRange:e,periodStats:a,agents:c}}async function E(e,t="24h"){return(await M(t)).agents.find(o=>o.id===e)||null}function A(e){return e.replace(/^cp-/,"").replace(/^feature\//,"").replace(/^\d{6,}-/,"").replace(/-v\d+$/,"").split("-")[0]||e}function S(e){return e.split("-").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}function b(e){var o;const t=new Map;for(const s of e){const a=s.project||"unknown",u=A(s.feature_branch);t.has(a)||t.set(a,new Map);const c=t.get(a);c.has(u)||c.set(u,[]),c.get(u).push(s)}const n=[];for(const[s,a]of t){const u=[];let c=0,r=0;for(const[i,d]of a){const f=[...d].sort((l,p)=>new Date(l.started_at).getTime()-new Date(p.started_at).getTime()),R=f.map((l,p)=>({id:l.id,version:p+1,date:new Date(l.started_at).toLocaleDateString("zh-CN",{month:"numeric",day:"numeric"}),status:l.status,branch:l.feature_branch})),m=f.find(l=>l.status==="running"),y=f[f.length-1];u.push({name:i,displayName:S(i),history:R,current:m,latestRun:y}),c+=m?1:0,r+=f.length}u.sort((i,d)=>i.current&&!d.current?-1:!i.current&&d.current?1:new Date(d.latestRun.started_at).getTime()-new Date(i.latestRun.started_at).getTime());const g=(o=e.find(i=>i.project===s&&i.repo_url))==null?void 0:o.repo_url;n.push({name:s,repoUrl:g,features:u,runningCount:c,totalRuns:r})}return n.sort((s,a)=>s.runningCount!==a.runningCount?a.runningCount-s.runningCount:a.totalRuns-s.totalRuns),n}async function N(){const e=await w(),t=(e==null?void 0:e.recent_runs)||[],n=b(t);return{projects:n,totalProjects:n.length,totalFeatures:n.reduce((o,s)=>o+s.features.length,0),totalRuns:t.length}}export{N as a,E as b,M as f};
