import{r as h,j as e,aj as W,x as E,K as F,aC as C,_ as B,aI as M,bd as A,C as H,R as G,a2 as I,a9 as T,aM as L}from"./index-VpQ83PAe.js";import{g as O,a as D}from"./github.api-OHZvbO3D.js";import"./index-B9ygI19o.js";const i={main:"#10b981",develop:"#3b82f6",merge:"#8b5cf6",node:"#ffffff",text:"#64748b"},d={width:600,height:300,padding:40,nodeRadius:6,lineHeight:60,nodeSpacing:50};function U({data:t,loading:a}){const l=h.useMemo(()=>{if(!t)return null;const s=t.main.slice(0,10),x=t.develop.slice(0,10),j=new Set(t.mergePoints),f=s.map((m,g)=>({...m,x:d.padding+g*d.nodeSpacing,y:d.padding+d.lineHeight,branch:"main",isMerge:j.has(m.sha)})),N=x.map((m,g)=>({...m,x:d.padding+g*d.nodeSpacing,y:d.padding+d.lineHeight*2,branch:"develop",isMerge:j.has(m.sha)})),p=[];N.forEach(m=>{if(m.isMerge){const g=f.find(k=>k.sha===m.sha);g&&p.push({from:m,to:g})}});const y=Math.max(d.padding*2+Math.max(s.length,x.length)*d.nodeSpacing,d.width);return{mainNodes:f,developNodes:N,mergeLines:p,graphWidth:y}},[t]);if(a)return e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"h-[200px] bg-slate-100 dark:bg-slate-700/50 rounded-lg"})});if(!l||!t)return e.jsx("div",{className:"h-[200px] flex items-center justify-center text-slate-400 dark:text-slate-500",children:e.jsx("p",{children:"暂无分支数据"})});const{mainNodes:o,developNodes:r,mergeLines:u,graphWidth:c}=l;return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("svg",{width:c,height:d.height,className:"min-w-full",viewBox:`0 0 ${c} ${d.height}`,children:[e.jsx("text",{x:12,y:d.padding+d.lineHeight,fill:i.main,fontSize:12,fontWeight:600,dominantBaseline:"middle",children:"main"}),e.jsx("text",{x:12,y:d.padding+d.lineHeight*2,fill:i.develop,fontSize:12,fontWeight:600,dominantBaseline:"middle",children:"develop"}),o.length>1&&e.jsx("line",{x1:o[0].x,y1:o[0].y,x2:o[o.length-1].x,y2:o[o.length-1].y,stroke:i.main,strokeWidth:3,strokeLinecap:"round"}),r.length>1&&e.jsx("line",{x1:r[0].x,y1:r[0].y,x2:r[r.length-1].x,y2:r[r.length-1].y,stroke:i.develop,strokeWidth:3,strokeLinecap:"round"}),u.map((s,x)=>e.jsx("path",{d:`M ${s.from.x} ${s.from.y} Q ${s.from.x} ${(s.from.y+s.to.y)/2} ${s.to.x} ${s.to.y}`,fill:"none",stroke:i.merge,strokeWidth:2,strokeDasharray:"4 2",opacity:.6},x)),o.map((s,x)=>e.jsxs("g",{className:"cursor-pointer",children:[e.jsx("title",{children:`${s.sha}: ${s.message}`}),e.jsx("circle",{cx:s.x,cy:s.y,r:d.nodeRadius,fill:s.isMerge?i.merge:i.main,stroke:i.node,strokeWidth:2}),(x===0||s.isMerge)&&e.jsx("text",{x:s.x,y:s.y-14,fill:i.text,fontSize:9,textAnchor:"middle",className:"font-mono",children:s.sha})]},`main-${x}`)),r.map((s,x)=>e.jsxs("g",{className:"cursor-pointer",children:[e.jsx("title",{children:`${s.sha}: ${s.message}`}),e.jsx("circle",{cx:s.x,cy:s.y,r:d.nodeRadius,fill:s.isMerge?i.merge:i.develop,stroke:i.node,strokeWidth:2}),x===0&&e.jsx("text",{x:s.x,y:s.y+18,fill:i.text,fontSize:9,textAnchor:"middle",className:"font-mono",children:s.sha})]},`develop-${x}`)),e.jsxs("g",{transform:`translate(${c-150}, 20)`,children:[e.jsx("circle",{cx:0,cy:0,r:4,fill:i.main}),e.jsx("text",{x:10,y:4,fontSize:10,fill:i.text,children:"main"}),e.jsx("circle",{cx:0,cy:16,r:4,fill:i.develop}),e.jsx("text",{x:10,y:20,fontSize:10,fill:i.text,children:"develop"}),e.jsx("circle",{cx:0,cy:32,r:4,fill:i.merge}),e.jsx("text",{x:10,y:36,fontSize:10,fill:i.text,children:"merge"})]})]})})}const _=({state:t})=>{const a={merged:{icon:A,color:"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400"},open:{icon:M,color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400"},closed:{icon:B,color:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"}},{icon:l,color:o}=a[t]||a.closed;return e.jsx("span",{className:`inline-flex items-center gap-1 px-1.5 py-0.5 text-xs font-medium rounded ${o}`,children:e.jsx(l,{className:"w-3 h-3"})})},q=({feature:t})=>{const[a,l]=h.useState(!1),o=c=>new Date(c).toLocaleDateString("zh-CN",{month:"short",day:"numeric"}),r=t.prs.filter(c=>c.state==="merged").length,u=t.prs.filter(c=>c.state==="open").length;return e.jsxs("div",{className:"border-b border-slate-200 dark:border-slate-700 last:border-b-0",children:[e.jsxs("button",{onClick:()=>l(!a),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-slate-50 dark:hover:bg-slate-700/30 transition-colors text-left",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[a?e.jsx(W,{className:"w-4 h-4 text-slate-400"}):e.jsx(E,{className:"w-4 h-4 text-slate-400"}),e.jsx("span",{className:"font-medium text-slate-800 dark:text-white",children:t.displayName}),e.jsxs("span",{className:"text-sm text-slate-500 dark:text-slate-400",children:["[",t.prs.length," PR",t.prs.length>1?"s":"","]"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[r>0&&e.jsxs("span",{className:"px-2 py-0.5 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400 rounded-full",children:[r," merged"]}),u>0&&e.jsxs("span",{className:"px-2 py-0.5 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded-full",children:[u," open"]})]})]}),!a&&t.latestPr&&e.jsx("div",{className:"px-4 pb-3 pl-11",children:e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 truncate",children:["Latest: ",t.latestPr.title]})}),a&&e.jsx("div",{className:"pb-2",children:t.prs.map(c=>e.jsx(K,{pr:c,formatDate:o},c.number))})]})},K=({pr:t,formatDate:a})=>e.jsx("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"block mx-4 mb-2 ml-11 p-3 bg-slate-50 dark:bg-slate-700/50 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg border border-slate-200 dark:border-slate-600 transition-colors group",children:e.jsx("div",{className:"flex items-start justify-between gap-2",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"text-xs font-mono text-slate-500 dark:text-slate-400",children:["#",t.number]}),e.jsx(_,{state:t.state}),e.jsx(F,{className:"w-3 h-3 text-slate-400 opacity-0 group-hover:opacity-100 transition-opacity"})]}),e.jsx("p",{className:"text-sm font-medium text-slate-800 dark:text-white truncate",children:t.title}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-xs text-slate-500 dark:text-slate-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(C,{className:"w-3 h-3"}),t.headBranch]}),e.jsx("span",{children:a(t.mergedAt||t.createdAt)})]})]})})});function Q({features:t,loading:a}){return a?e.jsx("div",{className:"animate-pulse space-y-3",children:[1,2,3].map(l=>e.jsx("div",{className:"h-16 bg-slate-100 dark:bg-slate-700/50 rounded-lg"},l))}):!t||t.length===0?e.jsx("div",{className:"h-[200px] flex items-center justify-center text-slate-400 dark:text-slate-500",children:e.jsx("p",{children:"暂无 Feature 数据"})}):e.jsx("div",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:t.map(l=>e.jsx(q,{feature:l},l.name))})}const P=["zenithjoy-engine","zenithjoy-core","zenithjoy-autopilot"],v=({children:t,className:a=""})=>e.jsx("div",{className:`
      rounded-2xl
      bg-white dark:bg-slate-800/80
      backdrop-blur-xl
      border border-slate-200 dark:border-slate-700
      shadow-lg shadow-slate-200/50 dark:shadow-black/30
      transition-all duration-300 ease-out
      ${a}
    `,children:t}),V=({repo:t,active:a,onClick:l})=>e.jsx("button",{onClick:l,className:`
      px-4 py-2 text-sm font-medium rounded-lg transition-all duration-200
      ${a?"bg-slate-800 dark:bg-white text-white dark:text-slate-800 shadow-md":"text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700"}
    `,children:t}),z=({icon:t,title:a})=>e.jsxs("div",{className:"flex items-center gap-2 px-5 py-3 border-b border-slate-200 dark:border-slate-700",children:[e.jsx(t,{className:"w-4 h-4 text-slate-500 dark:text-slate-400"}),e.jsx("h3",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300",children:a})]});function Z(){var k,S,$,R;const[t,a]=h.useState(P[0]),[l,o]=h.useState(null),[r,u]=h.useState(null),[c,s]=h.useState(!0),[x,j]=h.useState(null),[f,N]=h.useState(null),p=h.useCallback(async n=>{try{s(!0),j(null);const[b,w]=await Promise.all([O(n),D(n)]);b.success&&b.data?o(b.data):o(null),w.success&&w.data?u(w.data):u(null),N(new Date)}catch{j("Failed to connect to server")}finally{s(!1)}},[]);h.useEffect(()=>{p(t)},[t,p]),h.useEffect(()=>{const n=setInterval(()=>p(t),3e5);return()=>clearInterval(n)},[t,p]);const y=()=>{p(t)},m=n=>{n!==t&&a(n)},g={mainCommits:((k=l==null?void 0:l.main)==null?void 0:k.length)||0,developCommits:((S=l==null?void 0:l.develop)==null?void 0:S.length)||0,features:(($=r==null?void 0:r.features)==null?void 0:$.length)||0,totalPrs:((R=r==null?void 0:r.features)==null?void 0:R.reduce((n,b)=>n+b.prs.length,0))||0};return e.jsx("div",{className:"min-h-screen -m-8 -mt-8 p-8",children:e.jsxs("div",{className:"space-y-6 p-2",children:[e.jsxs(v,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:"VPS 全景视图"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"分支结构 + Feature 进化路径"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[f&&e.jsxs("span",{className:"text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1",children:[e.jsx(H,{className:"w-3 h-3"}),f.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})]}),e.jsx("button",{onClick:y,disabled:c,className:"p-2 text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors disabled:opacity-50",title:"刷新",children:e.jsx(G,{className:`w-5 h-5 ${c?"animate-spin":""}`})})]})]}),e.jsx("div",{className:"mt-4 flex items-center gap-2 p-1 bg-slate-100 dark:bg-slate-700/50 rounded-xl",children:P.map(n=>e.jsx(V,{repo:n,active:n===t,onClick:()=>m(n)},n))})]}),x&&e.jsx(v,{className:"p-6 border-red-200 dark:border-red-800/50",children:e.jsxs("div",{className:"flex items-center gap-3 text-red-600 dark:text-red-400",children:[e.jsx(I,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"加载失败"}),e.jsx("p",{className:"text-sm opacity-75",children:x})]})]})}),!x&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[{label:"仓库",value:t.replace("zenithjoy-",""),icon:T,color:"text-slate-600 dark:text-slate-400",bg:"bg-slate-500/10"},{label:"Main Commits",value:g.mainCommits,icon:C,color:"text-emerald-600 dark:text-emerald-400",bg:"bg-emerald-500/10"},{label:"Features",value:g.features,icon:L,color:"text-purple-600 dark:text-purple-400",bg:"bg-purple-500/10"},{label:"总 PRs",value:g.totalPrs,icon:M,color:"text-blue-600 dark:text-blue-400",bg:"bg-blue-500/10"}].map(n=>e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2.5 rounded-xl ${n.bg}`,children:e.jsx(n.icon,{className:`w-5 h-5 ${n.color}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:n.label}),e.jsx("p",{className:"text-xl font-semibold text-slate-800 dark:text-white",children:n.value})]})]})},n.label))}),!x&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(v,{className:"overflow-hidden",children:[e.jsx(z,{icon:C,title:"分支图"}),e.jsx("div",{className:"p-5",children:e.jsx(U,{data:l,loading:c})})]}),e.jsxs(v,{className:"overflow-hidden",children:[e.jsx(z,{icon:L,title:"Feature 进化路径"}),e.jsx("div",{className:"max-h-[400px] overflow-y-auto",children:e.jsx(Q,{features:(r==null?void 0:r.features)||[],loading:c})})]})]})]})})}export{Z as default};
