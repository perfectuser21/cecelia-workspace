import{bb as B,R as v,Z as E,j as e,z as P,a8 as G,r as h,a0 as R,B as U,bc as V,aR as A,A as F,a1 as M,l as W,a9 as Z,aA as D,C as L,aC as X,bd as q,aN as J,be as K,ai as I,bf as H,W as z,F as Q}from"./index-DWmptck8.js";import{f as Y,a as ee}from"./agents.api-cECKJsIg.js";const se={Zap:E,RefreshCw:v,Diamond:B};function te({agent:s,onClick:n}){const i=se[s.icon]||E,d=s.status==="planned",j=s.stats.todayRunning>0;return e.jsxs("button",{onClick:n,disabled:d,className:`
        w-full text-left p-5 rounded-xl border transition-all duration-200
        ${d?"bg-slate-800/50 border-slate-700 opacity-60 cursor-not-allowed":`bg-gradient-to-br ${s.gradient.from} ${s.gradient.to} bg-opacity-10
             dark:bg-slate-800 hover:scale-[1.02] hover:shadow-lg ${s.gradient.border}`}
      `,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:`
          p-3 rounded-xl
          ${d?"bg-slate-700":`bg-gradient-to-br ${s.gradient.from} ${s.gradient.to}`}
        `,children:e.jsx(i,{className:"w-6 h-6 text-white"})}),!d&&e.jsx(P,{className:"w-5 h-5 text-gray-400"})]}),e.jsx("h3",{className:"text-lg font-bold text-white mb-1",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-400 mb-1",children:[s.role," · ",s.codename]}),d?e.jsx("div",{className:"mt-4 pt-4 border-t border-slate-700",children:e.jsx("span",{className:"text-sm text-gray-500",children:"待激活"})}):e.jsx("div",{className:"mt-4 pt-4 border-t border-white/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-2xl font-bold text-white",children:s.stats.todayTotal}),e.jsx("span",{className:"text-sm text-gray-400 ml-1",children:"今日"})]}),s.stats.todaySuccess>0&&e.jsxs("div",{className:"text-emerald-400 text-sm",children:[s.stats.todaySuccess," 成功"]}),s.stats.todayError>0&&e.jsxs("div",{className:"text-red-400 text-sm",children:[s.stats.todayError," 失败"]})]}),j&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-blue-500/20 rounded-full",children:[e.jsx(v,{className:"w-3 h-3 text-blue-400 animate-spin"}),e.jsx("span",{className:"text-xs text-blue-400",children:"工作中"})]})]})})]})}const ae=[{value:"24h",label:"24时"},{value:"72h",label:"72时"},{value:"7d",label:"7天"}];function le({value:s,onChange:n}){return e.jsx("div",{className:"flex bg-slate-700 rounded-lg p-1",children:ae.map(i=>e.jsx("button",{onClick:()=>n(i.value),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-all ${s===i.value?"bg-blue-600 text-white shadow-sm":"text-gray-400 hover:text-white hover:bg-slate-600"}`,children:i.label},i.value))})}function de(){const s=G(),[n,i]=h.useState(null),[d,j]=h.useState(null),[b,w]=h.useState(!0),[_,N]=h.useState(null),[f,k]=h.useState(null),[a,y]=h.useState("24h"),[g,l]=h.useState("flat"),m=async()=>{try{const[t,p]=await Promise.all([Y(a),ee()]);i(t),j(p),N(null),k(new Date)}catch(t){N(t.message)}finally{w(!1)}};h.useEffect(()=>{w(!0),m();const t=setInterval(m,3e4);return()=>clearInterval(t)},[a]);const x=t=>{switch(t){case"completed":return e.jsx(M,{className:"w-4 h-4 text-emerald-500"});case"running":return e.jsx(v,{className:"w-4 h-4 text-blue-500 animate-spin"});case"failed":return e.jsx(R,{className:"w-4 h-4 text-red-500"});case"pending":return e.jsx(L,{className:"w-4 h-4 text-yellow-500"});default:return e.jsx(L,{className:"w-4 h-4 text-gray-400"})}},S=t=>new Date(t).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),o=t=>{const p=Math.floor((Date.now()-new Date(t).getTime())/1e3);return p<60?`${p}秒`:p<3600?`${Math.floor(p/60)}分${p%60}秒`:`${Math.floor(p/3600)}时${Math.floor(p%3600/60)}分`},u=t=>{switch(t){case"24h":return"过去 24 小时";case"72h":return"过去 72 小时";case"7d":return"过去 7 天"}},C=t=>t==="headless"?e.jsx(X,{className:"w-4 h-4 text-purple-400",title:"无头模式"}):e.jsx(q,{className:"w-4 h-4 text-cyan-400",title:"交互模式"}),c=t=>t==="headless"?"无头":"交互";if(b&&!n)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(v,{className:"w-8 h-8 text-blue-500 animate-spin"})});if(_&&!n)return e.jsxs("div",{className:"bg-red-900/20 border border-red-800 rounded-xl p-6 text-center",children:[e.jsx(R,{className:"w-12 h-12 text-red-500 mx-auto mb-3"}),e.jsxs("p",{className:"text-red-400",children:["加载失败: ",_]}),e.jsx("button",{onClick:m,className:"mt-4 px-4 py-2 bg-red-900/30 text-red-400 rounded-lg hover:bg-red-900/50 transition-colors",children:"重试"})]});const r=n==null?void 0:n.periodStats,T=(n==null?void 0:n.runningTasks)||[],O=(n==null?void 0:n.recentRuns)||[];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-violet-500 to-purple-600 rounded-xl",children:e.jsx(U,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Cecelia"}),e.jsxs("p",{className:"text-gray-400",children:["无头 Claude Code · ",T.length," 个运行中 · ",u(a)," ",(r==null?void 0:r.total)||0," 次任务"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center bg-slate-700 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>l("flat"),className:`px-3 py-1.5 rounded-md text-sm flex items-center gap-1.5 transition-colors ${g==="flat"?"bg-slate-600 text-white":"text-gray-400 hover:text-white"}`,title:"列表视图",children:[e.jsx(V,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"列表"})]}),e.jsxs("button",{onClick:()=>l("hierarchy"),className:`px-3 py-1.5 rounded-md text-sm flex items-center gap-1.5 transition-colors ${g==="hierarchy"?"bg-slate-600 text-white":"text-gray-400 hover:text-white"}`,title:"层级视图",children:[e.jsx(A,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"层级"})]})]}),e.jsx(le,{value:a,onChange:y}),f&&e.jsx("span",{className:"text-sm text-gray-500",children:f.toLocaleTimeString("zh-CN")}),e.jsx("button",{onClick:m,disabled:b,className:"p-2 text-gray-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors disabled:opacity-50",children:e.jsx(v,{className:`w-5 h-5 ${b?"animate-spin":""}`})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsx($,{icon:e.jsx(F,{className:"w-4 h-4 text-white"}),label:"运行中",value:(r==null?void 0:r.running)||0,color:"from-blue-500 to-cyan-600",animate:r&&r.running>0}),e.jsx($,{icon:e.jsx(M,{className:"w-4 h-4 text-white"}),label:"成功",value:(r==null?void 0:r.success)||0,color:"from-green-500 to-emerald-600"}),e.jsx($,{icon:e.jsx(R,{className:"w-4 h-4 text-white"}),label:"失败",value:(r==null?void 0:r.error)||0,color:"from-red-500 to-rose-600"}),e.jsx($,{icon:e.jsx(E,{className:"w-4 h-4 text-white"}),label:"总数",value:(r==null?void 0:r.total)||0,color:"from-purple-500 to-violet-600"}),e.jsx($,{icon:e.jsx(W,{className:"w-4 h-4 text-white"}),label:"成功率",value:`${(r==null?void 0:r.successRate)||0}%`,color:"from-emerald-500 to-teal-600"})]}),g==="hierarchy"&&d&&e.jsx(re,{hierarchy:d,getTaskStatusIcon:x,formatTime:S,getModeIcon:C,getModeLabel:c,navigate:s}),g==="flat"&&e.jsxs(e.Fragment,{children:[T.length>0&&e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-700 flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5 text-blue-400 animate-pulse"}),e.jsx("h2",{className:"font-semibold text-white",children:"正在运行的 Claude Code"}),e.jsxs("span",{className:"text-sm text-gray-400",children:["(",T.length," 个)"]})]}),e.jsx("div",{className:"p-4 space-y-4",children:T.map(t=>e.jsx(ne,{run:t,formatDuration:o,getModeIcon:C,getModeLabel:c},t.id))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("h2",{className:"font-semibold text-white",children:"Agent 状态"}),e.jsxs("span",{className:"text-sm text-gray-400",children:["(",n==null?void 0:n.agents.length," 个)"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:n==null?void 0:n.agents.map(t=>e.jsx(te,{agent:t,onClick:()=>s(`/cecelia/agents/${t.id}`)},t.id))})]}),e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-700 flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold text-white",children:"最近任务"}),e.jsx("button",{onClick:()=>s("/cecelia/runs"),className:"text-sm text-blue-400 hover:text-blue-300",children:"查看全部 →"})]}),O.length>0?e.jsx("div",{className:"divide-y divide-slate-700",children:O.map(t=>e.jsxs("div",{className:"px-6 py-4 flex items-center justify-between hover:bg-slate-700/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[x(t.status),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[C(t.mode),e.jsx("span",{className:"text-white",children:t.project}),e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-slate-700 text-gray-300",children:c(t.mode)})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-500",children:[e.jsx(D,{className:"w-3 h-3"}),e.jsx("span",{children:t.feature_branch}),e.jsx("span",{className:"text-gray-600",children:"·"}),e.jsxs("span",{children:[t.completed_checkpoints,"/",t.total_checkpoints," 步骤",t.failed_checkpoints>0&&e.jsxs("span",{className:"text-red-400 ml-1",children:["(",t.failed_checkpoints," 失败)"]})]})]})]})]}),e.jsx("span",{className:"text-sm text-gray-500",children:S(t.started_at)})]},t.id))}):e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(E,{className:"w-12 h-12 text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-400",children:"暂无任务"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"通过 N8N 工作流触发 Cecelia 执行任务"})]})]})]})]})}function re({hierarchy:s,getTaskStatusIcon:n,formatTime:i,getModeIcon:d,getModeLabel:j,navigate:b}){const[w,_]=h.useState(new Set),[N,f]=h.useState(new Set),k=l=>{_(m=>{const x=new Set(m);return x.has(l)?x.delete(l):x.add(l),x})},a=l=>{f(m=>{const x=new Set(m);return x.has(l)?x.delete(l):x.add(l),x})},y=l=>{switch(l){case"done":return e.jsx(M,{className:"w-3 h-3 text-emerald-500"});case"in_progress":return e.jsx(v,{className:"w-3 h-3 text-blue-500 animate-spin"});case"failed":return e.jsx(R,{className:"w-3 h-3 text-red-500"});default:return e.jsx(L,{className:"w-3 h-3 text-gray-500"})}},g=l=>{switch(l){case"done":return"bg-emerald-500/20 text-emerald-400";case"in_progress":return"bg-blue-500/20 text-blue-400 animate-pulse";case"failed":return"bg-red-500/20 text-red-400";default:return"bg-slate-700/50 text-gray-500"}};return s.hierarchy.length===0?e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 p-12 text-center",children:[e.jsx(A,{className:"w-12 h-12 text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-400",children:"暂无层级数据"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"运行 Cecelia 任务后将显示 Feature → SubProject → Run 层级"})]}):e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-700 flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5 text-violet-400"}),e.jsx("h2",{className:"font-semibold text-white",children:"Feature 层级"}),e.jsxs("span",{className:"text-sm text-gray-400",children:["(",s.total_features," Features · ",s.total_runs," Runs)"]})]}),e.jsx("div",{className:"divide-y divide-slate-700",children:s.hierarchy.map(l=>{const m=w.has(l.id),x=l.subprojects.reduce((o,u)=>o+u.runs.length,0),S=l.subprojects.some(o=>o.runs.some(u=>u.status==="running"));return e.jsxs("div",{className:"bg-slate-800/50",children:[e.jsxs("button",{onClick:()=>k(l.id),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-slate-700/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[m?e.jsx(J,{className:"w-5 h-5 text-violet-400"}):e.jsx(K,{className:"w-5 h-5 text-violet-400"}),e.jsxs("div",{className:"text-left",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-white",children:l.name}),S&&e.jsxs("span",{className:"px-2 py-0.5 text-[10px] rounded-full bg-blue-900/50 text-blue-400 flex items-center gap-1",children:[e.jsx(F,{className:"w-3 h-3 animate-pulse"}),"运行中"]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:[l.subprojects.length," SubProjects · ",x," Runs"]})]})]}),m?e.jsx(I,{className:"w-5 h-5 text-gray-500"}):e.jsx(P,{className:"w-5 h-5 text-gray-500"})]}),m&&e.jsx("div",{className:"bg-slate-900/30",children:l.subprojects.map(o=>{const u=N.has(`${l.id}:${o.id}`),C=o.runs.some(c=>c.status==="running");return e.jsxs("div",{className:"border-t border-slate-700/50",children:[e.jsx("button",{onClick:()=>a(`${l.id}:${o.id}`),className:"w-full pl-12 pr-6 py-3 flex items-center justify-between hover:bg-slate-700/20 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-2",children:[u?e.jsx(I,{className:"w-4 h-4 text-gray-500"}):e.jsx(P,{className:"w-4 h-4 text-gray-500"}),e.jsx(H,{className:"w-4 h-4 text-cyan-400"}),e.jsx("span",{className:"text-sm text-white",children:o.name}),C&&e.jsx(F,{className:"w-3 h-3 text-blue-400 animate-pulse"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",o.runs.length," runs)"]})]})}),u&&e.jsx("div",{className:"bg-slate-900/50 pl-16 pr-6 pb-3 space-y-2",children:o.runs.map(c=>e.jsxs("div",{onClick:()=>b(`/cecelia/runs/${c.id}`),className:`rounded-lg border p-3 transition-colors cursor-pointer ${c.status==="running"?"border-blue-500/30 bg-blue-900/20 hover:bg-blue-900/30":"border-slate-700/50 bg-slate-800/30 hover:bg-slate-800/50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n(c.status),e.jsx("span",{className:"text-sm text-white",children:c.project}),d(c.mode),e.jsx("span",{className:"text-[10px] text-gray-500 px-1.5 py-0.5 rounded bg-slate-700",children:j(c.mode)})]}),e.jsx("span",{className:"text-xs text-gray-500",children:i(c.started_at)})]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-400 mb-2",children:[e.jsx(D,{className:"w-3 h-3"}),e.jsx("span",{children:c.feature_branch})]}),c.prd_title&&e.jsxs("div",{className:"text-xs text-gray-400 mb-2 pl-3 border-l-2 border-slate-600",children:[e.jsx("p",{className:"font-medium text-gray-300",children:c.prd_title}),c.prd_summary&&e.jsx("p",{className:"text-gray-500 mt-0.5",children:c.prd_summary})]}),c.checkpoints_detail&&c.checkpoints_detail.length>0&&e.jsx("div",{className:"space-y-1.5 mt-2",children:c.checkpoints_detail.map(r=>e.jsxs("div",{className:"flex items-center gap-2",children:[y(r.status),e.jsx("span",{className:"text-[10px] font-mono text-gray-500",children:r.id}),e.jsx("span",{className:"text-xs text-gray-300",children:r.name}),r.status==="in_progress"&&e.jsx("span",{className:"text-[10px] text-blue-400",children:"← 当前"})]},r.id))}),c.steps&&c.steps.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:c.steps.map(r=>e.jsx("span",{className:`px-1.5 py-0.5 text-[10px] rounded ${g(r.status)}`,title:r.name,children:r.name},r.id))}),c.pr_url&&e.jsxs("a",{href:c.pr_url,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-400 hover:text-blue-300 mt-2 inline-flex items-center gap-1",children:[e.jsx(z,{className:"w-3 h-3"}),"查看 PR"]})]},c.id))})]},o.id)})})]},l.id)})})]})}function $({icon:s,label:n,value:i,color:d,animate:j}){return e.jsx("div",{className:"bg-slate-800 rounded-xl border border-slate-700 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-9 h-9 bg-gradient-to-br ${d} rounded-xl flex items-center justify-center shadow-lg ${j?"animate-pulse":""}`,children:s}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400",children:n}),e.jsx("div",{className:"text-xl font-bold text-white",children:i})]})]})})}function ne({run:s,formatDuration:n,getModeIcon:i,getModeLabel:d}){var f,k;const[j,b]=h.useState(null),w=a=>{switch(a){case"done":return e.jsx(M,{className:"w-4 h-4 text-emerald-500"});case"in_progress":return e.jsx(v,{className:"w-4 h-4 text-blue-500 animate-spin"});case"failed":return e.jsx(R,{className:"w-4 h-4 text-red-500"});default:return e.jsx(L,{className:"w-4 h-4 text-gray-500"})}},_=a=>{switch(a){case"done":return"bg-emerald-500/20 text-emerald-400 border-emerald-500/30";case"in_progress":return"bg-blue-500/20 text-blue-400 border-blue-500/30 animate-pulse";case"failed":return"bg-red-500/20 text-red-400 border-red-500/30";default:return"bg-slate-700/50 text-gray-500 border-slate-600/30"}},N=(k=(f=s.checkpoints_detail)==null?void 0:f.find(a=>a.status==="in_progress"))==null?void 0:k.id;return e.jsxs("div",{className:"border border-blue-600/30 bg-blue-900/20 rounded-xl p-5 hover:bg-blue-900/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(H,{className:"w-5 h-5 text-violet-400"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-white",children:s.project}),s.repo_url&&e.jsx("a",{href:s.repo_url,target:"_blank",rel:"noopener noreferrer",className:"text-gray-500 hover:text-blue-400 transition-colors",title:"打开 GitHub",children:e.jsx(z,{className:"w-3.5 h-3.5"})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400",children:[e.jsx(D,{className:"w-3 h-3"}),e.jsx("span",{children:s.feature_branch})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[i(s.mode),e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-purple-900/50 text-purple-300",children:d(s.mode)}),e.jsxs("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-blue-900/50 text-blue-400 flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4 animate-pulse"}),n(s.started_at)]})]})]}),(s.prd_title||s.prd_summary)&&e.jsx("div",{className:"mb-4 px-4 py-3 bg-slate-700/30 border border-slate-600/30 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-amber-400 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[s.prd_title&&e.jsx("p",{className:"text-sm font-medium text-white",children:s.prd_title}),s.prd_summary&&e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:s.prd_summary}),s.checkpoints_detail&&s.checkpoints_detail.length>0&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Checkpoints: ",s.checkpoints_detail.filter(a=>a.status==="done").length,"/",s.checkpoints_detail.length," 完成"]})]})]})}),s.current_action&&e.jsx("div",{className:"mb-4 px-3 py-2 bg-cyan-900/30 border border-cyan-700/30 rounded-lg",children:e.jsxs("p",{className:"text-sm text-cyan-300",children:[e.jsx("span",{className:"text-cyan-500",children:"正在："})," ",s.current_action]})}),s.checkpoints_detail&&s.checkpoints_detail.length>0&&e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"Checkpoint 进度"}),s.checkpoints_detail.map(a=>{const y=j===a.id||a.id===N,g=a.id===N;return e.jsxs("div",{className:`rounded-lg border transition-all ${g?"border-blue-500/50 bg-blue-900/30":"border-slate-600/30 bg-slate-700/20"}`,children:[e.jsx("button",{onClick:()=>b(y?null:a.id),className:"w-full px-3 py-2 flex items-center justify-between hover:bg-slate-700/30 transition-colors rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[y?e.jsx(I,{className:"w-4 h-4 text-gray-500"}):e.jsx(P,{className:"w-4 h-4 text-gray-500"}),w(a.status),e.jsx("span",{className:"text-xs font-mono text-gray-400",children:a.id}),e.jsx("span",{className:"text-sm text-white",children:a.name}),g&&e.jsx("span",{className:"px-1.5 py-0.5 text-[10px] rounded bg-blue-500/30 text-blue-300",children:"当前"})]})}),y&&e.jsx("div",{className:"px-3 pb-3 pt-1",children:e.jsx("div",{className:"flex flex-wrap gap-1.5",children:(a.dev_steps||s.steps||[]).map(l=>e.jsx("span",{className:`px-2 py-0.5 text-[10px] rounded border ${_(l.status)}`,title:`${l.name}: ${l.status}`,children:l.name},l.id))})})]},a.id)})]}),(!s.checkpoints_detail||s.checkpoints_detail.length===0)&&s.steps&&s.steps.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-400 mb-1",children:[e.jsx("span",{children:"工作流进度"}),e.jsxs("span",{children:[s.current_step||1," / ",s.steps.length]})]}),e.jsx("div",{className:"flex gap-1",children:s.steps.map(a=>e.jsxs("div",{className:"flex-1 group relative",title:`${a.name}: ${a.status}`,children:[e.jsx("div",{className:`h-2 rounded-full transition-all ${a.status==="done"?"bg-emerald-500":a.status==="in_progress"?"bg-blue-500 animate-pulse":a.status==="failed"?"bg-red-500":"bg-slate-600"}`}),e.jsx("span",{className:"absolute -bottom-5 left-1/2 -translate-x-1/2 text-[10px] text-gray-500 opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap",children:a.name})]},a.id))}),e.jsxs("div",{className:"flex justify-between text-[10px] text-gray-500 mt-1 pt-2",children:[e.jsx("span",{children:"PRD"}),e.jsx("span",{children:"Code"}),e.jsx("span",{children:"PR"}),e.jsx("span",{children:"Merge"})]})]}),(!s.checkpoints_detail||s.checkpoints_detail.length===0)&&(!s.steps||s.steps.length===0)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-2 bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-cyan-500 transition-all",style:{width:s.total_checkpoints>0?`${s.completed_checkpoints/s.total_checkpoints*100}%`:"0%"}})}),e.jsxs("span",{className:"text-xs text-gray-400",children:[s.completed_checkpoints,"/",s.total_checkpoints]})]}),s.pr_url&&e.jsx("div",{className:"mt-3 pt-3 border-t border-slate-700",children:e.jsxs("a",{href:s.pr_url,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-400 hover:text-blue-300 flex items-center gap-1",children:[e.jsx(D,{className:"w-3 h-3"}),"查看 PR →"]})})]})}export{de as default};
