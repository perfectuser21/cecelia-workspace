import{r as n,j as e,R as f,Z as P,C as A,k as v,a0 as w,l as F,aL as L,bb as J,ab as r,z as K,A as M}from"./index-DjV-74X0.js";const O=.015;function z(){const[h,y]=n.useState([]),[_,R]=n.useState([]),[j,C]=n.useState(!0),[p,k]=n.useState("7d"),x=async()=>{try{const[s,t]=await Promise.all([fetch("/api/cecelia/overview?limit=200"),fetch("/api/cecelia/projects")]),l=await s.json(),c=await t.json();l.success&&y(l.recent_runs||[]),c.success&&R(c.projects||[])}catch(s){console.error(s)}finally{C(!1)}};n.useEffect(()=>{x();const s=setInterval(x,15e3);return()=>clearInterval(s)},[]);const T=s=>{switch(s){case"24h":return 24;case"72h":return 72;case"7d":return 168;case"30d":return 720}},a=h.filter(s=>{const t=Date.now()-T(p)*60*60*1e3;return new Date(s.started_at).getTime()>=t}),d=a.filter(s=>s.status==="running"),m=a.filter(s=>s.status==="completed"),g=a.filter(s=>s.status==="failed"),E=a.length>0?Math.round(m.length/a.length*100):0,o=a.reduce((s,t)=>s+(t.token_usage||0),0),D=a.length*5e4,S=(o>0?o:D)/1e3*O,i=new Map;_.forEach(s=>i.set(s.name,{info:s,running:0,completed:0,failed:0,total:0})),a.forEach(s=>{let t=i.get(s.project);t||(t={running:0,completed:0,failed:0,total:0},i.set(s.project,t)),t.total++,s.status==="running"&&t.running++,s.status==="completed"&&t.completed++,s.status==="failed"&&t.failed++});const $=Array.from(i.entries()).filter(([,s])=>s.total>0).sort((s,t)=>t[1].total-s[1].total).slice(0,6),u=[...m].sort((s,t)=>new Date(t.started_at).getTime()-new Date(s.started_at).getTime()).slice(0,3),N=[...g].sort((s,t)=>new Date(t.started_at).getTime()-new Date(s.started_at).getTime()).slice(0,2);return j&&!h.length?e.jsx("div",{className:"min-h-screen bg-[#191919] flex items-center justify-center",children:e.jsx(f,{className:"w-5 h-5 text-gray-400 animate-spin"})}):e.jsx("div",{className:"min-h-screen bg-[#191919]",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-6 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-white tracking-tight",children:"Engine"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"自动化开发工作流"})]}),e.jsx("button",{onClick:x,className:"p-3 text-gray-500 hover:text-white rounded-xl hover:bg-white/5 transition",children:e.jsx(f,{className:`w-5 h-5 ${j?"animate-spin":""}`})})]}),e.jsxs("div",{className:"bg-gradient-to-r from-[#1a1a2e] to-[#16213e] rounded-2xl p-5 border border-[#2a2a4a] mb-8",children:[e.jsx("div",{className:"flex items-center gap-2 mb-5",children:["24h","72h","7d","30d"].map(s=>e.jsx("button",{onClick:()=>k(s),className:`px-4 py-2 rounded-xl text-sm font-medium transition ${p===s?"bg-blue-500 text-white shadow-lg shadow-blue-500/25":"bg-white/5 text-gray-400 hover:text-white hover:bg-white/10"}`,children:s==="24h"?"24h":s==="72h"?"72h":s==="7d"?"7 天":"30 天"},s))}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5 text-white"}),e.jsx("span",{className:"text-white font-bold text-2xl",children:a.length}),e.jsx("span",{className:"text-gray-400 text-sm",children:"任务"})]}),e.jsx("div",{className:"h-8 w-px bg-[#303030]"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5 text-blue-400"}),e.jsx("span",{className:"text-blue-400 font-bold text-2xl",children:d.length}),e.jsx("span",{className:"text-gray-400 text-sm",children:"运行中"})]}),e.jsx("div",{className:"h-8 w-px bg-[#303030]"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5 text-green-400"}),e.jsx("span",{className:"text-green-400 font-bold text-2xl",children:m.length}),e.jsx("span",{className:"text-gray-400 text-sm",children:"完成"})]}),e.jsx("div",{className:"h-8 w-px bg-[#303030]"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-5 h-5 text-red-400"}),e.jsx("span",{className:"text-red-400 font-bold text-2xl",children:g.length}),e.jsx("span",{className:"text-gray-400 text-sm",children:"失败"})]}),e.jsx("div",{className:"h-8 w-px bg-[#303030]"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5 text-purple-400"}),e.jsxs("span",{className:"text-purple-400 font-bold text-2xl",children:[E,"%"]}),e.jsx("span",{className:"text-gray-400 text-sm",children:"成功率"})]}),e.jsx("div",{className:"h-8 w-px bg-[#303030]"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-5 h-5 text-yellow-400"}),e.jsxs("span",{className:"text-yellow-400 font-bold text-xl",children:["$",S.toFixed(2)]}),e.jsx("span",{className:"text-gray-400 text-sm",children:o>0?"":"估算"})]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(J,{className:"w-5 h-5 text-orange-400"}),e.jsx("h2",{className:"text-xl font-semibold text-white",children:"热门项目"})]}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:$.map(([s,{info:t,running:l,completed:c,failed:b,total:I}])=>e.jsxs(r,{to:`/cecelia/project/${encodeURIComponent(s)}`,className:"bg-[#202020] rounded-2xl border border-[#303030] p-5 hover:border-[#404040] transition group",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-white font-semibold text-lg truncate",children:s}),e.jsx(K,{className:"w-5 h-5 text-gray-600 group-hover:text-white transition"})]}),(t==null?void 0:t.description)&&e.jsx("p",{className:"text-xs text-gray-500 mb-4 line-clamp-2",children:t.description}),e.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-white font-bold text-xl",children:I}),e.jsx("span",{className:"text-gray-500 ml-1 text-xs",children:"任务"})]}),l>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 bg-blue-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-blue-400 font-medium",children:l}),e.jsx("span",{className:"text-gray-500 text-xs",children:"进行中"})]}),c>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-green-400 font-medium",children:c}),e.jsx("span",{className:"text-gray-500 ml-1 text-xs",children:"完成"})]}),b>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-red-400 font-medium",children:b}),e.jsx("span",{className:"text-gray-500 ml-1 text-xs",children:"失败"})]})]})]},s))})]}),(u.length>0||N.length>0||d.length>0)&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(M,{className:"w-5 h-5 text-blue-400"}),e.jsx("h2",{className:"text-xl font-semibold text-white",children:"关键进展"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[d.slice(0,2).map(s=>e.jsxs(r,{to:`/cecelia/runs/${s.id}`,className:"bg-blue-500/10 border border-blue-500/30 rounded-2xl p-4 hover:bg-blue-500/15 transition",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"w-2 h-2 bg-blue-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs text-blue-400 font-medium",children:"运行中"})]}),e.jsx("div",{className:"text-white font-medium truncate mb-1",children:s.prd_title||s.feature_branch}),e.jsx("div",{className:"text-xs text-gray-500",children:s.project}),s.current_step&&e.jsxs("div",{className:"text-xs text-blue-400 mt-2",children:["Step ",s.current_step,"/9"]})]},s.id)),u.slice(0,2).map(s=>e.jsxs(r,{to:`/cecelia/runs/${s.id}`,className:"bg-green-500/10 border border-green-500/30 rounded-2xl p-4 hover:bg-green-500/15 transition",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(v,{className:"w-4 h-4 text-green-400"}),e.jsx("span",{className:"text-xs text-green-400 font-medium",children:"已完成"})]}),e.jsx("div",{className:"text-white font-medium truncate mb-1",children:s.prd_title||s.feature_branch}),e.jsx("div",{className:"text-xs text-gray-500",children:s.project})]},s.id)),N.slice(0,1).map(s=>e.jsxs(r,{to:`/cecelia/runs/${s.id}`,className:"bg-red-500/10 border border-red-500/30 rounded-2xl p-4 hover:bg-red-500/15 transition",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(w,{className:"w-4 h-4 text-red-400"}),e.jsx("span",{className:"text-xs text-red-400 font-medium",children:"失败"})]}),e.jsx("div",{className:"text-white font-medium truncate mb-1",children:s.prd_title||s.feature_branch}),e.jsx("div",{className:"text-xs text-gray-500",children:s.project})]},s.id))]})]})]})})}export{z as default};
