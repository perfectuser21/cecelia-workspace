import{j as e,a5 as A,at as S,C as p,_ as F,d as B,au as P,R as C,B as I,v as L,a9 as z,r as g,s as j,i as E}from"./index-Cs8Vqz41.js";import{a as b}from"./accounts.api-DGdZkcl4.js";import"./client-DyfwnZmM.js";import"./index-B9ygI19o.js";const H=({status:r,text:a,size:n="md"})=>{const s=(()=>{switch(r){case"success":case"active":case"valid":return{icon:B,text:a||"成功",bgColor:"bg-green-50",textColor:"text-green-700",iconColor:"text-green-500",borderColor:"border-green-200"};case"failed":case"error":case"expired":return{icon:F,text:a||"失败",bgColor:"bg-red-50",textColor:"text-red-700",iconColor:"text-red-500",borderColor:"border-red-200"};case"running":return{icon:p,text:a||"运行中",bgColor:"bg-blue-50",textColor:"text-blue-700",iconColor:"text-blue-500",borderColor:"border-blue-200",animate:!0};case"waiting":return{icon:p,text:a||"等待中",bgColor:"bg-gray-50",textColor:"text-gray-700",iconColor:"text-gray-500",borderColor:"border-gray-200"};case"paused":return{icon:S,text:a||"已暂停",bgColor:"bg-yellow-50",textColor:"text-yellow-700",iconColor:"text-yellow-500",borderColor:"border-yellow-200"};case"unknown":default:return{icon:A,text:a||"未知",bgColor:"bg-gray-50",textColor:"text-gray-700",iconColor:"text-gray-500",borderColor:"border-gray-200"}}})(),d=s.icon,x={sm:"px-2 py-1 text-xs",md:"px-2.5 py-1.5 text-sm",lg:"px-3 py-2 text-base"},i={sm:"w-3 h-3",md:"w-4 h-4",lg:"w-5 h-5"};return e.jsxs("span",{className:`inline-flex items-center gap-1.5 rounded-full border font-medium ${s.bgColor} ${s.textColor} ${s.borderColor} ${x[n]}`,children:[e.jsx(d,{className:`${i[n]} ${s.iconColor} ${s.animate?"animate-spin":""}`}),s.text]})},R=({account:r,onLogin:a,onViewMetrics:n,onDelete:o,onHealthCheck:s})=>{const d=l=>({xiaohongshu:"小红书",douyin:"抖音",bilibili:"B站",weibo:"微博"})[l]||l,i=(l=>({xiaohongshu:{bg:"bg-red-100",text:"text-red-700"},douyin:{bg:"bg-black",text:"text-white"},bilibili:{bg:"bg-pink-100",text:"text-pink-700"},weibo:{bg:"bg-orange-100",text:"text-orange-700"}})[l]||{bg:"bg-gray-100",text:"text-gray-700"})(r.platform),h=l=>l?new Date(l).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-";return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-5 hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[r.avatar?e.jsx("img",{src:r.avatar,alt:r.displayName,className:"w-12 h-12 rounded-full object-cover"}):e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${i.bg} ${i.text} font-semibold`,children:r.displayName.charAt(0)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 truncate mb-1",children:r.displayName}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`px-2 py-0.5 rounded-md text-xs font-medium ${i.bg} ${i.text}`,children:d(r.platform)}),e.jsx(H,{status:r.loginStatus,text:r.loginStatus==="valid"?"已登录":"已过期",size:"sm"})]})]})]}),e.jsx("button",{className:"p-1 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(P,{className:"w-5 h-5 text-gray-400"})})]}),e.jsxs("div",{className:"mb-4 pb-4 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"账号ID"}),e.jsx("span",{className:"font-mono text-gray-900",children:r.accountId})]}),r.lastHealthCheck&&e.jsxs("div",{className:"flex items-center justify-between text-sm mt-2",children:[e.jsx("span",{className:"text-gray-500",children:"最后检查"}),e.jsx("span",{className:"text-gray-900",children:h(r.lastHealthCheck.checkedAt)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[r.loginStatus!=="valid"&&e.jsx("span",{className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-yellow-100 text-yellow-700 rounded-lg font-medium text-sm",children:"需在 PC 端重新登录"}),r.loginStatus==="valid"&&e.jsxs("button",{onClick:()=>s==null?void 0:s(r.id),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 border border-gray-200 text-gray-700 rounded-lg font-medium text-sm hover:bg-gray-50 transition-colors",children:[e.jsx(C,{className:"w-4 h-4"}),"检查状态"]}),e.jsxs("button",{onClick:()=>n==null?void 0:n(r.id),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 border border-gray-200 text-gray-700 rounded-lg font-medium text-sm hover:bg-gray-50 transition-colors",children:[e.jsx(I,{className:"w-4 h-4"}),"查看数据"]}),e.jsx("button",{onClick:()=>o==null?void 0:o(r.id),className:"p-2 border border-red-200 text-red-600 rounded-lg hover:bg-red-50 transition-colors",title:"删除账号",children:e.jsx(L,{className:"w-5 h-5"})})]})]})};function q(){const r=z(),[a,n]=g.useState([]),[o,s]=g.useState("all"),[d,x]=g.useState(!0),[i,h]=g.useState(!1);g.useEffect(()=>{l()},[o]);const l=async()=>{try{x(!0);const t=o==="all"?void 0:o,c=await b.getAccounts(t);n(c)}catch(t){console.error("Failed to load accounts:",t)}finally{x(!1)}},u=()=>{const t=prompt("请选择平台 (xiaohongshu/douyin/bilibili/weibo)");if(!t)return;const c=prompt("请输入账号ID");if(!c)return;const f=prompt("请输入显示名称");f&&b.addAccount({platform:t,accountId:c,displayName:f}).then(()=>{alert("账号添加成功"),l()}).catch($=>{console.error("Failed to add account:",$),alert("添加失败")})},N=t=>{r(`/accounts/${t}/metrics`)},w=async t=>{if(confirm("确定要删除此账号吗？"))try{await b.deleteAccount(t),alert("账号已删除"),await l()}catch(c){console.error("Failed to delete account:",c),alert("删除失败")}},v=async t=>{try{await b.healthCheck(t),alert("健康检查已完成"),await l()}catch(c){console.error("Failed to health check:",c),alert("检查失败")}},k=async()=>{try{h(!0),await b.batchHealthCheck(),alert("批量健康检查已完成"),await l()}catch(t){console.error("Failed to batch health check:",t),alert("检查失败")}finally{h(!1)}},m={all:a.length,xiaohongshu:a.filter(t=>t.platform==="xiaohongshu").length,douyin:a.filter(t=>t.platform==="douyin").length,bilibili:a.filter(t=>t.platform==="bilibili").length,weibo:a.filter(t=>t.platform==="weibo").length},y=o==="all"?a:a.filter(t=>t.platform===o);return d?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"账号管理"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"管理所有社交媒体平台账号"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:k,disabled:i,className:"flex items-center gap-2 px-4 py-2 border border-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors disabled:opacity-50",children:[e.jsx(C,{className:`w-4 h-4 ${i?"animate-spin":""}`}),i?"检查中...":"批量检查"]}),e.jsxs("button",{onClick:u,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors",children:[e.jsx(j,{className:"w-4 h-4"}),"添加账号"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{className:"flex items-center gap-2 bg-white rounded-lg border border-gray-200 p-1",children:[e.jsxs("button",{onClick:()=>s("all"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${o==="all"?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:["全部 (",m.all,")"]}),e.jsxs("button",{onClick:()=>s("xiaohongshu"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${o==="xiaohongshu"?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:["小红书 (",m.xiaohongshu,")"]}),e.jsxs("button",{onClick:()=>s("douyin"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${o==="douyin"?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:["抖音 (",m.douyin,")"]}),e.jsxs("button",{onClick:()=>s("bilibili"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${o==="bilibili"?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:["B站 (",m.bilibili,")"]}),e.jsxs("button",{onClick:()=>s("weibo"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${o==="weibo"?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:["微博 (",m.weibo,")"]})]})]}),y.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5",children:y.map(t=>e.jsx(R,{account:t,onViewMetrics:N,onDelete:w,onHealthCheck:v},t.id))}):e.jsxs("div",{className:"text-center py-12 bg-white rounded-xl border border-gray-200",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx(j,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"暂无账号"}),e.jsx("p",{className:"text-gray-500 mb-4",children:'点击右上角"添加账号"按钮开始'})]})]})}export{q as default};
