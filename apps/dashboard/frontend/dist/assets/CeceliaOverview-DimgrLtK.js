import{j as e,aR as k,r as c,bb as _,W as R,A as j,ai as $,z as D,aA as E,R as b,aF as S,C as T,a0 as p,a1 as N,B as P,Z as L,l as F}from"./index-DqaiMzcA.js";import{f as I,a as O}from"./agents.api-59sW8kJ7.js";const U=[{value:"24h",label:"24时"},{value:"72h",label:"72时"},{value:"7d",label:"7天"}];function A({value:s,onChange:a}){return e.jsx("div",{className:"flex bg-slate-700 rounded-lg p-1",children:U.map(t=>e.jsx("button",{onClick:()=>a(t.value),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-all ${s===t.value?"bg-blue-600 text-white shadow-sm":"text-gray-400 hover:text-white hover:bg-slate-600"}`,children:t.label},t.value))})}function B({data:s}){return s.projects.length===0?e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 p-12 text-center",children:[e.jsx(k,{className:"w-12 h-12 text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-400",children:"暂无项目数据"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"运行 Cecelia 任务后将显示项目时间线"})]}):e.jsx("div",{className:"space-y-6",children:s.projects.map(a=>e.jsx(z,{project:a},a.name))})}function z({project:s}){const[a,t]=c.useState(s.runningCount>0);return e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 overflow-hidden",children:[e.jsxs("button",{onClick:()=>t(!a),className:"w-full px-6 py-4 flex items-center justify-between hover:bg-slate-700/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-2.5 bg-gradient-to-br from-violet-500 to-purple-600 rounded-xl",children:e.jsx(_,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"text-left",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:s.name}),s.repoUrl&&e.jsx("a",{href:s.repoUrl,target:"_blank",rel:"noopener noreferrer",onClick:n=>n.stopPropagation(),className:"text-gray-500 hover:text-blue-400 transition-colors",children:e.jsx(R,{className:"w-4 h-4"})}),s.runningCount>0&&e.jsxs("span",{className:"px-2 py-0.5 text-xs rounded-full bg-blue-900/50 text-blue-400 flex items-center gap-1",children:[e.jsx(j,{className:"w-3 h-3 animate-pulse"}),s.runningCount," 运行中"]})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-0.5",children:[s.features.length," Features · ",s.totalRuns," Runs"]})]})]}),a?e.jsx($,{className:"w-5 h-5 text-gray-500"}):e.jsx(D,{className:"w-5 h-5 text-gray-500"})]}),a&&e.jsx("div",{className:"border-t border-slate-700 divide-y divide-slate-700/50",children:s.features.map(n=>e.jsx(G,{feature:n},n.name))})]})}function G({feature:s}){const[a,t]=c.useState(s.current||null),n=!!s.current;return e.jsxs("div",{className:`px-6 py-4 ${n?"bg-blue-900/10":""}`,children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{className:`w-4 h-4 ${n?"text-blue-400":"text-cyan-400"}`}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-white",children:s.displayName}),n&&e.jsxs("span",{className:"px-1.5 py-0.5 text-[10px] rounded bg-blue-500/30 text-blue-300 flex items-center gap-1",children:[e.jsx(b,{className:"w-2.5 h-2.5 animate-spin"}),"运行中"]})]}),e.jsxs("div",{className:"flex items-center gap-1 mt-1.5",children:[e.jsx(S,{className:"w-3 h-3 text-gray-500"}),e.jsx("div",{className:"flex items-center gap-1",children:s.history.map((l,i)=>e.jsxs("button",{onClick:()=>{var d;return t(((d=s.current)==null?void 0:d.id)===l.id?s.current:s.latestRun.id===l.id?s.latestRun:null)},className:`
                      px-1.5 py-0.5 text-[10px] rounded transition-colors
                      ${l.status==="running"?"bg-blue-500/30 text-blue-300":l.status==="completed"?"bg-emerald-500/20 text-emerald-400 hover:bg-emerald-500/30":l.status==="failed"?"bg-red-500/20 text-red-400 hover:bg-red-500/30":"bg-slate-700/50 text-gray-400 hover:bg-slate-700"}
                    `,title:`v${l.version} - ${l.date} - ${l.branch}`,children:["v",l.version]},l.id))})]})]})]})}),(s.current||a)&&e.jsx(Z,{run:s.current||a})]})}function Z({run:s}){var n,l;const[a,t]=c.useState(((l=(n=s.checkpoints_detail)==null?void 0:n.find(i=>i.status==="in_progress"))==null?void 0:l.id)||null);return s.checkpoints_detail&&s.checkpoints_detail.length>0?e.jsxs("div",{className:"mt-3 ml-7",children:[s.prd_title&&e.jsxs("div",{className:"mb-3 text-sm",children:[e.jsx("span",{className:"text-gray-400",children:"当前: "}),e.jsx("span",{className:"text-white",children:s.prd_title})]}),e.jsx("div",{className:"flex items-start gap-2 overflow-x-auto pb-2",children:s.checkpoints_detail.map((i,d)=>{const h=a===i.id,o=i.status==="in_progress";return e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("button",{onClick:()=>t(h?null:i.id),className:`
                    flex-shrink-0 w-28 p-3 rounded-lg border text-left transition-all
                    ${o?"border-blue-500/50 bg-blue-900/30":i.status==="done"?"border-emerald-500/30 bg-emerald-900/20":i.status==="failed"?"border-red-500/30 bg-red-900/20":"border-slate-600/30 bg-slate-700/30"}
                    hover:scale-105
                  `,children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[e.jsx(M,{status:i.status}),e.jsx("span",{className:"text-[10px] font-mono text-gray-400",children:i.id})]}),e.jsx("p",{className:"text-xs text-white truncate",title:i.name,children:i.name}),o&&e.jsx("p",{className:"text-[10px] text-blue-400 mt-1",children:"← 当前"})]}),d<s.checkpoints_detail.length-1&&e.jsx("div",{className:"flex items-center h-full pt-6 text-gray-600",children:"→"})]},i.id)})}),a&&e.jsx(H,{run:s,checkpointId:a})]}):s.steps&&s.steps.length>0?e.jsx("div",{className:"mt-3 ml-7",children:e.jsx(v,{steps:s.steps,currentStep:s.current_step})}):e.jsx("div",{className:"mt-3 ml-7",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-2 bg-slate-700 rounded-full overflow-hidden max-w-xs",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-cyan-500",style:{width:s.total_checkpoints>0?`${s.completed_checkpoints/s.total_checkpoints*100}%`:"0%"}})}),e.jsxs("span",{className:"text-xs text-gray-400",children:[s.completed_checkpoints,"/",s.total_checkpoints]})]})})}function H({run:s,checkpointId:a}){var l;const t=(l=s.checkpoints_detail)==null?void 0:l.find(i=>i.id===a),n=(t==null?void 0:t.dev_steps)||s.steps||[];return n.length===0?e.jsx("div",{className:"mt-3 p-3 bg-slate-700/30 rounded-lg text-center",children:e.jsx("p",{className:"text-xs text-gray-500",children:"暂无步骤详情"})}):e.jsxs("div",{className:"mt-3 p-3 bg-slate-700/30 rounded-lg",children:[e.jsxs("p",{className:"text-xs text-gray-400 mb-2",children:[a," Dev 流程"]}),e.jsx(v,{steps:n,currentStep:s.current_step})]})}function v({steps:s,currentStep:a}){return e.jsx("div",{className:"flex flex-wrap gap-1.5",children:s.map(t=>e.jsx("span",{className:`
            px-2 py-1 text-xs rounded-md border transition-colors
            ${t.status==="done"?"bg-emerald-500/20 text-emerald-400 border-emerald-500/30":t.status==="in_progress"?"bg-blue-500/20 text-blue-400 border-blue-500/30 animate-pulse":t.status==="failed"?"bg-red-500/20 text-red-400 border-red-500/30":"bg-slate-700/50 text-gray-500 border-slate-600/30"}
          `,children:t.name},t.id))})}function M({status:s}){switch(s){case"done":return e.jsx(N,{className:"w-3.5 h-3.5 text-emerald-500"});case"in_progress":return e.jsx(b,{className:"w-3.5 h-3.5 text-blue-500 animate-spin"});case"failed":return e.jsx(p,{className:"w-3.5 h-3.5 text-red-500"});default:return e.jsx(T,{className:"w-3.5 h-3.5 text-gray-500"})}}function X(){const[s,a]=c.useState(null),[t,n]=c.useState(null),[l,i]=c.useState(!0),[d,h]=c.useState(null),[o,f]=c.useState(null),[u,w]=c.useState("24h"),g=async()=>{try{const[x,C]=await Promise.all([I(u),O()]);a(x),n(C),h(null),f(new Date)}catch(x){h(x.message)}finally{i(!1)}};c.useEffect(()=>{i(!0),g();const x=setInterval(g,3e4);return()=>clearInterval(x)},[u]);const y=x=>{switch(x){case"24h":return"过去 24 小时";case"72h":return"过去 72 小时";case"7d":return"过去 7 天"}};if(l&&!s)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(b,{className:"w-8 h-8 text-blue-500 animate-spin"})});if(d&&!s)return e.jsxs("div",{className:"bg-red-900/20 border border-red-800 rounded-xl p-6 text-center",children:[e.jsx(p,{className:"w-12 h-12 text-red-500 mx-auto mb-3"}),e.jsxs("p",{className:"text-red-400",children:["加载失败: ",d]}),e.jsx("button",{onClick:g,className:"mt-4 px-4 py-2 bg-red-900/30 text-red-400 rounded-lg hover:bg-red-900/50 transition-colors",children:"重试"})]});const r=s==null?void 0:s.periodStats;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-violet-500 to-purple-600 rounded-xl",children:e.jsx(P,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Cecelia"}),e.jsxs("p",{className:"text-gray-400",children:["无头 Claude Code · ",(t==null?void 0:t.totalProjects)||0," 项目 · ",(t==null?void 0:t.totalFeatures)||0," Features · ",y(u)," ",(r==null?void 0:r.total)||0," 次任务"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{value:u,onChange:w}),o&&e.jsx("span",{className:"text-sm text-gray-500",children:o.toLocaleTimeString("zh-CN")}),e.jsx("button",{onClick:g,disabled:l,className:"p-2 text-gray-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors disabled:opacity-50",children:e.jsx(b,{className:`w-5 h-5 ${l?"animate-spin":""}`})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsx(m,{icon:e.jsx(j,{className:"w-4 h-4 text-white"}),label:"运行中",value:(r==null?void 0:r.running)||0,color:"from-blue-500 to-cyan-600",animate:r&&r.running>0}),e.jsx(m,{icon:e.jsx(N,{className:"w-4 h-4 text-white"}),label:"成功",value:(r==null?void 0:r.success)||0,color:"from-green-500 to-emerald-600"}),e.jsx(m,{icon:e.jsx(p,{className:"w-4 h-4 text-white"}),label:"失败",value:(r==null?void 0:r.error)||0,color:"from-red-500 to-rose-600"}),e.jsx(m,{icon:e.jsx(L,{className:"w-4 h-4 text-white"}),label:"总数",value:(r==null?void 0:r.total)||0,color:"from-purple-500 to-violet-600"}),e.jsx(m,{icon:e.jsx(F,{className:"w-4 h-4 text-white"}),label:"成功率",value:`${(r==null?void 0:r.successRate)||0}%`,color:"from-emerald-500 to-teal-600"})]}),t&&e.jsx(B,{data:t})]})}function m({icon:s,label:a,value:t,color:n,animate:l}){return e.jsx("div",{className:"bg-slate-800 rounded-xl border border-slate-700 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-9 h-9 bg-gradient-to-br ${n} rounded-xl flex items-center justify-center shadow-lg ${l?"animate-pulse":""}`,children:s}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400",children:a}),e.jsx("div",{className:"text-xl font-bold text-white",children:t})]})]})})}export{X as default};
