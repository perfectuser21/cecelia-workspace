import{r as c,j as e,R as j,ab as R,aN as C,z as E}from"./index-D9scRkLz.js";function _(){const[u,N]=c.useState([]),[b,w]=c.useState([]),[g,v]=c.useState(!0),[m,y]=c.useState("72h"),h=async()=>{try{const[s,t]=await Promise.all([fetch("/api/cecelia/overview?limit=100"),fetch("/api/cecelia/projects")]),a=await s.json(),n=await t.json();a.success&&N(a.recent_runs||[]),n.success&&w(n.projects||[])}catch(s){console.error(s)}finally{v(!1)}};c.useEffect(()=>{h();const s=setInterval(h,1e4);return()=>clearInterval(s)},[]);const i=(s=>{const t=Date.now(),a=m==="24h"?24:m==="72h"?72:168;return s.filter(n=>new Date(n.started_at).getTime()>=t-a*60*60*1e3)})(u),o=new Map;b.forEach(s=>o.set(s.name,{info:s,runs:[]})),i.forEach(s=>{const t=o.get(s.project);t?t.runs.push(s):o.set(s.project,{runs:[s]})});const p=Array.from(o.entries()).filter(([,s])=>{var t;return s.runs.length>0||(((t=s.info)==null?void 0:t.features.length)||0)>0}).sort((s,t)=>{const a=s[1].runs.filter(l=>l.status==="running").length;return t[1].runs.filter(l=>l.status==="running").length-a}),d={running:i.filter(s=>s.status==="running").length,completed:i.filter(s=>s.status==="completed").length,failed:i.filter(s=>s.status==="failed").length};return g&&!u.length?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(j,{className:"w-6 h-6 text-blue-400 animate-spin"})}):e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Cecelia"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex bg-gray-800 rounded-lg p-1",children:["24h","72h","7d"].map(s=>e.jsx("button",{onClick:()=>y(s),className:`px-3 py-1 text-sm rounded-md transition ${m===s?"bg-blue-600 text-white":"text-gray-400 hover:text-white"}`,children:s},s))}),e.jsx("button",{onClick:h,className:"p-2 text-gray-400 hover:text-white rounded-lg hover:bg-gray-800",children:e.jsx(j,{className:`w-5 h-5 ${g?"animate-spin":""}`})})]})]}),e.jsxs("div",{className:"flex items-center gap-6 mb-8 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 bg-blue-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-white font-medium",children:d.running}),e.jsx("span",{className:"text-gray-400",children:"运行中"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-white font-medium",children:d.completed}),e.jsx("span",{className:"text-gray-400",children:"完成"})]}),d.failed>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 bg-red-500 rounded-full"}),e.jsx("span",{className:"text-white font-medium",children:d.failed}),e.jsx("span",{className:"text-gray-400",children:"失败"})]})]}),e.jsxs("div",{className:"space-y-4",children:[p.map(([s,{info:t,runs:a}])=>{const n=a.filter(r=>r.status==="running"),l=a.filter(r=>r.status==="completed").length,f=a.filter(r=>r.status==="failed").length,x=n[0];return e.jsxs(R,{to:`/cecelia/project/${encodeURIComponent(s)}`,className:`block p-5 rounded-xl border transition hover:border-blue-500/50 ${n.length>0?"bg-gray-800/80 border-blue-500/30":"bg-gray-800/40 border-gray-700"}`,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(C,{className:"w-5 h-5 text-gray-400"}),e.jsx("span",{className:"text-lg font-semibold text-white",children:s}),n.length>0&&e.jsxs("span",{className:"px-2 py-0.5 text-xs bg-blue-500/20 text-blue-400 rounded-full",children:[n.length," 运行中"]})]}),(t==null?void 0:t.description)&&e.jsx("p",{className:"text-sm text-gray-400 mb-3 ml-8",children:t.description}),x&&e.jsx("div",{className:"ml-8 p-3 bg-blue-500/10 rounded-lg mb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white",children:x.prd_title||x.feature_branch}),e.jsxs("span",{className:"text-blue-400 text-sm font-mono",children:["Step ",x.current_step||1,"/9"]})]})}),e.jsxs("div",{className:"flex items-center gap-4 ml-8 text-sm text-gray-500",children:[t&&e.jsxs("span",{children:[t.features.length," Features"]}),l>0&&e.jsxs("span",{className:"text-green-400",children:[l," 完成"]}),f>0&&e.jsxs("span",{className:"text-red-400",children:[f," 失败"]}),e.jsx(E,{className:"w-4 h-4 ml-auto text-gray-600"})]})]},s)}),p.length===0&&e.jsx("div",{className:"text-center py-12 text-gray-500",children:"暂无任务"})]})]})}export{_ as default};
