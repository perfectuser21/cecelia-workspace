import{aX as I,R as o,Z as p,j as e,x as P,ab as L,r as d,_ as u,aK as A,A as C,$ as _,e as O,aw as S,aI as b,C as $,ay as U,aY as z}from"./index-B5duVCzi.js";import{f as B}from"./agents.api-BFL0_4gZ.js";const G={Zap:p,RefreshCw:o,Diamond:I};function X({agent:t,onClick:a}){const n=G[t.icon]||p,c=t.status==="planned",i=t.stats.todayRunning>0;return e.jsxs("button",{onClick:a,disabled:c,className:`
        w-full text-left p-5 rounded-xl border transition-all duration-200
        ${c?"bg-slate-800/50 border-slate-700 opacity-60 cursor-not-allowed":`bg-gradient-to-br ${t.gradient.from} ${t.gradient.to} bg-opacity-10
             dark:bg-slate-800 hover:scale-[1.02] hover:shadow-lg ${t.gradient.border}`}
      `,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:`
          p-3 rounded-xl
          ${c?"bg-slate-700":`bg-gradient-to-br ${t.gradient.from} ${t.gradient.to}`}
        `,children:e.jsx(n,{className:"w-6 h-6 text-white"})}),!c&&e.jsx(P,{className:"w-5 h-5 text-gray-400"})]}),e.jsx("h3",{className:"text-lg font-bold text-white mb-1",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-400 mb-1",children:[t.role," · ",t.codename]}),c?e.jsx("div",{className:"mt-4 pt-4 border-t border-slate-700",children:e.jsx("span",{className:"text-sm text-gray-500",children:"待激活"})}):e.jsx("div",{className:"mt-4 pt-4 border-t border-white/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-2xl font-bold text-white",children:t.stats.todayTotal}),e.jsx("span",{className:"text-sm text-gray-400 ml-1",children:"今日"})]}),t.stats.todaySuccess>0&&e.jsxs("div",{className:"text-emerald-400 text-sm",children:[t.stats.todaySuccess," 成功"]}),t.stats.todayError>0&&e.jsxs("div",{className:"text-red-400 text-sm",children:[t.stats.todayError," 失败"]})]}),i&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-blue-500/20 rounded-full",children:[e.jsx(o,{className:"w-3 h-3 text-blue-400 animate-spin"}),e.jsx("span",{className:"text-xs text-blue-400",children:"工作中"})]})]})})]})}const Z=[{value:"24h",label:"24时"},{value:"72h",label:"72时"},{value:"7d",label:"7天"}];function K({value:t,onChange:a}){return e.jsx("div",{className:"flex bg-slate-700 rounded-lg p-1",children:Z.map(n=>e.jsx("button",{onClick:()=>a(n.value),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-all ${t===n.value?"bg-blue-600 text-white shadow-sm":"text-gray-400 hover:text-white hover:bg-slate-600"}`,children:n.label},n.value))})}function q(){const t=L(),[a,n]=d.useState(null),[c,i]=d.useState(!0),[g,N]=d.useState(null),[f,k]=d.useState(null),[m,R]=d.useState("24h"),h=async()=>{try{const s=await B(m);n(s),N(null),k(new Date)}catch(s){N(s.message)}finally{i(!1)}};d.useEffect(()=>{i(!0),h();const s=setInterval(h,3e4);return()=>clearInterval(s)},[m]);const T=s=>{switch(s){case"completed":return e.jsx(_,{className:"w-4 h-4 text-emerald-500"});case"running":return e.jsx(o,{className:"w-4 h-4 text-blue-500 animate-spin"});case"failed":return e.jsx(u,{className:"w-4 h-4 text-red-500"});case"pending":return e.jsx($,{className:"w-4 h-4 text-yellow-500"});default:return e.jsx($,{className:"w-4 h-4 text-gray-400"})}},M=s=>new Date(s).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),D=s=>{const r=Math.floor((Date.now()-new Date(s).getTime())/1e3);return r<60?`${r}秒`:r<3600?`${Math.floor(r/60)}分${r%60}秒`:`${Math.floor(r/3600)}时${Math.floor(r%3600/60)}分`},E=s=>{switch(s){case"24h":return"过去 24 小时";case"72h":return"过去 72 小时";case"7d":return"过去 7 天"}},v=s=>s==="headless"?e.jsx(U,{className:"w-4 h-4 text-purple-400",title:"无头模式"}):e.jsx(z,{className:"w-4 h-4 text-cyan-400",title:"交互模式"}),y=s=>s==="headless"?"无头":"交互";if(c&&!a)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(o,{className:"w-8 h-8 text-blue-500 animate-spin"})});if(g&&!a)return e.jsxs("div",{className:"bg-red-900/20 border border-red-800 rounded-xl p-6 text-center",children:[e.jsx(u,{className:"w-12 h-12 text-red-500 mx-auto mb-3"}),e.jsxs("p",{className:"text-red-400",children:["加载失败: ",g]}),e.jsx("button",{onClick:h,className:"mt-4 px-4 py-2 bg-red-900/30 text-red-400 rounded-lg hover:bg-red-900/50 transition-colors",children:"重试"})]});const l=a==null?void 0:a.periodStats,j=(a==null?void 0:a.runningTasks)||[],w=(a==null?void 0:a.recentRuns)||[];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-violet-500 to-purple-600 rounded-xl",children:e.jsx(A,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Cecelia"}),e.jsxs("p",{className:"text-gray-400",children:["无头 Claude Code · ",j.length," 个运行中 · ",E(m)," ",(l==null?void 0:l.total)||0," 次任务"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(K,{value:m,onChange:R}),f&&e.jsx("span",{className:"text-sm text-gray-500",children:f.toLocaleTimeString("zh-CN")}),e.jsx("button",{onClick:h,disabled:c,className:"p-2 text-gray-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors disabled:opacity-50",children:e.jsx(o,{className:`w-5 h-5 ${c?"animate-spin":""}`})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsx(x,{icon:e.jsx(C,{className:"w-4 h-4 text-white"}),label:"运行中",value:(l==null?void 0:l.running)||0,color:"from-blue-500 to-cyan-600",animate:l&&l.running>0}),e.jsx(x,{icon:e.jsx(_,{className:"w-4 h-4 text-white"}),label:"成功",value:(l==null?void 0:l.success)||0,color:"from-green-500 to-emerald-600"}),e.jsx(x,{icon:e.jsx(u,{className:"w-4 h-4 text-white"}),label:"失败",value:(l==null?void 0:l.error)||0,color:"from-red-500 to-rose-600"}),e.jsx(x,{icon:e.jsx(p,{className:"w-4 h-4 text-white"}),label:"总数",value:(l==null?void 0:l.total)||0,color:"from-purple-500 to-violet-600"}),e.jsx(x,{icon:e.jsx(O,{className:"w-4 h-4 text-white"}),label:"成功率",value:`${(l==null?void 0:l.successRate)||0}%`,color:"from-emerald-500 to-teal-600"})]}),j.length>0&&e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-700 flex items-center gap-2",children:[e.jsx(S,{className:"w-5 h-5 text-blue-400 animate-pulse"}),e.jsx("h2",{className:"font-semibold text-white",children:"正在运行的 Claude Code"}),e.jsxs("span",{className:"text-sm text-gray-400",children:["(",j.length," 个)"]})]}),e.jsx("div",{className:"p-4 space-y-4",children:j.map(s=>e.jsxs("div",{className:"border border-blue-600/30 bg-blue-900/20 rounded-xl p-5 hover:bg-blue-900/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[v(s.mode),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white",children:s.project}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400",children:[e.jsx(b,{className:"w-3 h-3"}),e.jsx("span",{children:s.feature_branch})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-purple-900/50 text-purple-300",children:y(s.mode)}),e.jsxs("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-blue-900/50 text-blue-400 flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4 animate-pulse"}),D(s.started_at)]})]})]}),s.current_action&&e.jsx("div",{className:"mb-4 px-3 py-2 bg-cyan-900/30 border border-cyan-700/30 rounded-lg",children:e.jsxs("p",{className:"text-sm text-cyan-300",children:[e.jsx("span",{className:"text-cyan-500",children:"正在："})," ",s.current_action]})}),s.steps&&s.steps.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-400 mb-1",children:[e.jsx("span",{children:"工作流进度"}),e.jsxs("span",{children:[s.current_step||1," / ",s.steps.length]})]}),e.jsx("div",{className:"flex gap-1",children:s.steps.map(r=>e.jsxs("div",{className:"flex-1 group relative",title:`${r.name}: ${r.status}`,children:[e.jsx("div",{className:`h-2 rounded-full transition-all ${r.status==="done"?"bg-emerald-500":r.status==="in_progress"?"bg-blue-500 animate-pulse":r.status==="failed"?"bg-red-500":"bg-slate-600"}`}),e.jsx("span",{className:"absolute -bottom-5 left-1/2 -translate-x-1/2 text-[10px] text-gray-500 opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap",children:r.name})]},r.id))}),e.jsxs("div",{className:"flex justify-between text-[10px] text-gray-500 mt-1 pt-2",children:[e.jsx("span",{children:"PRD"}),e.jsx("span",{children:"Code"}),e.jsx("span",{children:"PR"}),e.jsx("span",{children:"Merge"})]})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-2 bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-cyan-500 transition-all",style:{width:s.total_checkpoints>0?`${s.completed_checkpoints/s.total_checkpoints*100}%`:"0%"}})}),e.jsxs("span",{className:"text-xs text-gray-400",children:[s.completed_checkpoints,"/",s.total_checkpoints]})]}),s.pr_url&&e.jsx("div",{className:"mt-3 pt-3 border-t border-slate-700",children:e.jsxs("a",{href:s.pr_url,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-400 hover:text-blue-300 flex items-center gap-1",children:[e.jsx(b,{className:"w-3 h-3"}),"查看 PR →"]})})]},s.id))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("h2",{className:"font-semibold text-white",children:"Agent 状态"}),e.jsxs("span",{className:"text-sm text-gray-400",children:["(",a==null?void 0:a.agents.length," 个)"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:a==null?void 0:a.agents.map(s=>e.jsx(X,{agent:s,onClick:()=>t(`/cecelia/agents/${s.id}`)},s.id))})]}),e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-700 flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold text-white",children:"最近任务"}),e.jsx("button",{onClick:()=>t("/cecelia/runs"),className:"text-sm text-blue-400 hover:text-blue-300",children:"查看全部 →"})]}),w.length>0?e.jsx("div",{className:"divide-y divide-slate-700",children:w.map(s=>e.jsxs("div",{className:"px-6 py-4 flex items-center justify-between hover:bg-slate-700/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[T(s.status),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[v(s.mode),e.jsx("span",{className:"text-white",children:s.project}),e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-slate-700 text-gray-300",children:y(s.mode)})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-500",children:[e.jsx(b,{className:"w-3 h-3"}),e.jsx("span",{children:s.feature_branch}),e.jsx("span",{className:"text-gray-600",children:"·"}),e.jsxs("span",{children:[s.completed_checkpoints,"/",s.total_checkpoints," 步骤",s.failed_checkpoints>0&&e.jsxs("span",{className:"text-red-400 ml-1",children:["(",s.failed_checkpoints," 失败)"]})]})]})]})]}),e.jsx("span",{className:"text-sm text-gray-500",children:M(s.started_at)})]},s.id))}):e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(p,{className:"w-12 h-12 text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-400",children:"暂无任务"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"通过 N8N 工作流触发 Cecelia 执行任务"})]})]})]})}function x({icon:t,label:a,value:n,color:c,animate:i}){return e.jsx("div",{className:"bg-slate-800 rounded-xl border border-slate-700 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-9 h-9 bg-gradient-to-br ${c} rounded-xl flex items-center justify-center shadow-lg ${i?"animate-pulse":""}`,children:t}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400",children:a}),e.jsx("div",{className:"text-xl font-bold text-white",children:n})]})]})})}export{q as default};
