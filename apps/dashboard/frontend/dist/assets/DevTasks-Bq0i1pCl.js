import{c as x,r as c,j as e}from"./index-CWtkuk4d.js";import{a as b}from"./client-DyfwnZmM.js";import{R as j}from"./refresh-cw-Dh0Ajffi.js";import{A as m}from"./alert-circle-Cjw9fKga.js";import{L as o}from"./loader-2-CpZhkiQs.js";import{G as f}from"./git-branch-BaYnb-to.js";import{E as y}from"./external-link-By48GgNu.js";import{C as N}from"./clock-Cc5D9t81.js";import{C as v}from"./check-zriLt0Yv.js";import"./index-B9ygI19o.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g=x("FolderGit2",[["path",{d:"M9 20H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H20a2 2 0 0 1 2 2v5",key:"1w6njk"}],["circle",{cx:"13",cy:"12",r:"2",key:"1j92g6"}],["path",{d:"M18 19c-2.8 0-5-2.2-5-5v8",key:"pkpw2h"}],["circle",{cx:"20",cy:"19",r:"2",key:"1obnsp"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=x("GitPullRequest",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["line",{x1:"6",x2:"6",y1:"9",y2:"21",key:"rroup"}]]);async function k(){return(await b.get("/dev/tasks")).data}const C=({status:s})=>{const a={passed:{bg:"bg-emerald-500/20",text:"text-emerald-400",label:"通过"},running:{bg:"bg-cyan-500/20",text:"text-cyan-400",label:"运行中"},failed:{bg:"bg-red-500/20",text:"text-red-400",label:"失败"},pending:{bg:"bg-yellow-500/20",text:"text-yellow-400",label:"等待中"},unknown:{bg:"bg-gray-500/20",text:"text-gray-400",label:"未知"}}[s];return e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${a.bg} ${a.text}`,children:a.label})},S=({type:s})=>{const a={cp:{bg:"bg-cyan-500/20",text:"text-cyan-400"},feature:{bg:"bg-purple-500/20",text:"text-purple-400"},develop:{bg:"bg-blue-500/20",text:"text-blue-400"},main:{bg:"bg-emerald-500/20",text:"text-emerald-400"},unknown:{bg:"bg-gray-500/20",text:"text-gray-400"}},{bg:r,text:t}=a[s]||a.unknown;return e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${r} ${t}`,children:s})},$=({steps:s})=>{const a=t=>{switch(t){case"done":return"bg-emerald-500 border-emerald-400 text-white";case"in_progress":return"bg-cyan-500 border-cyan-400 text-white animate-pulse";case"failed":return"bg-red-500 border-red-400 text-white";case"skipped":return"bg-gray-600 border-gray-500 text-gray-300";default:return"bg-slate-700 border-slate-600 text-gray-400"}},r=(t,n)=>t==="done"?"bg-emerald-500":t==="in_progress"?"bg-gradient-to-r from-cyan-500 to-slate-600":"bg-slate-700";return e.jsx("div",{className:"flex items-center gap-0 overflow-x-auto pb-2",children:s.items.map((t,n)=>e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center text-xs font-bold transition-all ${a(t.status)}`,title:`${t.name}: ${t.status}`,children:t.status==="done"?e.jsx(v,{className:"w-4 h-4"}):t.status==="in_progress"?e.jsx(o,{className:"w-4 h-4 animate-spin"}):t.status==="failed"?e.jsx(m,{className:"w-4 h-4"}):t.id}),e.jsx("span",{className:`text-[10px] mt-1 whitespace-nowrap ${t.status==="done"?"text-emerald-400":t.status==="in_progress"?"text-cyan-400":t.status==="failed"?"text-red-400":"text-gray-500"}`,children:t.name})]}),n<s.items.length-1&&e.jsx("div",{className:`w-6 h-0.5 -mt-4 ${r(t.status,s.items[n+1].status)}`})]},t.id))})},L=({task:s})=>{const a=s.steps.items.filter(t=>t.status==="done").length,r=a/s.steps.total*100;return e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-sm rounded-2xl border border-slate-700/50 p-6 hover:border-cyan-500/30 transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-gradient-to-br from-cyan-500/20 to-blue-500/20 flex items-center justify-center",children:e.jsx(g,{className:"w-5 h-5 text-cyan-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white",children:s.repo.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx(f,{className:"w-3.5 h-3.5 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-400",children:s.branches.current}),e.jsx(S,{type:s.branches.type})]})]})]}),s.task.prUrl&&e.jsxs("a",{href:s.task.prUrl,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1.5 px-3 py-1.5 bg-purple-500/20 text-purple-400 rounded-lg text-sm hover:bg-purple-500/30 transition-colors",children:[e.jsx(w,{className:"w-4 h-4"}),"#",s.task.prNumber,e.jsx(y,{className:"w-3 h-3"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm mb-2",children:[e.jsx("span",{className:"text-gray-400",children:"进度"}),e.jsxs("span",{className:"text-cyan-400 font-medium",children:[a,"/",s.steps.total," 步骤"]})]}),e.jsx("div",{className:"h-2 bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-cyan-500 to-emerald-500 transition-all duration-500",style:{width:`${r}%`}})})]}),e.jsx($,{steps:s.steps}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-slate-700/50",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-1.5 text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"CI:"}),e.jsx(C,{status:s.quality.ci})]})}),e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-500",children:[e.jsx(N,{className:"w-3.5 h-3.5"}),new Date(s.updatedAt).toLocaleString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]})};function q(){const[s,a]=c.useState([]),[r,t]=c.useState(!0),[n,d]=c.useState(null),[h,p]=c.useState(new Date),i=c.useCallback(async()=>{try{const l=await k();l.success&&l.data?(a(l.data),d(null)):d(l.error||"获取任务失败")}catch{d("无法连接到服务器")}finally{t(!1),p(new Date)}},[]);c.useEffect(()=>{i();const l=setInterval(i,3e4);return()=>clearInterval(l)},[i]);const u=()=>{t(!0),i()};return e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"开发任务"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"实时追踪 VPS 上的开发进度"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["最后更新: ",h.toLocaleTimeString("zh-CN")]}),e.jsxs("button",{onClick:u,disabled:r,className:"flex items-center gap-2 px-4 py-2 bg-cyan-500/20 text-cyan-400 rounded-xl hover:bg-cyan-500/30 transition-colors disabled:opacity-50",children:[e.jsx(j,{className:`w-4 h-4 ${r?"animate-spin":""}`}),"刷新"]})]})]}),n&&e.jsx("div",{className:"bg-red-500/10 border border-red-500/30 rounded-xl p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-2 text-red-400",children:[e.jsx(m,{className:"w-5 h-5"}),e.jsx("span",{children:n})]})}),r&&s.length===0&&e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsxs("div",{className:"text-center",children:[e.jsx(o,{className:"w-10 h-10 text-cyan-400 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:"加载中..."})]})}),!r&&s.length===0&&!n&&e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsxs("div",{className:"text-center",children:[e.jsx(g,{className:"w-16 h-16 text-gray-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-300 mb-2",children:"暂无活跃任务"}),e.jsx("p",{className:"text-gray-500",children:"所有仓库都在 main 或 develop 分支上"})]})}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:s.map(l=>e.jsx(L,{task:l},l.repo.name))}),s.length>0&&e.jsx("div",{className:"mt-8 p-4 bg-slate-800/30 rounded-xl border border-slate-700/30",children:e.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"图例:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-emerald-500"}),e.jsx("span",{className:"text-gray-400",children:"完成"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-cyan-500 animate-pulse"}),e.jsx("span",{className:"text-gray-400",children:"进行中"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-red-500"}),e.jsx("span",{className:"text-gray-400",children:"失败"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded-full bg-slate-700"}),e.jsx("span",{className:"text-gray-400",children:"待处理"})]})]})})]})}export{q as default};
