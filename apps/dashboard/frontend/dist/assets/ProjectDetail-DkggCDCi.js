import{a7 as Z,r,j as e,R as v,ab as p,G as $,bo as y,C as M,k as g,a0 as f,l as z,aL as F,Z as I}from"./index-DjV-74X0.js";const G=.015;function H(){const{name:x}=Z(),[N,R]=r.useState([]),[l,_]=r.useState(null),[b,k]=r.useState(!0),[d,C]=r.useState("7d"),m=async()=>{try{const[s,t]=await Promise.all([fetch("/api/cecelia/overview?limit=100"),fetch("/api/cecelia/projects")]),c=await s.json(),i=await t.json();c.success&&R(c.recent_runs.filter(a=>a.project===x)),i.success&&_(i.projects.find(a=>a.name===x)||null)}catch(s){console.error(s)}finally{k(!1)}};r.useEffect(()=>{m();const s=setInterval(m,1e4);return()=>clearInterval(s)},[x]);const E=s=>{switch(s){case"24h":return 24;case"72h":return 72;case"7d":return 168;case"30d":return 720}},n=r.useMemo(()=>{const s=Date.now()-E(d)*60*60*1e3;return N.filter(t=>new Date(t.started_at).getTime()>=s)},[N,d]),T=n.filter(s=>s.status==="running"),w=n.filter(s=>s.status==="completed"),D=n.filter(s=>s.status==="failed"),P=n.length>0?Math.round(w.length/n.length*100):0,h=n.reduce((s,t)=>s+(t.token_usage||0),0),S=n.length*5e4,A=(h>0?h:S)/1e3*G,o=r.useMemo(()=>{const s=new Map;return n.forEach(t=>{const c=t.feature_branch.match(/^cp-([a-zA-Z][a-zA-Z0-9]*)-/i);if(!c)return;const i=c[1].toLowerCase();let a=s.get(i);if(!a){const j=l==null?void 0:l.features.find(L=>L.id.toLowerCase()===i);a={featureId:i,featureName:(j==null?void 0:j.name)||i,runs:[],running:0,completed:0,failed:0},s.set(i,a)}a.runs.push(t),t.status==="running"&&a.running++,t.status==="completed"&&a.completed++,t.status==="failed"&&a.failed++,(!a.latestRun||new Date(t.started_at)>new Date(a.latestRun.started_at))&&(a.latestRun=t)}),Array.from(s.values()).sort((t,c)=>c.running*10+c.runs.length-(t.running*10+t.runs.length))},[n,l]),u=r.useMemo(()=>n.filter(s=>!s.feature_branch.match(/^cp-([a-zA-Z][a-zA-Z0-9]*)-/i)),[n]);return b?e.jsx("div",{className:"min-h-screen bg-[#191919] flex items-center justify-center",children:e.jsx(v,{className:"w-5 h-5 text-gray-400 animate-spin"})}):e.jsx("div",{className:"min-h-screen bg-[#191919]",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-6 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs(p,{to:"/cecelia",className:"text-gray-400 hover:text-white flex items-center gap-2 text-sm",children:[e.jsx($,{className:"w-4 h-4"})," Engine 工作台"]}),e.jsx("button",{onClick:m,className:"p-2 text-gray-500 hover:text-white rounded-lg hover:bg-white/5",children:e.jsx(v,{className:`w-4 h-4 ${b?"animate-spin":""}`})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-white tracking-tight mb-2",children:x}),(l==null?void 0:l.description)&&e.jsx("p",{className:"text-gray-400",children:l.description})]}),e.jsxs("div",{className:"bg-gradient-to-r from-[#1a1a2e] to-[#16213e] rounded-2xl p-5 border border-[#2a2a4a] mb-8",children:[e.jsx("div",{className:"flex items-center gap-2 mb-5",children:["24h","72h","7d","30d"].map(s=>e.jsx("button",{onClick:()=>C(s),className:`px-4 py-2 rounded-xl text-sm font-medium transition ${d===s?"bg-blue-500 text-white shadow-lg shadow-blue-500/25":"bg-white/5 text-gray-400 hover:text-white hover:bg-white/10"}`,children:s==="24h"?"24h":s==="72h"?"72h":s==="7d"?"7 天":"30 天"},s))}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5 text-white"}),e.jsx("span",{className:"text-white font-bold text-2xl",children:n.length}),e.jsx("span",{className:"text-gray-400 text-sm",children:"任务"})]}),e.jsx("div",{className:"h-8 w-px bg-[#303030]"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5 text-blue-400"}),e.jsx("span",{className:"text-blue-400 font-bold text-2xl",children:T.length}),e.jsx("span",{className:"text-gray-400 text-sm",children:"运行中"})]}),e.jsx("div",{className:"h-8 w-px bg-[#303030]"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"w-5 h-5 text-green-400"}),e.jsx("span",{className:"text-green-400 font-bold text-2xl",children:w.length}),e.jsx("span",{className:"text-gray-400 text-sm",children:"完成"})]}),e.jsx("div",{className:"h-8 w-px bg-[#303030]"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5 text-red-400"}),e.jsx("span",{className:"text-red-400 font-bold text-2xl",children:D.length}),e.jsx("span",{className:"text-gray-400 text-sm",children:"失败"})]}),e.jsx("div",{className:"h-8 w-px bg-[#303030]"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-purple-400"}),e.jsxs("span",{className:"text-purple-400 font-bold text-2xl",children:[P,"%"]}),e.jsx("span",{className:"text-gray-400 text-sm",children:"成功率"})]}),e.jsx("div",{className:"h-8 w-px bg-[#303030]"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5 text-yellow-400"}),e.jsxs("span",{className:"text-yellow-400 font-bold text-xl",children:["$",A.toFixed(2)]}),e.jsx("span",{className:"text-gray-400 text-sm",children:h>0?"":"估算"})]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(I,{className:"w-5 h-5 text-blue-400"}),e.jsx("h2",{className:"text-xl font-semibold text-white",children:"活跃 Features"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",o.length,")"]})]}),o.length>0?e.jsx("div",{className:"grid grid-cols-3 gap-4",children:o.map(s=>e.jsxs("div",{className:"bg-[#202020] rounded-2xl border border-[#303030] p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-white font-semibold text-lg",children:s.featureName}),e.jsxs("span",{className:"text-xs text-gray-500 font-mono ml-2",children:["(",s.featureId,")"]})]}),s.running>0&&e.jsx("span",{className:"w-2.5 h-2.5 bg-blue-400 rounded-full animate-pulse"})]}),e.jsxs("div",{className:"flex items-center gap-4 mb-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-white font-bold",children:s.runs.length}),e.jsx("span",{className:"text-gray-500 ml-1",children:"任务"})]}),s.running>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-blue-400 rounded-full"}),e.jsx("span",{className:"text-blue-400",children:s.running})]}),s.completed>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-green-400",children:s.completed}),e.jsx("span",{className:"text-gray-500 ml-1",children:"完成"})]}),s.failed>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-red-400",children:s.failed}),e.jsx("span",{className:"text-gray-500 ml-1",children:"失败"})]})]}),e.jsxs("div",{className:"space-y-2",children:[s.runs.slice(0,3).map(t=>e.jsxs(p,{to:`/cecelia/runs/${t.id}`,className:"flex items-center justify-between p-2 rounded-lg hover:bg-white/5 transition",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[t.status==="running"&&e.jsx("span",{className:"w-2 h-2 bg-blue-400 rounded-full animate-pulse flex-shrink-0"}),t.status==="completed"&&e.jsx(g,{className:"w-3.5 h-3.5 text-green-400 flex-shrink-0"}),t.status==="failed"&&e.jsx(f,{className:"w-3.5 h-3.5 text-red-400 flex-shrink-0"}),e.jsx("span",{className:`text-sm truncate ${t.status==="completed"?"text-gray-400":"text-white"}`,children:t.prd_title||t.feature_branch})]}),t.status==="running"&&t.current_step&&e.jsxs("span",{className:"text-xs text-blue-400 font-mono flex-shrink-0",children:["S",t.current_step]})]},t.id)),s.runs.length>3&&e.jsxs("div",{className:"text-xs text-gray-500 text-center pt-1",children:["+",s.runs.length-3," 更多"]})]})]},s.featureId))}):e.jsx("div",{className:"bg-[#202020] rounded-2xl border border-[#303030] p-8 text-center text-gray-500",children:"该时间段内暂无活跃 Feature"})]}),u.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(y,{className:"w-5 h-5 text-gray-400"}),e.jsx("h2",{className:"text-lg font-semibold text-white",children:"其他任务"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",u.length,")"]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:u.map(s=>e.jsxs(p,{to:`/cecelia/runs/${s.id}`,className:"bg-[#202020] rounded-2xl border border-[#303030] p-4 hover:border-[#404040] transition",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.status==="running"&&e.jsx("span",{className:"w-2 h-2 bg-blue-400 rounded-full animate-pulse"}),s.status==="completed"&&e.jsx(g,{className:"w-4 h-4 text-green-400"}),s.status==="failed"&&e.jsx(f,{className:"w-4 h-4 text-red-400"}),e.jsx("span",{className:s.status==="completed"?"text-gray-400":"text-white",children:s.prd_title||s.feature_branch})]}),s.status==="running"&&s.current_step&&e.jsxs("div",{className:"text-xs text-blue-400 font-mono",children:["Step ",s.current_step,"/9"]})]},s.id))})]})]})})}export{H as default};
