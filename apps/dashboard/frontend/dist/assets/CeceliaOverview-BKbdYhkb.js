import{r as x,j as e,R as v,B as y,A as C,a1 as R,a0 as _,Z as D,ab as k,aA as S,z as T}from"./index-CreHPnjW.js";function A(){const[n,u]=x.useState(null),[c,h]=x.useState(!0),[a,g]=x.useState("24h"),f=async()=>{try{const t=await(await fetch("/api/cecelia/overview?limit=100")).json();t.success&&u(t)}catch(s){console.error(s)}finally{h(!1)}};x.useEffect(()=>{f();const s=setInterval(f,1e4);return()=>clearInterval(s)},[]);const N=s=>{const l=Date.now()-(a==="24h"?24:a==="72h"?72:168)*60*60*1e3;return s.filter(j=>new Date(j.started_at).getTime()>=l)};if(c&&!n)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(v,{className:"w-6 h-6 text-violet-400 animate-spin"})});const w=(n==null?void 0:n.recent_runs)||[],r=N(w),p=new Map;for(const s of r){const t=p.get(s.project);t?(t.features.push(s),s.status==="running"&&t.runningCount++,s.status==="completed"&&t.completedCount++,s.status==="failed"&&t.failedCount++):p.set(s.project,{name:s.project,runningCount:s.status==="running"?1:0,completedCount:s.status==="completed"?1:0,failedCount:s.status==="failed"?1:0,features:[s]})}const d=Array.from(p.values()),i={running:r.filter(s=>s.status==="running").length,completed:r.filter(s=>s.status==="completed").length,failed:r.filter(s=>s.status==="failed").length,total:r.length},b=a==="24h"?"24小时":a==="72h"?"72小时":"7天";return e.jsxs("div",{className:"space-y-5 max-w-5xl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-violet-600 rounded-lg",children:e.jsx(y,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-white",children:"Cecelia v3"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["近",b," · ",d.length,"个项目 · ",r.length,"个任务"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex bg-slate-800 rounded border border-slate-700",children:["24h","72h","7d"].map(s=>e.jsx("button",{onClick:()=>g(s),className:`px-2 py-1 text-xs ${a===s?"bg-violet-600 text-white":"text-gray-400 hover:text-white"}`,children:s},s))}),e.jsx("button",{onClick:f,className:"p-1.5 text-gray-400 hover:text-white hover:bg-slate-700 rounded",children:e.jsx(v,{className:`w-4 h-4 ${c?"animate-spin":""}`})})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsx(m,{icon:e.jsx(C,{className:"w-4 h-4"}),label:"运行中",value:i.running,color:"blue",pulse:i.running>0}),e.jsx(m,{icon:e.jsx(R,{className:"w-4 h-4"}),label:"成功",value:i.completed,color:"emerald"}),e.jsx(m,{icon:e.jsx(_,{className:"w-4 h-4"}),label:"失败",value:i.failed,color:"red"}),e.jsx(m,{icon:e.jsx(D,{className:"w-4 h-4"}),label:"总数",value:i.total,color:"violet"})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xs text-gray-400 mb-2",children:["项目 (",d.length,")"]}),d.length>0?e.jsx("div",{className:"space-y-3",children:d.map(s=>{const t=s.features.find(l=>l.status==="running"),o=s.features.filter(l=>l.status==="completed").sort((l,j)=>new Date(j.updated_at).getTime()-new Date(l.updated_at).getTime())[0];return e.jsx(k,{to:`/cecelia/project/${encodeURIComponent(s.name)}`,className:"block bg-slate-800 rounded-lg border border-slate-700 p-4 hover:border-violet-500/50",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-white font-medium text-base",children:s.name}),s.runningCount>0&&e.jsxs("span",{className:"px-1.5 py-0.5 text-xs bg-blue-500/20 text-blue-400 rounded flex items-center gap-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-blue-400 rounded-full animate-pulse"}),s.runningCount," 运行中"]})]}),t&&e.jsxs("div",{className:"mb-2 p-2 bg-blue-500/10 border border-blue-500/20 rounded text-sm",children:[e.jsx("span",{className:"text-blue-400",children:"正在执行: "}),e.jsx("span",{className:"text-white",children:t.prd_title||t.feature_branch}),t.current_step&&e.jsxs("span",{className:"text-gray-500 ml-2",children:["Step ",t.current_step,"/9"]})]}),o&&!t&&e.jsxs("div",{className:"mb-2 text-sm text-gray-400",children:["最近完成: ",e.jsx("span",{className:"text-emerald-400",children:o.prd_title||o.feature_branch})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(S,{className:"w-3 h-3"}),s.features.length," features"]}),e.jsxs("span",{className:"text-emerald-400",children:[s.completedCount," 完成"]}),s.failedCount>0&&e.jsxs("span",{className:"text-red-400",children:[s.failedCount," 失败"]})]})]}),e.jsx(T,{className:"w-5 h-5 text-gray-500 mt-1"})]})},s.name)})}):e.jsx("div",{className:"bg-slate-800 rounded-lg border border-slate-700 p-6 text-center",children:e.jsxs("p",{className:"text-gray-500 text-sm",children:["近",b,"暂无任务"]})})]})]})}function m({icon:n,label:u,value:c,color:h,pulse:a}){const g={blue:"bg-blue-500/20 text-blue-400",emerald:"bg-emerald-500/20 text-emerald-400",red:"bg-red-500/20 text-red-400",violet:"bg-violet-500/20 text-violet-400"};return e.jsx("div",{className:"bg-slate-800 rounded-lg border border-slate-700 p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-7 h-7 rounded flex items-center justify-center ${g[h]} ${a?"animate-pulse":""}`,children:n}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:u}),e.jsx("div",{className:"text-base font-semibold text-white",children:c})]})]})})}export{A as default};
