import{aa as y,ab as k,r as d,j as e,R as x,y as j,_ as g,aJ as _,K as C,aZ as L,C as $,$ as S,az as E,aY as I}from"./index-CjtIqAlY.js";const R={L1:{name:"L1 - 自动化检查",description:"Lint、TypeScript、单元测试"},L2:{name:"L2 - 功能验证",description:"集成测试、功能验收"},L3:{name:"L3 - 交付确认",description:"PR 合并、部署验证"}};function D(){const{runId:i}=y(),o=k(),[m,b]=d.useState(null),[N,f]=d.useState(!0),[h,c]=d.useState(null),l=async()=>{if(i)try{const a=await(await fetch(`/api/cecelia/runs/${i}`)).json();a.success?(b(a),c(null)):c(a.error||"加载失败")}catch(s){c(s.message)}finally{f(!1)}};d.useEffect(()=>{l();const s=setInterval(l,5e3);return()=>clearInterval(s)},[i]);const u=(s,a="w-5 h-5")=>{switch(s){case"completed":case"done":return e.jsx(S,{className:`${a} text-emerald-500`});case"running":case"in_progress":return e.jsx(x,{className:`${a} text-blue-500 animate-spin`});case"failed":return e.jsx(g,{className:`${a} text-red-500`});default:return e.jsx($,{className:`${a} text-gray-400`})}},p=s=>{const a={completed:"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400",done:"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400",running:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400",in_progress:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400",failed:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400",pending:"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400",skipped:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400"},n={completed:"已完成",done:"通过",running:"运行中",in_progress:"进行中",failed:"失败",pending:"等待中",skipped:"已跳过"};return e.jsx("span",{className:`px-2.5 py-1 text-xs font-medium rounded-full ${a[s]||a.pending}`,children:n[s]||s})},r=s=>s?new Date(s).toLocaleString("zh-CN"):"-",v=s=>s==="headless"?e.jsx(E,{className:"w-4 h-4 text-purple-400"}):e.jsx(I,{className:"w-4 h-4 text-cyan-400"});if(N)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(x,{className:"w-8 h-8 text-blue-500 animate-spin"})});if(h||!m)return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:()=>o("/cecelia/runs"),className:"flex items-center gap-2 text-gray-400 hover:text-white transition-colors",children:[e.jsx(j,{className:"w-4 h-4"}),"返回任务列表"]}),e.jsxs("div",{className:"bg-red-900/20 border border-red-800 rounded-xl p-6 text-center",children:[e.jsx(g,{className:"w-12 h-12 text-red-500 mx-auto mb-3"}),e.jsx("p",{className:"text-red-400",children:h||"任务不存在"}),e.jsx("button",{onClick:l,className:"mt-4 px-4 py-2 bg-red-900/30 text-red-400 rounded-lg hover:bg-red-900/50 transition-colors",children:"重试"})]})]});const{run:t,checkpoints:w}=m;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("button",{onClick:()=>o("/cecelia/runs"),className:"flex items-center gap-2 text-gray-400 hover:text-white transition-colors",children:[e.jsx(j,{className:"w-4 h-4"}),"返回任务列表"]}),e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[u(t.status,"w-6 h-6"),e.jsx("h1",{className:"text-2xl font-bold text-white",children:t.project}),p(t.status)]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_,{className:"w-4 h-4"}),e.jsx("span",{children:t.feature_branch})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[v(t.mode),e.jsx("span",{children:t.mode==="headless"?"无头模式":"交互模式"})]})]})]}),e.jsx("button",{onClick:l,className:"p-2 text-gray-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors",children:e.jsx(x,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"进度"}),e.jsxs("span",{className:"text-sm text-white font-medium",children:[t.completed_checkpoints,"/",t.total_checkpoints," Checkpoints"]})]}),e.jsx("div",{className:"h-3 bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all ${t.failed_checkpoints>0?"bg-gradient-to-r from-red-500 to-red-600":"bg-gradient-to-r from-blue-500 to-emerald-500"}`,style:{width:`${t.completed_checkpoints/t.total_checkpoints*100}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 mb-1",children:"开始时间"}),e.jsx("p",{className:"text-white",children:r(t.started_at)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 mb-1",children:"更新时间"}),e.jsx("p",{className:"text-white",children:r(t.updated_at)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 mb-1",children:"完成时间"}),e.jsx("p",{className:"text-white",children:r(t.completed_at)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 mb-1",children:"当前步骤"}),e.jsx("p",{className:"text-white",children:t.current_checkpoint||"-"})]})]}),t.error&&e.jsx("div",{className:"mt-4 p-4 bg-red-900/20 border border-red-800 rounded-lg",children:e.jsx("p",{className:"text-red-400 text-sm",children:t.error})})]}),e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700",children:[e.jsx("div",{className:"px-6 py-4 border-b border-slate-700",children:e.jsx("h2",{className:"font-semibold text-white",children:"Checkpoints"})}),e.jsx("div",{className:"divide-y divide-slate-700",children:w.map((s,a)=>{const n=R[s.checkpoint_id]||{name:s.checkpoint_id,description:""};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-700 flex items-center justify-center text-white font-medium",children:a+1}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[u(s.status),e.jsx("span",{className:"font-medium text-white",children:n.name})]}),e.jsx("p",{className:"text-sm text-gray-500 mt-0.5",children:n.description})]})]}),p(s.status)]}),e.jsxs("div",{className:"ml-11 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-400",children:[s.started_at&&e.jsxs("span",{children:["开始: ",r(s.started_at)]}),s.completed_at&&e.jsxs("span",{children:["完成: ",r(s.completed_at)]}),s.duration&&e.jsxs("span",{children:["耗时: ",s.duration,"s"]})]}),s.pr_url&&e.jsxs("a",{href:s.pr_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-sm text-blue-400 hover:text-blue-300",children:[e.jsx(C,{className:"w-4 h-4"}),"查看 PR"]}),s.output&&e.jsxs("div",{className:"mt-2 p-3 bg-slate-900 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 mb-2",children:[e.jsx(L,{className:"w-4 h-4"}),"输出"]}),e.jsx("pre",{className:"text-xs text-gray-300 whitespace-pre-wrap overflow-x-auto",children:s.output})]}),s.error&&e.jsx("div",{className:"mt-2 p-3 bg-red-900/20 border border-red-800 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-400",children:s.error})})]})]},s.checkpoint_id)})})]})]})}export{D as default};
