import{a7 as y,a8 as _,r as c,j as e,R as o,G as u,a9 as k,W as C,aA as $,a1 as g,a4 as f,bd as R}from"./index-C6sXer-l.js";const j={1:"PRD",2:"DoD",3:"Branch",4:"Code",5:"Test",6:"Local",7:"PR",8:"QA",9:"Merge"};function E(){const{runId:d}=y(),h=_(),[t,b]=c.useState(null),[r,p]=c.useState([]),[N,v]=c.useState(!0),x=async()=>{if(d)try{const a=await(await fetch(`/api/cecelia/runs/${d}`)).json();a.success&&(b(a.run),p(a.checkpoints||[]))}catch(s){console.error(s)}finally{v(!1)}};if(c.useEffect(()=>{x();const s=setInterval(x,5e3);return()=>clearInterval(s)},[d]),N)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(o,{className:"w-6 h-6 text-violet-400 animate-spin"})});if(!t)return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:()=>h(-1),className:"text-gray-400 hover:text-white text-sm flex items-center gap-2",children:[e.jsx(u,{className:"w-4 h-4"})," 返回"]}),e.jsx("div",{className:"bg-slate-800 rounded-lg p-8 text-center text-gray-500",children:"任务不存在"})]});const l=t.steps||[],w=r.filter(s=>s.status==="done").length,n=r.find(s=>s.status==="in_progress")||t.current_checkpoint,m=typeof n=="string"?n:n==null?void 0:n.checkpoint_id;return e.jsxs("div",{className:"space-y-4 max-w-4xl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>h(-1),className:"text-gray-400 hover:text-white text-sm flex items-center gap-2",children:[e.jsx(u,{className:"w-4 h-4"})," 返回"]}),e.jsx("button",{onClick:x,className:"p-2 text-gray-400 hover:text-white hover:bg-slate-700 rounded",children:e.jsx(o,{className:"w-4 h-4"})})]}),t.status==="running"&&e.jsx("div",{className:"bg-gradient-to-r from-blue-600/20 to-violet-600/20 rounded-lg border border-blue-500/30 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-500/30 flex items-center justify-center",children:e.jsx(k,{className:"w-5 h-5 text-blue-400 animate-pulse"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-white font-medium",children:[m?`${m}`:"Checkpoint",t.current_step&&e.jsxs("span",{className:"text-gray-400",children:[" → Step ",t.current_step," (",j[t.current_step],")"]})]}),t.current_action&&e.jsx("div",{className:"text-sm text-gray-400",children:t.current_action})]})]})}),e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${t.status==="running"?"bg-blue-500/20 text-blue-400":t.status==="completed"?"bg-emerald-500/20 text-emerald-400":t.status==="failed"?"bg-red-500/20 text-red-400":"bg-slate-700 text-gray-400"}`,children:t.status==="running"?"运行中":t.status==="completed"?"已完成":t.status==="failed"?"失败":"等待中"}),e.jsx("span",{className:"text-xs text-gray-500",children:t.mode==="headless"?"无头":"交互"}),t.pr_url&&e.jsxs("a",{href:t.pr_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 text-xs flex items-center gap-1 ml-auto",children:[e.jsx(C,{className:"w-3 h-3"})," PR"]})]}),e.jsx("h1",{className:"text-lg font-semibold text-white",children:t.prd_title||t.feature_branch}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 mt-1",children:[e.jsx("span",{children:t.project}),e.jsx("span",{children:"•"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx($,{className:"w-3 h-3"}),t.feature_branch]})]})]}),e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-sm font-medium text-white",children:"Checkpoints"}),e.jsxs("span",{className:"text-xs px-2 py-0.5 bg-slate-700 rounded",children:[w,"/",r.length]})]}),r.length>0?e.jsx("div",{className:"space-y-2",children:r.map((s,a)=>{const i=s.status==="in_progress"||s.checkpoint_id===m;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${s.status==="done"?"bg-emerald-500":i?"bg-blue-500 ring-2 ring-blue-400/50 ring-offset-2 ring-offset-slate-800":s.status==="failed"?"bg-red-500":"bg-slate-700"}`,children:s.status==="done"?e.jsx(g,{className:"w-5 h-5 text-white"}):i?e.jsx(o,{className:"w-4 h-4 text-white animate-spin"}):s.status==="failed"?e.jsx(f,{className:"w-4 h-4 text-white"}):e.jsx(R,{className:"w-4 h-4 text-gray-500"})}),a<r.length-1&&e.jsx("div",{className:`absolute ml-4 mt-10 w-0.5 h-6 ${s.status==="done"?"bg-emerald-500":"bg-slate-700"}`,style:{display:"none"}}),e.jsx("div",{className:`flex-1 px-3 py-2 rounded ${i?"bg-blue-500/10 border border-blue-500/30":s.status==="done"?"bg-emerald-500/5":"bg-slate-700/30"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`font-mono text-sm font-medium ${s.status==="done"?"text-emerald-400":i?"text-blue-400":"text-gray-400"}`,children:s.checkpoint_id}),s.name&&e.jsx("span",{className:`text-sm ${i?"text-white":"text-gray-400"}`,children:s.name})]})})]},s.checkpoint_id)})}):e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"暂无 Checkpoints"})]}),l.length>0&&e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-sm font-medium text-white",children:"Dev 流程"}),e.jsxs("span",{className:"text-xs px-2 py-0.5 bg-slate-700 rounded",children:[l.filter(s=>s.status==="done").length,"/",l.length]})]}),e.jsx("div",{className:"flex items-center justify-between",children:l.map((s,a)=>e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold ${s.status==="done"?"bg-emerald-500 text-white":s.status==="in_progress"?"bg-blue-500 text-white ring-2 ring-blue-400/50":s.status==="failed"?"bg-red-500 text-white":"bg-slate-700 text-gray-500"}`,children:s.status==="done"?"✓":s.id}),e.jsx("span",{className:`text-xs mt-1 ${s.status==="done"?"text-emerald-400":s.status==="in_progress"?"text-blue-400":"text-gray-600"}`,children:j[s.id]})]}),a<l.length-1&&e.jsx("div",{className:`flex-1 h-0.5 mx-1 ${s.status==="done"?"bg-emerald-500":"bg-slate-700"}`})]},s.id))}),t.status==="completed"&&e.jsxs("div",{className:"mt-4 flex items-center gap-2 text-sm p-3 bg-emerald-500/10 border border-emerald-500/20 rounded",children:[e.jsx(g,{className:"w-5 h-5 text-emerald-400"}),e.jsx("span",{className:"text-emerald-400 font-medium",children:"全部完成"})]}),t.status==="failed"&&e.jsxs("div",{className:"mt-4 flex items-center gap-2 text-sm p-3 bg-red-500/10 border border-red-500/20 rounded",children:[e.jsx(f,{className:"w-5 h-5 text-red-400"}),e.jsx("span",{className:"text-red-400 font-medium",children:"执行失败"})]})]})]})}export{E as default};
