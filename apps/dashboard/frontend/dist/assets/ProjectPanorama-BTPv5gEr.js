import{r as a,j as t,X as re,bc as Wt,w as $t,a0 as _t,x as Pt,R as ot,m as Lt,a_ as at,o as rt,aX as Ft}from"./index-Cq2G-yP9.js";const W="https://dashboard.zenjoymedia.media",we={trigger:"触发器",action:"动作",logic:"逻辑",output:"输出"},At={core:"核心系统",product:"产品模块",dashboard:"前端界面",feature:"功能模块",workflow:"n8n 工作流",service:"Docker 服务",project:"项目"},It={root:{title:"全景图",subtitle:"项目整体架构",nodes:[{id:"core",x:100,y:140,name:"Autopilot Core",desc:"开发内核",status:"in_progress",type:"core",hasChildren:!0},{id:"product",x:300,y:140,name:"ZenithJoy Autopilot",desc:"产品",status:"in_progress",type:"product",hasChildren:!0},{id:"dashboard",x:520,y:50,name:"Dashboard",desc:"前端",status:"in_progress",type:"dashboard",hasChildren:!0},{id:"task-queue",x:520,y:120,name:"任务队列",desc:"查看任务",status:"not_started",type:"dashboard"},{id:"content-publish",x:520,y:210,name:"Content Publish",desc:"9平台",status:"not_started",type:"feature",hasChildren:!0},{id:"data-collection",x:520,y:280,name:"Data Collection",desc:"6平台",status:"not_started",type:"feature",hasChildren:!0},{id:"monitor",x:520,y:350,name:"Monitor",desc:"监控",status:"not_started",type:"feature",hasChildren:!0}],edges:[{from:"core",to:"product"},{from:"product",to:"dashboard"},{from:"product",to:"task-queue"},{from:"product",to:"content-publish"},{from:"product",to:"data-collection"},{from:"product",to:"monitor"}]},core:{title:"Autopilot Core",subtitle:"开发内核",version:"v1.4",milestones:[{date:"1/10",label:"Core v2.0 - 24h稳定运行"},{date:"2/15",label:"Core v3.0 - 生物自愈系统"}],nodes:[{id:"task-dispatcher",x:60,y:80,name:"Task Dispatcher",desc:"调度",status:"completed",type:"core",hasChildren:!0,version:"v2.0"},{id:"executor",x:60,y:170,name:"Executor",desc:"执行",status:"completed",type:"core",hasChildren:!0,version:"v2.0"},{id:"completion-sync",x:240,y:125,name:"Completion Sync",desc:"同步",status:"in_progress",type:"core",hasChildren:!0,version:"v1.4",current:!0},{id:"feature-validator",x:420,y:80,name:"Feature Validator",desc:"验证",status:"not_started",type:"core",version:"v1.5"},{id:"quality-check",x:420,y:170,name:"Quality Check",desc:"质检",status:"not_started",type:"core",version:"v1.5"},{id:"auto-repair",x:600,y:125,name:"Auto Repair",desc:"自愈",status:"not_started",type:"core",version:"v3.0"}],edges:[{from:"task-dispatcher",to:"completion-sync"},{from:"executor",to:"completion-sync"},{from:"completion-sync",to:"feature-validator"},{from:"completion-sync",to:"quality-check"},{from:"feature-validator",to:"auto-repair"},{from:"quality-check",to:"auto-repair"}]},"task-dispatcher":{title:"Task Dispatcher",subtitle:"任务调度器",version:"v2.0",nodes:[{id:"td-poll",x:60,y:100,name:"Notion 轮询",desc:"n8n workflow",status:"completed",type:"workflow",hasChildren:!0},{id:"td-depend",x:220,y:60,name:"依赖检查",desc:"n8n workflow",status:"completed",type:"workflow",hasChildren:!0},{id:"td-parallel",x:220,y:140,name:"并行控制",desc:"n8n workflow",status:"completed",type:"workflow",hasChildren:!0},{id:"td-assign",x:380,y:100,name:"任务分配",desc:"n8n workflow",status:"completed",type:"workflow",hasChildren:!0}],edges:[{from:"td-poll",to:"td-depend"},{from:"td-poll",to:"td-parallel"},{from:"td-depend",to:"td-assign"},{from:"td-parallel",to:"td-assign"}]},"td-poll":{title:"Notion 轮询",subtitle:"每5分钟检查一次有没有新任务",scriptPath:"/dispatcher/poll.sh",isLeaf:!0,workflowNodes:[{id:"n1",x:50,y:100,name:"定时启动",type:"trigger",input:"无",output:"启动信号",logic:`每 5 分钟自动启动一次

就像闹钟一样，定时响
不管有没有任务都会响`},{id:"n2",x:220,y:100,name:"去 Notion 找任务",type:"action",input:"启动信号",output:"任务清单",logic:`去 Notion 的 Tasks 数据库找任务

找的条件：
1. 状态是 "Next Action"（准备好要做的）
2. 勾选了 "AI Task"（是 AI 要做的）
3. 属于 "AI Systems" 这个 Area

时间早的排前面`},{id:"n3",x:390,y:100,name:"过滤掉记录类",type:"logic",input:"任务清单",output:"编程任务清单",logic:`只保留真正要执行的任务：
✓ Workflow 类型
✓ Backend 类型
✓ Frontend 类型

过滤掉 AI Assist 类型
因为那是"已经做完的记录"
不是"要去做的任务"`},{id:"n4",x:560,y:100,name:"给每个任务编号",type:"logic",input:"编程任务清单",output:"带编号的任务",logic:`给每个任务一个唯一编号

这个编号叫 run_id
后面用来追踪这个任务的执行情况`},{id:"n5",x:730,y:100,name:"发给下一步",type:"output",input:"带编号的任务",output:"→ 依赖检查 + 并行控制",logic:`同时发给两个检查：

1. 依赖检查 - 看前置任务做完没
2. 并行控制 - 看还有没有空位

两个都通过才能执行`}],workflowEdges:[{from:"n1",to:"n2"},{from:"n2",to:"n3"},{from:"n3",to:"n4"},{from:"n4",to:"n5"}]},"td-depend":{title:"依赖检查",subtitle:"检查前置任务有没有做完",scriptPath:"/dispatcher/depend.sh",isLeaf:!0,workflowNodes:[{id:"n1",x:50,y:100,name:"收到任务",type:"trigger",input:"无",output:"一个任务",logic:`从轮询那边收到任务
一次检查一个`},{id:"n2",x:200,y:100,name:"看 Blocked by",type:"action",input:"一个任务",output:"依赖列表",logic:`看任务的 "Blocked by" 字段

这个字段关联了"必须先做完"的任务
比如：任务B 必须等 任务A 做完`},{id:"n3",x:370,y:50,name:"检查任务依赖",type:"logic",input:"依赖列表",output:"是否满足",logic:`检查每个依赖的任务：
它的状态是不是 "Completed"？

全部都完成了 → ✓ 通过
有任何一个没完成 → ✗ 不通过`},{id:"n4",x:370,y:150,name:"检查项目依赖",type:"logic",input:"一个任务",output:"是否满足",logic:`检查任务所属项目的依赖：
依赖的项目是不是都完成了？

这是更高层级的依赖
比如：B项目 必须等 A项目 做完`},{id:"n5",x:540,y:100,name:"综合判断",type:"logic",input:"两个检查结果",output:"能不能执行",logic:`两个检查都通过 → 可以执行
任何一个不通过 → 不能执行，等下次`},{id:"n6",x:710,y:100,name:"告诉下一步",type:"output",input:"能不能执行",output:"→ 任务分配",logic:`能执行 → 发给任务分配
不能执行 → 跳过，等下一轮检查`}],workflowEdges:[{from:"n1",to:"n2"},{from:"n2",to:"n3"},{from:"n2",to:"n4"},{from:"n3",to:"n5"},{from:"n4",to:"n5"},{from:"n5",to:"n6"}]},"td-parallel":{title:"并行控制",subtitle:"控制同时执行的任务数量",scriptPath:"/dispatcher/parallel.sh",isLeaf:!0,workflowNodes:[{id:"n1",x:50,y:100,name:"收到任务",type:"trigger",input:"无",output:"任务清单",logic:`从轮询那边收到任务
可能是多个`},{id:"n2",x:200,y:100,name:"数一下正在跑的",type:"action",input:"任务清单",output:"各类型数量",logic:`去 Notion 数一下：
现在有几个任务正在执行？

按类型分开数：
Workflow: 2个在跑
Backend: 1个在跑
Frontend: 0个在跑`},{id:"n3",x:390,y:100,name:"算还有几个空位",type:"logic",input:"各类型数量",output:"各类型空位",logic:`⚠️ 重要规则：

Workflow: 最多同时跑 3 个
Backend: 最多同时跑 2 个
Frontend: 最多同时跑 1 个

空位 = 上限 - 正在跑的

比如 Workflow: 3-2 = 还能跑 1 个`},{id:"n4",x:580,y:100,name:"选出能跑的",type:"logic",input:"任务 + 空位",output:"能执行的任务",logic:`每种类型只选"空位数"个任务
时间早的优先

比如 Workflow 有5个等着：
但只有1个空位
→ 只选时间最早的那1个
→ 其他4个下次再说`},{id:"n5",x:770,y:100,name:"发给下一步",type:"output",input:"能执行的任务",output:"→ 任务分配",logic:`把选出来的任务发给任务分配
没被选中的下次轮询再处理`}],workflowEdges:[{from:"n1",to:"n2"},{from:"n2",to:"n3"},{from:"n3",to:"n4"},{from:"n4",to:"n5"}]},"td-assign":{title:"任务分配",subtitle:"把任务分配给对应的执行器",scriptPath:"/dispatcher/assign.sh",isLeaf:!0,workflowNodes:[{id:"n1",x:50,y:100,name:"收到任务",type:"trigger",input:"无",output:"一个任务",logic:`收到通过了检查的任务
这些任务可以开始执行了`},{id:"n2",x:200,y:100,name:"看是什么类型",type:"logic",input:"一个任务",output:"类型",logic:`看任务的 Coding Type：

Workflow → 发给 Workflow 执行器
Backend → 发给 Backend 执行器
Frontend → 发给 Frontend 执行器`},{id:"n3",x:370,y:50,name:"Workflow 执行器",type:"action",input:"Workflow 任务",output:"已发送",logic:`把任务发给 Workflow 执行器

它会：
1. 读懂任务内容
2. 生成 n8n 工作流
3. 做完了回报结果`},{id:"n4",x:370,y:100,name:"Backend 执行器",type:"action",input:"Backend 任务",output:"已发送",logic:`把任务发给 Backend 执行器

它会：
1. 读懂任务内容
2. 写后端代码
3. 跑测试
4. 做完了回报结果`},{id:"n5",x:370,y:150,name:"Frontend 执行器",type:"action",input:"Frontend 任务",output:"已发送",logic:`把任务发给 Frontend 执行器

它会：
1. 读懂任务内容
2. 写前端代码
3. 做完了回报结果`},{id:"n6",x:560,y:100,name:"更新 Notion",type:"action",input:"已发送",output:"完成",logic:`更新 Notion 里的状态：

状态改成 "In Progress"
填上任务编号 run_id

这样下次轮询就不会重复处理`}],workflowEdges:[{from:"n1",to:"n2"},{from:"n2",to:"n3"},{from:"n2",to:"n4"},{from:"n2",to:"n5"},{from:"n3",to:"n6"},{from:"n4",to:"n6"},{from:"n5",to:"n6"}]},executor:{title:"Executor",subtitle:"执行器",version:"v2.0",nodes:[{id:"exec-workflow",x:60,y:60,name:"Workflow 执行器",desc:"n8n workflow",status:"completed",type:"workflow",hasChildren:!0},{id:"exec-backend",x:60,y:140,name:"Backend 执行器",desc:"n8n workflow",status:"completed",type:"workflow",hasChildren:!0},{id:"exec-frontend",x:260,y:60,name:"Frontend 执行器",desc:"n8n workflow",status:"completed",type:"workflow",hasChildren:!0},{id:"exec-check",x:260,y:140,name:"Check 执行器",desc:"n8n workflow",status:"in_progress",type:"workflow",hasChildren:!0,current:!0}],edges:[]},"exec-backend":{title:"Backend 执行器",subtitle:"执行后端开发任务",scriptPath:"/executor/backend.sh",isLeaf:!0,workflowNodes:[{id:"n1",x:50,y:100,name:"收到任务",type:"trigger",input:"无",output:"任务内容",logic:`收到后端开发任务
任务内容是 Markdown 格式`},{id:"n2",x:200,y:100,name:"理解任务",type:"logic",input:"任务内容",output:"任务要求",logic:`从任务内容里提取：

1. 要做什么（任务目标）
2. 具体要求是什么
3. 怎么算做完（验收标准）`},{id:"n3",x:370,y:100,name:"让 AI 写代码",type:"action",input:"任务要求",output:"AI 在跑",logic:`在服务器上启动 Claude Code

Claude 会：
1. 理解要求
2. 写后端代码
3. 写测试代码

这一步是后台运行的
启动后就不用等了`},{id:"n4",x:540,y:60,name:"跑测试",type:"logic",input:"代码写完",output:"测试结果",logic:`Claude 写完代码后会自动跑测试：

1. 检查代码规范 ✓/✗
2. 检查类型对不对 ✓/✗
3. 跑测试用例 ✓/✗

全部通过 = 成功
任何一个失败 = 失败`},{id:"n5",x:540,y:140,name:"保存日志",type:"action",input:"执行过程",output:"日志文件",logic:`把执行过程保存下来

方便你以后查看：
- 做了什么
- 改了哪些文件
- 有没有报错`},{id:"n6",x:710,y:100,name:"汇报结果",type:"output",input:"测试结果 + 日志",output:"→ Completion Sync",logic:`把结果告诉 Completion Sync：

成功 → 状态改成 Waiting，等你验收
失败 → 状态改成 AI Failed，需要处理`}],workflowEdges:[{from:"n1",to:"n2"},{from:"n2",to:"n3"},{from:"n3",to:"n4"},{from:"n3",to:"n5"},{from:"n4",to:"n6"},{from:"n5",to:"n6"}]},"exec-frontend":{title:"Frontend 执行器",subtitle:"执行前端开发任务",scriptPath:"/executor/frontend.sh",isLeaf:!0,workflowNodes:[{id:"n1",x:50,y:100,name:"收到任务",type:"trigger",input:"无",output:"任务内容",logic:"收到前端开发任务"},{id:"n2",x:200,y:100,name:"理解任务",type:"logic",input:"任务内容",output:"任务要求",logic:`提取：
1. 要做什么页面/组件
2. 长什么样
3. 验收标准`},{id:"n3",x:370,y:100,name:"让 AI 写代码",type:"action",input:"任务要求",output:"AI 在跑",logic:`Claude 会：
1. 写 React 组件
2. 写样式
3. 更新路由（如需要）`},{id:"n4",x:540,y:60,name:"检查能不能编译",type:"logic",input:"代码写完",output:"编译结果",logic:`检查：
1. 能不能编译成功
2. 代码规范对不对
3. 类型对不对`},{id:"n5",x:540,y:140,name:"保存日志",type:"action",input:"执行过程",output:"日志文件",logic:"保存执行过程"},{id:"n6",x:710,y:100,name:"汇报结果",type:"output",input:"结果",output:"→ Completion Sync",logic:`成功 → Waiting
失败 → AI Failed`}],workflowEdges:[{from:"n1",to:"n2"},{from:"n2",to:"n3"},{from:"n3",to:"n4"},{from:"n3",to:"n5"},{from:"n4",to:"n6"},{from:"n5",to:"n6"}]},"exec-workflow":{title:"Workflow 执行器",subtitle:"执行 n8n 工作流开发任务",scriptPath:"/executor/workflow.sh",isLeaf:!0,workflowNodes:[{id:"n1",x:50,y:100,name:"收到任务",type:"trigger",input:"无",output:"任务内容",logic:"收到 Workflow 开发任务"},{id:"n2",x:200,y:100,name:"理解任务",type:"logic",input:"任务内容",output:"任务要求",logic:`提取：
1. 要做什么工作流
2. 触发条件是什么
3. 有哪些步骤`},{id:"n3",x:370,y:100,name:"让 AI 生成",type:"action",input:"任务要求",output:"AI 在跑",logic:`Claude 会：
1. 生成 n8n 工作流
2. 导入到 n8n
3. 验证连接正确`},{id:"n4",x:540,y:100,name:"8项质检",type:"logic",input:"工作流",output:"质检结果",logic:`8项检查：
1. 工作流存在
2. 评分达标
3. 没有敏感信息
4. 连接正常
...`},{id:"n5",x:710,y:100,name:"汇报结果",type:"output",input:"质检结果",output:"→ Completion Sync",logic:`通过 → Waiting
不通过 → AI Failed`}],workflowEdges:[{from:"n1",to:"n2"},{from:"n2",to:"n3"},{from:"n3",to:"n4"},{from:"n4",to:"n5"}]},"exec-check":{title:"Check 执行器",subtitle:"验证整个 Feature 是否完成",scriptPath:"/executor/check.sh",isLeaf:!0,workflowNodes:[{id:"n1",x:50,y:100,name:"收到任务",type:"trigger",input:"无",output:"任务内容",logic:"收到 Feature 验证任务"},{id:"n2",x:200,y:100,name:"找到所有子任务",type:"action",input:"Feature ID",output:"子任务列表",logic:`找出这个 Feature 下的所有任务
确认都已经完成`},{id:"n3",x:370,y:100,name:"跑完整测试",type:"action",input:"子任务列表",output:"测试结果",logic:`跑整个 Feature 的测试：
1. 单元测试
2. 集成测试
3. 端到端测试`},{id:"n4",x:540,y:100,name:"验证结果",type:"logic",input:"测试结果",output:"是否通过",logic:`检查：
✓ 所有测试通过
✓ 覆盖率达标
✓ 没有错误`},{id:"n5",x:710,y:100,name:"汇报结果",type:"output",input:"验证结果",output:"→ Completion Sync",logic:`通过 → 整个 Feature 完成
不通过 → 需要修复`}],workflowEdges:[{from:"n1",to:"n2"},{from:"n2",to:"n3"},{from:"n3",to:"n4"},{from:"n4",to:"n5"}]},"completion-sync":{title:"Completion Sync",subtitle:"把执行结果同步回 Notion",version:"v1.4",milestones:[{date:"1/5",label:"v1.5 - 飞书通知"}],nodes:[{id:"cs-webhook",x:60,y:100,name:"Webhook 接收",desc:"",status:"completed",type:"workflow",hasChildren:!0},{id:"cs-status",x:220,y:60,name:"状态更新",desc:"",status:"completed",type:"workflow",hasChildren:!0},{id:"cs-log",x:220,y:140,name:"日志写入",desc:"",status:"in_progress",type:"workflow",hasChildren:!0,current:!0},{id:"cs-notify",x:380,y:100,name:"通知",desc:"",status:"not_started",type:"workflow"}],edges:[{from:"cs-webhook",to:"cs-status"},{from:"cs-webhook",to:"cs-log"},{from:"cs-status",to:"cs-notify"},{from:"cs-log",to:"cs-notify"}]},"cs-webhook":{title:"Webhook 接收",subtitle:"接收执行器的结果",scriptPath:"/completion/webhook.sh",isLeaf:!0,workflowNodes:[{id:"n1",x:50,y:100,name:"等待结果",type:"trigger",input:"无",output:"执行结果",logic:"等待执行器完成后发来结果"},{id:"n2",x:220,y:100,name:"验证来源",type:"logic",input:"执行结果",output:"验证后的结果",logic:`确认是我们的执行器发来的
不是别人伪造的`},{id:"n3",x:410,y:100,name:"解析内容",type:"logic",input:"验证后的结果",output:"解析后的数据",logic:`提取：
- 任务ID
- 成功还是失败
- 测试结果
- 日志位置`},{id:"n4",x:600,y:100,name:"分发处理",type:"output",input:"解析后的数据",output:"→ 状态更新 + 日志",logic:`同时发给：
1. 状态更新 - 改 Notion
2. 日志写入 - 保存文件`}],workflowEdges:[{from:"n1",to:"n2"},{from:"n2",to:"n3"},{from:"n3",to:"n4"}]},"cs-status":{title:"状态更新",subtitle:"更新 Notion 里的任务状态",scriptPath:"/completion/status.sh",isLeaf:!0,workflowNodes:[{id:"n1",x:50,y:100,name:"收到结果",type:"trigger",input:"无",output:"执行结果",logic:"从 Webhook 那边收到结果"},{id:"n2",x:200,y:100,name:"判断成败",type:"logic",input:"执行结果",output:"成功/失败",logic:"看 status 是 success 还是 failed"},{id:"n3",x:370,y:60,name:"成功处理",type:"action",input:"成功",output:"Waiting",logic:`状态改成 Waiting

意思是：
AI 做完了，等你验收`},{id:"n4",x:370,y:140,name:"失败处理",type:"action",input:"失败",output:"AI Failed",logic:`状态改成 AI Failed

意思是：
AI 执行失败，需要处理`},{id:"n5",x:540,y:100,name:"更新 Notion",type:"action",input:"新状态",output:"完成",logic:"把新状态写回 Notion"}],workflowEdges:[{from:"n1",to:"n2"},{from:"n2",to:"n3"},{from:"n2",to:"n4"},{from:"n3",to:"n5"},{from:"n4",to:"n5"}]},"cs-log":{title:"日志写入",subtitle:"保存执行日志",scriptPath:"/completion/log.sh",isLeaf:!0,workflowNodes:[{id:"n1",x:50,y:100,name:"收到日志",type:"trigger",input:"无",output:"日志内容",logic:"从 Webhook 收到日志内容"},{id:"n2",x:220,y:100,name:"整理格式",type:"logic",input:"日志内容",output:"格式化日志",logic:`加上时间戳
整理成方便阅读的格式`},{id:"n3",x:410,y:100,name:"保存文件",type:"action",input:"格式化日志",output:"文件路径",logic:`保存到服务器上
每个任务一个文件夹`},{id:"n4",x:600,y:100,name:"更新索引",type:"action",input:"文件路径",output:"完成",logic:`更新索引文件
方便以后查找`}],workflowEdges:[{from:"n1",to:"n2"},{from:"n2",to:"n3"},{from:"n3",to:"n4"}]},"content-publish":{title:"Content Publish",subtitle:"9平台发布",milestones:[{date:"1/20",label:"v1.0 - 首批3平台"}],nodes:[{id:"pub-dy",x:60,y:50,name:"抖音",desc:"",status:"not_started",type:"feature"},{id:"pub-xhs",x:60,y:110,name:"小红书",desc:"",status:"not_started",type:"feature"},{id:"pub-wx",x:60,y:170,name:"微信",desc:"",status:"not_started",type:"feature"},{id:"pub-wb",x:180,y:50,name:"微博",desc:"",status:"not_started",type:"feature"},{id:"pub-zh",x:180,y:110,name:"知乎",desc:"",status:"not_started",type:"feature"},{id:"pub-bili",x:180,y:170,name:"B站",desc:"",status:"not_started",type:"feature"},{id:"pub-ks",x:300,y:50,name:"快手",desc:"",status:"not_started",type:"feature"},{id:"pub-sph",x:300,y:110,name:"视频号",desc:"",status:"not_started",type:"feature"},{id:"pub-tt",x:300,y:170,name:"头条",desc:"",status:"not_started",type:"feature"}],edges:[]},"data-collection":{title:"Data Collection",subtitle:"6平台采集",milestones:[{date:"1/31",label:"v1.0 - Dad交付"}],nodes:[{id:"data-dy",x:60,y:70,name:"抖音",desc:"",status:"not_started",type:"feature"},{id:"data-xhs",x:60,y:140,name:"小红书",desc:"",status:"not_started",type:"feature"},{id:"data-wb",x:180,y:70,name:"微博",desc:"",status:"not_started",type:"feature"},{id:"data-zh",x:180,y:140,name:"知乎",desc:"",status:"not_started",type:"feature"},{id:"data-bili",x:300,y:70,name:"B站",desc:"",status:"not_started",type:"feature"},{id:"data-ks",x:300,y:140,name:"快手",desc:"",status:"not_started",type:"feature"}],edges:[]},monitor:{title:"Monitor",subtitle:"监控系统",nodes:[{id:"mon-health",x:60,y:100,name:"健康检查",desc:"",status:"not_started",type:"feature"},{id:"mon-report",x:200,y:60,name:"日报",desc:"",status:"not_started",type:"feature"},{id:"mon-alert",x:200,y:140,name:"告警",desc:"",status:"not_started",type:"feature"},{id:"mon-fix",x:340,y:100,name:"自动修复",desc:"",status:"not_started",type:"feature"}],edges:[{from:"mon-health",to:"mon-report"},{from:"mon-health",to:"mon-alert"},{from:"mon-alert",to:"mon-fix"}]},dashboard:{title:"Dashboard",subtitle:"前端界面",nodes:[{id:"ui-overview",x:60,y:70,name:"全景页",desc:"",status:"in_progress",type:"dashboard",current:!0},{id:"ui-tasks",x:60,y:140,name:"任务页",desc:"",status:"not_started",type:"dashboard"},{id:"ui-logs",x:180,y:70,name:"日志页",desc:"",status:"not_started",type:"dashboard"},{id:"ui-monitor",x:180,y:140,name:"监控页",desc:"",status:"not_started",type:"dashboard"}],edges:[]},product:{title:"ZenithJoy Autopilot",subtitle:"产品架构",nodes:[{id:"prod-dash",x:60,y:100,name:"Dashboard",desc:"",status:"in_progress",type:"product",hasChildren:!0},{id:"prod-api",x:200,y:60,name:"API Server",desc:"",status:"not_started",type:"product"},{id:"prod-n8n",x:200,y:140,name:"n8n",desc:"",status:"in_progress",type:"product"},{id:"prod-db",x:340,y:100,name:"Database",desc:"",status:"not_started",type:"product"}],edges:[{from:"prod-dash",to:"prod-api"},{from:"prod-api",to:"prod-db"},{from:"prod-n8n",to:"prod-api"}]}},v={core:{fill:"#a78bfa",bg:"rgba(167,139,250,0.12)",border:"rgba(167,139,250,0.35)"},product:{fill:"#fbbf24",bg:"rgba(251,191,36,0.12)",border:"rgba(251,191,36,0.35)"},dashboard:{fill:"#c084fc",bg:"rgba(192,132,252,0.12)",border:"rgba(192,132,252,0.35)"},feature:{fill:"#60a5fa",bg:"rgba(96,165,250,0.12)",border:"rgba(96,165,250,0.35)"},workflow:{fill:"#34d399",bg:"rgba(52,211,153,0.12)",border:"rgba(52,211,153,0.35)"},service:{fill:"#f472b6",bg:"rgba(244,114,182,0.12)",border:"rgba(244,114,182,0.35)"},project:{fill:"#818cf8",bg:"rgba(129,140,248,0.12)",border:"rgba(129,140,248,0.35)"},trigger:{fill:"#fbbf24",bg:"rgba(251,191,36,0.15)",border:"rgba(251,191,36,0.4)"},action:{fill:"#60a5fa",bg:"rgba(96,165,250,0.15)",border:"rgba(96,165,250,0.4)"},logic:{fill:"#a78bfa",bg:"rgba(167,139,250,0.15)",border:"rgba(167,139,250,0.4)"},output:{fill:"#34d399",bg:"rgba(52,211,153,0.15)",border:"rgba(52,211,153,0.4)"}},ee={completed:"#34d399",in_progress:"#60a5fa",not_started:"#64748b"},x=180,c=64,Tt=160,zt=56,ke={blueprint:{name:"蓝图",desc:"我想做什么"},runtime:{name:"运行",desc:"机器人们在干嘛"},code:{name:"代码",desc:"我的项目们"},dataflow:{name:"数据流",desc:"任务怎么流转"},workspace:{name:"工作区",desc:"Claude 协作"}},Ot=It;function Gt({embedded:Y=!1,hideControls:Bt=!1}){var Ve,Ze,qe,Je,Qe,et,tt,st,nt;const[j,lt]=a.useState("blueprint"),[g,te]=a.useState(["root"]),[ve,je]=a.useState({}),[A,z]=a.useState(null),[se,H]=a.useState(null),[h,I]=a.useState(null),[$,Ne]=a.useState(null),[le,it]=a.useState({x:0,y:0}),[G,K]=a.useState(1),[V,_]=a.useState(!1),[E,Ce]=a.useState(!1),[C,P]=a.useState(new Set),S=a.useRef(null),[Z,dt]=a.useState(null),[ie,Se]=a.useState(!1),[Dt,ct]=a.useState(null),[p,Me]=a.useState(null),[Ee,We]=a.useState(!1),[q,de]=a.useState(!1),[Xt,ut]=a.useState(null),[ne,$e]=a.useState(""),[O,ce]=a.useState(!1),[N,B]=a.useState(null),[Rt,Ut]=a.useState({x:0,y:0}),D=j==="blueprint"?Ot:j==="workspace"&&p?{"workspace-root":{title:p.title,subtitle:p.subtitle,nodes:p.nodes,edges:p.edges}}:Z||{},[m,J]=a.useState(1),[X,ue]=a.useState({x:0,y:0}),[xe,_e]=a.useState(!1),[pe,xt]=a.useState({x:0,y:0}),[R,Pe]=a.useState(!1),[y,pt]=a.useState({x:0,y:0}),[b,Le]=a.useState({x:0,y:0}),Fe=20,me=a.useCallback(async(e=!1)=>{try{Se(!0);const s=e?`${W}/api/v1/panorama/refresh`:`${W}/api/v1/panorama`,o=await fetch(s,{method:e?"POST":"GET"});if(!o.ok)throw new Error("Failed to fetch data");const r=await o.json();r.allData&&(dt(r.allData),ct(r.lastUpdated))}catch{}finally{Se(!1)}},[]),k=a.useCallback(async()=>{try{We(!0);const e=await fetch(`${W}/api/v1/panorama/workspace`);if(!e.ok)throw new Error("Failed to fetch workspace");const s=await e.json();Me(s)}catch{}finally{We(!1)}},[]),Ae=a.useCallback(async e=>{try{const s=await fetch(`${W}/api/v1/panorama/workspace`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok)throw new Error("Failed to save workspace");const o=await s.json();o.workspace&&Me(o.workspace)}catch{}},[]),Ie=a.useCallback(async e=>{if(!e.trim())return;const s={id:`node-${Date.now()}`,name:e.trim(),x:60+((p==null?void 0:p.nodes.length)||0)%4*210,y:60+Math.floor(((p==null?void 0:p.nodes.length)||0)/4)*100,status:"not_started",type:"feature"},o=[...(p==null?void 0:p.nodes)||[],s];await Ae({nodes:o}),$e("")},[p,Ae]),mt=a.useCallback(async e=>{try{if(!(await fetch(`${W}/api/v1/panorama/workspace/node/${e}`,{method:"DELETE"})).ok)throw new Error("Failed to delete node");await k()}catch{}},[k]);a.useCallback(async(e,s)=>{try{if(!(await fetch(`${W}/api/v1/panorama/workspace/node/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok)throw new Error("Failed to update node");await k()}catch{}},[k]);const ht=a.useCallback(async()=>{try{if(!(await fetch(`${W}/api/v1/panorama/workspace`,{method:"DELETE"})).ok)throw new Error("Failed to clear workspace");await k()}catch{}},[k]),Te=a.useCallback(async(e,s)=>{try{if(!(await fetch(`${W}/api/v1/panorama/workspace/edge`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({from:e,to:s})})).ok)throw new Error("Failed to add edge");await k()}catch{}},[k]),ft=a.useCallback(async(e,s)=>{try{if(!(await fetch(`${W}/api/v1/panorama/workspace/edge`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({from:e,to:s})})).ok)throw new Error("Failed to delete edge");await k()}catch{}},[k]),gt=a.useCallback(e=>{B(e)},[]),yt=a.useCallback(async e=>{N&&N!==e&&await Te(N,e),B(null)},[N,Te]),bt=a.useCallback(()=>{B(null)},[]),wt={blueprint:"root",runtime:"runtime-root",code:"code-root",dataflow:"dataflow-root",workspace:"workspace-root"},kt=a.useCallback(e=>{lt(e),te([wt[e]]),H(null),z(null),I(null),P(new Set),J(1),ue({x:0,y:0}),de(!1),ut(null),ce(!1),B(null),e==="workspace"?k():e!=="blueprint"&&!Z&&me()},[Z,me,k]),U=g[g.length-1],n=D[U],f=A||se,he=f!=null&&f.hasChildren?D[f.id]:null,ze=a.useCallback(e=>{if(!e||e.length===0)return{};const s=x+30,o=c+36,r=Math.min(4,Math.max(2,Math.ceil(Math.sqrt(e.length)))),l={};return e.forEach((i,d)=>{l[i.id]={x:60+d%r*s,y:60+Math.floor(d/r)*o}}),l},[]),Oe=a.useCallback(e=>{if(!e||e.length<2)return!1;for(let s=0;s<e.length;s++)for(let o=s+1;o<e.length;o++){const r=Math.abs(e[s].x-e[o].x),l=Math.abs(e[s].y-e[o].y);if(r<x&&l<c)return!0}return!1},[]),L=a.useCallback(e=>{const s=ve[`${U}-${e.id}`];return s||(n!=null&&n.nodes&&Oe(n.nodes)?ze(n.nodes)[e.id]||{x:e.x,y:e.y}:{x:e.x,y:e.y})},[ve,U,n,Oe,ze]),Be=e=>{D[e]&&(te([...g,e]),H(null),z(null),I(null),K(1),_(!1),P(new Set))},De=()=>{g.length>1&&(te(g.slice(0,-1)),H(null),z(null),I(null),K(1),_(!1),P(new Set))},Xe=e=>{te(g.slice(0,e+1)),H(null),z(null),I(null),K(1),_(!1),P(new Set)},vt=e=>{P(s=>{const o=new Set(s);return o.has(e)?o.delete(e):o.add(e),o})},Re=()=>{n!=null&&n.nodes&&P(new Set(n.nodes.map(e=>e.id)))},fe=()=>{P(new Set)},oe=(e,s)=>{C.size!==0&&je(o=>{const r={...o};return C.forEach(l=>{var d;const i=(d=n==null?void 0:n.nodes)==null?void 0:d.find(u=>u.id===l);if(i){const u=`${U}-${l}`,M=r[u]||{x:i.x,y:i.y};r[u]={x:M.x+e,y:M.y+s}}}),r})},Ue=(e,s)=>{if(!S.current)return{x:0,y:0};const o=S.current.createSVGPoint();o.x=e,o.y=s;const r=S.current.getScreenCTM();if(!r)return{x:0,y:0};const l=o.matrixTransform(r.inverse());return{x:(l.x-X.x)/m,y:(l.y-X.y)/m}},jt=a.useCallback(e=>{if(n!=null&&n.isLeaf)return;e.preventDefault();const s=e.deltaY>0?.9:1.1;J(o=>Math.min(3,Math.max(.3,o*s)))},[n==null?void 0:n.isLeaf]),Nt=e=>{if(e.target!==S.current&&e.target.tagName!=="rect")return;if(N){bt();return}V&&_(!1);const s=Ue(e.clientX,e.clientY);e.button===1||e.shiftKey?(_e(!0),xt({x:e.clientX-X.x,y:e.clientY-X.y})):e.button===0&&(Pe(!0),pt(s),Le(s))},Ct=a.useCallback(e=>{xe?ue({x:e.clientX-pe.x,y:e.clientY-pe.y}):R&&Le(Ue(e.clientX,e.clientY))},[xe,pe,R]),Ye=a.useCallback(()=>{if(R&&(n!=null&&n.nodes)){const e=Math.min(y.x,b.x),s=Math.max(y.x,b.x),o=Math.min(y.y,b.y),r=Math.max(y.y,b.y);if(Math.abs(b.x-y.x)>10||Math.abs(b.y-y.y)>10){const l=n.nodes.filter(i=>{const d=L(i),u=d.x+x/2,M=d.y+c/2;return u>=e&&u<=s&&M>=o&&M<=r});l.length>0&&P(new Set(l.map(i=>i.id)))}}Pe(!1),_e(!1)},[R,y,b,n,L]),St=()=>{J(1),ue({x:0,y:0})},He=()=>{Ce(e=>(e||_(!1),!e))};a.useEffect(()=>{const e=s=>{var o;if(((o=document.activeElement)==null?void 0:o.tagName)!=="INPUT"&&(s.key==="Escape"&&(C.size>0?fe():h?I(null):V?_(!1):E?Ce(!1):g.length>1&&De()),(s.key==="f"||s.key==="F")&&(h||He()),(s.ctrlKey||s.metaKey)&&s.key==="a"&&(s.preventDefault(),Re()),C.size>0&&!(n!=null&&n.isLeaf))){const r=s.shiftKey?Fe*3:Fe;s.key==="ArrowLeft"&&(s.preventDefault(),oe(-r,0)),s.key==="ArrowRight"&&(s.preventDefault(),oe(r,0)),s.key==="ArrowUp"&&(s.preventDefault(),oe(0,-r)),s.key==="ArrowDown"&&(s.preventDefault(),oe(0,r))}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[g,h,V,E,C,n]);const Mt=(e,s)=>{if(e.stopPropagation(),!S.current)return;const o=S.current.createSVGPoint();o.x=e.clientX,o.y=e.clientY;const r=S.current.getScreenCTM();if(!r)return;const l=o.matrixTransform(r.inverse()),i=L(s);Ne(s.id),it({x:l.x-i.x,y:l.y-i.y})},Ge=a.useCallback(e=>{if(!$||!S.current)return;const s=S.current.createSVGPoint();s.x=e.clientX,s.y=e.clientY;const o=S.current.getScreenCTM();if(!o)return;const r=s.matrixTransform(o.inverse());je(l=>({...l,[`${U}-${$}`]:{x:r.x-le.x,y:r.y-le.y}}))},[$,le,U]),ae=a.useCallback(()=>Ne(null),[]),Ke=()=>{if(!(n!=null&&n.workflowNodes))return 900;const e=Math.max(...n.workflowNodes.map(s=>s.x));return Math.max(e+200,900)},Et=e=>{if(!(e!=null&&e.nodes))return null;const{nodes:s,edges:o}=e,r=Tt,l=zt,i=12,d=3,u=i+d*(l+i),M=Math.ceil(s.length/d),T=s.map((w,F)=>({...w,lx:i+F%M*(r+i),ly:i+Math.floor(F/M)*(l+i)})),Q=Math.max(...T.map(w=>w.lx+r))+i;return t.jsx("div",{style:{width:"100%",height:u,overflowX:"auto",overflowY:"hidden",borderRadius:12,background:"rgba(30,41,59,0.5)"},children:t.jsxs("svg",{width:Math.max(Q,400),height:u,style:{display:"block"},children:[o==null?void 0:o.map((w,F)=>{const ge=T.find(be=>be.id===w.from),ye=T.find(be=>be.id===w.to);return!ge||!ye?null:t.jsx("line",{x1:ge.lx+r,y1:ge.ly+l/2,x2:ye.lx,y2:ye.ly+l/2,stroke:"#475569",strokeWidth:1.5},F)}),T.map(w=>{const F=v[w.type]||v.feature;return t.jsxs("g",{transform:`translate(${w.lx}, ${w.ly})`,children:[t.jsx("rect",{width:r,height:l,rx:8,fill:F.bg,stroke:F.border,strokeWidth:1}),t.jsx("rect",{width:3,height:l,rx:1.5,fill:F.fill}),t.jsx("circle",{cx:16,cy:l/2,r:4,fill:ee[w.status]}),t.jsx("text",{x:28,y:l/2+4,fill:"#e2e8f0",fontSize:11,fontWeight:500,children:w.name.length>12?w.name.slice(0,12)+"..":w.name})]},w.id)})]})})};return t.jsxs("div",{className:Y?"flex w-full h-full":E?"fixed inset-0 z-50 flex":"flex -m-8 rounded-none",style:{...Y?{}:{background:"linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #0f172a 100%)"},...!Y&&!E?{height:"calc(100vh - 64px)"}:{}},onMouseMove:Ge,onMouseUp:ae,onMouseLeave:ae,children:[E&&t.jsx("div",{className:`absolute left-0 top-0 bottom-0 z-20 transition-transform duration-300 ${V?"translate-x-0":"-translate-x-full"}`,children:t.jsxs("div",{className:"h-full w-64 bg-slate-900/95 backdrop-blur-xl border-r border-slate-700/50 flex flex-col",children:[t.jsxs("div",{className:"p-4 border-b border-slate-700/50 flex justify-between items-center",children:[t.jsx("span",{className:"text-sm font-semibold text-slate-200",children:"导航"}),t.jsx("button",{onClick:()=>_(!1),className:"p-1.5 rounded-lg text-slate-400 hover:text-slate-200 hover:bg-slate-800",children:t.jsx(re,{className:"w-4 h-4"})})]}),t.jsxs("div",{className:"p-4 border-b border-slate-700/50",children:[t.jsx("div",{className:"text-xs text-slate-500 mb-3",children:"当前位置"}),g.map((e,s)=>{var o;return t.jsxs("div",{onClick:()=>s<g.length-1&&Xe(s),style:{marginLeft:s*12},className:`py-1.5 px-2 rounded-lg mb-1 text-sm cursor-pointer transition-colors ${s===g.length-1?"bg-blue-500/20 text-blue-300":"text-slate-400 hover:text-slate-200 hover:bg-slate-800"}`,children:[s>0&&t.jsx("span",{className:"text-slate-600 mr-1",children:"└"}),(o=D[e])==null?void 0:o.title]},e)})]}),(n==null?void 0:n.milestones)&&n.milestones.length>0&&t.jsxs("div",{className:"p-4 border-b border-slate-700/50",children:[t.jsx("div",{className:"text-xs text-slate-500 mb-3",children:"里程碑"}),n.milestones.map((e,s)=>t.jsxs("div",{className:`p-2 rounded-lg mb-2 ${s===0?"bg-amber-500/10 border border-amber-500/30":"bg-slate-800/50"}`,children:[t.jsx("span",{className:`text-xs font-semibold ${s===0?"text-amber-400":"text-slate-400"}`,children:e.date}),t.jsx("span",{className:`text-xs ml-2 ${s===0?"text-amber-300":"text-slate-500"}`,children:e.label})]},s))]}),t.jsxs("div",{className:"p-4 mt-auto",children:[t.jsx("div",{className:"text-xs text-slate-500 mb-3",children:"图例"}),t.jsx("div",{className:"space-y-2",children:["core","product","dashboard","feature","workflow"].map(e=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded",style:{background:v[e].fill}}),t.jsx("span",{className:"text-xs text-slate-400",children:At[e]})]},e))}),t.jsx("div",{className:"mt-4 pt-4 border-t border-slate-700/50",children:t.jsx("div",{className:"flex gap-3",children:[["completed","完成"],["in_progress","进行"],["not_started","待做"]].map(([e,s])=>t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("div",{className:"w-2 h-2 rounded-full",style:{background:ee[e]}}),t.jsx("span",{className:"text-xs text-slate-500",children:s})]},e))})})]})]})}),E&&!V&&t.jsx("button",{onClick:()=>_(!0),className:"absolute left-4 top-4 z-10 p-2.5 rounded-xl bg-slate-800/80 backdrop-blur border border-slate-700/50 text-slate-300 hover:text-white hover:bg-slate-700/80 transition-all shadow-lg",children:t.jsx(Wt,{className:"w-5 h-5"})}),t.jsxs("div",{className:"flex-1 flex flex-col",children:[t.jsxs("div",{className:`h-14 flex items-center gap-3 ${Y?"px-4":"px-16"}`,children:[t.jsx("div",{className:"flex items-center gap-1 p-1 bg-slate-800/50 border border-slate-700/50 rounded-xl",children:Object.keys(ke).map(e=>t.jsx("button",{onClick:()=>kt(e),className:`flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg transition-all ${j===e?"bg-blue-500/20 text-blue-300 border border-blue-500/30":"text-slate-400 hover:text-slate-200 hover:bg-slate-700/50"}`,title:ke[e].desc,children:ke[e].name},e))}),t.jsx("div",{className:"w-px h-6 bg-slate-700/50"}),g.length>1&&t.jsxs("button",{onClick:De,className:"flex items-center gap-1 px-3 py-1.5 text-sm text-slate-300 bg-slate-800/50 border border-slate-700/50 rounded-lg hover:bg-slate-700/50 transition-colors",children:[t.jsx($t,{className:"w-4 h-4"}),"返回"]}),t.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[g.map((e,s)=>{var o;return t.jsxs(_t.Fragment,{children:[s>0&&t.jsx(Pt,{className:"w-4 h-4 text-slate-600"}),t.jsx("button",{onClick:()=>s<g.length-1&&Xe(s),className:`px-2 py-1 rounded ${s===g.length-1?"bg-blue-500/20 text-blue-300 font-medium":"text-slate-500 hover:text-slate-300"}`,children:(o=D[e])==null?void 0:o.title})]},e)}),(n==null?void 0:n.version)&&t.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs bg-purple-500/20 text-purple-300 rounded-full border border-purple-500/30",children:n.version})]}),t.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[j==="workspace"&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-slate-800/50 border border-slate-700/50 rounded-lg",children:[t.jsx("input",{type:"text",value:ne,onChange:e=>$e(e.target.value),onKeyDown:e=>e.key==="Enter"&&Ie(ne),placeholder:"新节点名称...",className:"w-32 bg-transparent text-xs text-slate-200 placeholder:text-slate-500 focus:outline-none"}),t.jsx("button",{onClick:()=>Ie(ne),disabled:!ne.trim(),className:"px-2 py-0.5 text-xs bg-blue-500/20 text-blue-300 rounded hover:bg-blue-500/30 disabled:opacity-50 disabled:cursor-not-allowed",children:"添加"})]}),t.jsx("button",{onClick:()=>{de(!q),ce(!1),B(null)},className:`px-3 py-1.5 text-xs rounded-lg transition-all ${q?"bg-amber-500/20 text-amber-300 border border-amber-500/30":"text-slate-400 bg-slate-800/50 border border-slate-700/50 hover:text-slate-200"}`,children:q?"退出编辑":"编辑模式"}),t.jsx("button",{onClick:()=>{ce(!O),de(!1),B(null)},className:`px-3 py-1.5 text-xs rounded-lg transition-all ${O?"bg-emerald-500/20 text-emerald-300 border border-emerald-500/30":"text-slate-400 bg-slate-800/50 border border-slate-700/50 hover:text-slate-200"}`,children:O?N?"选择目标...":"选择起点...":"连线模式"}),(p==null?void 0:p.nodes)&&p.nodes.length>0&&t.jsx("button",{onClick:()=>{confirm("确定清空工作区？")&&ht()},className:"px-2 py-1.5 text-xs text-red-400 bg-slate-800/50 border border-slate-700/50 rounded-lg hover:bg-red-500/10 hover:border-red-500/30",children:"清空"}),t.jsx("button",{onClick:k,disabled:Ee,className:"p-1.5 text-slate-400 bg-slate-800/50 border border-slate-700/50 rounded-lg hover:text-slate-200 disabled:opacity-50",title:"刷新工作区",children:t.jsx(ot,{className:`w-3.5 h-3.5 ${Ee?"animate-spin":""}`})})]}),j!=="blueprint"&&j!=="workspace"&&t.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-slate-800/50 border border-slate-700/50 rounded-lg",children:[ie?t.jsx(Lt,{className:"w-3.5 h-3.5 text-blue-400 animate-spin"}):t.jsx("div",{className:`w-2 h-2 rounded-full ${Z?"bg-emerald-400":"bg-amber-400"}`}),t.jsx("span",{className:"text-xs text-slate-400",children:Z?"实时":"未加载"}),t.jsx("button",{onClick:()=>me(!0),disabled:ie,className:"p-1 text-slate-400 hover:text-slate-200 disabled:opacity-50",title:"刷新数据",children:t.jsx(ot,{className:`w-3.5 h-3.5 ${ie?"animate-spin":""}`})})]}),!(n!=null&&n.isLeaf)&&(n==null?void 0:n.nodes)&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-slate-800/50 border border-slate-700/50 rounded-lg",children:[t.jsx("button",{onClick:()=>J(e=>Math.max(.3,e*.8)),className:"p-1 text-slate-400 hover:text-slate-200",children:t.jsx(at,{className:"w-4 h-4"})}),t.jsxs("span",{className:"text-xs text-slate-400 w-12 text-center",children:[Math.round(m*100),"%"]}),t.jsx("button",{onClick:()=>J(e=>Math.min(3,e*1.25)),className:"p-1 text-slate-400 hover:text-slate-200",children:t.jsx(rt,{className:"w-4 h-4"})}),t.jsx("button",{onClick:St,className:"p-1 text-slate-400 hover:text-slate-200 ml-1",title:"重置视图",children:t.jsx(re,{className:"w-3 h-3"})})]}),t.jsxs("button",{onClick:Re,className:"px-3 py-1.5 text-xs text-slate-300 bg-slate-800/50 border border-slate-700/50 rounded-lg hover:bg-slate-700/50 transition-colors",children:["全选 (",n.nodes.length,")"]}),C.size>0&&t.jsxs("span",{className:"px-2 py-1 text-xs bg-blue-500/20 text-blue-300 rounded-lg border border-blue-500/30",children:["已选 ",C.size]}),t.jsx("div",{className:"w-px h-6 bg-slate-700/50 mx-1"})]}),!Y&&t.jsxs("button",{onClick:He,className:"flex items-center gap-1.5 px-3 py-1.5 text-xs text-slate-300 bg-slate-800/50 border border-slate-700/50 rounded-lg hover:bg-slate-700/50 transition-colors",title:E?"退出全屏 (Esc)":"进入全屏 (F)",children:[E?t.jsx(re,{className:"w-3.5 h-3.5"}):t.jsx(Ft,{className:"w-3.5 h-3.5"}),E?"退出":"全屏"]})]})]}),t.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:n!=null&&n.isLeaf?t.jsx("div",{className:"h-full overflow-auto p-6",children:t.jsxs("div",{className:"max-w-5xl mx-auto",children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h2",{className:"text-xl font-semibold text-white mb-1",children:n.title}),t.jsx("p",{className:"text-slate-400",children:n.subtitle}),n.scriptPath&&t.jsx("code",{className:"inline-block mt-2 px-3 py-1 text-xs bg-slate-800/80 text-slate-300 rounded-lg font-mono border border-slate-700/50",children:n.scriptPath})]}),t.jsxs("div",{className:"mb-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("span",{className:"text-sm text-slate-400",children:"执行流程 (点击节点查看详情)"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>K(e=>Math.max(.5,e-.1)),className:"p-1.5 rounded-lg bg-slate-800/80 text-slate-400 hover:text-slate-200 border border-slate-700/50",children:t.jsx(at,{className:"w-4 h-4"})}),t.jsxs("span",{className:"text-xs text-slate-500 w-12 text-center",children:[Math.round(G*100),"%"]}),t.jsx("button",{onClick:()=>K(e=>Math.min(1.5,e+.1)),className:"p-1.5 rounded-lg bg-slate-800/80 text-slate-400 hover:text-slate-200 border border-slate-700/50",children:t.jsx(rt,{className:"w-4 h-4"})})]})]}),t.jsx("div",{className:"overflow-x-auto bg-slate-900/50 rounded-xl p-4 border border-slate-700/30 cursor-grab active:cursor-grabbing",style:{scrollbarWidth:"thin",scrollbarColor:"#475569 transparent"},onMouseDown:e=>{const s=e.currentTarget,o=e.pageX-s.offsetLeft,r=s.scrollLeft,l=d=>{s.scrollLeft=r-(d.pageX-s.offsetLeft-o)},i=()=>{document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",i)};document.addEventListener("mousemove",l),document.addEventListener("mouseup",i)},children:t.jsx("svg",{width:Ke()*G,height:260*G,style:{display:"block",minWidth:Ke()*G},children:t.jsxs("g",{transform:`scale(${G})`,children:[(Ve=n.workflowEdges)==null?void 0:Ve.map((e,s)=>{var l,i;const o=(l=n.workflowNodes)==null?void 0:l.find(d=>d.id===e.from),r=(i=n.workflowNodes)==null?void 0:i.find(d=>d.id===e.to);return!o||!r?null:t.jsx("line",{x1:o.x+150,y1:o.y+50,x2:r.x,y2:r.y+50,stroke:"#475569",strokeWidth:2},s)}),(Ze=n.workflowNodes)==null?void 0:Ze.map(e=>{var r,l,i,d;const s=v[e.type]||v.action,o=(h==null?void 0:h.id)===e.id;return t.jsxs("g",{transform:`translate(${e.x}, ${e.y})`,onClick:()=>I(o?null:e),style:{cursor:"pointer"},children:[o&&t.jsx("rect",{x:-4,y:-4,width:158,height:108,rx:12,fill:"none",stroke:"#fbbf24",strokeWidth:3}),t.jsx("rect",{width:150,height:100,rx:10,fill:s.bg,stroke:s.border,strokeWidth:o?2:1.5}),t.jsx("rect",{width:5,height:100,rx:2.5,fill:s.fill}),t.jsx("text",{x:18,y:28,fill:"#f1f5f9",fontSize:13,fontWeight:600,children:e.name}),t.jsx("text",{x:18,y:48,fill:"#94a3b8",fontSize:11,children:we[e.type]}),t.jsx("text",{x:18,y:70,fill:"#cbd5e1",fontSize:10,children:(l=(r=e.logic)==null?void 0:r.split(`
`)[0])==null?void 0:l.slice(0,18)}),t.jsx("text",{x:18,y:86,fill:"#64748b",fontSize:9,children:(d=(i=e.logic)==null?void 0:i.split(`
`)[1])==null?void 0:d.slice(0,20)})]},e.id)})]})})}),t.jsx("div",{className:"text-xs text-slate-600 mt-2 text-center",children:"← 拖拽或滚动查看更多 →"}),t.jsx("div",{className:"flex gap-6 mt-3",children:["trigger","action","logic","output"].map(e=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded",style:{background:v[e].fill}}),t.jsx("span",{className:"text-xs text-slate-400",children:we[e]})]},e))})]}),h&&t.jsxs("div",{className:"bg-slate-900/50 rounded-xl p-6 relative border border-slate-700/30",children:[t.jsx("button",{onClick:()=>I(null),className:"absolute top-4 right-4 p-1.5 rounded-lg bg-slate-800 text-slate-400 hover:text-slate-200",children:t.jsx(re,{className:"w-4 h-4"})}),t.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[t.jsx("div",{className:"w-4 h-4 rounded",style:{background:(qe=v[h.type])==null?void 0:qe.fill}}),t.jsx("h3",{className:"text-lg font-semibold text-white",children:h.name}),t.jsx("span",{className:"px-2 py-1 text-xs rounded-lg border",style:{background:(Je=v[h.type])==null?void 0:Je.bg,borderColor:(Qe=v[h.type])==null?void 0:Qe.border,color:(et=v[h.type])==null?void 0:et.fill},children:we[h.type]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[t.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-slate-700/30",children:[t.jsx("div",{className:"text-sm font-medium text-blue-400 mb-2",children:"输入"}),t.jsx("div",{className:"text-slate-200",children:h.input||"无"})]}),t.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-slate-700/30",children:[t.jsx("div",{className:"text-sm font-medium text-emerald-400 mb-2",children:"输出"}),t.jsx("div",{className:"text-slate-200",children:h.output||"无"})]})]}),t.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-slate-700/30",children:[t.jsx("div",{className:"text-sm font-medium text-amber-400 mb-3",children:"这一步做什么"}),t.jsx("div",{className:"text-slate-200 whitespace-pre-wrap leading-relaxed",children:h.logic})]})]})]})}):t.jsxs("svg",{ref:S,width:"100%",height:"100%",style:{cursor:xe?"grabbing":R?"crosshair":$?"grabbing":"default"},onWheel:jt,onMouseDown:Nt,onMouseMove:e=>{Ct(e),Ge(e)},onMouseUp:()=>{Ye(),ae()},onMouseLeave:()=>{Ye(),ae()},children:[t.jsx("defs",{children:t.jsx("pattern",{id:"grid",width:30*m,height:30*m,patternUnits:"userSpaceOnUse",children:t.jsx("path",{d:`M ${30*m} 0 L 0 0 0 ${30*m}`,fill:"none",stroke:"rgba(71,85,105,0.15)",strokeWidth:"1"})})}),t.jsx("rect",{width:"100%",height:"100%",fill:"url(#grid)"}),t.jsxs("g",{transform:`translate(${X.x}, ${X.y}) scale(${m})`,children:[j==="workspace"&&(!(n!=null&&n.nodes)||n.nodes.length===0)&&t.jsxs("g",{transform:"translate(200, 150)",children:[t.jsx("rect",{x:-150,y:-80,width:300,height:160,rx:16,fill:"rgba(30,41,59,0.8)",stroke:"rgba(71,85,105,0.5)",strokeWidth:1,strokeDasharray:"4 2"}),t.jsx("text",{x:0,y:-20,fill:"#94a3b8",fontSize:14,textAnchor:"middle",children:"工作区是空的"}),t.jsx("text",{x:0,y:10,fill:"#64748b",fontSize:12,textAnchor:"middle",children:"在上方输入名称添加节点"}),t.jsx("text",{x:0,y:40,fill:"#64748b",fontSize:12,textAnchor:"middle",children:"或等待 Claude 推送架构方案"})]}),(tt=n==null?void 0:n.edges)==null?void 0:tt.map((e,s)=>{var M,T;const o=(M=n.nodes)==null?void 0:M.find(Q=>Q.id===e.from),r=(T=n.nodes)==null?void 0:T.find(Q=>Q.id===e.to);if(!o||!r)return null;const l=L(o),i=L(r),d=`M ${l.x+x} ${l.y+c/2} C ${(l.x+x+i.x)/2} ${l.y+c/2}, ${(l.x+x+i.x)/2} ${i.y+c/2}, ${i.x} ${i.y+c/2}`,u=j==="workspace"&&q;return t.jsxs("g",{children:[u&&t.jsx("path",{d,fill:"none",stroke:"transparent",strokeWidth:12,style:{cursor:"pointer"},onClick:()=>{confirm(`删除连线 ${o.name} → ${r.name}?`)&&ft(e.from,e.to)}}),t.jsx("path",{d,fill:"none",stroke:u?"#ef4444":"#475569",strokeWidth:2,pointerEvents:"none"})]},s)}),j==="workspace"&&O&&N&&A&&N!==A.id&&(()=>{var r;const e=(r=n==null?void 0:n.nodes)==null?void 0:r.find(l=>l.id===N);if(!e)return null;const s=L(e),o=L(A);return t.jsx("path",{d:`M ${s.x+x} ${s.y+c/2} C ${(s.x+x+o.x)/2} ${s.y+c/2}, ${(s.x+x+o.x)/2} ${o.y+c/2}, ${o.x} ${o.y+c/2}`,fill:"none",stroke:"#10b981",strokeWidth:2,strokeDasharray:"6 3",pointerEvents:"none"})})(),(st=n==null?void 0:n.nodes)==null?void 0:st.map(e=>{const s=L(e),o=v[e.type]||v.feature,r=(A==null?void 0:A.id)===e.id,l=(se==null?void 0:se.id)===e.id,i=C.has(e.id),d=e.hasChildren&&D[e.id];return t.jsxs("g",{transform:`translate(${s.x}, ${s.y}) ${r&&!$?"scale(1.04)":""}`,style:{transition:$?"none":"transform 0.15s",transformOrigin:`${x/2}px ${c/2}px`},onMouseDown:u=>Mt(u,e),onMouseEnter:()=>!$&&z(e),onMouseLeave:()=>z(null),onClick:u=>{if(u.stopPropagation(),j==="workspace"&&O){N?yt(e.id):gt(e.id);return}u.ctrlKey||u.metaKey?vt(e.id):(H(l?null:e),C.size>0&&fe())},onDoubleClick:()=>d&&Be(e.id),children:[j==="workspace"&&O&&N===e.id&&t.jsxs(t.Fragment,{children:[t.jsx("rect",{x:-8,y:-8,width:x+16,height:c+16,rx:16,fill:"none",stroke:"rgba(16,185,129,0.3)",strokeWidth:1}),t.jsx("rect",{x:-4,y:-4,width:x+8,height:c+8,rx:12,fill:"none",stroke:"#10b981",strokeWidth:2})]}),i&&t.jsxs(t.Fragment,{children:[t.jsx("rect",{x:-8,y:-8,width:x+16,height:c+16,rx:16,fill:"none",stroke:"rgba(96,165,250,0.3)",strokeWidth:1}),t.jsx("rect",{x:-4,y:-4,width:x+8,height:c+8,rx:12,fill:"none",stroke:"rgba(96,165,250,0.7)",strokeWidth:1.5})]}),(r||l)&&!i&&N!==e.id&&t.jsx("rect",{x:-4,y:-4,width:x+8,height:c+8,rx:12,fill:"none",stroke:l?"#fbbf24":"#60a5fa",strokeWidth:2}),t.jsx("rect",{width:x,height:c,rx:10,fill:i?"rgba(96,165,250,0.08)":e.current?"rgba(96,165,250,0.15)":o.bg,stroke:i?"rgba(96,165,250,0.5)":o.border,strokeWidth:i?1.5:e.current?2:1.5,style:{cursor:$===e.id?"grabbing":"grab"}}),t.jsx("rect",{width:4,height:c,rx:2,fill:o.fill}),t.jsx("circle",{cx:18,cy:c/2,r:5,fill:ee[e.status]}),t.jsxs("foreignObject",{x:28,y:e.desc?6:12,width:x-48,height:c-12,children:[t.jsx("div",{style:{fontSize:12,fontWeight:600,color:"#f1f5f9",lineHeight:1.2,overflow:"hidden",textOverflow:"ellipsis",display:"-webkit-box",WebkitLineClamp:e.desc?1:2,WebkitBoxOrient:"vertical",wordBreak:"break-all"},children:e.name}),e.desc&&t.jsx("div",{style:{fontSize:10,color:"#94a3b8",marginTop:2,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.desc})]}),d&&t.jsx("text",{x:x-14,y:c-12,fill:"#64748b",fontSize:14,children:"→"}),e.current&&t.jsxs("g",{transform:`translate(${x-32}, ${c-16})`,children:[t.jsx("rect",{width:26,height:12,rx:3,fill:"#60a5fa"}),t.jsx("text",{x:13,y:9,fill:"#fff",fontSize:8,textAnchor:"middle",fontWeight:500,children:"NOW"})]}),j==="workspace"&&q&&t.jsxs("g",{transform:`translate(${x-20}, 4)`,onClick:u=>{u.stopPropagation(),confirm(`删除节点 "${e.name}"?`)&&mt(e.id)},style:{cursor:"pointer"},children:[t.jsx("circle",{r:8,fill:"rgba(239, 68, 68, 0.2)",stroke:"rgba(239, 68, 68, 0.5)",strokeWidth:1}),t.jsx("text",{x:0,y:4,fill:"#ef4444",fontSize:12,textAnchor:"middle",fontWeight:"bold",children:"×"})]})]},e.id)}),R&&t.jsxs("g",{pointerEvents:"none",children:[t.jsx("rect",{x:Math.min(y.x,b.x)-2/m,y:Math.min(y.y,b.y)-2/m,width:Math.abs(b.x-y.x)+4/m,height:Math.abs(b.y-y.y)+4/m,fill:"none",stroke:"rgba(96, 165, 250, 0.2)",strokeWidth:4/m,rx:6/m}),t.jsx("rect",{x:Math.min(y.x,b.x),y:Math.min(y.y,b.y),width:Math.abs(b.x-y.x),height:Math.abs(b.y-y.y),fill:"rgba(96, 165, 250, 0.06)",stroke:"rgba(96, 165, 250, 0.5)",strokeWidth:1.5/m,strokeDasharray:`${4/m} ${2/m}`,rx:4/m})]})]})]})}),!(n!=null&&n.isLeaf)&&t.jsx("div",{className:`transition-all duration-300 border-t border-slate-700/50 bg-slate-900/80 backdrop-blur ${he?"h-80":"h-14"}`,children:he&&f?t.jsxs("div",{className:"h-full p-5 flex gap-6",children:[t.jsxs("div",{className:"w-48 flex-shrink-0",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx("div",{className:"w-3 h-3 rounded",style:{background:(nt=v[f.type])==null?void 0:nt.fill}}),t.jsx("span",{className:"font-semibold text-white",children:f.name})]}),f.desc&&t.jsx("p",{className:"text-sm text-slate-400 mb-3",children:f.desc}),t.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[t.jsx("span",{className:"px-2 py-1 text-xs rounded-lg",style:{background:ee[f.status]+"20",color:ee[f.status]},children:f.status==="completed"?"已完成":f.status==="in_progress"?"进行中":"未开始"}),f.version&&t.jsx("span",{className:"px-2 py-1 text-xs bg-purple-500/20 text-purple-300 rounded-lg border border-purple-500/30",children:f.version})]}),t.jsx("button",{onClick:()=>Be(f.id),className:"w-full py-2.5 bg-blue-500 hover:bg-blue-600 text-white text-sm font-medium rounded-xl transition-colors",children:"进入 →"})]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-xs text-slate-500 mb-2",children:"下一层预览"}),t.jsx("div",{className:"h-[calc(100%-24px)]",children:Et(he)})]})]}):t.jsx("div",{className:"h-full flex items-center justify-center gap-4 text-slate-500 text-sm",children:C.size>0?t.jsxs(t.Fragment,{children:[t.jsxs("span",{className:"text-blue-400",children:["已选 ",C.size," 个节点"]}),t.jsx("span",{children:"方向键移动 · Shift加速 · Esc取消"}),t.jsx("button",{onClick:fe,className:"px-2 py-1 text-xs bg-slate-700 hover:bg-slate-600 text-slate-300 rounded",children:"清除选择"})]}):t.jsx("span",{children:"拖拽框选 · ⌘/Ctrl+点击多选 · 滚轮缩放 · Shift+拖拽平移 · 双击进入"})})})]})]})}export{Gt as default};
