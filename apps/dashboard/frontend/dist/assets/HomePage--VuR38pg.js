import{j as a,d as R,a5 as b,a as N,R as C,a9 as k,x as P,m as y,r as p,ar as S,ay as T,az as $,aA as q,U as D,aB as A,a3 as M,aC as U}from"./index-Cs8Vqz41.js";import{v as x}from"./vps-monitor.api-Dxkyqz6U.js";import{c as _}from"./claude-stats.api-CuQV9AQh.js";import{g as E}from"./dev-tracker.api-CFjw6oWP.js";import{n as W}from"./n8n-workflows.api-DteZgY7-.js";import{a as I}from"./index-B9ygI19o.js";import{f as H}from"./qa-report.api-wEreUZo6.js";import"./client-DSYFshK-.js";import"./client-2fFfTFJr.js";function O(){const e=new Date().getHours();return e<6?"凌晨好":e<9?"早上好":e<12?"上午好":e<14?"中午好":e<18?"下午好":e<22?"晚上好":"夜深了"}function B({systemStatus:e,loading:t=!1,onRefresh:n}){const s=O();return a.jsx("div",{className:"bg-white/5 rounded-xl p-6 border border-white/10",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"flex items-center gap-4",children:a.jsx("div",{className:"text-3xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent",children:s})}),a.jsxs("div",{className:"flex items-center gap-4",children:[e&&a.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[e.vpsOnline?a.jsx(R,{className:"w-4 h-4 text-emerald-400"}):a.jsx(b,{className:"w-4 h-4 text-red-400"}),a.jsx("span",{className:"text-white/60",children:"VPS"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(N,{className:"w-4 h-4 text-blue-400"}),a.jsxs("span",{className:"text-white/60",children:[e.containersRunning,"/",e.containersTotal]})]})]}),n&&a.jsx("button",{onClick:n,disabled:t,className:"p-2 hover:bg-white/10 rounded-lg transition-colors disabled:opacity-50",title:"刷新数据",children:a.jsx(C,{className:`w-5 h-5 text-white/50 ${t?"animate-spin":""}`})})]})]})})}const L={default:"text-white/70",success:"text-emerald-400",warning:"text-amber-400",error:"text-red-400"};function u({id:e,title:t,icon:n,iconColor:s="text-blue-400",path:d,metrics:l=[],loading:c=!1,error:o=null,onClick:r}){const i=k(),m=()=>{r?r():i(d)};return a.jsxs("button",{onClick:m,className:`w-full bg-white/5 rounded-xl p-5 border border-white/10
                 hover:border-white/20 hover:bg-white/10 hover:scale-[1.02]
                 transition-all duration-200 text-left group`,children:[a.jsxs("div",{className:"flex items-start justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:`p-2 rounded-lg bg-white/10 ${s}`,children:a.jsx(n,{className:"w-5 h-5"})}),a.jsx("h3",{className:"font-semibold text-base",children:t})]}),a.jsx(P,{className:"w-5 h-5 text-white/30 group-hover:text-white/60 transition-colors"})]}),a.jsx("div",{className:"space-y-2 min-h-[72px]",children:c?a.jsx("div",{className:"flex items-center justify-center h-[72px]",children:a.jsx(y,{className:"w-5 h-5 text-white/30 animate-spin"})}):o?a.jsxs("div",{className:"flex items-center gap-2 text-red-400 text-sm",children:[a.jsx(b,{className:"w-4 h-4"}),a.jsx("span",{className:"truncate",children:o})]}):l.length>0?l.map((h,j)=>a.jsxs("div",{className:"flex items-center justify-between text-sm",children:[a.jsx("span",{className:"text-white/40",children:h.label}),a.jsx("span",{className:L[h.color||"default"],children:h.value})]},j)):a.jsx("div",{className:"flex items-center justify-center h-[72px] text-white/30 text-sm",children:"暂无数据"})})]})}const F="";async function v(e){const t=await fetch(`${F}${e}`);if(!t.ok)throw new Error(`API error: ${t.status}`);return t.json()}const V={getOverview:e=>{const t=new URLSearchParams;e!=null&&e.status&&t.append("status",e.status),e!=null&&e.limit&&t.append("limit",e.limit.toString()),e!=null&&e.workflowId&&t.append("workflowId",e.workflowId);const n=t.toString(),s=`/api/v1/runs${n?`?${n}`:""}`;return v(s)},getRunDetails:e=>v(`/api/v1/runs/${e}`),getStats:e=>{const t=e?`/api/v1/runs/stats?workflowId=${e}`:"/api/v1/runs/stats";return v(t)}},G=I.create({baseURL:"/api/github",headers:{"Content-Type":"application/json"}});async function Q(){return(await G.get("/panorama")).data}function g(e,t,n){return Promise.race([e,new Promise((s,d)=>setTimeout(()=>d(new Error(`Timeout after ${t}ms`)),t))]).catch(s=>{throw s})}const f={data:null,error:null,loading:!0},w={vps:{...f},claude:{...f},engine:{...f},n8n:{...f},cecilia:{...f},panorama:{...f},qa:{...f}};function z(e,t){const n=t;return{cpuUsage:Math.round(e.cpu.usage),memoryUsage:Math.round(e.memory.usagePercent),containersRunning:n.running??n.runningContainers??0,containersTotal:n.total??n.totalContainers??0}}function J(e){const t=e.daily[0],n=e.overview.total_input_tokens+e.overview.total_output_tokens,s=e.overview.by_model.reduce((l,c)=>l+c.cache_read_tokens,0),d=n>0?Math.round(s/n*100):0;return{todayCost:(t==null?void 0:t.total_cost)||0,totalSessions:e.overview.total_sessions,cacheHitRate:d}}function K(e){const t=e.filter(s=>s.steps.items.find(l=>l.status==="in_progress")!==void 0).length,n=e.filter(s=>s.steps.items.every(l=>l.status==="done"||l.status==="skipped")&&s.steps.items.length>0).length;return{totalTasks:e.length,inProgressTasks:t,completedTasks:n}}function X(e){return{totalWorkflows:e.workflows.totalWorkflows,activeWorkflows:e.workflows.activeWorkflows,successRate:Math.round(e.recentExecutions.successRate)}}function Y(e){return{totalRuns:e.totalRuns,runningRuns:e.runningRuns,successRate:Math.round(e.overallSuccessRate)}}function Z(e){const t=e.reduce((d,l)=>{const c=l.recentPrs.filter(o=>o.state==="open").length;return d+c},0),n=e.reduce((d,l)=>d+l.recentPrs.length,0);let s="low";return n>=10?s="high":n>=5&&(s="medium"),{totalRepos:e.length,openPrs:t,recentActivity:s}}function ee(e){return e.length===0?{overallScore:0,totalRepos:0}:{overallScore:Math.round(e.reduce((n,s)=>n+s.summary.overall,0)/e.length),totalRepos:e.length}}function ae(e=3e4){const[t,n]=p.useState(w),[s,d]=p.useState(!1),l=p.useCallback(async()=>{d(!0);const c=1e4,o=await Promise.allSettled([g(Promise.all([x.getStats(),x.getContainers()]),c),g(_.getStats(7),c),g(E(),c),g(W.getOverview(),c),g(V.getOverview({limit:50}),c),g(Q(),c),g(H(),c)]),r={...w};if(o[0].status==="fulfilled"){const[i,m]=o[0].value;r.vps={data:z(i,m),error:null,loading:!1}}else r.vps={data:null,error:"加载失败",loading:!1};if(o[1].status==="fulfilled"?r.claude={data:J(o[1].value),error:null,loading:!1}:r.claude={data:null,error:"加载失败",loading:!1},o[2].status==="fulfilled"){const i=o[2].value;i.success&&i.data?r.engine={data:K(i.data),error:null,loading:!1}:r.engine={data:null,error:i.error||"加载失败",loading:!1}}else r.engine={data:null,error:"加载失败",loading:!1};if(o[3].status==="fulfilled"?r.n8n={data:X(o[3].value),error:null,loading:!1}:r.n8n={data:null,error:"加载失败",loading:!1},o[4].status==="fulfilled"?r.cecilia={data:Y(o[4].value),error:null,loading:!1}:r.cecilia={data:null,error:"加载失败",loading:!1},o[5].status==="fulfilled"){const i=o[5].value;i.success&&i.data?r.panorama={data:Z(i.data),error:null,loading:!1}:r.panorama={data:null,error:i.error||"加载失败",loading:!1}}else r.panorama={data:null,error:"加载失败",loading:!1};if(o[6].status==="fulfilled"){const i=o[6].value;i.success&&i.data?r.qa={data:ee(i.data),error:null,loading:!1}:r.qa={data:null,error:i.error||"加载失败",loading:!1}}else r.qa={data:null,error:"加载失败",loading:!1};n(r),d(!1)},[]);return p.useEffect(()=>{l()},[l]),p.useEffect(()=>{if(e<=0)return;const c=setInterval(l,e);return()=>clearInterval(c)},[e,l]),{data:t,isRefreshing:s,refresh:l}}const te={high:"高",medium:"中",low:"低"},ne={high:"success",medium:"warning",low:"default"};function fe(){const{data:e,isRefreshing:t,refresh:n}=ae(3e4),s=e.vps.data?{vpsOnline:!0,containersRunning:e.vps.data.containersRunning,containersTotal:e.vps.data.containersTotal}:null,d=e.vps.data?[{label:"CPU",value:`${e.vps.data.cpuUsage}%`,color:e.vps.data.cpuUsage>80?"error":e.vps.data.cpuUsage>50?"warning":"success"},{label:"内存",value:`${e.vps.data.memoryUsage}%`,color:e.vps.data.memoryUsage>80?"error":e.vps.data.memoryUsage>50?"warning":"success"},{label:"容器",value:`${e.vps.data.containersRunning}/${e.vps.data.containersTotal}`}]:[],l=e.claude.data?[{label:"今日费用",value:`$${e.claude.data.todayCost.toFixed(2)}`},{label:"会话数",value:e.claude.data.totalSessions},{label:"缓存命中",value:`${e.claude.data.cacheHitRate}%`,color:e.claude.data.cacheHitRate>80?"success":"warning"}]:[],c=e.engine.data?[{label:"总任务",value:e.engine.data.totalTasks},{label:"进行中",value:e.engine.data.inProgressTasks,color:e.engine.data.inProgressTasks>0?"warning":"default"},{label:"已完成",value:e.engine.data.completedTasks,color:"success"}]:[],o=e.n8n.data?[{label:"工作流",value:e.n8n.data.totalWorkflows},{label:"运行中",value:e.n8n.data.activeWorkflows,color:e.n8n.data.activeWorkflows>0?"success":"default"},{label:"成功率",value:`${e.n8n.data.successRate}%`,color:e.n8n.data.successRate>=90?"success":e.n8n.data.successRate>=70?"warning":"error"}]:[],r=e.cecilia.data?[{label:"总执行",value:e.cecilia.data.totalRuns},{label:"运行中",value:e.cecilia.data.runningRuns,color:e.cecilia.data.runningRuns>0?"warning":"default"},{label:"成功率",value:`${e.cecilia.data.successRate}%`,color:e.cecilia.data.successRate>=90?"success":e.cecilia.data.successRate>=70?"warning":"error"}]:[],i=e.panorama.data?[{label:"仓库数",value:e.panorama.data.totalRepos},{label:"待处理 PR",value:e.panorama.data.openPrs,color:e.panorama.data.openPrs>5?"warning":"default"},{label:"活跃度",value:te[e.panorama.data.recentActivity],color:ne[e.panorama.data.recentActivity]}]:[],m=e.qa.data?[{label:"综合分数",value:e.qa.data.overallScore,color:e.qa.data.overallScore>=80?"success":e.qa.data.overallScore>=60?"warning":"error"},{label:"仓库数",value:e.qa.data.totalRepos}]:[];return a.jsx("div",{className:"min-h-screen bg-[#0a0a0f] text-white p-6",children:a.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[a.jsx(B,{systemStatus:s,loading:t,onRefresh:n}),a.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[a.jsx(u,{id:"vps",title:"VPS",icon:S,iconColor:"text-cyan-400",path:"/vps-monitor",metrics:d,loading:e.vps.loading,error:e.vps.error}),a.jsx(u,{id:"claude",title:"Claude",icon:T,iconColor:"text-orange-400",path:"/claude-monitor",metrics:l,loading:e.claude.loading,error:e.claude.error}),a.jsx(u,{id:"engine",title:"Engine",icon:$,iconColor:"text-purple-400",path:"/engine",metrics:c,loading:e.engine.loading,error:e.engine.error}),a.jsx(u,{id:"n8n",title:"N8N",icon:q,iconColor:"text-green-400",path:"/n8n",metrics:o,loading:e.n8n.loading,error:e.n8n.error}),a.jsx(u,{id:"cecilia",title:"Cecilia",icon:D,iconColor:"text-pink-400",path:"/cecilia",metrics:r,loading:e.cecilia.loading,error:e.cecilia.error}),a.jsx(u,{id:"panorama",title:"Panorama",icon:A,iconColor:"text-blue-400",path:"/panorama",metrics:i,loading:e.panorama.loading,error:e.panorama.error}),a.jsx(u,{id:"qa",title:"QA",icon:M,iconColor:"text-emerald-400",path:"/qa",metrics:m,loading:e.qa.loading,error:e.qa.error}),a.jsx(u,{id:"canvas",title:"Canvas",icon:U,iconColor:"text-amber-400",path:"/canvas",metrics:[{label:"",value:"打开画布 →"}],loading:!1,error:null})]})]})})}export{fe as default};
