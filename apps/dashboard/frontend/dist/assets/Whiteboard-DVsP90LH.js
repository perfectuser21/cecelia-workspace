import{c as ae,r as i,j as t,a as Ve,P as Ct,F as Qt,d as es,C as fn,e as ls,f as rs,X as is,T as os,R as kt,Z as ts,I as pn,L as mn,S as gn,g as bn,M as yn,h as vn,i as wn}from"./index-BA7JDtNR.js";import{Z as ss}from"./zoom-out-BkX4ExyB.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jn=ae("AlignCenterVertical",[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"M8 10H4a2 2 0 0 1-2-2V6c0-1.1.9-2 2-2h4",key:"14d6g8"}],["path",{d:"M16 10h4a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-4",key:"1e2lrw"}],["path",{d:"M8 20H7a2 2 0 0 1-2-2v-2c0-1.1.9-2 2-2h1",key:"1fkdwx"}],["path",{d:"M16 14h1a2 2 0 0 1 2 2v2a2 2 0 0 1-2 2h-1",key:"1euafb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kn=ae("AlignCenter",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"17",x2:"7",y1:"12",y2:"12",key:"rsh8ii"}],["line",{x1:"19",x2:"5",y1:"18",y2:"18",key:"1t0tuv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nn=ae("AlignEndVertical",[["rect",{width:"16",height:"6",x:"2",y:"4",rx:"2",key:"10wcwx"}],["rect",{width:"9",height:"6",x:"9",y:"14",rx:"2",key:"4p5bwg"}],["path",{d:"M22 22V2",key:"12ipfv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cn=ae("AlignHorizontalSpaceBetween",[["rect",{width:"6",height:"14",x:"3",y:"5",rx:"2",key:"j77dae"}],["rect",{width:"6",height:"10",x:"15",y:"7",rx:"2",key:"bq30hj"}],["path",{d:"M3 2v20",key:"1d2pfg"}],["path",{d:"M21 2v20",key:"p059bm"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sn=ae("AlignLeft",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}],["line",{x1:"17",x2:"3",y1:"18",y2:"18",key:"1awlsn"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mn=ae("AlignRight",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}],["line",{x1:"21",x2:"7",y1:"18",y2:"18",key:"1g9eri"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const En=ae("AlignStartVertical",[["rect",{width:"9",height:"6",x:"6",y:"14",rx:"2",key:"lpm2y7"}],["rect",{width:"16",height:"6",x:"6",y:"4",rx:"2",key:"rdj6ps"}],["path",{d:"M2 2v20",key:"1ivd8o"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dn=ae("AlignVerticalSpaceBetween",[["rect",{width:"14",height:"6",x:"5",y:"15",rx:"2",key:"1w91an"}],["rect",{width:"10",height:"6",x:"7",y:"3",rx:"2",key:"17wqzy"}],["path",{d:"M2 21h20",key:"1nyx9w"}],["path",{d:"M2 3h20",key:"91anmk"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $n=ae("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zn=ae("Group",[["path",{d:"M3 7V5c0-1.1.9-2 2-2h2",key:"adw53z"}],["path",{d:"M17 3h2c1.1 0 2 .9 2 2v2",key:"an4l38"}],["path",{d:"M21 17v2c0 1.1-.9 2-2 2h-2",key:"144t0e"}],["path",{d:"M7 21H5c-1.1 0-2-.9-2-2v-2",key:"rtnfgi"}],["rect",{width:"7",height:"5",x:"7",y:"7",rx:"1",key:"1eyiv7"}],["rect",{width:"7",height:"5",x:"10",y:"12",rx:"1",key:"1qlmkx"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const In=ae("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tn=ae("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pn=ae("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const An=ae("Ungroup",[["rect",{width:"8",height:"6",x:"5",y:"4",rx:"1",key:"nzclkv"}],["rect",{width:"8",height:"6",x:"11",y:"14",rx:"1",key:"4tytwb"}]]),Ke=150,Ue=100,oe=10;function Yn({nodes:y,edges:r,viewBox:x,canvasSize:p,onPanTo:D}){const L=i.useRef(null),[U,_]=i.useState(!1),H=i.useCallback(()=>{const f=y.filter(Y=>typeof Y.x=="number"&&typeof Y.y=="number");if(f.length===0)return{minX:0,minY:0,maxX:p.width,maxY:p.height};const M=Math.min(...f.map(Y=>Y.x),x.x),k=Math.min(...f.map(Y=>Y.y),x.y),z=Math.max(...f.map(Y=>Y.x+(Y.width||150)),x.x+x.width),A=Math.max(...f.map(Y=>Y.y+(Y.height||50)),x.y+x.height);return{minX:M,minY:k,maxX:z,maxY:A}},[y,x,p]),P=i.useCallback(()=>{const f=H(),M=f.maxX-f.minX+oe*2,k=f.maxY-f.minY+oe*2,z=(Ke-oe*2)/M,A=(Ue-oe*2)/k;return Math.min(z,A,1)},[H]),F=i.useCallback((f,M)=>{const k=H(),z=P(),A=(Ke-(k.maxX-k.minX+oe*2)*z)/2,Y=(Ue-(k.maxY-k.minY+oe*2)*z)/2,T=(f-A-oe*z)/z+k.minX,G=(M-Y-oe*z)/z+k.minY;return{x:T,y:G}},[H,P]),Z=i.useCallback((f,M)=>{const k=H(),z=P(),A=(Ke-(k.maxX-k.minX+oe*2)*z)/2,Y=(Ue-(k.maxY-k.minY+oe*2)*z)/2,T=(f-k.minX)*z+A+oe*z,G=(M-k.minY)*z+Y+oe*z;return{x:T,y:G}},[H,P]),ce=i.useCallback(f=>{if(!L.current)return;const M=L.current.getBoundingClientRect(),k=f.clientX-M.left,z=f.clientY-M.top,A=F(k,z);D(A.x-x.width/2,A.y-x.height/2)},[F,D,x.width,x.height]),K=i.useCallback(f=>{f.stopPropagation(),_(!0)},[]),te=i.useCallback(f=>{if(!U||!L.current)return;const M=L.current.getBoundingClientRect(),k=f.clientX-M.left,z=f.clientY-M.top,A=F(k,z);D(A.x-x.width/2,A.y-x.height/2)},[U,F,D,x.width,x.height]),w=i.useCallback(()=>{_(!1)},[]),u=i.useCallback(()=>{_(!1)},[]);i.useEffect(()=>{if(U){const f=()=>_(!1);return window.addEventListener("mouseup",f),()=>window.removeEventListener("mouseup",f)}},[U]);const v=i.useCallback(f=>{const M=y.find(k=>k.id===f);return!M||typeof M.x!="number"||typeof M.y!="number"?null:{x:M.x+(M.width||150)/2,y:M.y+(M.height||50)/2}},[y]),$=P();H();const S={x:Z(x.x,x.y).x,y:Z(x.x,x.y).y,width:x.width*$,height:x.height*$};return t.jsxs("div",{className:"absolute bottom-28 left-3 w-[150px] h-[100px] bg-slate-800/90 border border-slate-600 rounded-lg overflow-hidden shadow-lg backdrop-blur-sm z-10",children:[t.jsxs("svg",{ref:L,width:"100%",height:"100%",onClick:ce,onMouseMove:te,onMouseUp:w,onMouseLeave:u,style:{cursor:U?"grabbing":"pointer"},children:[t.jsx("rect",{width:Ke,height:Ue,fill:"transparent"}),r.map((f,M)=>{const k=v(f.from),z=v(f.to);if(!k||!z)return null;const A=Z(k.x,k.y),Y=Z(z.x,z.y);return t.jsx("line",{x1:A.x,y1:A.y,x2:Y.x,y2:Y.y,stroke:"#64748b",strokeWidth:.5,pointerEvents:"none"},`edge-${M}`)}),y.filter(f=>typeof f.x=="number"&&typeof f.y=="number").map(f=>{const M=Z(f.x,f.y),k=Math.max((f.width||150)*$,4),z=Math.max((f.height||50)*$,3);return t.jsx("rect",{x:M.x,y:M.y,width:k,height:z,rx:1,fill:f.color||"#3b82f6",opacity:.8,pointerEvents:"none"},f.id)}),t.jsx("rect",{x:S.x,y:S.y,width:S.width,height:S.height,fill:"rgba(59, 130, 246, 0.1)",stroke:"#3b82f6",strokeWidth:1.5,strokeDasharray:"4 2",style:{cursor:U?"grabbing":"grab"},onMouseDown:K}),S.width>20&&S.height>15&&t.jsx("circle",{cx:S.x+S.width/2,cy:S.y+S.height/2,r:3,fill:"#3b82f6",pointerEvents:"none"})]}),t.jsx("div",{className:"absolute top-1 left-2 text-[10px] text-slate-500 font-medium pointer-events-none",children:"Mini Map"})]})}const Xn=[{keys:["Cmd/Ctrl","C"],desc:"å¤åˆ¶"},{keys:["Cmd/Ctrl","V"],desc:"ç²˜è´´"},{keys:["Cmd/Ctrl","Z"],desc:"æ’¤é”€"},{keys:["Cmd/Ctrl","Shift","Z"],desc:"é‡åš"},{keys:["Delete"],desc:"åˆ é™¤"},{keys:["Shift","ç‚¹å‡»"],desc:"å¤šé€‰"},{keys:["æ‹–æ‹½ç©ºç™½"],desc:"æ¡†é€‰"},{keys:["æ»šè½®"],desc:"ç¼©æ”¾"},{keys:["Shift","æ‹–æ‹½"],desc:"å¹³ç§»ç”»å¸ƒ"},{keys:["åŒå‡»èŠ‚ç‚¹"],desc:"ç¼–è¾‘æ–‡å­—"},{keys:["?"],desc:"æ˜¾ç¤ºå¸®åŠ©"}];function Ln({isOpen:y,onClose:r}){const x=i.useCallback(p=>{p.key==="Escape"&&r()},[r]);return i.useEffect(()=>{if(y)return document.addEventListener("keydown",x),()=>document.removeEventListener("keydown",x)},[y,x]),y?t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 animate-fade-in",onClick:r,children:t.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-xl p-6 max-w-md w-full mx-4 shadow-2xl animate-scale-in",onClick:p=>p.stopPropagation(),children:[t.jsx("h2",{className:"text-lg font-semibold text-slate-100 mb-4",children:"å¿«æ·é”®"}),t.jsx("div",{className:"space-y-2",children:Xn.map(({keys:p,desc:D})=>t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-slate-300",children:D}),t.jsx("div",{className:"flex gap-1",children:p.map(L=>t.jsx("kbd",{className:"px-2 py-1 bg-slate-700 text-slate-200 text-xs rounded border border-slate-600",children:L},L))})]},D))}),t.jsx("button",{onClick:r,className:"mt-4 w-full py-2 bg-slate-700 hover:bg-slate-600 text-slate-200 rounded-lg transition-colors",children:"å…³é—­"})]})}):null}const St={startX:100,startY:100,nodeSpacingH:200,nodeSpacingV:150,iterations:100};function Hn(y,r,x){const p={...St,...x};if(y.length===0)return[];if(y.length===1)return[{...y[0],x:p.startX,y:p.startY}];const D=new Map,L=new Map;y.forEach((w,u)=>{const v=w.x!==0||w.y!==0;D.set(w.id,{x:v?w.x:p.startX+Math.random()*300-150,y:v?w.y:p.startY+Math.random()*300-150}),L.set(w.id,{vx:0,vy:0})}),new Set(r.map(w=>`${w.from}-${w.to}`));const U=5e3,_=.01,H=.9,P=50;for(let w=0;w<p.iterations;w++){const u=new Map;y.forEach(v=>u.set(v.id,{fx:0,fy:0}));for(let v=0;v<y.length;v++)for(let $=v+1;$<y.length;$++){const S=y[v],f=y[$],M=D.get(S.id),k=D.get(f.id),z=k.x-M.x,A=k.y-M.y,Y=Math.max(Math.sqrt(z*z+A*A),P),T=U/(Y*Y),G=z/Y*T,E=A/Y*T,W=u.get(S.id),Xe=u.get(f.id);W.fx-=G,W.fy-=E,Xe.fx+=G,Xe.fy+=E}r.forEach(v=>{const $=D.get(v.from),S=D.get(v.to);if(!$||!S)return;const f=S.x-$.x,M=S.y-$.y,k=Math.sqrt(f*f+M*M);if(k<P)return;const z=k*_,A=f/k*z,Y=M/k*z,T=u.get(v.from),G=u.get(v.to);T&&(T.fx+=A,T.fy+=Y),G&&(G.fx-=A,G.fy-=Y)}),y.forEach(v=>{const $=D.get(v.id),S=L.get(v.id),f=u.get(v.id);S.vx=(S.vx+f.fx)*H,S.vy=(S.vy+f.fy)*H;const M=50,k=Math.sqrt(S.vx*S.vx+S.vy*S.vy);k>M&&(S.vx=S.vx/k*M,S.vy=S.vy/k*M),$.x+=S.vx,$.y+=S.vy})}const F=Array.from(D.values()),Z=F.reduce((w,u)=>w+u.x,0)/F.length,ce=F.reduce((w,u)=>w+u.y,0)/F.length,K=p.startX-Z,te=p.startY-ce;return y.map(w=>{const u=D.get(w.id);return{...w,x:Math.round(u.x+K),y:Math.round(u.y+te)}})}function Rn(y,r){const x={...St,...r};if(y.length===0)return[];const p=Math.ceil(Math.sqrt(y.length));Math.ceil(y.length/p);const D=Math.max(...y.map(H=>H.width)),L=Math.max(...y.map(H=>H.height)),U=D+x.nodeSpacingH,_=L+x.nodeSpacingV;return y.map((H,P)=>{const F=P%p,Z=Math.floor(P/p);return{...H,x:x.startX+F*U,y:x.startY+Z*_}})}function Wn(y,r){const x={...St,...r};if(y.length===0)return[];if(y.length===1)return[{...y[0],x:x.startX,y:x.startY}];const p=Math.max(...y.map(_=>Math.max(_.width,_.height))),D=y.length*(p+x.nodeSpacingH)/(2*Math.PI),L=Math.max(D,200),U=2*Math.PI/y.length;return y.map((_,H)=>{const P=-Math.PI/2+H*U;return{..._,x:Math.round(x.startX+L*Math.cos(P)),y:Math.round(x.startY+L*Math.sin(P))}})}function On(y){const r=new Date(y),p=new Date().getTime()-r.getTime(),D=Math.floor(p/6e4),L=Math.floor(p/36e5),U=Math.floor(p/864e5);return D<1?"åˆšåˆš":D<60?`${D} åˆ†é’Ÿå‰`:L<24?`${L} å°æ—¶å‰`:U<7?`${U} å¤©å‰`:r.toLocaleDateString("zh-CN")}function _n({projects:y,currentProjectId:r,onSelectProject:x,onCreateProject:p,onDeleteProject:D,onRenameProject:L,isCollapsed:U,onToggleCollapse:_}){var G;const[H,P]=i.useState(null),[F,Z]=i.useState(null),[ce,K]=i.useState(""),[te,w]=i.useState(null),u=i.useRef(null),v=i.useRef(null),$=[...y].sort((E,W)=>new Date(W.updatedAt).getTime()-new Date(E.updatedAt).getTime()).slice(0,5);i.useEffect(()=>{const E=W=>{v.current&&!v.current.contains(W.target)&&P(null)};if(H)return document.addEventListener("mousedown",E),()=>document.removeEventListener("mousedown",E)},[H]),i.useEffect(()=>{F&&u.current&&(u.current.focus(),u.current.select())},[F]);const S=i.useCallback((E,W)=>{E.preventDefault(),E.stopPropagation(),P({id:W,x:E.clientX,y:E.clientY})},[]),f=i.useCallback(E=>{Z(E.id),K(E.name),P(null)},[]),M=i.useCallback(()=>{F&&ce.trim()&&L(F,ce.trim()),Z(null),K("")},[F,ce,L]),k=i.useCallback(()=>{Z(null),K("")},[]),z=i.useCallback(E=>{E.key==="Enter"?M():E.key==="Escape"&&k()},[M,k]),A=i.useCallback(E=>{w(E),P(null)},[]),Y=i.useCallback(()=>{te&&(D(te),w(null))},[te,D]),T=i.useCallback(()=>{w(null)},[]);return U?t.jsxs("div",{className:"w-12 h-full border-r border-slate-700/50 flex flex-col items-center py-3 gap-2",style:{background:"linear-gradient(180deg, #1e2a5e 0%, #1e1b4b 100%)"},children:[t.jsx("button",{onClick:_,className:"p-2 rounded-lg hover:bg-slate-800 text-slate-400 hover:text-slate-200 transition-colors",title:"å±•å¼€ä¾§è¾¹æ ",children:t.jsx(Ve,{size:18})}),t.jsx("div",{className:"w-8 h-px bg-slate-700 my-1"}),t.jsx("button",{onClick:p,className:"p-2 rounded-lg hover:bg-slate-800 text-slate-400 hover:text-blue-400 transition-colors",title:"æ–°å»ºé¡¹ç›®",children:t.jsx(Ct,{size:18})}),t.jsx("button",{className:"p-2 rounded-lg text-slate-400 cursor-default",title:"é¡¹ç›®åˆ—è¡¨",children:t.jsx(Qt,{size:18})}),t.jsx("button",{className:"p-2 rounded-lg text-slate-400 cursor-default",title:"æœ€è¿‘é¡¹ç›®",children:t.jsx(es,{size:18})})]}):t.jsxs("div",{className:"w-60 h-full border-r border-slate-700/50 flex flex-col",style:{background:"linear-gradient(180deg, #1e2a5e 0%, #1e1b4b 100%)"},children:[t.jsxs("div",{className:"flex items-center justify-between px-3 py-3 border-b border-slate-700",children:[t.jsxs("div",{className:"flex items-center gap-2 text-slate-200 font-medium",children:[t.jsx(Qt,{size:18,className:"text-slate-400"}),t.jsx("span",{children:"é¡¹ç›®ç®¡ç†"})]}),t.jsx("button",{onClick:_,className:"p-1.5 rounded hover:bg-slate-800 text-slate-400 hover:text-slate-200 transition-colors",title:"æ”¶èµ·ä¾§è¾¹æ ",children:t.jsx(fn,{size:16})})]}),t.jsx("div",{className:"px-3 py-2",children:t.jsxs("button",{onClick:p,className:"w-full flex items-center justify-center gap-2 px-3 py-2 rounded-lg bg-blue-600 hover:bg-blue-500 text-white text-sm font-medium transition-colors",children:[t.jsx(Ct,{size:16}),"æ–°å»ºé¡¹ç›®"]})}),t.jsxs("div",{className:"flex-1 overflow-y-auto",children:[t.jsxs("div",{className:"px-3 py-2",children:[t.jsxs("div",{className:"text-xs text-slate-500 font-medium mb-2 flex items-center gap-1.5",children:[t.jsx(ls,{size:12}),"æ‰€æœ‰é¡¹ç›® (",y.length,")"]}),t.jsx("div",{className:"space-y-1",children:y.length===0?t.jsx("div",{className:"text-sm text-slate-500 py-4 text-center",children:"æš‚æ— é¡¹ç›®"}):y.map(E=>t.jsx("div",{className:`group relative flex items-center px-2 py-2 rounded-lg cursor-pointer transition-colors ${r===E.id?"bg-blue-600/20 text-blue-400":"hover:bg-slate-800 text-slate-300"}`,onClick:()=>x(E.id),onContextMenu:W=>S(W,E.id),children:F===E.id?t.jsxs("div",{className:"flex-1 flex items-center gap-1",children:[t.jsx("input",{ref:u,type:"text",value:ce,onChange:W=>K(W.target.value),onKeyDown:z,onBlur:M,className:"flex-1 bg-slate-800 border border-slate-600 rounded px-2 py-1 text-sm text-slate-200 focus:outline-none focus:border-blue-500",onClick:W=>W.stopPropagation()}),t.jsx("button",{onClick:W=>{W.stopPropagation(),M()},className:"p-1 text-green-400 hover:text-green-300",children:t.jsx(rs,{size:14})}),t.jsx("button",{onClick:W=>{W.stopPropagation(),k()},className:"p-1 text-red-400 hover:text-red-300",children:t.jsx(is,{size:14})})]}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-sm truncate",children:E.name}),t.jsx("div",{className:"text-xs text-slate-500 flex items-center gap-2",children:t.jsxs("span",{children:[E.nodeCount," èŠ‚ç‚¹"]})})]}),t.jsx("button",{onClick:W=>{W.stopPropagation(),S(W,E.id)},className:"opacity-0 group-hover:opacity-100 p-1 rounded hover:bg-slate-700 text-slate-400 hover:text-slate-200 transition-all",children:t.jsx(Tn,{size:14})})]})},E.id))})]}),$.length>0&&t.jsxs("div",{className:"px-3 py-2 border-t border-slate-800",children:[t.jsxs("div",{className:"text-xs text-slate-500 font-medium mb-2 flex items-center gap-1.5",children:[t.jsx(es,{size:12}),"æœ€è¿‘ç¼–è¾‘"]}),t.jsx("div",{className:"space-y-1",children:$.map(E=>t.jsx("div",{className:`flex items-center px-2 py-1.5 rounded-lg cursor-pointer transition-colors ${r===E.id?"bg-blue-600/10 text-blue-400":"hover:bg-slate-800/50 text-slate-400"}`,onClick:()=>x(E.id),children:t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"text-xs truncate",children:E.name}),t.jsx("div",{className:"text-[10px] text-slate-600",children:On(E.updatedAt)})]})},`recent-${E.id}`))})]})]}),t.jsxs("div",{className:"px-3 py-2 border-t border-slate-700 text-xs text-slate-500",children:["å…± ",y.length," ä¸ªé¡¹ç›®"]}),H&&t.jsxs("div",{ref:v,className:"fixed bg-slate-800 border border-slate-600 rounded-lg shadow-xl py-1 z-50 min-w-[120px]",style:{left:H.x,top:H.y},children:[t.jsxs("button",{onClick:()=>{const E=y.find(W=>W.id===H.id);E&&f(E)},className:"w-full flex items-center gap-2 px-3 py-1.5 text-sm text-slate-300 hover:bg-slate-700 transition-colors",children:[t.jsx(Pn,{size:14}),"é‡å‘½å"]}),t.jsxs("button",{onClick:()=>A(H.id),className:"w-full flex items-center gap-2 px-3 py-1.5 text-sm text-red-400 hover:bg-slate-700 transition-colors",children:[t.jsx(os,{size:14}),"åˆ é™¤"]})]}),te&&t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-slate-800 border border-slate-600 rounded-lg shadow-xl p-4 max-w-sm mx-4",children:[t.jsx("h3",{className:"text-lg font-medium text-slate-200 mb-2",children:"ç¡®è®¤åˆ é™¤"}),t.jsxs("p",{className:"text-sm text-slate-400 mb-4",children:['ç¡®å®šè¦åˆ é™¤é¡¹ç›® "',(G=y.find(E=>E.id===te))==null?void 0:G.name,'" å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ã€‚']}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx("button",{onClick:T,className:"px-3 py-1.5 text-sm rounded-lg bg-slate-700 hover:bg-slate-600 text-slate-300 transition-colors",children:"å–æ¶ˆ"}),t.jsx("button",{onClick:Y,className:"px-3 py-1.5 text-sm rounded-lg bg-red-600 hover:bg-red-500 text-white transition-colors",children:"åˆ é™¤"})]})]})})]})}const Ce="https://dashboard.zenjoymedia.media",ns=["#1e40af","#2563eb","#3b82f6","#60a5fa","#93c5fd","#bfdbfe"],Gn=y=>ns[Math.min(y,ns.length-1)],pe={feature:{label:"Feature",color:"#3b82f6",bgColor:"#3b82f620",desc:"åŠŸèƒ½æ¨¡å—"},code:{label:"Code",color:"#10b981",bgColor:"#10b98120",desc:"ä»£ç å®žçŽ°"},annotation:{label:"æ³¨é‡Š",color:"#fbbf24",bgColor:"#fbbf2415",desc:"ä¾¿ç­¾æ³¨é‡Š"},module:{label:"Module",color:"#3b82f6",bgColor:"#3b82f620",desc:"åŠŸèƒ½æ¨¡å—"},logic:{label:"Logic",color:"#8b5cf6",bgColor:"#8b5cf620",desc:"é€»è¾‘å±‚"}},Nt={rounded:{label:"åœ†è§’çŸ©å½¢",icon:"â–¢"},rect:{label:"çŸ©å½¢",icon:"â–¬"},pill:{label:"èƒ¶å›Š",icon:"â¬­"},diamond:{label:"è±å½¢",icon:"â—†"}},Se={none:{label:"æ— ç®­å¤´",icon:"â€•"},"arrow-end":{label:"â†’",icon:"â†’"},"arrow-start":{label:"â†",icon:"â†"},"arrow-both":{label:"â†”",icon:"â†”"}},Me={solid:{label:"å®žçº¿"},dashed:{label:"è™šçº¿"}},Ye=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#06b6d4"],as=["#f472b6","#a78bfa","#60a5fa","#34d399","#fbbf24","#fb923c"];function Bn({embedded:y=!1}){const[r,x]=i.useState([]),[p,D]=i.useState([]),[L,U]=i.useState(new Map),[_,H]=i.useState([]),[P,F]=i.useState(null),[Z,ce]=i.useState(!1),[K,te]=i.useState([]),w=K.length>0?K[K.length-1]:null,[u,v]=i.useState(new Set),[$,S]=i.useState(null),[f,M]=i.useState(null),[k,z]=i.useState(!1),[A,Y]=i.useState(null),[T,G]=i.useState(null),[E,W]=i.useState(null),[Xe,Mt]=i.useState(null),[ve,Be]=i.useState(null),[qe,Et]=i.useState({x:0,y:0}),[Ze,Je]=i.useState(new Map),[cs,Dt]=i.useState([]),[X,Le]=i.useState(null),[He,Ee]=i.useState({x:0,y:0}),[ne,Qe]=i.useState(null),[O,me]=i.useState(1),[le,we]=i.useState({x:0,y:0}),[et,$t]=i.useState(!1),[tt,ds]=i.useState({x:0,y:0}),[st,zt]=i.useState("rounded"),[nt,hs]=i.useState(Ye[0]),[at,xs]=i.useState("arrow-end"),[lt,us]=i.useState("solid"),[It,Fn]=i.useState("#64748b"),[Kn,Re]=i.useState(!1),[ge,De]=i.useState("idle"),[rt,fs]=i.useState(!1),[ps,$e]=i.useState(!1),[ze,it]=i.useState(null),[Ie,ms]=i.useState([]),[be,ot]=i.useState(-1),[gs,ct]=i.useState(!1),[dt,ht]=i.useState(null),[xt,Tt]=i.useState(""),[ut,Pt]=i.useState(null),[Te,bs]=i.useState({x:0,y:0,width:0,height:0}),[ys,We]=i.useState(!1),[At,Yt]=i.useState(!1),[je,Xt]=i.useState(null),[ie,ke]=i.useState(new Set),[xe,Lt]=i.useState("horizontal"),re=i.useRef(null),ft=i.useRef(null),Oe=i.useRef(null);i.useEffect(()=>{dt&&Oe.current&&setTimeout(()=>{var e,s;(e=Oe.current)==null||e.focus(),(s=Oe.current)==null||s.select()},0)},[dt]),i.useEffect(()=>{const e=()=>fs(!!document.fullscreenElement);return document.addEventListener("fullscreenchange",e),()=>document.removeEventListener("fullscreenchange",e)},[]),i.useEffect(()=>{$e(!0)},[r,p]),i.useEffect(()=>{if(gs){ct(!1);return}const e=Ie.slice(0,be+1);e.push({nodes:[...r],edges:[...p]}),e.length>50&&e.shift(),ms(e),ot(e.length-1)},[r,p]);const vs=i.useCallback(()=>{!document.fullscreenElement&&ft.current?ft.current.requestFullscreen():document.fullscreenElement&&document.exitFullscreen()},[]),de=i.useCallback((e,s)=>{if(!re.current)return{x:0,y:0};const n=re.current.getBoundingClientRect();return{x:(e-n.left-le.x)/O,y:(s-n.top-le.y)/O}},[le,O]),ue=i.useCallback((e,s)=>{const n=e.x+e.width/2,a=e.y+e.height/2;switch(s){case"top":return{x:n,y:e.y};case"right":return{x:e.x+e.width,y:a};case"bottom":return{x:n,y:e.y+e.height};case"left":return{x:e.x,y:a}}},[]),Ht=i.useCallback((e,s,n)=>{const a=`node-${Date.now()}`,l={id:a,x:e??100+r.length*50%400,y:s??100+Math.floor(r.length/4)*80,width:120,height:50,name:`èŠ‚ç‚¹ ${r.length+1}`,shape:n??st,color:nt};x([...r,l]),v(new Set([a]))},[r,st,nt]),ws=i.useCallback(e=>{e.preventDefault();const s=e.dataTransfer.getData("application/whiteboard-shape");if(s){const n=s,a=de(e.clientX,e.clientY);Ht(a.x-60,a.y-25,n)}},[de,Ht]),js=i.useCallback(e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy"},[]);i.useCallback(e=>{x(s=>s.filter(n=>n.id!==e)),D(s=>s.filter(n=>n.from!==e&&n.to!==e)),v(s=>{const n=new Set(s);return n.delete(e),n})},[]);const pt=i.useCallback(()=>{if(u.size===0)return;const e=Array.from(u);x(s=>s.filter(n=>!e.includes(n.id))),D(s=>s.filter(n=>!e.includes(n.from)&&!e.includes(n.to))),v(new Set)},[u]),_e=i.useCallback((e,s,n,a)=>{e===n||p.some(o=>o.from===e&&o.fromAnchor===s&&o.to===n&&o.toAnchor===a)||D([...p,{id:`edge-${Date.now()}`,from:e,fromAnchor:s,to:n,toAnchor:a,lineType:at,lineStyle:lt,color:It}])},[p,at,lt,It]),mt=i.useCallback(e=>{D(s=>s.filter(n=>n.id!==e)),$===e&&S(null)},[$]);i.useEffect(()=>{const e=s=>{var a;const n=(a=document.activeElement)==null?void 0:a.tagName.toLowerCase();if(!(n==="input"||n==="textarea")){if((s.key==="Delete"||s.key==="Backspace")&&(u.size>0?pt():$&&mt($)),(s.metaKey||s.ctrlKey)&&s.key==="c"){if(s.preventDefault(),u.size>0){const l=r.filter(d=>u.has(d.id)),o=p.filter(d=>u.has(d.from)&&u.has(d.to));it({nodes:l.map(d=>({...d})),edges:o.map(d=>({...d}))})}else if($){const l=p.find(o=>o.id===$);l&&it({nodes:[],edges:[{...l}]})}}if((s.metaKey||s.ctrlKey)&&s.key==="v"&&(s.preventDefault(),ze&&ze.nodes.length>0)){const l=new Map,o=ze.nodes.map(c=>{const h=`node-${Date.now()}-${Math.random().toString(36).slice(2,6)}`;return l.set(c.id,h),{...c,id:h,x:c.x+30,y:c.y+30}}),d=ze.edges.map(c=>({...c,id:`edge-${Date.now()}-${Math.random().toString(36).slice(2,6)}`,from:l.get(c.from)||c.from,to:l.get(c.to)||c.to})).filter(c=>l.has(c.from)&&l.has(c.to));x(c=>[...c,...o]),D(c=>[...c,...d]),v(new Set(o.map(c=>c.id)))}if((s.metaKey||s.ctrlKey)&&s.key==="a"&&(s.preventDefault(),v(new Set(r.map(l=>l.id)))),s.key==="Escape"&&(v(new Set),S(null),We(!1)),(s.key==="?"||s.shiftKey&&s.key==="/")&&(s.preventDefault(),We(!0)),(s.metaKey||s.ctrlKey)&&s.key==="z"&&!s.shiftKey&&(s.preventDefault(),be>0)){ct(!0);const l=Ie[be-1];x(l.nodes),D(l.edges),ot(be-1)}if((s.metaKey||s.ctrlKey)&&s.key==="z"&&s.shiftKey&&(s.preventDefault(),be<Ie.length-1)){ct(!0);const l=Ie[be+1];x(l.nodes),D(l.edges),ot(be+1)}}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[u,$,r,p,ze,Ie,be,pt,mt]);const ks=i.useCallback(e=>{$&&D(p.map(s=>s.id===$?{...s,lineType:e}:s))},[$,p]),Ns=i.useCallback(e=>{$&&D(p.map(s=>s.id===$?{...s,color:e}:s))},[$,p]),Cs=i.useCallback(e=>{$&&D(p.map(s=>s.id===$?{...s,lineStyle:e}:s))},[$,p]),Rt=i.useCallback((e,s,n,a)=>{D(p.map(l=>l.id!==e?l:s==="from"?{...l,from:n,fromAnchor:a}:{...l,to:n,toAnchor:a}))},[p]),Ss=i.useCallback(()=>{confirm("ç¡®å®šæ¸…ç©ºç”»å¸ƒï¼Ÿ")&&(x([]),D([]),v(new Set),S(null))},[]),Ms=i.useCallback(e=>{r.some(n=>n.parentId===e.id)&&(Mt(e.id),setTimeout(()=>{Mt(null),te(n=>[...n,e.id]),ke(n=>new Set([...n,e.id])),v(new Set),S(null),Ge(!0)},300))},[r]),Wt=i.useCallback((e,s)=>{x(r.map(n=>n.id===e?{...n,name:s}:n)),ht(null)},[r]),Es=i.useCallback((e,s)=>{if(e.button!==0)return;if(e.stopPropagation(),e.detail===2){ht(s.id),Tt(s.name);return}const n=de(e.clientX,e.clientY);if(e.shiftKey){v(a=>{const l=new Set(a);return l.has(s.id)?l.delete(s.id):l.add(s.id),l}),S(null);return}if(u.has(s.id)){const a=new Map;u.forEach(l=>{const o=r.find(d=>d.id===l);o&&a.set(l,{x:n.x-o.x,y:n.y-o.y})}),Je(a),Be(s.id),Et({x:n.x-s.x,y:n.y-s.y})}else v(new Set([s.id])),Be(s.id),Et({x:n.x-s.x,y:n.y-s.y}),Je(new Map([[s.id,{x:n.x-s.x,y:n.y-s.y}]]));S(null)},[de,u,r]),Ds=i.useCallback((e,s,n)=>{e.stopPropagation(),e.preventDefault();const a=de(e.clientX,e.clientY);Le({nodeId:s,anchor:n}),Ee(a)},[de]),$s=i.useCallback((e,s)=>{X&&X.nodeId!==e&&_e(X.nodeId,X.anchor,e,s),Le(null)},[X,_e]),zs=i.useCallback(e=>{const s=e.target;if(!(s.tagName!=="rect"&&s.tagName!=="svg")){if(X){Le(null);return}if(e.button===1||e.altKey){$t(!0),ds({x:e.clientX-le.x,y:e.clientY-le.y});return}if(e.button===0){const n=de(e.clientX,e.clientY);e.shiftKey||v(new Set),S(null),z(!0),M({startX:n.x,startY:n.y,endX:n.x,endY:n.y})}}},[X,le,de]),gt=i.useCallback((e,s)=>{let a=null;for(const l of r)if(l.id!==s)for(const o of["top","right","bottom","left"]){const d=ue(l,o),c=Math.sqrt((d.x-e.x)**2+(d.y-e.y)**2);c<35&&(!a||c<a.dist)&&(a={nodeId:l.id,anchor:o,dist:c})}return a},[r,ue]),Is=i.useCallback(e=>{const s=de(e.clientX,e.clientY);if(k&&f){M({...f,endX:s.x,endY:s.y});return}if(X){Ee(s);const n=gt(s,X.nodeId);G(n?{nodeId:n.nodeId,anchor:n.anchor}:null)}if(ne){Ee(s);const n=p.find(a=>a.id===ne.edgeId);if(n){const a=ne.end==="from"?n.to:n.from,l=gt(s,a);G(l?{nodeId:l.nodeId,anchor:l.anchor}:null)}}if(ut){const n=(e.clientX-Te.x)/O,a=(e.clientY-Te.y)/O,l=Math.max(60,Te.width+n),o=Math.max(30,Te.height+a);x(r.map(d=>d.id===ut.nodeId?{...d,width:l,height:o}:d))}if(et)we({x:e.clientX-tt.x,y:e.clientY-tt.y});else if(ve){const n=r.find(d=>d.id===ve);if(!n)return;let a=s.x-qe.x,l=s.y-qe.y;a-n.x,l-n.y;const o=[];if(u.size===1){const c=a+n.width/2,h=l+n.height/2,m=a+n.width,I=l+n.height;for(const N of r){if(u.has(N.id))continue;const b=N.x+N.width/2,g=N.y+N.height/2,j=N.x+N.width,C=N.y+N.height;Math.abs(c-b)<8?(a=b-n.width/2,o.push({type:"v",pos:b})):Math.abs(a-N.x)<8?(a=N.x,o.push({type:"v",pos:N.x})):Math.abs(m-j)<8&&(a=j-n.width,o.push({type:"v",pos:j})),Math.abs(h-g)<8?(l=g-n.height/2,o.push({type:"h",pos:g})):Math.abs(l-N.y)<8?(l=N.y,o.push({type:"h",pos:N.y})):Math.abs(I-C)<8&&(l=C-n.height,o.push({type:"h",pos:C}))}}Dt(o),u.size>1&&Ze.size>0?x(r.map(d=>{if(u.has(d.id)){const c=Ze.get(d.id);if(c)return{...d,x:s.x-c.x,y:s.y-c.y}}return d})):x(r.map(d=>d.id===ve?{...d,x:a,y:l}:d))}},[X,ne,p,et,tt,ve,qe,de,r,gt,ut,Te,O,k,f,u,Ze]),Ot=i.useCallback(()=>{if($t(!1),Be(null),Dt([]),Pt(null),Je(new Map),k&&f){const e=Math.min(f.startX,f.endX),s=Math.max(f.startX,f.endX),n=Math.min(f.startY,f.endY),a=Math.max(f.startY,f.endY),l=new Set;r.forEach(o=>{const d=o.x+o.width/2,c=o.y+o.height/2;d>=e&&d<=s&&c>=n&&c<=a&&l.add(o.id)}),v(o=>{const d=new Set(o);return l.forEach(c=>d.add(c)),d}),z(!1),M(null)}if(X&&(T&&T.nodeId!==X.nodeId&&_e(X.nodeId,X.anchor,T.nodeId,T.anchor),Le(null),G(null)),ne){if(T){const e=p.find(s=>s.id===ne.edgeId);if(e){const s=ne.end==="from"?e.to:e.from;T.nodeId!==s&&Rt(ne.edgeId,ne.end,T.nodeId,T.anchor)}}Qe(null),G(null)}},[X,T,_e,ne,p,Rt,k,f,r]),Ts=i.useCallback(e=>{if(e.metaKey||e.ctrlKey){e.preventDefault();const s=e.deltaY>0?.95:1.05;me(n=>Math.min(3,Math.max(.3,n*s)))}else e.preventDefault(),we(s=>({x:s.x-e.deltaX,y:s.y-e.deltaY}))},[]),Ps=(e,s,n,a)=>{const{width:l,height:o,shape:d}=e,c=a||e.color||"#3b82f6",h=`${c}20`,m=s?"#fbbf24":n?"#60a5fa":c,I=s?2.5:n?2:1.5;if(e.layerType==="annotation"){const N="#fbbf24",b="rgba(251, 191, 36, 0.08)",g=s?"#fbbf24":n?"#fcd34d":"rgba(251, 191, 36, 0.4)",j=e.attachPosition||"top-left";let C="";return j==="top-right"||j==="bottom-right"?C=`-8,${o/2-6} 0,${o/2} -8,${o/2+6}`:C=`${l+8},${o/2-6} ${l},${o/2} ${l+8},${o/2+6}`,t.jsxs("g",{children:[t.jsx("rect",{width:l,height:o,rx:6,fill:b,stroke:g,strokeWidth:s?2:1,strokeDasharray:s?void 0:"4 2"}),e.attachedTo&&t.jsx("polygon",{points:C,fill:b,stroke:g,strokeWidth:1,strokeDasharray:"4 2"}),t.jsx("text",{x:6,y:14,fontSize:10,fill:N,style:{pointerEvents:"none"},children:"ðŸ“"})]})}switch(d){case"rect":return t.jsx("rect",{width:l,height:o,fill:h,stroke:m,strokeWidth:I});case"rounded":return t.jsx("rect",{width:l,height:o,rx:8,fill:h,stroke:m,strokeWidth:I});case"pill":return t.jsx("rect",{width:l,height:o,rx:o/2,fill:h,stroke:m,strokeWidth:I});case"diamond":return t.jsx("polygon",{points:`${l/2},0 ${l},${o/2} ${l/2},${o} 0,${o/2}`,fill:h,stroke:m,strokeWidth:I})}},As=e=>{const s=["top","right","bottom","left"];return A===e.id||u.has(e.id)||X!==null||ne!==null?s.map(a=>{const l=ue(e,a),o=l.x-e.x,d=l.y-e.y,c=(T==null?void 0:T.nodeId)===e.id&&(T==null?void 0:T.anchor)===a,h=(X==null?void 0:X.nodeId)===e.id&&(X==null?void 0:X.anchor)===a,m=X&&X.nodeId!==e.id;return t.jsx("circle",{cx:o,cy:d,r:c||h?7:5,fill:h?"#10b981":c?"#60a5fa":m?"#94a3b8":"#64748b",stroke:"#1e293b",strokeWidth:2,style:{cursor:"crosshair"},onMouseDown:I=>Ds(I,e.id,a),onMouseUp:()=>$s(e.id,a),onMouseEnter:()=>G({nodeId:e.id,anchor:a}),onMouseLeave:()=>G(null)},a)}):null},Ys=e=>{const s=r.find(B=>B.id===e.from),n=r.find(B=>B.id===e.to);if(!s||!n)return null;const a=ue(s,e.fromAnchor),l=ue(n,e.toAnchor),o=l.x-a.x,d=l.y-a.y,c=Math.min(Math.abs(o),Math.abs(d),60)+30;let h=a.x,m=a.y,I=l.x,N=l.y;switch(e.fromAnchor){case"top":m-=c;break;case"right":h+=c;break;case"bottom":m+=c;break;case"left":h-=c;break}switch(e.toAnchor){case"top":N-=c;break;case"right":I+=c;break;case"bottom":N+=c;break;case"left":I-=c;break}const b=`M ${a.x} ${a.y} C ${h} ${m}, ${I} ${N}, ${l.x} ${l.y}`,g=$===e.id,j=e.lineType||"arrow-end",V=(e.lineStyle||"solid")==="dashed"?"6 4":void 0,R=(e.color||"#64748b").slice(1);let q,se;switch(j){case"arrow-end":q=`url(#arrowhead-${R})`;break;case"arrow-start":se=`url(#arrowhead-start-${R})`;break;case"arrow-both":q=`url(#arrowhead-${R})`,se=`url(#arrowhead-start-${R})`;break}return t.jsxs("g",{children:[t.jsx("path",{d:b,fill:"none",stroke:"transparent",strokeWidth:12,style:{cursor:"pointer"},onClick:()=>{S(e.id),v(new Set)}}),t.jsx("path",{d:b,fill:"none",stroke:g?"#ef4444":e.color||"#64748b",strokeWidth:g?2.5:2,strokeDasharray:V,markerEnd:q,markerStart:se,pointerEvents:"none"}),g&&t.jsxs(t.Fragment,{children:[t.jsx("circle",{cx:a.x,cy:a.y,r:8,fill:"#ef4444",stroke:"#fff",strokeWidth:2,style:{cursor:"grab"},onMouseDown:B=>{B.stopPropagation(),Qe({edgeId:e.id,end:"from"}),Ee(a)}}),t.jsx("circle",{cx:l.x,cy:l.y,r:8,fill:"#ef4444",stroke:"#fff",strokeWidth:2,style:{cursor:"grab"},onMouseDown:B=>{B.stopPropagation(),Qe({edgeId:e.id,end:"to"}),Ee(l)}})]})]},e.id)},Xs=()=>{if(!X)return null;const e=r.find(l=>l.id===X.nodeId);if(!e)return null;const s=ue(e,X.anchor);let n=He.x,a=He.y;if(T&&T.nodeId!==X.nodeId){const l=r.find(o=>o.id===T.nodeId);if(l){const o=ue(l,T.anchor);n=o.x,a=o.y}}return t.jsx("line",{x1:s.x,y1:s.y,x2:n,y2:a,stroke:"#10b981",strokeWidth:2,strokeDasharray:"8 4",pointerEvents:"none"})},Ls=()=>{if(!ne)return null;const e=p.find(h=>h.id===ne.edgeId);if(!e)return null;const s=ne.end==="from"?"to":"from",n=s==="from"?e.from:e.to,a=s==="from"?e.fromAnchor:e.toAnchor,l=r.find(h=>h.id===n);if(!l)return null;const o=ue(l,a);let d=He.x,c=He.y;if(T){const h=r.find(m=>m.id===T.nodeId);if(h){const m=ue(h,T.anchor);d=m.x,c=m.y}}return t.jsx("line",{x1:o.x,y1:o.y,x2:d,y2:c,stroke:"#f59e0b",strokeWidth:2,strokeDasharray:"8 4",pointerEvents:"none"})},he=i.useCallback(async()=>{try{const s=await(await fetch(`${Ce}/api/v1/panorama/projects`)).json();s.projects&&H(s.projects)}catch{}},[]),[_t,Ge]=i.useState(!1),[Gt,Ft]=i.useState(!1),bt=i.useCallback(async e=>{var s,n;try{Re(!0),console.log("[Whiteboard] Loading project:",e);const l=await(await fetch(`${Ce}/api/v1/panorama/projects/${e}`)).json();if(console.log("[Whiteboard] Loaded data:",l),l.project){const o=l.project;console.log("[Whiteboard] Setting nodes:",(s=o.nodes)==null?void 0:s.length,"edges:",(n=o.edges)==null?void 0:n.length),x(o.nodes||[]),D(o.edges||[]),F(e),te([]),ke(new Set),$e(!1),Ge(!0)}}catch(a){console.error("[Whiteboard] Load error:",a)}finally{Re(!1)}},[]),Hs=i.useCallback(async()=>{if(P)try{De("saving"),Re(!0),await fetch(`${Ce}/api/v1/panorama/projects/${P}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({nodes:r,edges:p})}),De("saved"),$e(!1),he(),setTimeout(()=>De("idle"),2e3)}catch{De("error"),setTimeout(()=>De("idle"),2e3)}finally{Re(!1)}},[P,r,p,he]),Rs=i.useCallback(async()=>{try{const s=await(await fetch(`${Ce}/api/v1/panorama/projects`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:`æ–°é¡¹ç›® ${_.length+1}`})})).json();s.project&&(await he(),bt(s.project.id))}catch{}},[_.length,he,bt]),Ws=i.useCallback(async e=>{try{await fetch(`${Ce}/api/v1/panorama/projects/${e}`,{method:"DELETE"}),await he(),P===e&&(F(null),x([]),D([]))}catch{}},[P,he]),Os=i.useCallback(async(e,s)=>{try{await fetch(`${Ce}/api/v1/panorama/projects/${e}/name`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:s})}),await he()}catch{}},[he]);i.useEffect(()=>{he()},[he]),i.useEffect(()=>{if(_t&&r.length>0){Ge(!1);const e=new Set;r.forEach(b=>{r.some(g=>g.parentId===b.id)&&e.add(b.id)}),ke(e);const s=xe==="horizontal",n=s?200:100,a=s?30:40,l=50,o=150,d=80,c=80,h=[],m=b=>{const g=s?l:o;if(!e.has(b))return g;const j=r.filter(V=>V.parentId===b);if(j.length===0)return g;const C=j.reduce((V,R)=>V+m(R.id)+a,-a);return Math.max(g,C)},I=(b,g,j,C)=>{if(!r.find(se=>se.id===b))return;const q=j+(C-(s?l:o))/2;if(s?h.push({id:b,x:g,y:q}):h.push({id:b,x:q,y:g}),e.has(b)){const se=r.filter(B=>B.parentId===b);if(se.length>0){const B=g+(s?o:l)+n;let fe=j;se.forEach(ye=>{const Ae=m(ye.id);I(ye.id,B,fe,Ae),fe+=Ae+a})}}},N=w;if(N){const b=m(N);I(N,d,c,b)}else{const b=r.filter(j=>!j.parentId);if(b.length===0)return;let g=c;b.forEach(j=>{const C=m(j.id);I(j.id,d,g,C),g+=C+a*2})}h.length>0&&(x(b=>b.map(g=>{const j=h.find(C=>C.id===g.id);return j?{...g,x:j.x,y:j.y}:g})),setTimeout(()=>Ft(!0),50))}},[_t,r,w,xe]);const Kt=i.useCallback(()=>{if(r.length===0||!re.current)return;const e=Math.min(...r.map(R=>R.x)),s=Math.min(...r.map(R=>R.y)),n=Math.max(...r.map(R=>R.x+R.width)),a=Math.max(...r.map(R=>R.y+R.height)),l=n-e,o=a-s,d=re.current.getBoundingClientRect(),c=d.width,h=d.height,m=40,I=(c-m*2)/l,N=(h-m*2)/o,b=Math.min(Math.max(I,N,.8),1.2),g=(e+n)/2,j=(s+a)/2,C=c/2-g*b,V=h/2-j*b;me(b),we({x:C,y:V})},[r]);i.useEffect(()=>{Gt&&(Ft(!1),Kt())},[Gt,Kt]),i.useEffect(()=>{if(!re.current||r.length===0)return;let e=0;const s=new ResizeObserver(n=>{const a=n[0];if(!a)return;const l=a.contentRect.width;if(e&&Math.abs(l-e)>10){const o=l-e;we(d=>({...d,x:d.x+o/2}))}e=l});return s.observe(re.current),()=>s.disconnect()},[r.length]);const _s=i.useCallback(e=>{u.size!==0&&x(r.map(s=>u.has(s.id)?{...s,color:e}:s))},[u,r]),J=i.useCallback(()=>r.filter(e=>u.has(e.id)),[r,u]),Gs=i.useCallback(()=>{const e=J();if(e.length<2)return;const s=Math.min(...e.map(n=>n.x));x(r.map(n=>u.has(n.id)?{...n,x:s}:n))},[J,r,u]),Fs=i.useCallback(()=>{const e=J();if(e.length<2)return;const s=e.reduce((n,a)=>n+a.x+a.width/2,0)/e.length;x(r.map(n=>u.has(n.id)?{...n,x:s-n.width/2}:n))},[J,r,u]),Ks=i.useCallback(()=>{const e=J();if(e.length<2)return;const s=Math.max(...e.map(n=>n.x+n.width));x(r.map(n=>u.has(n.id)?{...n,x:s-n.width}:n))},[J,r,u]),Us=i.useCallback(()=>{const e=J();if(e.length<2)return;const s=Math.min(...e.map(n=>n.y));x(r.map(n=>u.has(n.id)?{...n,y:s}:n))},[J,r,u]),Vs=i.useCallback(()=>{const e=J();if(e.length<2)return;const s=e.reduce((n,a)=>n+a.y+a.height/2,0)/e.length;x(r.map(n=>u.has(n.id)?{...n,y:s-n.height/2}:n))},[J,r,u]),Bs=i.useCallback(()=>{const e=J();if(e.length<2)return;const s=Math.max(...e.map(n=>n.y+n.height));x(r.map(n=>u.has(n.id)?{...n,y:s-n.height}:n))},[J,r,u]),qs=i.useCallback(()=>{const e=J();if(e.length<3)return;const s=[...e].sort((h,m)=>h.x-m.x),n=s[0].x,a=s[s.length-1].x+s[s.length-1].width,l=s.reduce((h,m)=>h+m.width,0),o=(a-n-l)/(s.length-1);let d=n;const c=new Map;s.forEach((h,m)=>{c.set(h.id,d),d+=h.width+o}),x(r.map(h=>{const m=c.get(h.id);return m!==void 0?{...h,x:m}:h}))},[J,r]),Zs=i.useCallback(()=>{const e=J();if(e.length<3)return;const s=[...e].sort((h,m)=>h.y-m.y),n=s[0].y,a=s[s.length-1].y+s[s.length-1].height,l=s.reduce((h,m)=>h+m.height,0),o=(a-n-l)/(s.length-1);let d=n;const c=new Map;s.forEach((h,m)=>{c.set(h.id,d),d+=h.height+o}),x(r.map(h=>{const m=c.get(h.id);return m!==void 0?{...h,y:m}:h}))},[J,r]),Js=i.useCallback(()=>{if(u.size<2)return;const e=`group-${Date.now()}`,s=as[L.size%as.length],n=`Group ${L.size+1}`;U(a=>{const l=new Map(a);return l.set(e,{name:n,color:s}),l}),x(r.map(a=>u.has(a.id)?{...a,groupId:e}:a))},[u,r,L.size]),Qs=i.useCallback(e=>{x(r.map(s=>s.groupId===e?{...s,groupId:void 0}:s)),U(s=>{const n=new Map(s);return n.delete(e),n})},[r]),en=i.useCallback(e=>{const s=r.filter(n=>n.groupId===e).map(n=>n.id);v(new Set(s))},[r]),tn=i.useCallback(()=>{if(u.size===0)return null;const e=r.filter(n=>u.has(n.id));if(new Set(e.map(n=>n.groupId).filter(Boolean)).size===1){const n=e[0].groupId,a=r.filter(l=>l.groupId===n);if(a.length===e.length&&a.every(l=>u.has(l.id)))return n||null}return null},[u,r]),yt=i.useCallback(e=>{if(w&&e.id===w||(e.parentId||null)===w)return!0;const s=[];let n=e.parentId;for(;n;){s.unshift(n);const l=r.find(o=>o.id===n);if(!l)break;n=l.parentId}let a=!1;for(const l of s){const o=r.find(d=>d.id===l);if(!o||((o.parentId||null)===w&&(a=!0),a&&!ie.has(l)))return!1}return a},[r,w,ie]),Q=r.filter(yt),Fe=p.filter(e=>{if(w&&e.to===w)return!1;const s=r.find(a=>a.id===e.from),n=r.find(a=>a.id===e.to);return s&&n&&yt(s)&&yt(n)}),vt=i.useCallback(e=>{let s=0,n=r.find(a=>a.id===e);for(;n!=null&&n.parentId;)s++,n=r.find(a=>a.id===n.parentId);return s},[r]),ee=i.useCallback(e=>{if(e.layerType==="code")return pe.code.color;if(e.layerType==="feature"||e.layerType==="module"||e.layerType==="logic"){const s=vt(e.id);return Gn(s)}return e.color||"#3b82f6"},[vt]),Ut=i.useCallback(e=>{const s=xe==="horizontal",n=s?200:100,a=s?30:40,l=50,o=150,d=80,c=80,h=[],m=g=>{const j=s?l:o;if(!e.has(g))return j;const C=r.filter(R=>R.parentId===g);if(C.length===0)return j;const V=C.reduce((R,q)=>R+m(q.id)+a,-a);return Math.max(j,V)},I=(g,j,C,V)=>{if(!r.find(B=>B.id===g))return;const se=C+(V-(s?l:o))/2;if(s?h.push({id:g,x:j,y:se}):h.push({id:g,x:se,y:j}),e.has(g)){const B=r.filter(fe=>fe.parentId===g);if(B.length>0){const fe=j+(s?o:l)+n;let ye=C;B.forEach(Ae=>{const Jt=m(Ae.id);I(Ae.id,fe,ye,Jt),ye+=Jt+a})}}};if(w&&r.find(j=>j.id===w)){const j=m(w);return I(w,d,c,j),h}const N=r.filter(g=>(g.parentId||null)===w);if(N.length===0)return[];let b=c;return N.forEach(g=>{const j=m(g.id);I(g.id,d,b,j),b+=j+a*2}),h},[r,w,xe]),Ne=i.useCallback(e=>{const s=Ut(e);s.length>0&&x(n=>n.map(a=>{const l=s.find(o=>o.id===a.id);return l?{...a,x:l.x,y:l.y}:a}))},[Ut]),Vt=i.useCallback(e=>{const s=ie.has(e),n=new Set(ie);if(s){n.delete(e);const a=l=>{r.filter(o=>o.parentId===l).forEach(o=>{n.delete(o.id),a(o.id)})};a(e)}else n.add(e);ke(n),setTimeout(()=>Ne(n),0)},[r,ie,Ne]),sn=i.useCallback(()=>{const e=new Set;r.forEach(s=>{r.some(n=>n.parentId===s.id)&&e.add(s.id)}),ke(e),setTimeout(()=>Ne(e),0)},[r,Ne]),nn=i.useCallback(()=>{ke(new Set),setTimeout(()=>Ne(new Set),0)},[Ne]),Bt=i.useCallback(e=>{r.filter(n=>n.parentId===e).length>0&&(te([...K,e]),ke(n=>new Set([...n,e])),v(new Set),S(null),Ge(!0))},[r,K]),an=i.useCallback(()=>{K.length>0&&(te(K.slice(0,-1)),v(new Set),S(null))},[K]),qt=i.useCallback(e=>{te(K.slice(0,e)),v(new Set),S(null)},[K]),ln=i.useCallback(e=>{const s=[];let n=r.find(a=>a.id===e);for(;n;)s.unshift(n),n=n.parentId?r.find(a=>a.id===n.parentId):void 0;return s},[r]),Zt=i.useCallback(e=>r.some(s=>s.parentId===e),[r]),wt=i.useCallback(e=>{Xt(e),Yt(!0)},[]),rn=i.useCallback(()=>{Yt(!1),Xt(null)},[]),on=i.useCallback((e,s)=>{x(r.map(n=>n.id===e?{...n,description:s}:n))},[r]),jt=i.useCallback(e=>r.filter(s=>s.parentId===e),[r]),cn=i.useCallback(e=>{const s=r.find(o=>o.id===e);if(!s)return;const n=jt(e),a=`node-${Date.now()}`,l={id:a,x:s.x+s.width+80,y:s.y+n.length*70,width:120,height:50,name:`å­èŠ‚ç‚¹ ${n.length+1}`,shape:s.shape,color:s.color,parentId:e};x([...r,l]),D([...p,{id:`edge-${Date.now()}`,from:e,fromAnchor:"right",to:a,toAnchor:"left",lineType:"arrow-end",lineStyle:"solid",color:s.color}])},[r,p,jt]),Pe=i.useCallback(()=>{if(r.length===0)return;const e=xe==="horizontal",s=e?200:100,n=e?40:50,a=55,l=150,o=80,d=80,c=new Map,h=new Set;r.forEach(N=>{r.some(b=>b.parentId===N.id)&&h.add(N.id)});const m=N=>{const b=e?a:l;if(!h.has(N))return b;const g=r.filter(C=>C.parentId===N);if(g.length===0)return b;const j=g.reduce((C,V)=>C+m(V.id)+n,-n);return Math.max(b,j)},I=(N,b,g,j)=>{if(!r.find(q=>q.id===N))return;const R=g+(j-(e?a:l))/2;if(e?c.set(N,{x:b,y:R}):c.set(N,{x:R,y:b}),h.has(N)){const q=r.filter(se=>se.parentId===N);if(q.length>0){const se=b+(e?l:a)+s;let B=g;q.forEach(fe=>{const ye=m(fe.id);I(fe.id,se,B,ye),B+=ye+n})}}};if(w){const N=m(w);I(w,o,d,N)}else{const N=r.filter(g=>!g.parentId);let b=d;N.forEach(g=>{const j=m(g.id);I(g.id,o,b,j),b+=j+n*2})}x(N=>N.map(b=>{const g=c.get(b.id);return g?{...b,x:g.x,y:g.y}:b})),we({x:0,y:0}),me(1)},[r,w,xe]);i.useCallback(()=>{if(!w)return;const e=n=>{const a=r.filter(o=>o.parentId===n),l=[...a];return a.forEach(o=>{l.push(...e(o.id))}),l},s=e(w);s.length!==0&&(x(r.map(n=>s.some(a=>a.id===n.id)?{...n,parentId:w}:n)),setTimeout(()=>Pe(),100))},[w,r,Pe]),i.useCallback(()=>{if(Q.length===0)return;const e=Q.map(a=>({id:a.id,x:a.x,y:a.y,width:a.width,height:a.height})),s=Fe.map(a=>({from:a.from,to:a.to})),n=Hn(e,s,{startX:400,startY:300});x(r.map(a=>{const l=n.find(o=>o.id===a.id);return l?{...a,x:l.x,y:l.y}:a}))},[Q,Fe,r]),i.useCallback(()=>{if(Q.length===0)return;const e=Q.map(n=>({id:n.id,x:n.x,y:n.y,width:n.width,height:n.height})),s=Rn(e,{startX:100,startY:100,nodeSpacingH:50,nodeSpacingV:50});x(r.map(n=>{const a=s.find(l=>l.id===n.id);return a?{...n,x:a.x,y:a.y}:n}))},[Q,r]),i.useCallback(()=>{if(Q.length===0)return;const e=Q.map(n=>({id:n.id,x:n.x,y:n.y,width:n.width,height:n.height})),s=Wn(e,{startX:400,startY:300});x(r.map(n=>{const a=s.find(l=>l.id===n.id);return a?{...n,x:a.x,y:a.y}:n}))},[Q,r]);const dn=i.useCallback((e,s)=>{we({x:-e*O,y:-s*O})},[O]),hn=i.useCallback(()=>{if(!re.current)return{x:0,y:0,width:800,height:600};const e=re.current.getBoundingClientRect();return{x:-le.x/O,y:-le.y/O,width:e.width/O,height:e.height/O}},[le,O]),xn=i.useCallback(()=>{const e=_.find(o=>o.id===P),s={title:(e==null?void 0:e.name)||"ç™½æ¿",nodes:r.map(o=>({...o})),edges:p.map(o=>({...o})),exportedAt:new Date().toISOString()},n=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),a=URL.createObjectURL(n),l=document.createElement("a");l.href=a,l.download=`whiteboard-${Date.now()}.json`,l.click(),URL.revokeObjectURL(a)},[r,p,_,P]),un=i.useCallback(async()=>{if(!re.current||r.length===0)return;const e=40,s=Math.min(...r.map(C=>C.x))-e,n=Math.min(...r.map(C=>C.y))-e,a=Math.max(...r.map(C=>C.x+C.width))+e,l=Math.max(...r.map(C=>C.y+C.height))+e,o=a-s,d=l-n,c="http://www.w3.org/2000/svg",h=document.createElementNS(c,"svg");h.setAttribute("width",String(o)),h.setAttribute("height",String(d)),h.setAttribute("viewBox",`${s} ${n} ${o} ${d}`);const m=document.createElementNS(c,"rect");m.setAttribute("x",String(s)),m.setAttribute("y",String(n)),m.setAttribute("width",String(o)),m.setAttribute("height",String(d)),m.setAttribute("fill","#0f172a"),h.appendChild(m);const I=re.current.querySelector("g[transform]");if(I){const C=I.cloneNode(!0);C.setAttribute("transform",""),h.appendChild(C)}const N=new XMLSerializer().serializeToString(h),b=new Blob([N],{type:"image/svg+xml;charset=utf-8"}),g=URL.createObjectURL(b),j=new window.Image;j.onload=()=>{const C=document.createElement("canvas");C.width=o*2,C.height=d*2;const V=C.getContext("2d");V&&(V.scale(2,2),V.drawImage(j,0,0),C.toBlob(R=>{if(R){const q=document.createElement("a");q.href=URL.createObjectURL(R),q.download=`whiteboard-${Date.now()}.png`,q.click()}},"image/png")),URL.revokeObjectURL(g)},j.src=g},[r]);return t.jsxs("div",{ref:ft,className:`flex relative bg-slate-900 ${y?"h-full w-full":"h-screen"} ${rt?"fixed inset-0 z-50":""}`,children:[t.jsx(_n,{projects:_,currentProjectId:P,onSelectProject:bt,onCreateProject:Rs,onDeleteProject:Ws,onRenameProject:Os,isCollapsed:Z,onToggleCollapse:()=>ce(!Z)}),t.jsx("div",{className:"flex-1 flex min-w-0 h-full overflow-hidden",children:t.jsxs("div",{className:"flex-1 flex flex-col min-w-0 h-full",children:[t.jsxs("div",{className:`h-12 flex-shrink-0 flex items-center gap-1 px-2 border-b border-indigo-500/20 min-w-0 relative z-30 ${y?"bg-slate-900/40 backdrop-blur-sm":"bg-slate-900/40"}`,children:[K.length>0&&t.jsxs("div",{className:"flex items-center gap-1 mr-2",children:[t.jsx("button",{onClick:an,className:"flex items-center gap-1 px-2 py-1 text-xs text-slate-300 bg-slate-900/60 border border-indigo-500/30 rounded hover:bg-indigo-500/20",children:"â† è¿”å›ž"}),t.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-400",children:[t.jsx("button",{onClick:()=>qt(0),className:"hover:text-slate-200",children:"æ ¹"}),K.map((e,s)=>{const n=r.find(a=>a.id===e);return t.jsxs(kt.Fragment,{children:[t.jsx(Ve,{className:"w-3 h-3"}),t.jsx("button",{onClick:()=>qt(s+1),className:"hover:text-slate-200 max-w-[80px] truncate",title:n==null?void 0:n.name,children:(n==null?void 0:n.name)||e})]},e)})]}),t.jsx("div",{className:"w-px h-6 bg-slate-700/50 ml-2"})]}),t.jsx("div",{className:"flex items-center gap-0.5 p-0.5 bg-slate-900/60 border border-indigo-500/30 rounded-lg min-w-0 overflow-hidden",children:Object.keys(Nt).map(e=>t.jsx("div",{draggable:!0,onDragStart:s=>{zt(e),s.dataTransfer.setData("application/whiteboard-shape",e),s.dataTransfer.effectAllowed="copy"},onClick:()=>zt(e),className:`w-8 h-8 flex items-center justify-center text-base rounded cursor-grab active:cursor-grabbing transition-all ${st===e?"bg-blue-500/20 text-blue-300":"text-slate-400 hover:text-slate-200 hover:bg-slate-700/50"}`,title:`${Nt[e].label} - æ‹–åˆ°ç”»å¸ƒ`,children:Nt[e].icon},e))}),t.jsx("div",{className:"flex items-center gap-0.5 p-0.5 bg-slate-900/60 border border-indigo-500/30 rounded-lg min-w-0 overflow-hidden",children:Ye.map(e=>t.jsx("button",{onClick:()=>hs(e),className:`w-6 h-6 rounded-full border-2 transition-all ${nt===e?"border-white scale-110":"border-transparent hover:scale-105"}`,style:{backgroundColor:e}},e))}),t.jsx("div",{className:"w-px h-5 bg-slate-700/50"}),t.jsx("div",{className:"flex items-center gap-0.5 p-0.5 bg-slate-900/60 border border-indigo-500/30 rounded-lg",children:Object.keys(Se).map(e=>t.jsx("button",{onClick:()=>xs(e),className:`w-8 h-8 flex items-center justify-center text-base rounded transition-all ${at===e?"bg-blue-500/20 text-blue-300":"text-slate-400 hover:text-slate-200 hover:bg-slate-700/50"}`,title:Se[e].label,children:Se[e].icon},e))}),t.jsx("div",{className:"flex items-center gap-0.5 p-0.5 bg-slate-900/60 border border-indigo-500/30 rounded-lg",children:Object.keys(Me).map(e=>t.jsx("button",{onClick:()=>us(e),className:`px-2 h-8 flex items-center justify-center text-xs rounded transition-all ${lt===e?"bg-blue-500/20 text-blue-300":"text-slate-400 hover:text-slate-200 hover:bg-slate-700/50"}`,title:Me[e].label,children:Me[e].label},e))}),t.jsx("div",{className:"flex-1"}),t.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 bg-slate-900/60 border border-indigo-500/30 rounded-lg",children:[t.jsx("button",{onClick:()=>me(e=>Math.max(.3,e*.8)),className:"p-1 text-slate-400 hover:text-slate-200",children:t.jsx(ss,{className:"w-4 h-4"})}),t.jsxs("span",{className:"text-xs text-slate-400 w-10 text-center",children:[Math.round(O*100),"%"]}),t.jsx("button",{onClick:()=>me(e=>Math.min(3,e*1.25)),className:"p-1 text-slate-400 hover:text-slate-200",children:t.jsx(ts,{className:"w-4 h-4"})})]}),r.length>0&&t.jsx("button",{onClick:Ss,className:"px-2 py-1 text-xs text-red-400 bg-slate-800/50 border border-slate-700/50 rounded hover:bg-red-500/10",children:"æ¸…ç©º"}),t.jsxs("div",{className:"flex items-center gap-0.5 p-0.5 bg-slate-900/60 border border-indigo-500/30 rounded-lg",children:[t.jsx("button",{onClick:un,disabled:r.length===0,className:"p-1.5 text-slate-400 hover:text-slate-200 disabled:opacity-30",title:"å¯¼å‡º PNG",children:t.jsx(pn,{className:"w-4 h-4"})}),t.jsx("button",{onClick:xn,disabled:r.length===0,className:"p-1.5 text-slate-400 hover:text-slate-200 disabled:opacity-30",title:"å¯¼å‡º JSON",children:t.jsx($n,{className:"w-4 h-4"})})]}),t.jsxs("div",{className:"flex-shrink-0 flex items-center gap-1 bg-slate-800/50 border border-slate-700/50 rounded-lg p-0.5",children:[t.jsx("button",{onClick:()=>{Lt("horizontal"),setTimeout(Pe,50)},className:`px-2 py-1 text-xs rounded transition-colors ${xe==="horizontal"?"bg-blue-600 text-white":"text-slate-400 hover:text-slate-200"}`,title:"æ°´å¹³å¸ƒå±€ï¼šçˆ¶â†’å­ä»Žå·¦åˆ°å³",children:"å·¦â†’å³"}),t.jsx("button",{onClick:()=>{Lt("vertical"),setTimeout(Pe,50)},className:`px-2 py-1 text-xs rounded transition-colors ${xe==="vertical"?"bg-blue-600 text-white":"text-slate-400 hover:text-slate-200"}`,title:"åž‚ç›´å¸ƒå±€ï¼šçˆ¶â†’å­ä»Žä¸Šåˆ°ä¸‹",children:"ä¸Šâ†’ä¸‹"}),t.jsx("div",{className:"w-px h-4 bg-slate-600"}),t.jsx("button",{onClick:Pe,disabled:Q.length===0,className:"px-2 py-1 text-xs text-green-400 hover:bg-green-500/20 rounded disabled:opacity-30",title:"é‡æ–°æ•´ç†å¸ƒå±€",children:"æ•´ç†"})]}),t.jsxs("div",{className:"flex-shrink-0 flex items-center gap-1 bg-slate-800/50 border border-slate-700/50 rounded-lg p-0.5",children:[t.jsx("button",{onClick:sn,disabled:Q.length===0,className:"px-2 py-1 text-xs text-green-400 hover:bg-green-500/20 rounded disabled:opacity-30",title:"å±•å¼€æ‰€æœ‰å­èŠ‚ç‚¹",children:"å±•å¼€"}),t.jsx("div",{className:"w-px h-4 bg-slate-600"}),t.jsx("button",{onClick:nn,disabled:ie.size===0,className:"px-2 py-1 text-xs text-orange-400 hover:bg-orange-500/20 rounded disabled:opacity-30",title:"æ”¶èµ·æ‰€æœ‰å­èŠ‚ç‚¹",children:"æ”¶èµ·"})]}),t.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-slate-900/60 border border-indigo-500/30 rounded-lg",children:[t.jsx("button",{onClick:()=>me(e=>Math.max(.3,e*.8)),className:"p-1 text-slate-400 hover:text-slate-200",title:"ç¼©å°",children:t.jsx(ss,{className:"w-4 h-4"})}),t.jsxs("span",{className:"text-xs text-slate-400 w-12 text-center",children:[Math.round(O*100),"%"]}),t.jsx("button",{onClick:()=>me(e=>Math.min(3,e*1.25)),className:"p-1 text-slate-400 hover:text-slate-200",title:"æ”¾å¤§",children:t.jsx(ts,{className:"w-4 h-4"})}),t.jsx("div",{className:"w-px h-4 bg-slate-700 mx-1"}),t.jsx("button",{onClick:()=>{me(1),we({x:0,y:0})},className:"px-1.5 py-0.5 text-xs text-slate-400 hover:text-slate-200",title:"é‡ç½®è§†å›¾",children:"1:1"})]}),t.jsx("button",{onClick:()=>We(!0),className:"p-1.5 text-slate-400 bg-slate-800/50 border border-slate-700/50 rounded hover:text-slate-200",title:"å¿«æ·é”®å¸®åŠ© (?)",children:t.jsx(In,{className:"w-4 h-4"})}),t.jsxs("div",{className:"relative",children:[t.jsxs("button",{onClick:Hs,disabled:ge==="saving"||!P,className:`flex items-center gap-1 px-2 py-1 text-xs rounded transition-all ${P?ge==="saved"?"bg-green-500/20 text-green-300 border border-green-500/30":ge==="error"?"bg-red-500/20 text-red-300 border border-red-500/30":"bg-slate-800/50 text-slate-300 border border-slate-700/50 hover:bg-slate-700/50":"bg-slate-800/30 text-slate-500 border border-slate-700/30 cursor-not-allowed"}`,title:P?"ä¿å­˜":"è¯·å…ˆé€‰æ‹©æˆ–åˆ›å»ºé¡¹ç›®",children:[ge==="saving"?t.jsx(mn,{className:"w-3.5 h-3.5 animate-spin"}):ge==="saved"?t.jsx(rs,{className:"w-3.5 h-3.5"}):t.jsx(gn,{className:"w-3.5 h-3.5"}),ge==="saving"?"ä¿å­˜ä¸­":ge==="saved"?"å·²ä¿å­˜":"ä¿å­˜"]}),ps&&ge==="idle"&&P&&t.jsx("span",{className:"absolute -top-0.5 -right-0.5 w-2 h-2 bg-amber-400 rounded-full"})]}),!y&&t.jsx("button",{onClick:vs,className:"p-1.5 text-slate-400 bg-slate-800/50 border border-slate-700/50 rounded hover:text-slate-200",title:rt?"é€€å‡ºå…¨å±":"å…¨å±",children:rt?t.jsx(bn,{className:"w-4 h-4"}):t.jsx(yn,{className:"w-4 h-4"})})]}),t.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[t.jsx("div",{className:"flex-1 relative overflow-hidden bg-slate-900",children:t.jsxs("svg",{ref:re,width:"100%",height:"100%",style:{cursor:et||ve?"grabbing":X?"crosshair":"default"},onWheel:Ts,onMouseDown:zs,onMouseMove:Is,onMouseUp:Ot,onMouseLeave:Ot,onDrop:ws,onDragOver:js,children:[t.jsxs("defs",{children:[t.jsx("pattern",{id:"grid",width:30*O,height:30*O,patternUnits:"userSpaceOnUse",children:t.jsx("path",{d:`M ${30*O} 0 L 0 0 0 ${30*O}`,fill:"none",stroke:"rgba(71,85,105,0.15)",strokeWidth:"1"})}),[...Ye,"#64748b"].map(e=>t.jsxs(kt.Fragment,{children:[t.jsx("marker",{id:`arrowhead-${e.slice(1)}`,markerWidth:"12",markerHeight:"8",refX:"10",refY:"4",orient:"auto",children:t.jsx("polygon",{points:"0 0, 12 4, 0 8",fill:e})}),t.jsx("marker",{id:`arrowhead-start-${e.slice(1)}`,markerWidth:"12",markerHeight:"8",refX:"2",refY:"4",orient:"auto-start-reverse",children:t.jsx("polygon",{points:"0 0, 12 4, 0 8",fill:e})})]},e))]}),t.jsx("rect",{width:"100%",height:"100%",fill:"url(#grid)"}),t.jsxs("g",{transform:`translate(${le.x}, ${le.y}) scale(${O})`,children:[Fe.map(Ys),Q.filter(e=>e.parentId&&ie.has(e.parentId)).map(e=>{if(w&&e.id===w)return null;const s=Q.find(I=>I.id===e.parentId);if(!s)return null;const n=ee(s),a=xe==="horizontal";let l,o,d,c,h,m;if(a){l=s.x+s.width,o=s.y+s.height/2,d=e.x,c=e.y+e.height/2;const I=(l+d)/2;h=`M ${l} ${o} C ${I} ${o}, ${I} ${c}, ${d} ${c}`,m=`${d},${c} ${d-8},${c-4} ${d-8},${c+4}`}else{l=s.x+s.width/2,o=s.y+s.height,d=e.x+e.width/2,c=e.y;const I=(o+c)/2;h=`M ${l} ${o} C ${l} ${I}, ${d} ${I}, ${d} ${c}`,m=`${d},${c} ${d-4},${c-8} ${d+4},${c-8}`}return t.jsxs("g",{children:[t.jsx("path",{d:h,fill:"none",stroke:n,strokeWidth:2,strokeOpacity:.5,strokeDasharray:"6 4"}),t.jsx("polygon",{points:m,fill:n,fillOpacity:.7})]},`expand-edge-${s.id}-${e.id}`)}),Xs(),Ls(),cs.map((e,s)=>e.type==="v"?t.jsx("line",{x1:e.pos,y1:-1e4,x2:e.pos,y2:1e4,stroke:"#f472b6",strokeWidth:1,strokeDasharray:"4 4",pointerEvents:"none"},s):t.jsx("line",{x1:-1e4,y1:e.pos,x2:1e4,y2:e.pos,stroke:"#f472b6",strokeWidth:1,strokeDasharray:"4 4",pointerEvents:"none"},s)),Q.map(e=>{const s=u.has(e.id),n=A===e.id,a=dt===e.id,l=e.groupId?L.get(e.groupId):null,o=Zt(e.id),d=Xe===e.id;return o&&r.filter(c=>c.parentId===e.id).length,t.jsxs("g",{transform:`translate(${e.x}, ${e.y})`,onMouseDown:c=>Es(c,e),onDoubleClick:()=>Ms(e),onMouseEnter:c=>{if(Y(e.id),re.current){const h=re.current.getBoundingClientRect(),m=h.left+le.x+(e.x+e.width+10)*O,I=h.top+le.y+e.y*O;W({x:m,y:I})}},onMouseLeave:()=>{Y(null),W(null)},style:{cursor:o?"pointer":ve===e.id?"grabbing":"grab"},children:[o&&n&&!d&&t.jsx("rect",{x:-6,y:-6,width:e.width+12,height:e.height+12,rx:14,fill:"none",stroke:ee(e),strokeWidth:2,opacity:.6,pointerEvents:"none",children:t.jsx("animate",{attributeName:"opacity",values:"0.3;0.7;0.3",dur:"1.5s",repeatCount:"indefinite"})}),d&&t.jsxs("rect",{x:-8,y:-8,width:e.width+16,height:e.height+16,rx:16,fill:"none",stroke:"#22c55e",strokeWidth:3,pointerEvents:"none",children:[t.jsx("animate",{attributeName:"opacity",values:"1;0",dur:"0.3s",fill:"freeze"}),t.jsx("animate",{attributeName:"stroke-width",values:"3;6",dur:"0.3s",fill:"freeze"})]}),l&&t.jsx("rect",{x:-6,y:-6,width:e.width+12,height:e.height+12,rx:14,fill:`${l.color}15`,stroke:l.color,strokeWidth:2,strokeDasharray:"6 3",pointerEvents:"none"}),s&&t.jsx("rect",{x:-4,y:-4,width:e.width+8,height:e.height+8,rx:12,fill:"none",stroke:"#fbbf24",strokeWidth:2}),Ps(e,s,n,ee(e)),a?t.jsx("foreignObject",{x:4,y:e.height/2-12,width:e.width-8,height:24,children:t.jsx("input",{ref:Oe,autoFocus:!0,value:xt,onChange:c=>Tt(c.target.value),onBlur:()=>Wt(e.id,xt),onKeyDown:c=>{c.key==="Enter"&&Wt(e.id,xt),c.key==="Escape"&&ht(null)},onMouseDown:c=>c.stopPropagation(),onClick:c=>c.stopPropagation(),style:{width:"100%",background:"transparent",border:"none",color:"#f1f5f9",fontSize:12,textAlign:"center",outline:"none"}})}):t.jsx("foreignObject",{x:8,y:e.layerType?14:4,width:e.width-16,height:e.height-(e.layerType?18:8),children:t.jsx("div",{style:{height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:t.jsx("div",{style:{fontSize:12,fontWeight:600,color:"#f1f5f9",textAlign:"center",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.name})})}),As(e),s&&!a&&u.size===1&&t.jsx("rect",{x:e.width-6,y:e.height-6,width:12,height:12,fill:"#3b82f6",stroke:"#fff",strokeWidth:1,rx:2,style:{cursor:"se-resize"},onMouseDown:c=>{c.stopPropagation(),Pt({nodeId:e.id,corner:"se"}),bs({x:c.clientX,y:c.clientY,width:e.width,height:e.height})}}),l&&t.jsxs("g",{transform:`translate(${e.width-8}, -8)`,style:{cursor:"pointer"},onClick:c=>{c.stopPropagation(),e.groupId&&en(e.groupId)},onMouseDown:c=>c.stopPropagation(),children:[t.jsx("circle",{r:10,fill:l.color,stroke:"#1e293b",strokeWidth:2}),t.jsx("text",{x:0,y:4,fill:"#fff",fontSize:10,fontWeight:600,textAnchor:"middle",style:{pointerEvents:"none"},children:"G"}),t.jsx("title",{children:"Click to select entire group"})]}),o&&t.jsxs("g",{transform:`translate(${e.width+4}, ${e.height/2})`,style:{cursor:"pointer"},onClick:c=>{c.stopPropagation(),Vt(e.id)},onMouseDown:c=>c.stopPropagation(),children:[t.jsx("circle",{r:10,fill:ie.has(e.id)?ee(e):"#1e293b",stroke:ee(e),strokeWidth:2}),t.jsx("text",{x:0,y:4,fill:ie.has(e.id)?"#fff":ee(e),fontSize:14,fontWeight:600,textAnchor:"middle",style:{pointerEvents:"none"},children:ie.has(e.id)?"âˆ’":"+"}),t.jsxs("title",{children:[ie.has(e.id)?"æ”¶èµ·å­èŠ‚ç‚¹":"å±•å¼€å­èŠ‚ç‚¹"," (åŒå‡»è¿›å…¥)"]})]}),e.layerType&&t.jsxs("g",{transform:"translate(-8, -8)",children:[t.jsx("rect",{x:-22,y:-8,width:44,height:16,rx:8,fill:ee(e),stroke:"#1e293b",strokeWidth:1.5}),t.jsx("text",{x:0,y:4,fill:"#fff",fontSize:9,fontWeight:600,textAnchor:"middle",style:{pointerEvents:"none"},children:pe[e.layerType].label}),t.jsx("title",{children:pe[e.layerType].desc})]}),e.layerType==="code"&&e.filePath&&t.jsxs("g",{transform:`translate(8, ${e.height+6})`,style:{cursor:"pointer"},onClick:c=>{c.stopPropagation(),navigator.clipboard.writeText(e.filePath||"")},children:[t.jsx("text",{fill:"#10b981",fontSize:9,style:{pointerEvents:"none"},children:e.filePath.length>30?"..."+e.filePath.slice(-27):e.filePath}),t.jsxs("title",{children:["ç‚¹å‡»å¤åˆ¶è·¯å¾„: ",e.filePath]})]}),s&&u.size===1&&t.jsxs("g",{transform:`translate(${l?e.width-28:e.width-8}, -8)`,style:{cursor:"pointer"},onClick:c=>{c.stopPropagation(),wt(e.id)},onMouseDown:c=>c.stopPropagation(),children:[t.jsx("circle",{r:10,fill:"#3b82f6",stroke:"#1e293b",strokeWidth:2}),t.jsx("text",{x:0,y:4,fill:"#fff",fontSize:11,fontWeight:600,textAnchor:"middle",style:{pointerEvents:"none"},children:"i"}),t.jsx("title",{children:"æŸ¥çœ‹è¯¦æƒ… / æ·»åŠ å­èŠ‚ç‚¹"})]})]},e.id)}),f&&t.jsx("rect",{x:Math.min(f.startX,f.endX),y:Math.min(f.startY,f.endY),width:Math.abs(f.endX-f.startX),height:Math.abs(f.endY-f.startY),fill:"rgba(59, 130, 246, 0.1)",stroke:"#3b82f6",strokeWidth:1,strokeDasharray:"4 2",pointerEvents:"none"}),r.length===0&&t.jsxs("g",{transform:"translate(200, 120)",children:[t.jsx("rect",{x:-140,y:-60,width:280,height:120,rx:12,fill:"rgba(30,41,59,0.8)",stroke:"rgba(71,85,105,0.5)",strokeWidth:1,strokeDasharray:"4 2"}),t.jsx("text",{x:0,y:-15,fill:"#94a3b8",fontSize:13,textAnchor:"middle",children:"ç™½æ¿æ˜¯ç©ºçš„"}),t.jsx("text",{x:0,y:10,fill:"#64748b",fontSize:11,textAnchor:"middle",children:"æ‹–æ‹½ä¸Šæ–¹å½¢çŠ¶åˆ°è¿™é‡Œå¼€å§‹"}),t.jsx("text",{x:0,y:35,fill:"#64748b",fontSize:11,textAnchor:"middle",children:"ä»Žé”šç‚¹æ‹–å‡ºè¿žçº¿"})]})]})]})}),u.size>1&&t.jsxs("div",{className:"absolute bottom-20 left-1/2 -translate-x-1/2 flex flex-col gap-3 px-4 py-3 bg-slate-900/95 backdrop-blur-xl border border-indigo-500/30 rounded-xl shadow-2xl z-10",children:[t.jsxs("div",{className:"flex items-center justify-between gap-4",children:[t.jsxs("span",{className:"text-sm text-slate-300",children:["å·²é€‰ä¸­ ",u.size," ä¸ªèŠ‚ç‚¹"]}),t.jsx("button",{onClick:()=>v(new Set),className:"text-xs text-slate-400 hover:text-slate-200",children:"å–æ¶ˆé€‰æ‹©"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(vn,{className:"w-4 h-4 text-slate-400"}),t.jsx("span",{className:"text-sm text-slate-300 w-12",children:"é¢œè‰²:"}),t.jsx("div",{className:"flex items-center gap-1",children:Ye.map(e=>t.jsx("button",{onClick:()=>_s(e),className:"w-5 h-5 rounded-full border-2 border-transparent hover:border-white hover:scale-110 transition-all",style:{backgroundColor:e},title:`è®¾ç½®é¢œè‰² ${e}`},e))})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm text-slate-300 w-12",children:"å¯¹é½:"}),t.jsxs("div",{className:"flex items-center gap-0.5 p-0.5 bg-slate-700/50 rounded-lg",children:[t.jsx("button",{onClick:Gs,className:"p-1.5 text-slate-400 hover:text-slate-200 hover:bg-slate-600 rounded",title:"å·¦å¯¹é½",children:t.jsx(Sn,{className:"w-4 h-4"})}),t.jsx("button",{onClick:Fs,className:"p-1.5 text-slate-400 hover:text-slate-200 hover:bg-slate-600 rounded",title:"æ°´å¹³å±…ä¸­",children:t.jsx(kn,{className:"w-4 h-4"})}),t.jsx("button",{onClick:Ks,className:"p-1.5 text-slate-400 hover:text-slate-200 hover:bg-slate-600 rounded",title:"å³å¯¹é½",children:t.jsx(Mn,{className:"w-4 h-4"})}),t.jsx("div",{className:"w-px h-5 bg-slate-600 mx-1"}),t.jsx("button",{onClick:Us,className:"p-1.5 text-slate-400 hover:text-slate-200 hover:bg-slate-600 rounded",title:"é¡¶éƒ¨å¯¹é½",children:t.jsx(En,{className:"w-4 h-4"})}),t.jsx("button",{onClick:Vs,className:"p-1.5 text-slate-400 hover:text-slate-200 hover:bg-slate-600 rounded",title:"åž‚ç›´å±…ä¸­",children:t.jsx(jn,{className:"w-4 h-4"})}),t.jsx("button",{onClick:Bs,className:"p-1.5 text-slate-400 hover:text-slate-200 hover:bg-slate-600 rounded",title:"åº•éƒ¨å¯¹é½",children:t.jsx(Nn,{className:"w-4 h-4"})})]}),u.size>=3&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-px h-5 bg-slate-600 mx-1"}),t.jsxs("div",{className:"flex items-center gap-0.5 p-0.5 bg-slate-700/50 rounded-lg",children:[t.jsx("button",{onClick:qs,className:"p-1.5 text-slate-400 hover:text-slate-200 hover:bg-slate-600 rounded",title:"æ°´å¹³ç­‰é—´è·åˆ†å¸ƒ",children:t.jsx(Cn,{className:"w-4 h-4"})}),t.jsx("button",{onClick:Zs,className:"p-1.5 text-slate-400 hover:text-slate-200 hover:bg-slate-600 rounded",title:"åž‚ç›´ç­‰é—´è·åˆ†å¸ƒ",children:t.jsx(Dn,{className:"w-4 h-4"})})]})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm text-slate-300 w-12",children:"åˆ†ç»„:"}),(()=>{const e=tn();if(e){const s=L.get(e);return t.jsxs("button",{onClick:()=>Qs(e),className:"flex items-center gap-1.5 px-3 py-1.5 text-sm text-orange-400 bg-slate-700/50 hover:bg-orange-500/20 rounded-lg transition-all",title:"è§£æ•£å½“å‰ç»„",children:[t.jsx(An,{className:"w-3.5 h-3.5"}),"è§£æ•£ç»„",s&&t.jsx("span",{className:"w-3 h-3 rounded-full ml-1",style:{backgroundColor:s.color}})]})}else return t.jsxs("button",{onClick:Js,className:"flex items-center gap-1.5 px-3 py-1.5 text-sm text-purple-400 bg-slate-700/50 hover:bg-purple-500/20 rounded-lg transition-all",title:"å°†é€‰ä¸­èŠ‚ç‚¹åˆ›å»ºä¸ºä¸€ç»„",children:[t.jsx(zn,{className:"w-3.5 h-3.5"}),"åˆ›å»ºç»„"]})})()]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("button",{onClick:()=>{const e=r.filter(n=>u.has(n.id)),s=p.filter(n=>u.has(n.from)&&u.has(n.to));it({nodes:e.map(n=>({...n})),edges:s.map(n=>({...n}))})},className:"flex items-center gap-1.5 px-3 py-1.5 text-sm text-slate-300 bg-slate-700/50 hover:bg-slate-600 rounded-lg transition-all",title:"å¤åˆ¶ (Cmd+C)",children:[t.jsx(wn,{className:"w-3.5 h-3.5"}),"å¤åˆ¶"]}),t.jsxs("button",{onClick:pt,className:"flex items-center gap-1.5 px-3 py-1.5 text-sm text-red-400 bg-slate-700/50 hover:bg-red-500/20 rounded-lg transition-all",title:"åˆ é™¤ (Delete)",children:[t.jsx(os,{className:"w-3.5 h-3.5"}),"åˆ é™¤"]})]})]}),$&&t.jsxs("div",{className:"absolute bottom-20 left-1/2 -translate-x-1/2 flex flex-col gap-2 px-4 py-3 bg-slate-900/95 backdrop-blur-xl border border-indigo-500/30 rounded-xl shadow-2xl z-10",onMouseDown:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm text-slate-300 w-16",children:"ç®­å¤´:"}),Object.keys(Se).map(e=>{const s=p.find(l=>l.id===$),a=((s==null?void 0:s.lineType)||"arrow-end")===e;return t.jsx("button",{onClick:l=>{l.stopPropagation(),l.preventDefault(),ks(e)},className:`px-3 py-1.5 text-sm rounded-lg transition-all ${a?"bg-blue-500 text-white":"text-slate-400 hover:text-white hover:bg-slate-700"}`,title:Se[e].label,children:Se[e].icon},e)})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm text-slate-300 w-16",children:"æ ·å¼:"}),Object.keys(Me).map(e=>{const s=p.find(l=>l.id===$),a=((s==null?void 0:s.lineStyle)||"solid")===e;return t.jsx("button",{onClick:l=>{l.stopPropagation(),l.preventDefault(),Cs(e)},className:`px-3 py-1.5 text-sm rounded-lg transition-all ${a?"bg-blue-500 text-white":"text-slate-400 hover:text-white hover:bg-slate-700"}`,title:Me[e].label,children:Me[e].label},e)}),t.jsx("div",{className:"w-px h-6 bg-slate-600 mx-1"}),t.jsx("div",{className:"flex items-center gap-1",children:[...Ye,"#64748b"].map(e=>{const s=p.find(l=>l.id===$),a=((s==null?void 0:s.color)||"#64748b")===e;return t.jsx("button",{onClick:l=>{l.stopPropagation(),l.preventDefault(),Ns(e)},className:`w-5 h-5 rounded-full border-2 transition-all ${a?"border-white scale-110":"border-transparent hover:scale-105"}`,style:{backgroundColor:e},title:`çº¿æ¡é¢œè‰² ${e}`},e)})}),t.jsx("div",{className:"w-px h-6 bg-slate-600 mx-1"}),t.jsx("button",{onClick:e=>{e.stopPropagation(),e.preventDefault(),mt($)},className:"px-3 py-1.5 text-sm text-red-400 hover:text-white hover:bg-red-500 rounded-lg transition-all",children:"åˆ é™¤"})]})]}),Q.length>0&&t.jsx(Yn,{nodes:Q.map(e=>({id:e.id,x:e.x,y:e.y,width:e.width,height:e.height,color:e.color})),edges:Fe.map(e=>({from:e.from,to:e.to})),viewBox:hn(),canvasSize:{width:2e3,height:1500},onPanTo:dn}),A&&E&&!ve&&!X&&(()=>{const e=r.find(s=>s.id===A);return!e||!e.description?null:t.jsx("div",{className:"fixed z-50 pointer-events-none",style:{left:E.x,top:E.y,transform:"translateY(-50%)",maxWidth:280},children:t.jsxs("div",{className:"bg-slate-900/95 backdrop-blur-sm border border-slate-700/50 rounded-lg shadow-xl p-3",children:[t.jsx("div",{className:"absolute left-0 top-1/2 -translate-x-full -translate-y-1/2",style:{width:0,height:0,borderTop:"6px solid transparent",borderBottom:"6px solid transparent",borderRight:"6px solid rgba(51, 65, 85, 0.8)"}}),t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:ee(e)}}),t.jsx("span",{className:"text-sm font-medium text-slate-200 truncate",children:e.name}),e.layerType&&t.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded",style:{backgroundColor:`${ee(e)}30`,color:ee(e)},children:pe[e.layerType].label})]}),t.jsx("div",{className:"text-xs text-slate-400 leading-relaxed line-clamp-3",children:e.description}),Zt(e.id)&&t.jsxs("div",{className:"mt-2 text-xs text-slate-500",children:["åŒ…å« ",r.filter(s=>s.parentId===e.id).length," ä¸ªå­èŠ‚ç‚¹"]})]})})})()]}),u.size===1&&(()=>{const e=r.find(d=>d.id===[...u][0]);if(!e)return null;const s=e.parentId?r.find(d=>d.id===e.parentId):null,n=r.filter(d=>d.parentId===e.id),a=p.filter(d=>d.from===e.id),l=p.filter(d=>d.to===e.id),o=vt(e.id);return t.jsx("div",{className:"flex-shrink-0 border-t border-indigo-500/30 bg-slate-900/80 px-5 py-8 relative z-40",children:t.jsxs("div",{className:"max-w-6xl mx-auto",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[t.jsx("div",{className:"w-3 h-3 rounded",style:{backgroundColor:ee(e)}}),t.jsx("h3",{className:"text-base font-semibold text-white",children:e.name}),e.layerType&&t.jsx("span",{className:"px-2 py-0.5 text-xs rounded",style:{backgroundColor:`${ee(e)}30`,color:ee(e)},children:pe[e.layerType].label}),s&&t.jsxs("span",{className:"text-xs text-slate-500 cursor-pointer hover:text-slate-300",onClick:()=>v(new Set([s.id])),children:["â† ",s.name]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs text-slate-500 font-medium",children:"ç»“æž„"}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsxs("span",{className:"px-2 py-1 bg-slate-800 rounded text-xs text-slate-300",children:["æ·±åº¦ ",o]}),n.length>0&&t.jsxs("span",{className:"px-2 py-1 bg-blue-900/50 rounded text-xs text-blue-300 cursor-pointer hover:bg-blue-800/50",onClick:()=>Bt(e.id),children:[n.length," å­èŠ‚ç‚¹"]}),(a.length>0||l.length>0)&&t.jsxs("span",{className:"px-2 py-1 bg-purple-900/50 rounded text-xs text-purple-300",children:[a.length,"å‡º / ",l.length,"å…¥"]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("div",{className:"text-xs text-slate-500 font-medium",children:"ä¾èµ–å…³ç³»"}),a.length>0||l.length>0?t.jsxs("div",{className:"flex flex-wrap gap-1",children:[a.slice(0,3).map(d=>{const c=r.find(h=>h.id===d.to);return c&&t.jsxs("span",{className:"px-2 py-1 bg-slate-800 rounded text-xs text-slate-300 cursor-pointer hover:bg-slate-700",onClick:()=>v(new Set([c.id])),children:["â†’ ",c.name]},d.id)}),l.slice(0,3).map(d=>{const c=r.find(h=>h.id===d.from);return c&&t.jsxs("span",{className:"px-2 py-1 bg-slate-800 rounded text-xs text-slate-300 cursor-pointer hover:bg-slate-700",onClick:()=>v(new Set([c.id])),children:["â† ",c.name]},d.id)}),a.length+l.length>6&&t.jsxs("span",{className:"px-2 py-1 text-xs text-slate-500",children:["+",a.length+l.length-6," æ›´å¤š"]})]}):t.jsx("span",{className:"text-xs text-slate-500 italic",children:"æ— è¿žæŽ¥"})]}),t.jsx("div",{className:"space-y-2",children:e.layerType==="code"&&e.filePath?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-xs text-slate-500 font-medium",children:"æ–‡ä»¶"}),t.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 bg-slate-800 rounded text-green-400 cursor-pointer hover:bg-slate-700 w-fit",onClick:()=>navigator.clipboard.writeText(e.filePath||""),title:"ç‚¹å‡»å¤åˆ¶",children:[t.jsx(ls,{size:12}),t.jsx("span",{className:"font-mono text-xs truncate max-w-[200px]",children:e.filePath})]})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-xs text-slate-500 font-medium",children:"æè¿°"}),t.jsx("div",{className:"text-xs text-slate-300 line-clamp-2",children:e.description||t.jsx("span",{className:"text-slate-500 italic",children:"æ— "})})]})})]})]})})})()]})}),!At&&(()=>{const e=A?r.find(d=>d.id===A):u.size===1?r.find(d=>d.id===[...u][0]):null;if(!e)return null;const s=r.filter(d=>d.parentId===e.id),n=s.length,a=ie.has(e.id);e.parentId&&r.find(d=>d.id===e.parentId);const l=ln(e.id),o=p.filter(d=>d.from===e.id||d.to===e.id);return t.jsxs("div",{className:"w-60 flex-shrink-0 h-full max-h-full border-l border-indigo-500/20 flex flex-col overflow-hidden relative z-20",style:{background:"linear-gradient(180deg, #1e2a5e 0%, #1e1b4b 100%)"},children:[t.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-4 pb-3 border-b border-slate-700/50",children:[t.jsx("div",{className:"w-3 h-3 rounded",style:{backgroundColor:ee(e)}}),t.jsx("span",{className:"text-sm font-medium text-white truncate",children:e.name}),e.layerType&&t.jsx("span",{className:"text-xs text-slate-400 ml-auto",children:pe[e.layerType].label})]}),l.length>1&&t.jsxs("div",{className:"mb-4",children:[t.jsx("div",{className:"text-xs text-slate-500 mb-1",children:"è·¯å¾„"}),t.jsxs("div",{className:"flex items-center gap-1 text-xs text-slate-400 flex-wrap",children:[l.slice(0,-1).map((d,c)=>t.jsxs(kt.Fragment,{children:[t.jsx("span",{className:"hover:text-slate-200 cursor-pointer",onClick:()=>v(new Set([d.id])),children:d.name}),t.jsx(Ve,{size:10})]},d.id)),t.jsx("span",{className:"text-slate-200",children:e.name})]})]}),n>0&&t.jsxs("div",{className:"mb-4",children:[t.jsxs("div",{className:"text-sm text-slate-500 mb-2 font-medium",children:["å­èŠ‚ç‚¹ (",n,") ",a&&t.jsx("span",{className:"text-green-400",children:"å·²å±•å¼€"})]}),t.jsxs("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:[s.slice(0,8).map(d=>t.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-slate-800/50 rounded-lg cursor-pointer hover:bg-slate-700/50",onClick:()=>v(new Set([d.id])),children:[d.layerType&&t.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:ee(d)}}),t.jsx("span",{className:"text-sm text-slate-300 truncate",children:d.name}),r.some(c=>c.parentId===d.id)&&t.jsxs("span",{className:"text-xs text-slate-500 ml-auto",children:["+",r.filter(c=>c.parentId===d.id).length]})]},d.id)),n>8&&t.jsxs("div",{className:"text-xs text-slate-500 text-center py-1",children:["è¿˜æœ‰ ",n-8," ä¸ª..."]})]})]}),o.length>0&&t.jsxs("div",{className:"mb-4",children:[t.jsx("div",{className:"text-sm text-slate-500 mb-2 font-medium",children:"è¿žæŽ¥å…³ç³»"}),t.jsx("div",{className:"text-xs text-slate-400 space-y-1",children:o.slice(0,5).map(d=>{const c=d.from===e.id,h=r.find(m=>m.id===(c?d.to:d.from));return h?t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-slate-500",children:c?"â†’":"â†"}),t.jsx("span",{className:"text-slate-400 hover:text-slate-200 cursor-pointer",onClick:()=>v(new Set([h.id])),children:h.name})]},d.id):null})})]})]}),n>0&&t.jsxs("div",{className:"p-5 border-t border-slate-700 space-y-3",children:[t.jsx("button",{onClick:()=>Vt(e.id),className:`w-full py-3 text-white text-sm font-medium rounded-lg transition-colors ${a?"bg-orange-500 hover:bg-orange-600":"bg-green-500 hover:bg-green-600"}`,children:a?"æ”¶èµ·å­èŠ‚ç‚¹ â†‘":"å±•å¼€å­èŠ‚ç‚¹ â†“"}),t.jsx("button",{onClick:()=>Bt(e.id),className:"w-full py-3 bg-blue-500 hover:bg-blue-600 text-white text-sm font-medium rounded-lg transition-colors",children:"è¿›å…¥æŸ¥çœ‹è¯¦æƒ… â†’"})]})]})})(),At&&je&&(()=>{const e=r.find(n=>n.id===je);if(!e)return null;const s=jt(je);return t.jsxs("div",{className:"w-80 flex-shrink-0 h-full max-h-full border-l border-indigo-500/30 flex flex-col overflow-hidden",style:{background:"linear-gradient(180deg, #1e2a5e 0%, #1e1b4b 100%)"},children:[t.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-indigo-500/30",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded",style:{backgroundColor:ee(e)}}),t.jsx("span",{className:"font-medium text-slate-200",children:e.name})]}),t.jsx("button",{onClick:rn,className:"p-1 text-slate-400 hover:text-slate-200 rounded hover:bg-slate-700",children:t.jsx(is,{size:18})})]}),t.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-slate-400 mb-1.5",children:"å±‚çº§ç±»åž‹"}),t.jsx("div",{className:"grid grid-cols-2 gap-1.5",children:["feature","code"].map(n=>t.jsx("button",{onClick:()=>{x(a=>a.map(l=>l.id===je?{...l,layerType:n}:l)),$e(!0)},className:`px-2 py-1.5 text-xs rounded-lg border transition-all ${e.layerType===n?"border-transparent text-white":"border-slate-600 text-slate-400 hover:border-slate-500"}`,style:e.layerType===n?{backgroundColor:pe[n].color}:{},children:pe[n].label},n))}),e.layerType&&t.jsx("p",{className:"text-xs text-slate-500 mt-1.5",children:pe[e.layerType].desc})]}),e.layerType==="code"&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-slate-400 mb-1.5",children:"æ–‡ä»¶è·¯å¾„"}),t.jsx("input",{type:"text",value:e.filePath||"",onChange:n=>{x(a=>a.map(l=>l.id===je?{...l,filePath:n.target.value}:l)),$e(!0)},placeholder:"src/pages/Whiteboard.tsx:100",className:"w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-lg text-sm text-slate-200 placeholder-slate-500 focus:outline-none focus:border-green-500"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-slate-400 mb-1.5",children:"æè¿° / å¤‡æ³¨"}),t.jsx("textarea",{value:e.description||"",onChange:n=>on(je,n.target.value),placeholder:"æ·»åŠ æè¿°...",className:"w-full h-24 px-3 py-2 bg-slate-900 border border-slate-600 rounded-lg text-sm text-slate-200 placeholder-slate-500 resize-none focus:outline-none focus:border-blue-500"})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("label",{className:"text-xs text-slate-400",children:["å­èŠ‚ç‚¹ (",s.length,")"]}),t.jsxs("button",{onClick:()=>cn(je),className:"flex items-center gap-1 px-2 py-1 text-xs text-blue-400 hover:text-blue-300 hover:bg-slate-700 rounded",children:[t.jsx(Ct,{size:14}),"æ·»åŠ "]})]}),t.jsx("div",{className:"space-y-1",children:s.length===0?t.jsx("div",{className:"text-sm text-slate-500 py-3 text-center border border-dashed border-slate-600 rounded-lg",children:"æš‚æ— å­èŠ‚ç‚¹"}):s.map(n=>t.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-700 group",onClick:()=>{v(new Set([n.id])),wt(n.id)},children:[t.jsx("div",{className:"w-2 h-2 rounded",style:{backgroundColor:n.color||"#3b82f6"}}),t.jsx("span",{className:"flex-1 text-sm text-slate-300 truncate",children:n.name}),t.jsx(Ve,{size:14,className:"text-slate-500 group-hover:text-slate-300"})]},n.id))})]}),e.parentId&&(()=>{const n=r.find(a=>a.id===e.parentId);return n?t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs text-slate-400 mb-1.5",children:"çˆ¶èŠ‚ç‚¹"}),t.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-slate-900 rounded-lg cursor-pointer hover:bg-slate-700",onClick:()=>{v(new Set([n.id])),wt(n.id)},children:[t.jsx("div",{className:"w-2 h-2 rounded",style:{backgroundColor:n.color||"#3b82f6"}}),t.jsx("span",{className:"text-sm text-slate-300",children:n.name})]})]}):null})(),t.jsxs("div",{className:"pt-2 border-t border-slate-700",children:[t.jsx("label",{className:"block text-xs text-slate-400 mb-1.5",children:"èŠ‚ç‚¹ä¿¡æ¯"}),t.jsxs("div",{className:"text-xs text-slate-500 space-y-1",children:[t.jsxs("div",{children:["ID: ",e.id]}),t.jsxs("div",{children:["ä½ç½®: (",Math.round(e.x),", ",Math.round(e.y),")"]}),t.jsxs("div",{children:["å¤§å°: ",e.width," Ã— ",e.height]})]})]})]})]})})(),t.jsx(Ln,{isOpen:ys,onClose:()=>We(!1)})]})}export{Bn as default};
