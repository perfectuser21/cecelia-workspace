import{aa as P,ab as F,r as n,j as e,m as z,a5 as y,y as B,ae as O,a as Z,K as _,R as K,aw as V,aR as X,aS as q,k as G,B as H,Z as p,$ as j,_ as N,e as J,C as Q,A as Y,aT as ee,aU as te,aV as ae}from"./index-B5duVCzi.js";import{n as f}from"./n8n-workflows.api-DteZgY7-.js";function de(){var u,b;const{instance:r,id:c}=P(),k=F(),[t,v]=n.useState(null),[s,w]=n.useState(null),[i,g]=n.useState(!0),[o,h]=n.useState(null),[C,S]=n.useState(""),x=async()=>{if(!(!r||!c))try{const[a,l]=await Promise.all([f.getWorkflowDetail(r,c),f.getWorkflowExecutions(r,c,50)]);v(a),w(l),S(new Date().toLocaleTimeString("zh-CN")),h(null)}catch(a){h(a instanceof Error?a.message:"Failed to fetch data")}finally{g(!1)}};n.useEffect(()=>{x();const a=setInterval(x,3e4);return()=>clearInterval(a)},[r,c]);const m=()=>{g(!0),x()},T=a=>{switch(a){case"success":return"text-green-600 bg-green-100 dark:bg-green-900/30 dark:text-green-400";case"error":case"crashed":return"text-red-600 bg-red-100 dark:bg-red-900/30 dark:text-red-400";case"running":case"waiting":return"text-blue-600 bg-blue-100 dark:bg-blue-900/30 dark:text-blue-400";default:return"text-gray-600 bg-gray-100 dark:bg-gray-900/30 dark:text-gray-400"}},D=a=>{switch(a){case"success":return e.jsx(j,{className:"w-4 h-4"});case"error":case"crashed":return e.jsx(N,{className:"w-4 h-4"});case"running":case"waiting":return e.jsx(Y,{className:"w-4 h-4 animate-pulse"});default:return e.jsx(y,{className:"w-4 h-4"})}},L=a=>{switch(a){case"success":return"Success";case"error":return"Failed";case"crashed":return"Crashed";case"running":return"Running";case"waiting":return"Waiting";default:return a}},$=a=>{switch(a){case"schedule":return e.jsx(ae,{className:"w-4 h-4"});case"webhook":return e.jsx(te,{className:"w-4 h-4"});case"manual":return e.jsx(ee,{className:"w-4 h-4"});default:return e.jsx(p,{className:"w-4 h-4"})}},R=a=>{switch(a){case"schedule":return"Scheduled";case"webhook":return"Webhook";case"manual":return"Manual";default:return"Other"}},A=a=>new Date(a).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),E=a=>new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),I=(a,l)=>{if(!l)return"-";const M=new Date(a).getTime(),U=new Date(l).getTime(),d=Math.round((U-M)/1e3);return d<60?`${d}s`:d<3600?`${Math.floor(d/60)}m ${d%60}s`:`${Math.floor(d/3600)}h ${Math.floor(d%3600/60)}m`};if(i&&!t)return e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx(z,{className:"w-8 h-8 animate-spin text-blue-500"})});if(o&&!t)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-96",children:[e.jsx(y,{className:"w-12 h-12 text-red-500 dark:text-red-400 mb-4"}),e.jsx("p",{className:"text-red-600 dark:text-red-400 mb-3",children:o}),e.jsx("button",{onClick:m,className:"px-4 py-2 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-xl hover:from-blue-700 hover:to-blue-800 shadow-lg shadow-blue-500/25",children:"Retry"})]});const W=r==="local"?"http://localhost:5679":"#";return e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("button",{onClick:()=>k("/n8n/workflows"),className:"mt-1 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700 transition text-gray-500 dark:text-gray-400",children:e.jsx(B,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:(t==null?void 0:t.name)||"Loading..."}),e.jsxs("span",{className:`px-2.5 py-1 rounded-lg text-xs font-medium flex items-center gap-1 ${r==="local"?"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400"}`,children:[r==="local"?e.jsx(O,{className:"w-3 h-3"}):e.jsx(Z,{className:"w-3 h-3"}),r==="local"?"Local":"Cloud"]})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:["Updated at ",C]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("a",{href:`${W}/workflow/${c}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-4 py-2 border border-gray-200 dark:border-slate-600 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-50 dark:hover:bg-slate-700 transition",children:[e.jsx(_,{className:"w-4 h-4"}),"Open in n8n"]}),e.jsxs("button",{onClick:m,disabled:i,className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-xl hover:from-blue-700 hover:to-blue-800 disabled:opacity-50 shadow-lg shadow-blue-500/25",children:[e.jsx(K,{className:`w-4 h-4 ${i?"animate-spin":""}`}),"Refresh"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-gray-200 dark:border-slate-700 p-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-xl flex items-center justify-center ${t!=null&&t.active?"bg-gradient-to-br from-green-500 to-emerald-600 shadow-lg shadow-green-500/25":"bg-gradient-to-br from-gray-400 to-gray-500 shadow-lg shadow-gray-500/25"}`,children:t!=null&&t.active?e.jsx(V,{className:"w-5 h-5 text-white"}):e.jsx(X,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Status"}),e.jsx("div",{className:`text-lg font-bold ${t!=null&&t.active?"text-green-600 dark:text-green-400":"text-gray-500 dark:text-gray-400"}`,children:t!=null&&t.active?"Active":"Inactive"})]})]})}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-gray-200 dark:border-slate-700 p-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-violet-600 rounded-xl flex items-center justify-center shadow-lg shadow-purple-500/25",children:$(t==null?void 0:t.triggerType)}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Trigger"}),e.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-white",children:R(t==null?void 0:t.triggerType)}),(t==null?void 0:t.triggerInfo)&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 truncate max-w-[120px]",title:t.triggerInfo,children:t.triggerInfo})]})]})}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-gray-200 dark:border-slate-700 p-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-orange-500 to-amber-600 rounded-xl flex items-center justify-center shadow-lg shadow-orange-500/25",children:e.jsx(q,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Nodes"}),e.jsx("div",{className:"text-lg font-bold text-gray-900 dark:text-white",children:(t==null?void 0:t.nodeCount)||0})]})]})}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-gray-200 dark:border-slate-700 p-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-cyan-600 rounded-xl flex items-center justify-center shadow-lg shadow-blue-500/25",children:e.jsx(G,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Created"}),e.jsx("div",{className:"text-sm font-bold text-gray-900 dark:text-white",children:t!=null&&t.createdAt?E(t.createdAt):"-"})]})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-gray-200 dark:border-slate-700 p-6",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2 mb-5",children:[e.jsx(H,{className:"w-5 h-5"}),"Execution Statistics"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-slate-700/50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 dark:text-gray-400 text-sm mb-1",children:[e.jsx(p,{className:"w-4 h-4"}),"Total"]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:(s==null?void 0:s.total)||0})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-slate-700/50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-600 dark:text-green-400 text-sm mb-1",children:[e.jsx(j,{className:"w-4 h-4"}),"Success"]}),e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:(s==null?void 0:s.success)||0})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-slate-700/50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-600 dark:text-red-400 text-sm mb-1",children:[e.jsx(N,{className:"w-4 h-4"}),"Failed"]}),e.jsx("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:(s==null?void 0:s.error)||0})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-slate-700/50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-emerald-600 dark:text-emerald-400 text-sm mb-1",children:[e.jsx(J,{className:"w-4 h-4"}),"Success Rate"]}),e.jsxs("div",{className:`text-2xl font-bold ${((s==null?void 0:s.successRate)||0)>=90?"text-green-600 dark:text-green-400":((s==null?void 0:s.successRate)||0)>=70?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400"}`,children:[(s==null?void 0:s.successRate)||0,"%"]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-gray-200 dark:border-slate-700 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5 text-gray-700 dark:text-gray-300"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Recent Executions"}),e.jsxs("span",{className:"text-sm text-gray-400 dark:text-gray-500",children:["(Last ",((u=s==null?void 0:s.executions)==null?void 0:u.length)||0,")"]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-slate-700/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Mode"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Started"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Duration"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-slate-700",children:(b=s==null?void 0:s.executions)!=null&&b.length?s.executions.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-slate-700/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-3",children:e.jsxs("span",{className:"text-sm font-mono text-gray-600 dark:text-gray-300",children:["#",a.id]})}),e.jsx("td",{className:"px-6 py-3",children:e.jsxs("span",{className:`px-2.5 py-1 rounded-lg text-xs font-medium flex items-center gap-1 w-fit ${T(a.status)}`,children:[D(a.status),L(a.status)]})}),e.jsx("td",{className:"px-6 py-3 text-sm text-gray-500 dark:text-gray-400",children:a.mode}),e.jsx("td",{className:"px-6 py-3 text-sm text-gray-500 dark:text-gray-400",children:A(a.startedAt)}),e.jsx("td",{className:"px-6 py-3 text-sm text-gray-500 dark:text-gray-400 font-mono",children:I(a.startedAt,a.stoppedAt)})]},a.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-12 text-center text-gray-500 dark:text-gray-400",children:"No executions yet"})})})]})})]}),(t==null?void 0:t.description)&&e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-gray-200 dark:border-slate-700 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Description"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:t.description})]})]})}export{de as default};
