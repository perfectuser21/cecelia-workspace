import{c as T,r as m,j as e,b as $,C as u,A as h,L as i,i as E,Z as N}from"./index-BuPFs-8Q.js";import{g as I}from"./dev-tracker.api-CFjw6oWP.js";import{g as S}from"./engine.api-Cc7KQEmz.js";import{C as g}from"./check-circle-2-ClqW3yBL.js";import{A as k}from"./alert-circle-DgeeXCFK.js";import{G as p}from"./git-branch-Di9zeHyk.js";import{C as R}from"./clock-CaLttIlK.js";import{T as _}from"./terminal-Dav_wMy5.js";import{W as L}from"./workflow-0sDxJTZB.js";import"./client-DyfwnZmM.js";import"./index-B9ygI19o.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=T("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);function K(){var f;const[n,w]=m.useState([]),[c,v]=m.useState(null),[y,A]=m.useState(!0),j=async()=>{try{const[s,t]=await Promise.all([I(),S()]);s.success&&s.data&&w(s.data),t.success&&t.engine&&v(t.engine)}catch(s){console.error("Failed to fetch dashboard data:",s)}finally{A(!1)}};m.useEffect(()=>{j();const s=setInterval(j,3e4);return()=>clearInterval(s)},[]);const b=n.flatMap(s=>{const t=[],{repo:a,task:l,steps:r,quality:o}=s;return l.createdAt&&t.push({id:`${a.name}-start`,type:"task_start",title:`开始任务: ${l.name||s.branches.current}`,project:a.name,time:l.createdAt,branch:s.branches.current}),r.items.filter(d=>d.status==="done"&&d.completedAt).forEach(d=>{t.push({id:`${a.name}-step-${d.id}`,type:"task_complete",title:`完成 Step ${d.id}: ${d.name}`,project:a.name,time:d.completedAt,branch:s.branches.current})}),o.ci==="passed"?t.push({id:`${a.name}-ci-pass`,type:"ci_pass",title:"CI 检查通过",project:a.name,time:o.lastCheck,branch:s.branches.current}):o.ci==="failed"&&t.push({id:`${a.name}-ci-fail`,type:"ci_fail",title:"CI 检查失败",project:a.name,time:o.lastCheck,branch:s.branches.current}),l.prUrl&&t.push({id:`${a.name}-pr`,type:"pr",title:`创建 PR #${l.prNumber}`,project:a.name,time:l.createdAt,branch:s.branches.current}),t}).sort((s,t)=>new Date(t.time).getTime()-new Date(s.time).getTime()).slice(0,10),x={activeTasks:n.filter(s=>s.steps.current>0&&s.steps.current<10).length,completedToday:n.filter(s=>{if(!s.steps.items.every(r=>r.status==="done"||r.status==="skipped"))return!1;const a=s.steps.items.find(r=>r.status==="done"&&r.completedAt);if(!(a!=null&&a.completedAt))return!1;const l=new Date().toDateString();return new Date(a.completedAt).toDateString()===l}).length,failedTasks:n.filter(s=>s.quality.ci==="failed"||s.steps.items.some(t=>t.status==="failed")).length,totalRepos:new Set(n.map(s=>s.repo.name)).size},C=s=>{switch(s){case"commit":return e.jsx(p,{className:"w-4 h-4 text-blue-500"});case"pr":return e.jsx(p,{className:"w-4 h-4 text-purple-500"});case"task_start":return e.jsx(N,{className:"w-4 h-4 text-cyan-500"});case"task_complete":return e.jsx(g,{className:"w-4 h-4 text-emerald-500"});case"ci_pass":return e.jsx(g,{className:"w-4 h-4 text-green-500"});case"ci_fail":return e.jsx(k,{className:"w-4 h-4 text-red-500"});default:return e.jsx(h,{className:"w-4 h-4 text-gray-500"})}},D=s=>{const t=new Date(s),l=new Date().getTime()-t.getTime(),r=Math.floor(l/6e4);return r<1?"刚刚":r<60?`${r} 分钟前`:r<1440?`${Math.floor(r/60)} 小时前`:t.toLocaleDateString("zh-CN",{month:"short",day:"numeric"})};return y?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx($,{className:"w-8 h-8 text-cyan-500 animate-spin"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-slate-900 to-slate-800 rounded-2xl p-6 border border-cyan-500/20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white mb-1",children:"Engine 工作台"}),e.jsx("p",{className:"text-slate-400",children:new Date().toLocaleDateString("zh-CN",{weekday:"long",month:"long",day:"numeric"})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[c&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-slate-400",children:"Engine 版本"}),e.jsxs("p",{className:"text-lg font-mono text-cyan-400",children:["v",c.version]})]}),e.jsx("div",{className:"p-3 bg-cyan-500/20 rounded-xl",children:e.jsx(u,{className:"w-8 h-8 text-cyan-400"})})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-5 border border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-cyan-100 dark:bg-cyan-900/30 rounded-lg",children:e.jsx(h,{className:"w-5 h-5 text-cyan-600 dark:text-cyan-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"进行中"}),e.jsx("p",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:x.activeTasks})]})]})}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-5 border border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-emerald-100 dark:bg-emerald-900/30 rounded-lg",children:e.jsx(g,{className:"w-5 h-5 text-emerald-600 dark:text-emerald-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"今日完成"}),e.jsx("p",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:x.completedToday})]})]})}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-5 border border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-100 dark:bg-red-900/30 rounded-lg",children:e.jsx(k,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"需关注"}),e.jsx("p",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:x.failedTasks})]})]})}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-5 border border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg",children:e.jsx(p,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"活跃仓库"}),e.jsx("p",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:x.totalRepos})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between",children:[e.jsxs("h2",{className:"text-lg font-semibold text-slate-900 dark:text-white flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5 text-cyan-500"}),"最近活动"]}),e.jsxs(i,{to:"/engine/dev",className:"text-sm text-cyan-600 dark:text-cyan-400 hover:underline flex items-center gap-1",children:["查看全部 ",e.jsx(M,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:b.length===0?e.jsxs("div",{className:"p-8 text-center text-slate-500 dark:text-slate-400",children:[e.jsx(h,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"暂无最近活动"}),e.jsx("p",{className:"text-sm mt-1",children:"开始一个新任务吧"})]}):b.map(s=>e.jsx("div",{className:"p-4 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"mt-0.5",children:C(s.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-slate-900 dark:text-white truncate",children:s.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-slate-500 dark:text-slate-400",children:[e.jsx("span",{className:"font-mono bg-slate-100 dark:bg-slate-700 px-1.5 py-0.5 rounded",children:s.project}),s.branch&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(p,{className:"w-3 h-3"}),s.branch]})]})]}),e.jsx("span",{className:"text-xs text-slate-400 whitespace-nowrap",children:D(s.time)})]})},s.id))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-slate-900 dark:text-white mb-3 flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4 text-cyan-500"}),"进行中的任务"]}),n.filter(s=>s.steps.current>0&&s.steps.current<10).length===0?e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 py-4 text-center",children:"暂无进行中的任务"}):e.jsx("div",{className:"space-y-2",children:n.filter(s=>s.steps.current>0&&s.steps.current<10).slice(0,3).map(s=>e.jsxs(i,{to:"/engine/dev",className:"block p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-slate-900 dark:text-white truncate",children:s.task.name||s.branches.current}),e.jsxs("span",{className:"text-xs text-slate-500",children:["Step ",s.steps.current,"/10"]})]}),e.jsx("div",{className:"w-full h-1.5 bg-slate-200 dark:bg-slate-600 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-cyan-500 transition-all",style:{width:`${s.steps.current/10*100}%`}})})]},s.repo.name))})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-900 dark:text-white mb-3",children:"快捷入口"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(i,{to:"/engine",className:"flex items-center gap-2 p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors",children:[e.jsx(u,{className:"w-4 h-4 text-cyan-500"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:"能力概览"})]}),e.jsxs(i,{to:"/engine/tasks",className:"flex items-center gap-2 p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors",children:[e.jsx(h,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:"任务监控"})]}),e.jsxs(i,{to:"/engine/dev",className:"flex items-center gap-2 p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors",children:[e.jsx(E,{className:"w-4 h-4 text-emerald-500"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:"开发任务"})]}),e.jsxs(i,{to:"/cecilia",className:"flex items-center gap-2 p-3 bg-slate-50 dark:bg-slate-700/50 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors",children:[e.jsx(L,{className:"w-4 h-4 text-orange-500"}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:"Cecilia"})]})]})]}),c&&e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-slate-900 dark:text-white mb-3 flex items-center gap-2",children:[e.jsx(N,{className:"w-4 h-4 text-yellow-500"}),"Engine 能力"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between text-slate-600 dark:text-slate-400",children:[e.jsx("span",{children:"Skills"}),e.jsxs("span",{className:"font-medium text-slate-900 dark:text-white",children:[c.skills.length," 个"]})]}),e.jsxs("div",{className:"flex justify-between text-slate-600 dark:text-slate-400",children:[e.jsx("span",{children:"Hooks"}),e.jsxs("span",{className:"font-medium text-slate-900 dark:text-white",children:[c.hooks.length," 个"]})]}),e.jsxs("div",{className:"flex justify-between text-slate-600 dark:text-slate-400",children:[e.jsx("span",{children:"最近更新"}),e.jsx("span",{className:"font-medium text-slate-900 dark:text-white",children:((f=c.changelog[0])==null?void 0:f.date)||"-"})]})]})]})]})]})]})}export{K as default};
