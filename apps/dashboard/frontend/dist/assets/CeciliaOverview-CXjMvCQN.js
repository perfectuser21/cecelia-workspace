import{aX as I,R as o,Z as u,j as e,x as L,ab as A,r as d,_ as p,aL as O,A as C,$ as k,e as P,ax as z,aJ as $,C as _,az as S,aY as U}from"./index-BlJAP1Lt.js";import{f as B}from"./agents.api-BXQsx6BK.js";const G={Zap:u,RefreshCw:o,Diamond:I};function X({agent:t,onClick:a}){const r=G[t.icon]||u,c=t.status==="planned",i=t.stats.todayRunning>0;return e.jsxs("button",{onClick:a,disabled:c,className:`
        w-full text-left p-5 rounded-xl border transition-all duration-200
        ${c?"bg-slate-800/50 border-slate-700 opacity-60 cursor-not-allowed":`bg-gradient-to-br ${t.gradient.from} ${t.gradient.to} bg-opacity-10
             dark:bg-slate-800 hover:scale-[1.02] hover:shadow-lg ${t.gradient.border}`}
      `,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:`
          p-3 rounded-xl
          ${c?"bg-slate-700":`bg-gradient-to-br ${t.gradient.from} ${t.gradient.to}`}
        `,children:e.jsx(r,{className:"w-6 h-6 text-white"})}),!c&&e.jsx(L,{className:"w-5 h-5 text-gray-400"})]}),e.jsx("h3",{className:"text-lg font-bold text-white mb-1",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-400 mb-1",children:[t.role," · ",t.codename]}),c?e.jsx("div",{className:"mt-4 pt-4 border-t border-slate-700",children:e.jsx("span",{className:"text-sm text-gray-500",children:"待激活"})}):e.jsx("div",{className:"mt-4 pt-4 border-t border-white/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-2xl font-bold text-white",children:t.stats.todayTotal}),e.jsx("span",{className:"text-sm text-gray-400 ml-1",children:"今日"})]}),t.stats.todaySuccess>0&&e.jsxs("div",{className:"text-emerald-400 text-sm",children:[t.stats.todaySuccess," 成功"]}),t.stats.todayError>0&&e.jsxs("div",{className:"text-red-400 text-sm",children:[t.stats.todayError," 失败"]})]}),i&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 bg-blue-500/20 rounded-full",children:[e.jsx(o,{className:"w-3 h-3 text-blue-400 animate-spin"}),e.jsx("span",{className:"text-xs text-blue-400",children:"工作中"})]})]})})]})}const Z=[{value:"24h",label:"24时"},{value:"72h",label:"72时"},{value:"7d",label:"7天"}];function J({value:t,onChange:a}){return e.jsx("div",{className:"flex bg-slate-700 rounded-lg p-1",children:Z.map(r=>e.jsx("button",{onClick:()=>a(r.value),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-all ${t===r.value?"bg-blue-600 text-white shadow-sm":"text-gray-400 hover:text-white hover:bg-slate-600"}`,children:r.label},r.value))})}function q(){const t=A(),[a,r]=d.useState(null),[c,i]=d.useState(!0),[g,b]=d.useState(null),[N,T]=d.useState(null),[m,R]=d.useState("24h"),h=async()=>{try{const s=await B(m);r(s),b(null),T(new Date)}catch(s){b(s.message)}finally{i(!1)}};d.useEffect(()=>{i(!0),h();const s=setInterval(h,3e4);return()=>clearInterval(s)},[m]);const M=s=>{switch(s){case"completed":return e.jsx(k,{className:"w-4 h-4 text-emerald-500"});case"running":return e.jsx(o,{className:"w-4 h-4 text-blue-500 animate-spin"});case"failed":return e.jsx(p,{className:"w-4 h-4 text-red-500"});case"pending":return e.jsx(_,{className:"w-4 h-4 text-yellow-500"});default:return e.jsx(_,{className:"w-4 h-4 text-gray-400"})}},f=s=>new Date(s).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),E=s=>{const n=Math.floor((Date.now()-new Date(s).getTime())/1e3);return n<60?`${n}秒`:n<3600?`${Math.floor(n/60)}分${n%60}秒`:`${Math.floor(n/3600)}时${Math.floor(n%3600/60)}分`},D=s=>{switch(s){case"24h":return"过去 24 小时";case"72h":return"过去 72 小时";case"7d":return"过去 7 天"}},v=s=>s==="headless"?e.jsx(S,{className:"w-4 h-4 text-purple-400",title:"无头模式"}):e.jsx(U,{className:"w-4 h-4 text-cyan-400",title:"交互模式"}),w=s=>s==="headless"?"无头":"交互";if(c&&!a)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(o,{className:"w-8 h-8 text-blue-500 animate-spin"})});if(g&&!a)return e.jsxs("div",{className:"bg-red-900/20 border border-red-800 rounded-xl p-6 text-center",children:[e.jsx(p,{className:"w-12 h-12 text-red-500 mx-auto mb-3"}),e.jsxs("p",{className:"text-red-400",children:["加载失败: ",g]}),e.jsx("button",{onClick:h,className:"mt-4 px-4 py-2 bg-red-900/30 text-red-400 rounded-lg hover:bg-red-900/50 transition-colors",children:"重试"})]});const l=a==null?void 0:a.periodStats,j=(a==null?void 0:a.runningTasks)||[],y=(a==null?void 0:a.recentRuns)||[];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-violet-500 to-purple-600 rounded-xl",children:e.jsx(O,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Cecilia"}),e.jsxs("p",{className:"text-gray-400",children:["无头 Claude Code · ",j.length," 个运行中 · ",D(m)," ",(l==null?void 0:l.total)||0," 次任务"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(J,{value:m,onChange:R}),N&&e.jsx("span",{className:"text-sm text-gray-500",children:N.toLocaleTimeString("zh-CN")}),e.jsx("button",{onClick:h,disabled:c,className:"p-2 text-gray-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors disabled:opacity-50",children:e.jsx(o,{className:`w-5 h-5 ${c?"animate-spin":""}`})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsx(x,{icon:e.jsx(C,{className:"w-4 h-4 text-white"}),label:"运行中",value:(l==null?void 0:l.running)||0,color:"from-blue-500 to-cyan-600",animate:l&&l.running>0}),e.jsx(x,{icon:e.jsx(k,{className:"w-4 h-4 text-white"}),label:"成功",value:(l==null?void 0:l.success)||0,color:"from-green-500 to-emerald-600"}),e.jsx(x,{icon:e.jsx(p,{className:"w-4 h-4 text-white"}),label:"失败",value:(l==null?void 0:l.error)||0,color:"from-red-500 to-rose-600"}),e.jsx(x,{icon:e.jsx(u,{className:"w-4 h-4 text-white"}),label:"总数",value:(l==null?void 0:l.total)||0,color:"from-purple-500 to-violet-600"}),e.jsx(x,{icon:e.jsx(P,{className:"w-4 h-4 text-white"}),label:"成功率",value:`${(l==null?void 0:l.successRate)||0}%`,color:"from-emerald-500 to-teal-600"})]}),j.length>0&&e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-700 flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5 text-blue-400 animate-pulse"}),e.jsx("h2",{className:"font-semibold text-white",children:"正在运行的 Claude Code"}),e.jsxs("span",{className:"text-sm text-gray-400",children:["(",j.length," 个)"]})]}),e.jsx("div",{className:"p-4 space-y-3",children:j.map(s=>e.jsx("div",{className:"border border-blue-600/30 bg-blue-900/20 rounded-xl p-4 hover:bg-blue-900/30 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[v(s.mode),e.jsx("h3",{className:"font-medium text-white text-sm",children:s.project}),e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-purple-900/50 text-purple-300",children:w(s.mode)})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs text-gray-400",children:[e.jsx($,{className:"w-3 h-3"}),e.jsx("span",{children:s.feature_branch}),e.jsx("span",{className:"text-gray-600",children:"·"}),e.jsxs("span",{children:["开始于 ",f(s.started_at)]})]}),s.current_checkpoint&&e.jsxs("p",{className:"text-xs text-cyan-400 mt-1",children:["当前: ",s.current_checkpoint]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-24 h-2 bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-cyan-500 transition-all",style:{width:s.total_checkpoints>0?`${s.completed_checkpoints/s.total_checkpoints*100}%`:"0%"}})}),e.jsxs("span",{className:"text-xs text-gray-400 w-12 text-right",children:[s.completed_checkpoints,"/",s.total_checkpoints]})]}),e.jsxs("span",{className:"px-3 py-1 rounded-full text-sm font-medium bg-blue-900/50 text-blue-400 flex items-center gap-2",children:[e.jsx(C,{className:"w-4 h-4 animate-pulse"}),"已耗时 ",E(s.started_at)]})]})]})},s.id))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("h2",{className:"font-semibold text-white",children:"Agent 状态"}),e.jsxs("span",{className:"text-sm text-gray-400",children:["(",a==null?void 0:a.agents.length," 个)"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:a==null?void 0:a.agents.map(s=>e.jsx(X,{agent:s,onClick:()=>t(`/cecilia/agents/${s.id}`)},s.id))})]}),e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-slate-700 flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold text-white",children:"最近任务"}),e.jsx("button",{onClick:()=>t("/cecilia/runs"),className:"text-sm text-blue-400 hover:text-blue-300",children:"查看全部 →"})]}),y.length>0?e.jsx("div",{className:"divide-y divide-slate-700",children:y.map(s=>e.jsxs("div",{className:"px-6 py-4 flex items-center justify-between hover:bg-slate-700/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[M(s.status),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[v(s.mode),e.jsx("span",{className:"text-white",children:s.project}),e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-slate-700 text-gray-300",children:w(s.mode)})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-gray-500",children:[e.jsx($,{className:"w-3 h-3"}),e.jsx("span",{children:s.feature_branch}),e.jsx("span",{className:"text-gray-600",children:"·"}),e.jsxs("span",{children:[s.completed_checkpoints,"/",s.total_checkpoints," 步骤",s.failed_checkpoints>0&&e.jsxs("span",{className:"text-red-400 ml-1",children:["(",s.failed_checkpoints," 失败)"]})]})]})]})]}),e.jsx("span",{className:"text-sm text-gray-500",children:f(s.started_at)})]},s.id))}):e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(u,{className:"w-12 h-12 text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-400",children:"暂无任务"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"通过 N8N 工作流触发 Cecilia 执行任务"})]})]})]})}function x({icon:t,label:a,value:r,color:c,animate:i}){return e.jsx("div",{className:"bg-slate-800 rounded-xl border border-slate-700 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-9 h-9 bg-gradient-to-br ${c} rounded-xl flex items-center justify-center shadow-lg ${i?"animate-pulse":""}`,children:t}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400",children:a}),e.jsx("div",{className:"text-xl font-bold text-white",children:r})]})]})})}export{q as default};
