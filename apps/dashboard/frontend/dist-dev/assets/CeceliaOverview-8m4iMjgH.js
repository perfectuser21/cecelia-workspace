import{r as o,j as s,R as b,B as R,A as _,a1 as k,a0 as $,Z as D,ab as F,bb as S,aR as I,z as T}from"./index-ESCoPjhb.js";function A(){const[n,h]=o.useState(null),[g,f]=o.useState([]),[d,p]=o.useState(!0),[i,N]=o.useState("72h"),j=async()=>{try{const[e,t]=await Promise.all([fetch("/api/cecelia/overview?limit=100"),fetch("/api/cecelia/projects")]),a=await e.json(),r=await t.json();a.success&&h(a),r.success&&f(r.projects)}catch(e){console.error(e)}finally{p(!1)}};o.useEffect(()=>{j();const e=setInterval(j,1e4);return()=>clearInterval(e)},[]);const w=e=>{const r=Date.now()-(i==="24h"?24:i==="72h"?72:168)*60*60*1e3;return e.filter(y=>new Date(y.started_at).getTime()>=r)};if(d&&!n)return s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx(b,{className:"w-6 h-6 text-violet-400 animate-spin"})});const C=(n==null?void 0:n.recent_runs)||[],l=w(C),u=new Map;for(const e of g)u.set(e.name,{name:e.name,description:e.description,registeredFeatures:e.features,runningCount:0,completedCount:0,failedCount:0,recentRuns:[]});for(const e of l){const t=u.get(e.project);t?(t.recentRuns.push(e),e.status==="running"&&t.runningCount++,e.status==="completed"&&t.completedCount++,e.status==="failed"&&t.failedCount++):u.set(e.project,{name:e.project,description:"",registeredFeatures:[],runningCount:e.status==="running"?1:0,completedCount:e.status==="completed"?1:0,failedCount:e.status==="failed"?1:0,recentRuns:[e]})}const x=Array.from(u.values()).filter(e=>e.recentRuns.length>0||e.registeredFeatures.length>0),c={running:l.filter(e=>e.status==="running").length,completed:l.filter(e=>e.status==="completed").length,failed:l.filter(e=>e.status==="failed").length,total:l.length},v=i==="24h"?"24小时":i==="72h"?"72小时":"7天";return s.jsxs("div",{className:"space-y-5 max-w-5xl",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"p-2 bg-violet-600 rounded-lg",children:s.jsx(R,{className:"w-5 h-5 text-white"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-lg font-semibold text-white",children:"Cecelia v4"}),s.jsxs("p",{className:"text-xs text-gray-500",children:["近",v," · ",x.length,"个项目 · ",l.length,"个任务"]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"flex bg-slate-800 rounded border border-slate-700",children:["24h","72h","7d"].map(e=>s.jsx("button",{onClick:()=>N(e),className:`px-2 py-1 text-xs ${i===e?"bg-violet-600 text-white":"text-gray-400 hover:text-white"}`,children:e},e))}),s.jsx("button",{onClick:j,className:"p-1.5 text-gray-400 hover:text-white hover:bg-slate-700 rounded",children:s.jsx(b,{className:`w-4 h-4 ${d?"animate-spin":""}`})})]})]}),s.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[s.jsx(m,{icon:s.jsx(_,{className:"w-4 h-4"}),label:"运行中",value:c.running,color:"blue",pulse:c.running>0}),s.jsx(m,{icon:s.jsx(k,{className:"w-4 h-4"}),label:"成功",value:c.completed,color:"emerald"}),s.jsx(m,{icon:s.jsx($,{className:"w-4 h-4"}),label:"失败",value:c.failed,color:"red"}),s.jsx(m,{icon:s.jsx(D,{className:"w-4 h-4"}),label:"总数",value:c.total,color:"violet"})]}),s.jsxs("div",{children:[s.jsxs("h2",{className:"text-xs text-gray-400 mb-2",children:["项目 (",x.length,")"]}),x.length>0?s.jsx("div",{className:"space-y-3",children:x.map(e=>{const t=e.recentRuns.find(a=>a.status==="running");return e.recentRuns.filter(a=>a.status==="completed").sort((a,r)=>new Date(r.updated_at).getTime()-new Date(a.updated_at).getTime())[0],s.jsx(F,{to:`/cecelia/project/${encodeURIComponent(e.name)}`,className:`block bg-slate-800 rounded-lg border p-4 transition-all ${e.runningCount>0?"border-blue-500/40 hover:border-blue-500/60":"border-slate-700 hover:border-violet-500/50"}`,children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(S,{className:`w-4 h-4 ${e.runningCount>0?"text-blue-400":"text-violet-400"}`}),s.jsx("span",{className:"text-white font-medium truncate",children:e.name}),e.runningCount>0&&s.jsxs("span",{className:"px-1.5 py-0.5 text-xs bg-blue-500/20 text-blue-400 rounded flex items-center gap-1 flex-shrink-0",children:[s.jsx("span",{className:"w-1.5 h-1.5 bg-blue-400 rounded-full animate-pulse"}),e.runningCount]})]}),t&&s.jsxs("div",{className:"mt-2 text-sm",children:[s.jsx("span",{className:"text-white",children:t.prd_title||t.feature_branch}),t.current_step&&s.jsxs("span",{className:"text-blue-400 ml-2",children:["Step ",t.current_step,"/9"]})]}),s.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500 mt-2",children:[e.registeredFeatures.length>0&&s.jsxs("span",{className:"flex items-center gap-1",children:[s.jsx(I,{className:"w-3 h-3"}),e.registeredFeatures.length]}),e.completedCount>0&&s.jsxs("span",{className:"text-emerald-400",children:["✓ ",e.completedCount]}),e.failedCount>0&&s.jsxs("span",{className:"text-red-400",children:["✗ ",e.failedCount]})]})]}),s.jsx(T,{className:"w-5 h-5 text-gray-500 flex-shrink-0"})]})},e.name)})}):s.jsx("div",{className:"bg-slate-800 rounded-lg border border-slate-700 p-6 text-center",children:s.jsxs("p",{className:"text-gray-500 text-sm",children:["近",v,"暂无任务"]})})]})]})}function m({icon:n,label:h,value:g,color:f,pulse:d}){const p={blue:"bg-blue-500/20 text-blue-400",emerald:"bg-emerald-500/20 text-emerald-400",red:"bg-red-500/20 text-red-400",violet:"bg-violet-500/20 text-violet-400"};return s.jsx("div",{className:"bg-slate-800 rounded-lg border border-slate-700 p-3",children:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:`w-7 h-7 rounded flex items-center justify-center ${p[f]} ${d?"animate-pulse":""}`,children:n}),s.jsxs("div",{children:[s.jsx("div",{className:"text-xs text-gray-500",children:h}),s.jsx("div",{className:"text-base font-semibold text-white",children:g})]})]})})}export{A as default};
