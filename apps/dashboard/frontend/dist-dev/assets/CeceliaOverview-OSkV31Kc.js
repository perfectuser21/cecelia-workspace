import{r as o,j as e,R as u,B as h,A as j,a1 as p,a0 as b,Z as v,ab as g,aA as f,z as N}from"./index-D0DF2d61.js";function w(){const[t,c]=o.useState(null),[n,d]=o.useState(!0),a=async()=>{try{const l=await(await fetch("/api/cecelia/overview?limit=50")).json();l.success&&c(l)}catch(s){console.error(s)}finally{d(!1)}};if(o.useEffect(()=>{a();const s=setInterval(a,1e4);return()=>clearInterval(s)},[]),n&&!t)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(u,{className:"w-6 h-6 text-violet-400 animate-spin"})});const r=new Map;for(const s of(t==null?void 0:t.recent_runs)||[]){const l=r.get(s.project);l?(l.features.push(s),s.status==="running"&&l.runningCount++,s.status==="completed"&&l.completedCount++,!l.latestPrdTitle&&s.prd_title&&(l.latestPrdTitle=s.prd_title,l.latestPrdSummary=s.prd_summary)):r.set(s.project,{name:s.project,runningCount:s.status==="running"?1:0,completedCount:s.status==="completed"?1:0,features:[s],latestPrdTitle:s.prd_title,latestPrdSummary:s.prd_summary})}const x=Array.from(r.values()),m=((t==null?void 0:t.recent_runs)||[]).filter(s=>s.status==="running"||s.status==="completed").slice(0,5);return e.jsxs("div",{className:"space-y-6 max-w-6xl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2.5 bg-violet-600 rounded-lg",children:e.jsx(h,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-white",children:"Cecelia"}),e.jsx("p",{className:"text-sm text-gray-500",children:"无头 Claude Code 任务追踪"})]})]}),e.jsx("button",{onClick:a,className:"p-2 text-gray-400 hover:text-white hover:bg-slate-700 rounded",children:e.jsx(u,{className:`w-4 h-4 ${n?"animate-spin":""}`})})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsx(i,{icon:e.jsx(j,{className:"w-4 h-4"}),label:"运行中",value:(t==null?void 0:t.running)||0,color:"blue",pulse:(t==null?void 0:t.running)&&t.running>0}),e.jsx(i,{icon:e.jsx(p,{className:"w-4 h-4"}),label:"成功",value:(t==null?void 0:t.completed)||0,color:"emerald"}),e.jsx(i,{icon:e.jsx(b,{className:"w-4 h-4"}),label:"失败",value:(t==null?void 0:t.failed)||0,color:"red"}),e.jsx(i,{icon:e.jsx(v,{className:"w-4 h-4"}),label:"总数",value:(t==null?void 0:t.total_runs)||0,color:"violet"})]}),m.length>0&&e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700 p-4",children:[e.jsx("h2",{className:"text-sm text-gray-400 mb-3",children:"近期工作"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:m.map(s=>e.jsxs(g,{to:`/cecelia/run/${s.id}`,className:`px-3 py-1.5 rounded text-sm flex items-center gap-2 transition-colors ${s.status==="running"?"bg-blue-500/20 text-blue-400 hover:bg-blue-500/30":"bg-slate-700 text-gray-300 hover:bg-slate-600"}`,children:[s.status==="running"&&e.jsx("span",{className:"w-1.5 h-1.5 bg-blue-400 rounded-full animate-pulse"}),s.prd_title||s.feature_branch]},s.id))})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm text-gray-400 mb-3",children:"项目"}),x.length>0?e.jsx("div",{className:"space-y-3",children:x.map(s=>e.jsx(g,{to:`/cecelia/project/${encodeURIComponent(s.name)}`,className:"block bg-slate-800 rounded-lg border border-slate-700 p-4 hover:border-violet-500/50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"text-white font-medium",children:s.name}),s.runningCount>0&&e.jsxs("span",{className:"px-1.5 py-0.5 text-xs bg-blue-500/20 text-blue-400 rounded",children:[s.runningCount," 运行中"]})]}),s.latestPrdTitle&&e.jsxs("p",{className:"text-sm text-gray-400 mb-2",children:[s.latestPrdTitle,s.latestPrdSummary&&` - ${s.latestPrdSummary}`]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(f,{className:"w-3 h-3"}),s.features.length," features"]}),e.jsxs("span",{children:[s.completedCount," 已完成"]})]})]}),e.jsx(N,{className:"w-5 h-5 text-gray-500"})]})},s.name))}):e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700 p-8 text-center",children:[e.jsx(h,{className:"w-10 h-10 text-gray-600 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500",children:"暂无项目数据"})]})]})]})}function i({icon:t,label:c,value:n,color:d,pulse:a}){const r={blue:"bg-blue-500/20 text-blue-400",emerald:"bg-emerald-500/20 text-emerald-400",red:"bg-red-500/20 text-red-400",violet:"bg-violet-500/20 text-violet-400"};return e.jsx("div",{className:"bg-slate-800 rounded-lg border border-slate-700 p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${r[d]} ${a?"animate-pulse":""}`,children:t}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:c}),e.jsx("div",{className:"text-lg font-semibold text-white",children:n})]})]})})}export{w as default};
