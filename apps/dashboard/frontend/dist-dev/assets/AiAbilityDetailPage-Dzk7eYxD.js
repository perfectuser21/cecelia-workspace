import{a5 as w,a6 as y,r as i,j as e,m as b,y as k,am as v,C as T,_ as A,d as C}from"./index-CtUv-lZj.js";import{g as S,b as E}from"./ai-employees.api-DCgx3ksA.js";function F(){const{employeeId:t,abilityId:a}=w(),r=y(),[n,m]=i.useState(null),[d,c]=i.useState(""),[o,l]=i.useState([]),[f,h]=i.useState(!0),[g,D]=i.useState(!0);i.useEffect(()=>{if(!t||!a){r("/ai-employees");return}const s=S(t);if(!s){r("/ai-employees");return}const x=s.abilities.find(u=>u.id===a);if(!x){r(`/ai-employees/${t}`);return}c(s.name),m(x),p()},[t,a,r]);const p=async()=>{if(!(!t||!a)){h(!0);try{const x=(await E(t)).filter(u=>u.abilityId===a);l(x)}catch(s){console.error("Failed to load tasks:",s)}finally{h(!1)}}},j=()=>{alert("功能开发中")},N=()=>{r(`/ai-employees/${t}`)};return n?e.jsxs("div",{className:"px-4 sm:px-0 pb-8",children:[e.jsxs("button",{onClick:N,className:"flex items-center gap-2 mb-6 text-slate-600 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:[e.jsx(k,{className:"w-5 h-5"}),e.jsxs("span",{children:["返回 ",d]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-semibold text-slate-800 dark:text-white mb-2",children:n.name}),n.description&&e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:n.description}),e.jsxs("p",{className:"text-sm text-slate-400 dark:text-slate-500 mt-1",children:["所属员工: ",d]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-sm mb-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-800 dark:text-white mb-1",children:"自动运行"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:"定时自动执行此职能的任务"})]}),e.jsx("button",{className:`relative inline-flex h-7 w-12 items-center rounded-full transition-colors ${g?"bg-blue-600":"bg-slate-300 dark:bg-slate-600"}`,disabled:!0,children:e.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full bg-white transition-transform ${g?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("button",{onClick:j,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl font-medium transition-colors",children:[e.jsx(v,{className:"w-5 h-5"}),"手动运行"]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-sm p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-slate-800 dark:text-white mb-4",children:"最近执行记录"}),f?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(b,{className:"w-6 h-6 text-blue-500 animate-spin"})}):o.length===0?e.jsx("div",{className:"text-center py-12 text-slate-400 dark:text-slate-500",children:"暂无执行记录"}):e.jsx("div",{className:"space-y-3",children:o.map(s=>e.jsx($,{task:s},s.id))})]})]}):e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx(b,{className:"w-8 h-8 text-blue-500 animate-spin"})})}function $({task:t}){const a=()=>{switch(t.status){case"success":return e.jsx(C,{className:"w-5 h-5 text-green-500"});case"error":return e.jsx(A,{className:"w-5 h-5 text-red-500"});case"running":case"waiting":return e.jsx(b,{className:"w-5 h-5 text-blue-500 animate-spin"});default:return e.jsx(T,{className:"w-5 h-5 text-slate-400"})}},r=()=>{switch(t.status){case"success":return"成功";case"error":return"失败";case"running":return"运行中";case"waiting":return"等待中";default:return"未知"}},n=()=>{switch(t.status){case"success":return"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800";case"error":return"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800";case"running":case"waiting":return"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800";default:return"bg-slate-50 dark:bg-slate-700 border-slate-200 dark:border-slate-600"}},m=c=>new Date(c).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}),d=()=>{if(!t.stoppedAt)return null;const c=new Date(t.startedAt).getTime(),l=new Date(t.stoppedAt).getTime()-c;return l<1e3?`${l}ms`:l<6e4?`${(l/1e3).toFixed(1)}s`:`${(l/6e4).toFixed(1)}m`};return e.jsx("div",{className:`p-4 rounded-xl border ${n()}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[a(),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h3",{className:"text-sm font-medium text-slate-800 dark:text-white truncate",children:t.workflowName}),e.jsx("span",{className:"text-xs font-medium text-slate-600 dark:text-slate-300 ml-2",children:r()})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-slate-500 dark:text-slate-400",children:[e.jsx("span",{children:m(t.startedAt)}),d()&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"·"}),e.jsxs("span",{children:["耗时 ",d()]})]})]})]})]})})}export{F as default};
