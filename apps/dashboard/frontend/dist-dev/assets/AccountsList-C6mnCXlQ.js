import{j as e,a2 as F,an as B,C as w,_ as I,d as P,ao as H,R as y,B as L,v as R,a6 as z,r as u,s as C,i as D}from"./index-CtUv-lZj.js";import{a as i}from"./client-DyfwnZmM.js";import"./index-B9ygI19o.js";const E=({status:t,text:s,size:n="md"})=>{const a=(()=>{switch(t){case"success":case"active":case"valid":return{icon:P,text:s||"成功",bgColor:"bg-green-50",textColor:"text-green-700",iconColor:"text-green-500",borderColor:"border-green-200"};case"failed":case"error":case"expired":return{icon:I,text:s||"失败",bgColor:"bg-red-50",textColor:"text-red-700",iconColor:"text-red-500",borderColor:"border-red-200"};case"running":return{icon:w,text:s||"运行中",bgColor:"bg-blue-50",textColor:"text-blue-700",iconColor:"text-blue-500",borderColor:"border-blue-200",animate:!0};case"waiting":return{icon:w,text:s||"等待中",bgColor:"bg-gray-50",textColor:"text-gray-700",iconColor:"text-gray-500",borderColor:"border-gray-200"};case"paused":return{icon:B,text:s||"已暂停",bgColor:"bg-yellow-50",textColor:"text-yellow-700",iconColor:"text-yellow-500",borderColor:"border-yellow-200"};case"unknown":default:return{icon:F,text:s||"未知",bgColor:"bg-gray-50",textColor:"text-gray-700",iconColor:"text-gray-500",borderColor:"border-gray-200"}}})(),x=a.icon,g={sm:"px-2 py-1 text-xs",md:"px-2.5 py-1.5 text-sm",lg:"px-3 py-2 text-base"},c={sm:"w-3 h-3",md:"w-4 h-4",lg:"w-5 h-5"};return e.jsxs("span",{className:`inline-flex items-center gap-1.5 rounded-full border font-medium ${a.bgColor} ${a.textColor} ${a.borderColor} ${g[n]}`,children:[e.jsx(x,{className:`${c[n]} ${a.iconColor} ${a.animate?"animate-spin":""}`}),a.text]})},T=({account:t,onLogin:s,onViewMetrics:n,onDelete:o,onHealthCheck:a})=>{const x=l=>({xiaohongshu:"小红书",douyin:"抖音",bilibili:"B站",weibo:"微博"})[l]||l,c=(l=>({xiaohongshu:{bg:"bg-red-100",text:"text-red-700"},douyin:{bg:"bg-black",text:"text-white"},bilibili:{bg:"bg-pink-100",text:"text-pink-700"},weibo:{bg:"bg-orange-100",text:"text-orange-700"}})[l]||{bg:"bg-gray-100",text:"text-gray-700"})(t.platform),b=l=>l?new Date(l).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-";return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-5 hover:shadow-md transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[t.avatar?e.jsx("img",{src:t.avatar,alt:t.displayName,className:"w-12 h-12 rounded-full object-cover"}):e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${c.bg} ${c.text} font-semibold`,children:t.displayName.charAt(0)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 truncate mb-1",children:t.displayName}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`px-2 py-0.5 rounded-md text-xs font-medium ${c.bg} ${c.text}`,children:x(t.platform)}),e.jsx(E,{status:t.loginStatus,text:t.loginStatus==="valid"?"已登录":"已过期",size:"sm"})]})]})]}),e.jsx("button",{className:"p-1 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(H,{className:"w-5 h-5 text-gray-400"})})]}),e.jsxs("div",{className:"mb-4 pb-4 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500",children:"账号ID"}),e.jsx("span",{className:"font-mono text-gray-900",children:t.accountId})]}),t.lastHealthCheck&&e.jsxs("div",{className:"flex items-center justify-between text-sm mt-2",children:[e.jsx("span",{className:"text-gray-500",children:"最后检查"}),e.jsx("span",{className:"text-gray-900",children:b(t.lastHealthCheck.checkedAt)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.loginStatus!=="valid"&&e.jsxs("button",{onClick:()=>s==null?void 0:s(t.platform,t.accountId),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium text-sm hover:bg-blue-700 transition-colors",children:[e.jsx(y,{className:"w-4 h-4"}),"重新登录"]}),t.loginStatus==="valid"&&e.jsxs("button",{onClick:()=>a==null?void 0:a(t.id),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 border border-gray-200 text-gray-700 rounded-lg font-medium text-sm hover:bg-gray-50 transition-colors",children:[e.jsx(y,{className:"w-4 h-4"}),"检查状态"]}),e.jsxs("button",{onClick:()=>n==null?void 0:n(t.id),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 border border-gray-200 text-gray-700 rounded-lg font-medium text-sm hover:bg-gray-50 transition-colors",children:[e.jsx(L,{className:"w-4 h-4"}),"查看数据"]}),e.jsx("button",{onClick:()=>o==null?void 0:o(t.id),className:"p-2 border border-red-200 text-red-600 rounded-lg hover:bg-red-50 transition-colors",title:"删除账号",children:e.jsx(R,{className:"w-5 h-5"})})]})]})},h={getAccounts:async t=>(await i.get("/v1/accounts",{params:{platform:t}})).data,getAccount:async t=>(await i.get(`/v1/accounts/${t}`)).data,addAccount:async t=>(await i.post("/v1/accounts",t)).data,updateAccount:async(t,s)=>(await i.put(`/v1/accounts/${t}`,s)).data,deleteAccount:async t=>{await i.delete(`/v1/accounts/${t}`)},healthCheck:async t=>(await i.post(`/v1/accounts/${t}/healthcheck`)).data,batchHealthCheck:async()=>(await i.post("/v1/accounts/healthcheck/batch")).data.results,initiateLogin:async(t,s)=>(await i.post("/v1/login/initiate",{platform:t,accountId:s})).data,getLoginStatus:async t=>(await i.get(`/v1/login/status/${t}`)).data,refreshQRCode:async t=>(await i.post(`/v1/login/refresh/${t}`)).data,getAccountMetrics:async(t,s,n)=>(await i.get(`/v1/accounts/${t}/metrics`,{params:{startDate:s,endDate:n}})).data,exportAccountData:async(t,s="csv")=>(await i.get(`/v1/accounts/${t}/export`,{params:{format:s},responseType:"blob"})).data};function q(){const t=z(),[s,n]=u.useState([]),[o,a]=u.useState("all"),[x,g]=u.useState(!0),[c,b]=u.useState(!1);u.useEffect(()=>{l()},[o]);const l=async()=>{try{g(!0);const r=o==="all"?void 0:o,d=await h.getAccounts(r);n(d)}catch(r){console.error("Failed to load accounts:",r)}finally{g(!1)}},p=()=>{const r=prompt("请选择平台 (xiaohongshu/douyin/bilibili/weibo)");if(!r)return;const d=prompt("请输入账号ID");if(!d)return;const j=prompt("请输入显示名称");j&&h.addAccount({platform:r,accountId:d,displayName:j}).then(()=>{alert("账号添加成功"),l()}).catch(S=>{console.error("Failed to add account:",S),alert("添加失败")})},N=(r,d)=>{t(`/login/${r}/${d}`)},v=r=>{t(`/accounts/${r}/metrics`)},k=async r=>{if(confirm("确定要删除此账号吗？"))try{await h.deleteAccount(r),alert("账号已删除"),await l()}catch(d){console.error("Failed to delete account:",d),alert("删除失败")}},$=async r=>{try{await h.healthCheck(r),alert("健康检查已完成"),await l()}catch(d){console.error("Failed to health check:",d),alert("检查失败")}},A=async()=>{try{b(!0),await h.batchHealthCheck(),alert("批量健康检查已完成"),await l()}catch(r){console.error("Failed to batch health check:",r),alert("检查失败")}finally{b(!1)}},m={all:s.length,xiaohongshu:s.filter(r=>r.platform==="xiaohongshu").length,douyin:s.filter(r=>r.platform==="douyin").length,bilibili:s.filter(r=>r.platform==="bilibili").length,weibo:s.filter(r=>r.platform==="weibo").length},f=o==="all"?s:s.filter(r=>r.platform===o);return x?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"账号管理"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"管理所有社交媒体平台账号"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:A,disabled:c,className:"flex items-center gap-2 px-4 py-2 border border-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors disabled:opacity-50",children:[e.jsx(y,{className:`w-4 h-4 ${c?"animate-spin":""}`}),c?"检查中...":"批量检查"]}),e.jsxs("button",{onClick:p,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition-colors",children:[e.jsx(C,{className:"w-4 h-4"}),"添加账号"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5 text-gray-400"}),e.jsxs("div",{className:"flex items-center gap-2 bg-white rounded-lg border border-gray-200 p-1",children:[e.jsxs("button",{onClick:()=>a("all"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${o==="all"?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:["全部 (",m.all,")"]}),e.jsxs("button",{onClick:()=>a("xiaohongshu"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${o==="xiaohongshu"?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:["小红书 (",m.xiaohongshu,")"]}),e.jsxs("button",{onClick:()=>a("douyin"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${o==="douyin"?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:["抖音 (",m.douyin,")"]}),e.jsxs("button",{onClick:()=>a("bilibili"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${o==="bilibili"?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:["B站 (",m.bilibili,")"]}),e.jsxs("button",{onClick:()=>a("weibo"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${o==="weibo"?"bg-blue-600 text-white":"text-gray-600 hover:bg-gray-100"}`,children:["微博 (",m.weibo,")"]})]})]}),f.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5",children:f.map(r=>e.jsx(T,{account:r,onLogin:N,onViewMetrics:v,onDelete:k,onHealthCheck:$},r.id))}):e.jsxs("div",{className:"text-center py-12 bg-white rounded-xl border border-gray-200",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx(C,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"暂无账号"}),e.jsx("p",{className:"text-gray-500 mb-4",children:'点击右上角"添加账号"按钮开始'})]})]})}export{q as default};
