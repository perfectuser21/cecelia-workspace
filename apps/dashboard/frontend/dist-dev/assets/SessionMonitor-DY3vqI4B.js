import{r as a,j as s}from"./index-D9scRkLz.js";import{L as j,f as x,g as p,a as k}from"./formatters-C86KzPYP.js";const g="",y=e=>{switch(e){case"online":return"✅";case"offline":return"❌";default:return"❓"}};function w(){const[e,n]=a.useState(null),[m,h]=a.useState(!0),[l,c]=a.useState(!1),d=async()=>{try{const t=await(await fetch(`${g}/api/session/status`)).json();n(t)}catch{}finally{h(!1)}},i=async()=>{c(!0);try{const t=await(await fetch(`${g}/api/session/check`,{method:"POST"})).json();t.success&&n(o=>o?{...o,last_check:t.last_check,platforms:t.platforms}:null)}catch{}finally{c(!1)}};a.useEffect(()=>{d();const r=setInterval(d,5*60*1e3);return()=>clearInterval(r)},[]);const u=e!=null&&e.platforms?Object.keys(e.platforms).length:0,b=e!=null&&e.platforms?Object.values(e.platforms).filter(r=>r.status==="online").length:0,f=e!=null&&e.platforms?Object.values(e.platforms).filter(r=>r.status==="offline").length:0;return m&&!e?s.jsx(j,{height:"h-96",message:"加载 Session 状态..."}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Session 监控"}),s.jsxs("div",{className:"flex items-center gap-4 mt-1",children:[s.jsxs("span",{className:`inline-flex items-center gap-1 text-sm ${(e==null?void 0:e.runner_status)==="online"?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[s.jsx("span",{className:`w-2 h-2 rounded-full ${(e==null?void 0:e.runner_status)==="online"?"bg-green-500":"bg-red-500"}`}),"Windows Runner ",(e==null?void 0:e.runner_status)==="online"?"在线":"离线"]}),(e==null?void 0:e.last_check)&&s.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["上次检查: ",x(e.last_check)]})]})]}),s.jsx("button",{onClick:i,disabled:l,className:"px-4 py-2 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-xl hover:from-blue-700 hover:to-blue-800 disabled:opacity-50 shadow-lg shadow-blue-500/25 magnetic-btn",children:l?"检查中...":"检查所有平台"})]}),s.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-6 border border-gray-200 dark:border-slate-700 shimmer-card",children:[s.jsx("h2",{className:"font-semibold mb-4 text-gray-900 dark:text-white",children:"状态汇总"}),s.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[s.jsxs("div",{className:"p-4 bg-green-50 dark:bg-green-900/20 rounded-xl",children:[s.jsx("div",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:b}),s.jsx("div",{className:"text-sm text-green-600/70 dark:text-green-400/70 mt-1",children:"已登录"})]}),s.jsxs("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 rounded-xl",children:[s.jsx("div",{className:"text-3xl font-bold text-red-600 dark:text-red-400",children:f}),s.jsx("div",{className:"text-sm text-red-600/70 dark:text-red-400/70 mt-1",children:"已掉线"})]}),s.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-slate-700/50 rounded-xl",children:[s.jsx("div",{className:"text-3xl font-bold text-gray-600 dark:text-gray-300",children:u}),s.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"总平台数"})]})]})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:(e==null?void 0:e.platforms)&&Object.entries(e.platforms).map(([r,t])=>s.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-5 border border-gray-200 dark:border-slate-700 tilt-card",children:[s.jsxs("div",{className:"flex justify-between items-start mb-3",children:[s.jsx("h3",{className:"font-semibold text-lg text-gray-900 dark:text-white",children:t.name}),s.jsxs("span",{className:`px-2.5 py-1 rounded-lg text-sm font-medium ${k(t.status)}`,children:[y(t.status)," ",p(t.status)]})]}),s.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[t.currentUrl&&s.jsxs("p",{className:"truncate",title:t.currentUrl,children:["URL: ",s.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:new URL(t.currentUrl).hostname})]}),t.error&&s.jsx("p",{className:"text-red-500 dark:text-red-400",children:t.error}),s.jsxs("p",{children:["检查时间: ",x(t.lastCheck)]})]})]},r))}),(!(e!=null&&e.platforms)||Object.keys(e.platforms).length===0)&&s.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-12 border border-gray-200 dark:border-slate-700 text-center",children:[s.jsx("div",{className:"text-gray-400 dark:text-gray-500 text-lg mb-4",children:"暂无平台状态数据"}),s.jsx("button",{onClick:i,disabled:l,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:"点击检查所有平台"})]})]})}export{w as default};
