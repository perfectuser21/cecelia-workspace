import{a7 as j,a8 as b,r as c,j as e,R as i,G as h,aA as f,W as N}from"./index-D0DF2d61.js";const d={1:"PRD",2:"DoD",3:"Branch",4:"Code",5:"Test",6:"Local",7:"PR",8:"QA",9:"Merge"};function w(){const{runId:l}=j(),x=b(),[s,u]=c.useState(null),[g,p]=c.useState(!0),n=async()=>{if(l)try{const r=await(await fetch(`/api/cecelia/runs/${l}`)).json();r.success&&u(r.run)}catch(t){console.error(t)}finally{p(!1)}};if(c.useEffect(()=>{n();const t=setInterval(n,5e3);return()=>clearInterval(t)},[l]),g)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(i,{className:"w-6 h-6 text-violet-400 animate-spin"})});if(!s)return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:()=>x(-1),className:"text-gray-400 hover:text-white text-sm flex items-center gap-2",children:[e.jsx(h,{className:"w-4 h-4"})," 返回"]}),e.jsx("div",{className:"bg-slate-800 rounded-lg p-8 text-center text-gray-500",children:"任务不存在"})]});const a=s.steps||[],m=a.find(t=>t.status==="in_progress"),o=a.filter(t=>t.status==="done");return e.jsxs("div",{className:"space-y-4 max-w-3xl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>x(-1),className:"text-gray-400 hover:text-white text-sm flex items-center gap-2",children:[e.jsx(h,{className:"w-4 h-4"})," 返回"]}),e.jsx("button",{onClick:n,className:"p-2 text-gray-400 hover:text-white hover:bg-slate-700 rounded",children:e.jsx(i,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${s.status==="running"?"bg-blue-500/20 text-blue-400":s.status==="completed"?"bg-emerald-500/20 text-emerald-400":s.status==="failed"?"bg-red-500/20 text-red-400":"bg-slate-700 text-gray-400"}`,children:s.status==="running"?"运行中":s.status==="completed"?"已完成":s.status==="failed"?"失败":"等待中"}),e.jsx("span",{className:"text-xs text-gray-500",children:s.mode==="headless"?"无头":"交互"})]}),e.jsx("h1",{className:"text-lg font-semibold text-white mb-1",children:s.prd_title||s.feature_branch}),s.prd_summary&&e.jsx("p",{className:"text-sm text-gray-400 mb-3",children:s.prd_summary}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsx("span",{children:s.project}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(f,{className:"w-3 h-3"}),s.feature_branch]}),s.pr_url&&e.jsxs("a",{href:s.pr_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 flex items-center gap-1",children:[e.jsx(N,{className:"w-3 h-3"})," PR"]})]})]}),e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"font-medium text-white",children:"Checkpoints"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[s.completed_checkpoints,"/",s.total_checkpoints]})]}),e.jsx("div",{className:"h-2 bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-emerald-500 rounded-full transition-all",style:{width:`${s.total_checkpoints>0?s.completed_checkpoints/s.total_checkpoints*100:0}%`}})})]}),a.length>0&&e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700 p-4",children:[e.jsx("h2",{className:"font-medium text-white mb-3",children:"Dev 流程"}),e.jsx("div",{className:"flex items-center gap-1 mb-2",children:a.map((t,r)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs ${t.status==="done"?"bg-emerald-500 text-white":t.status==="in_progress"?"bg-blue-500 text-white":t.status==="failed"?"bg-red-500 text-white":"bg-slate-700 text-gray-500"}`,children:t.id}),r<a.length-1&&e.jsx("div",{className:`w-3 h-0.5 ${t.status==="done"?"bg-emerald-500":"bg-slate-700"}`})]},t.id))}),e.jsx("div",{className:"flex items-center gap-1 text-xs mb-3",children:a.map((t,r)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:`w-6 text-center ${t.status==="done"?"text-emerald-400":t.status==="in_progress"?"text-blue-400":"text-gray-600"}`,children:d[t.id]}),r<a.length-1&&e.jsx("span",{className:"w-3"})]},t.id))}),m&&e.jsxs("div",{className:"flex items-center gap-2 text-sm p-2 bg-blue-500/10 border border-blue-500/20 rounded",children:[e.jsx(i,{className:"w-3 h-3 text-blue-400 animate-spin"}),e.jsx("span",{className:"text-blue-400",children:d[m.id]}),s.current_action&&e.jsxs("span",{className:"text-gray-400",children:["- ",s.current_action]})]}),o.length>0&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["已完成: ",o.map(t=>d[t.id]).join(" > ")]})]})]})}export{w as default};
