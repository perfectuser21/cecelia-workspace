import{a7 as y,a8 as _,r as i,j as e,R as u,G as g,aA as k,W as C,L as j,Y as d}from"./index-D9scRkLz.js";function R(){var o;const{runId:c}=y(),m=_(),[t,f]=i.useState(null),[l,b]=i.useState([]),[p,N]=i.useState(!0),x=async()=>{if(c)try{const a=await(await fetch(`/api/cecelia/runs/${c}`)).json();a.success&&(f(a.run),b(a.checkpoints||[]))}catch(s){console.error(s)}finally{N(!1)}};if(i.useEffect(()=>{x();const s=setInterval(x,5e3);return()=>clearInterval(s)},[c]),p)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(u,{className:"w-6 h-6 text-blue-400 animate-spin"})});if(!t)return e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsxs("button",{onClick:()=>m(-1),className:"text-gray-400 hover:text-white flex items-center gap-2 mb-6",children:[e.jsx(g,{className:"w-5 h-5"})," 返回"]}),e.jsx("div",{className:"text-gray-500 text-center py-12",children:"任务不存在"})]});const r=t.steps||[],v=r.filter(s=>s.status==="done").length,w=l.filter(s=>s.status==="done").length;return e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("button",{onClick:()=>m(-1),className:"text-gray-400 hover:text-white flex items-center gap-2",children:[e.jsx(g,{className:"w-5 h-5"})," 返回"]}),e.jsx("button",{onClick:x,className:"p-2 text-gray-400 hover:text-white rounded-lg hover:bg-gray-800",children:e.jsx(u,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[t.status==="running"&&e.jsx("span",{className:"w-3 h-3 bg-blue-500 rounded-full animate-pulse"}),t.status==="completed"&&e.jsx("span",{className:"w-3 h-3 bg-green-500 rounded-full"}),t.status==="failed"&&e.jsx("span",{className:"w-3 h-3 bg-red-500 rounded-full"}),e.jsx("h1",{className:"text-2xl font-bold text-white",children:t.prd_title||t.feature_branch})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-400",children:[e.jsx("span",{children:t.project}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(k,{className:"w-4 h-4"}),t.feature_branch]}),t.pr_url&&e.jsxs("a",{href:t.pr_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:underline flex items-center gap-1",children:[e.jsx(C,{className:"w-4 h-4"})," PR"]})]})]}),t.status==="running"&&e.jsx("div",{className:"mb-8 p-4 bg-blue-500/10 border border-blue-500/30 rounded-xl",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(j,{className:"w-5 h-5 text-blue-400 animate-spin"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-white font-medium",children:["Step ",t.current_step,"/9: ",((o=r.find(s=>s.id===t.current_step))==null?void 0:o.name)||""]}),t.current_action&&e.jsx("div",{className:"text-sm text-gray-400",children:t.current_action})]})]})}),l.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Checkpoints"}),e.jsxs("span",{className:"text-sm text-gray-400",children:[w,"/",l.length," 完成"]})]}),e.jsx("div",{className:"space-y-2",children:l.map(s=>{const a=s.status==="done",n=s.status==="in_progress";return e.jsxs("div",{className:`flex items-center gap-4 p-4 rounded-xl border transition ${a?"bg-green-500/5 border-green-500/30":n?"bg-blue-500/10 border-blue-500/30":"bg-gray-800/50 border-gray-700"}`,children:[e.jsxs("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${a?"bg-green-500":n?"bg-blue-500":"bg-gray-700"}`,children:[a&&e.jsx(d,{className:"w-5 h-5 text-white"}),n&&e.jsx(j,{className:"w-5 h-5 text-white animate-spin"}),!a&&!n&&e.jsx("span",{className:"text-gray-400 text-sm",children:s.checkpoint_id.replace("CP-","")})]}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`font-mono text-sm font-medium ${a?"text-green-400":n?"text-blue-400":"text-gray-400"}`,children:s.checkpoint_id}),e.jsx("span",{className:`${a?"text-green-300":n?"text-white":"text-gray-300"}`,children:s.name||""})]})})]},s.checkpoint_id)})})]}),r.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Dev 流程"}),e.jsxs("span",{className:"text-sm text-gray-400",children:[v,"/",r.length," 完成"]})]}),e.jsx("div",{className:"flex items-center justify-between bg-gray-800/50 rounded-xl p-4",children:r.map((s,a)=>{const n=s.status==="done",h=s.status==="in_progress";return e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center font-medium transition ${n?"bg-green-500 text-white":h?"bg-blue-500 text-white ring-4 ring-blue-500/30":"bg-gray-700 text-gray-400"}`,children:n?e.jsx(d,{className:"w-5 h-5"}):s.id}),e.jsx("span",{className:`mt-2 text-xs ${n?"text-green-400":h?"text-blue-400":"text-gray-500"}`,children:s.name})]}),a<r.length-1&&e.jsx("div",{className:`w-6 h-1 mx-1 rounded ${n?"bg-green-500":"bg-gray-700"}`})]},s.id)})})]}),t.status==="completed"&&e.jsxs("div",{className:"p-4 bg-green-500/10 border border-green-500/30 rounded-xl flex items-center gap-3",children:[e.jsx(d,{className:"w-6 h-6 text-green-400"}),e.jsx("span",{className:"text-green-300 font-medium",children:"任务已完成"})]}),t.status==="failed"&&e.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/30 rounded-xl flex items-center gap-3",children:e.jsx("span",{className:"text-red-300 font-medium",children:"任务执行失败"})})]})}export{R as default};
