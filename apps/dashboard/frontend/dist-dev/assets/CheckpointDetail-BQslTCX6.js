import{a7 as w,a8 as y,r,j as e,R as l,G as o,a1 as m,a4 as h,bc as u,C}from"./index-A9akftxR.js";const _={L1:"阻塞性问题",L2:"功能性问题",L3:"最佳实践",L4:"优化建议"},k={L1:"必须修复的严重问题，如安全漏洞、数据丢失、崩溃等",L2:"影响功能的问题，如逻辑错误、边界条件、异常处理",L3:"代码质量建议，如命名规范、代码重复、性能优化",L4:"过度优化警告，避免不必要的复杂度"},L={1:"PRD",2:"DoD",3:"Branch",4:"Code",5:"Test",6:"Local",7:"PR",8:"QA",9:"Merge"},E={1:"需求文档确认",2:"验收标准定义",3:"创建功能分支",4:"编写代码实现",5:"编写测试用例",6:"本地测试验证",7:"创建 Pull Request",8:"QA 审核验证",9:"合并到主分支"};function D(){const{runId:c,cpId:d}=w(),x=y(),[a,g]=r.useState(null),[t,p]=r.useState(null),[j,N]=r.useState(!0),i=async()=>{if(c)try{const n=await(await fetch(`/api/cecelia/runs/${c}`)).json();if(n.success){g(n.run);const b=(n.checkpoints||[]).find(v=>v.checkpoint_id===d);p(b||null)}}catch(s){console.error(s)}finally{N(!1)}};if(r.useEffect(()=>{i();const s=setInterval(i,5e3);return()=>clearInterval(s)},[c,d]),j)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(l,{className:"w-6 h-6 text-violet-400 animate-spin"})});if(!a||!t)return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:()=>x(-1),className:"text-gray-400 hover:text-white text-sm flex items-center gap-2",children:[e.jsx(o,{className:"w-4 h-4"})," 返回"]}),e.jsx("div",{className:"bg-slate-800 rounded-lg p-8 text-center text-gray-500",children:a?"Checkpoint 不存在":"任务不存在"})]});const f=a.steps||[];return e.jsxs("div",{className:"space-y-4 max-w-3xl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>x(-1),className:"text-gray-400 hover:text-white text-sm flex items-center gap-2",children:[e.jsx(o,{className:"w-4 h-4"})," 返回"]}),e.jsx("button",{onClick:i,className:"p-2 text-gray-400 hover:text-white hover:bg-slate-700 rounded",children:e.jsx(l,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700 p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[t.status==="done"?e.jsx(m,{className:"w-6 h-6 text-emerald-400"}):t.status==="in_progress"?e.jsx(l,{className:"w-6 h-6 text-blue-400 animate-spin"}):t.status==="failed"?e.jsx(h,{className:"w-6 h-6 text-red-400"}):e.jsx(u,{className:"w-6 h-6 text-gray-500"}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-lg font-semibold text-white",children:[t.checkpoint_id," - ",_[t.checkpoint_id]||"检查点"]}),e.jsx("p",{className:"text-sm text-gray-400",children:k[t.checkpoint_id]||""})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsx("span",{className:`px-2 py-0.5 rounded ${t.status==="done"?"bg-emerald-500/20 text-emerald-400":t.status==="in_progress"?"bg-blue-500/20 text-blue-400":t.status==="failed"?"bg-red-500/20 text-red-400":"bg-slate-700 text-gray-400"}`,children:t.status==="done"?"已完成":t.status==="in_progress"?"进行中":t.status==="failed"?"失败":"待处理"}),e.jsx("span",{children:a.prd_title||a.feature_branch})]}),t.output&&e.jsxs("div",{className:"mt-4 p-3 bg-slate-900 rounded border border-slate-700",children:[e.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"输出"}),e.jsx("pre",{className:"text-sm text-gray-300 whitespace-pre-wrap",children:t.output})]})]}),e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700",children:[e.jsx("div",{className:"px-4 py-3 border-b border-slate-700",children:e.jsx("h2",{className:"font-medium text-white",children:"Dev 流程步骤"})}),e.jsx("div",{className:"divide-y divide-slate-700",children:f.map(s=>e.jsx("div",{className:`px-4 py-3 ${s.status==="in_progress"?"bg-blue-500/5":""}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[s.status==="done"?e.jsx(m,{className:"w-5 h-5 text-emerald-400 flex-shrink-0"}):s.status==="in_progress"?e.jsx(l,{className:"w-5 h-5 text-blue-400 animate-spin flex-shrink-0"}):s.status==="failed"?e.jsx(h,{className:"w-5 h-5 text-red-400 flex-shrink-0"}):e.jsx(u,{className:"w-5 h-5 text-gray-600 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`font-medium ${s.status==="done"?"text-emerald-400":s.status==="in_progress"?"text-blue-400":s.status==="failed"?"text-red-400":"text-gray-500"}`,children:[s.id,". ",L[s.id]]}),s.status==="in_progress"&&a.current_action&&e.jsxs("span",{className:"text-xs text-gray-400",children:["- ",a.current_action]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:E[s.id]})]}),s.completed_at&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(C,{className:"w-3 h-3"}),new Date(s.completed_at).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})]})]})},s.id))})]})]})}export{D as default};
