import{a7 as b,a8 as j,r as n,j as e,R as i,G as d,aA as f,W as p,ab as N,a1 as v,a4 as y,bc as w,z as k}from"./index-A9akftxR.js";const _={L1:"阻塞性",L2:"功能性",L3:"最佳实践",L4:"优化"};function L(){const{runId:l}=b(),x=j(),[t,m]=n.useState(null),[a,o]=n.useState([]),[h,u]=n.useState(!0),c=async()=>{if(l)try{const r=await(await fetch(`/api/cecelia/runs/${l}`)).json();r.success&&(m(r.run),o(r.checkpoints||[]))}catch(s){console.error(s)}finally{u(!1)}};if(n.useEffect(()=>{c();const s=setInterval(c,5e3);return()=>clearInterval(s)},[l]),h)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(i,{className:"w-6 h-6 text-violet-400 animate-spin"})});if(!t)return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:()=>x(-1),className:"text-gray-400 hover:text-white text-sm flex items-center gap-2",children:[e.jsx(d,{className:"w-4 h-4"})," 返回"]}),e.jsx("div",{className:"bg-slate-800 rounded-lg p-8 text-center text-gray-500",children:"任务不存在"})]});const g=a.filter(s=>s.status==="done").length;return e.jsxs("div",{className:"space-y-4 max-w-3xl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>x(-1),className:"text-gray-400 hover:text-white text-sm flex items-center gap-2",children:[e.jsx(d,{className:"w-4 h-4"})," 返回"]}),e.jsx("button",{onClick:c,className:"p-2 text-gray-400 hover:text-white hover:bg-slate-700 rounded",children:e.jsx(i,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700 p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-2 py-0.5 text-xs rounded ${t.status==="running"?"bg-blue-500/20 text-blue-400":t.status==="completed"?"bg-emerald-500/20 text-emerald-400":t.status==="failed"?"bg-red-500/20 text-red-400":"bg-slate-700 text-gray-400"}`,children:t.status==="running"?"运行中":t.status==="completed"?"已完成":t.status==="failed"?"失败":"等待中"}),e.jsx("span",{className:"text-xs text-gray-500",children:t.mode==="headless"?"无头":"交互"})]}),e.jsx("h1",{className:"text-lg font-semibold text-white mb-1",children:t.prd_title||t.feature_branch}),t.prd_summary&&e.jsx("p",{className:"text-sm text-gray-400 mb-3",children:t.prd_summary}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsx("span",{children:t.project}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(f,{className:"w-3 h-3"}),t.feature_branch]}),t.pr_url&&e.jsxs("a",{href:t.pr_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 flex items-center gap-1",children:[e.jsx(p,{className:"w-3 h-3"})," PR"]})]})]}),e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"font-medium text-white",children:"Checkpoints"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[g,"/",a.length," 完成"]})]}),a.length>0?e.jsx("div",{className:"flex items-center gap-2",children:a.map((s,r)=>e.jsxs("div",{className:"flex items-center",children:[e.jsxs(N,{to:`/cecelia/runs/${l}/checkpoints/${s.checkpoint_id}`,className:`flex flex-col items-center p-3 rounded-lg border transition-colors hover:border-violet-500/50 ${s.status==="done"?"bg-emerald-500/10 border-emerald-500/30":s.status==="in_progress"?"bg-blue-500/10 border-blue-500/30":s.status==="failed"?"bg-red-500/10 border-red-500/30":"bg-slate-700/50 border-slate-600"}`,children:[s.status==="done"?e.jsx(v,{className:"w-6 h-6 text-emerald-400 mb-1"}):s.status==="in_progress"?e.jsx(i,{className:"w-6 h-6 text-blue-400 animate-spin mb-1"}):s.status==="failed"?e.jsx(y,{className:"w-6 h-6 text-red-400 mb-1"}):e.jsx(w,{className:"w-6 h-6 text-gray-500 mb-1"}),e.jsx("span",{className:`text-sm font-medium ${s.status==="done"?"text-emerald-400":s.status==="in_progress"?"text-blue-400":s.status==="failed"?"text-red-400":"text-gray-400"}`,children:s.checkpoint_id}),e.jsx("span",{className:"text-xs text-gray-500 mt-0.5",children:_[s.checkpoint_id]||"检查"})]}),r<a.length-1&&e.jsx(k,{className:"w-4 h-4 text-gray-600 mx-1"})]},s.checkpoint_id))}):e.jsx("div",{className:"text-center text-gray-500",children:"暂无 Checkpoints"})]})]})}export{L as default};
