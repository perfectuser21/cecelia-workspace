import{a7 as v,a8 as R,r as m,j as e,R as h,a0 as p,bc as C,Z as b,G as k,C as S,a1 as A}from"./index-DjV-74X0.js";const j=[{id:"spark",name:"Spark",codename:"点燃执行",icon:"Zap",role:"执行者",description:"解析 PRD 文档，拆解 Checkpoints，调用 Claude Code 执行代码任务",workflowKeywords:["PRD Executor","prd-executor","Execute","Cecelia"],status:"active",gradient:{from:"from-blue-500",to:"to-cyan-500",border:"border-blue-500/30"}},{id:"echo",name:"Echo",codename:"协调反馈",icon:"RefreshCw",role:"协调者",description:"监控执行状态，处理多阶段任务，分析结果并创建下一阶段",workflowKeywords:["Coordinator","coordinator","Multi-stage","Callback"],status:"active",gradient:{from:"from-emerald-500",to:"to-teal-500",border:"border-emerald-500/30"}},{id:"prism",name:"Prism",codename:"多维分析",icon:"Diamond",role:"分析者",description:"多维度分析执行结果，提供智能决策建议",workflowKeywords:["Analyzer","Analysis","Report"],status:"planned",gradient:{from:"from-violet-500",to:"to-purple-500",border:"border-violet-500/30"}}],T="";async function E(){try{const a=await fetch(`${T}/api/cecelia/overview?limit=20`);if(!a.ok)return null;const s=await a.json();return s.success?s:null}catch{return null}}function M(a){switch(a){case"24h":return 24*60*60*1e3;case"72h":return 72*60*60*1e3;case"7d":return 7*24*60*60*1e3}}function $(a,s){const t=Date.now(),o=M(s),l=t-o;return a.filter(i=>new Date(i.started_at).getTime()>=l)}function I(a,s){const t=$(a,s),o=t.filter(r=>r.status==="completed").length,l=t.filter(r=>r.status==="failed").length,i=t.filter(r=>r.status==="running").length,d=t.length,c=o+l;return{total:d,success:o,error:l,running:i,successRate:c>0?Math.round(o/c*100):0}}function D(a){const s=new Map;for(const t of j)s.set(t.id,[]);for(const t of a){const o=s.get("spark")||[];o.push(t),s.set("spark",o)}return s}function P(a){const s=new Date().toDateString(),t=a.filter(r=>new Date(r.started_at).toDateString()===s),o=t.filter(r=>r.status==="completed").length,l=t.filter(r=>r.status==="failed").length,i=t.filter(r=>r.status==="running").length,d=t.length,c=o+l;return{todayTotal:d,todaySuccess:o,todayError:l,todayRunning:i,successRate:c>0?Math.round(o/c*100):0}}async function _(a="24h"){const s=await E(),t=(s==null?void 0:s.recent_runs)||[],o=t.filter(r=>r.status==="running"),l=t.filter(r=>r.status!=="running").slice(0,10),i=I(t,a),d=D(t),c=j.map(r=>{const u=d.get(r.id)||[],g=P(u);return{...r,stats:g,recentRuns:u.slice(0,5)}});return{totalRuns:(s==null?void 0:s.total_runs)||0,runningRuns:(s==null?void 0:s.running)||0,completedRuns:(s==null?void 0:s.completed)||0,failedRuns:(s==null?void 0:s.failed)||0,runningTasks:o,recentRuns:l,timeRange:a,periodStats:i,agents:c}}async function K(a,s="24h"){return(await _(s)).agents.find(o=>o.id===a)||null}const L={Zap:b,RefreshCw:h,Diamond:C};function Z(){const{agentId:a}=v(),s=R(),[t,o]=m.useState(null),[l,i]=m.useState(!0),[d,c]=m.useState(null),r=async()=>{if(a)try{const n=await K(a);n?(o(n),c(null)):c("Agent 不存在")}catch(n){c(n.message)}finally{i(!1)}};m.useEffect(()=>{r();const n=setInterval(r,3e4);return()=>clearInterval(n)},[a]);const u=n=>{switch(n){case"success":return e.jsx(A,{className:"w-4 h-4 text-emerald-500"});case"running":return e.jsx(h,{className:"w-4 h-4 text-blue-500 animate-spin"});case"error":return e.jsx(p,{className:"w-4 h-4 text-red-500"});default:return e.jsx(S,{className:"w-4 h-4 text-gray-400"})}},g=n=>new Date(n).toLocaleString("zh-CN"),w=n=>{if(!n)return"-";const x=Math.floor(n/1e3);if(x<60)return`${x}s`;const N=Math.floor(x/60),y=x%60;return`${N}m ${y}s`};if(l)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(h,{className:"w-8 h-8 text-blue-500 animate-spin"})});if(d||!t)return e.jsxs("div",{className:"bg-red-900/20 border border-red-800 rounded-xl p-6 text-center",children:[e.jsx(p,{className:"w-12 h-12 text-red-500 mx-auto mb-3"}),e.jsx("p",{className:"text-red-400",children:d||"Agent 不存在"}),e.jsx("button",{onClick:()=>s("/cecelia"),className:"mt-4 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors",children:"返回总览"})]});const f=L[t.icon]||b;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("button",{onClick:()=>s("/cecelia"),className:"flex items-center gap-2 text-gray-400 hover:text-white transition-colors",children:[e.jsx(k,{className:"w-4 h-4"}),e.jsx("span",{children:"返回 Cecelia"})]}),e.jsxs("div",{className:`
        p-6 rounded-xl border
        bg-gradient-to-br ${t.gradient.from} ${t.gradient.to} bg-opacity-10
        dark:bg-slate-800 ${t.gradient.border}
      `,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-4 rounded-xl bg-gradient-to-br ${t.gradient.from} ${t.gradient.to}`,children:e.jsx(f,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:t.name}),e.jsxs("p",{className:"text-gray-400",children:[t.role," · ",t.codename]})]})]}),e.jsx("button",{onClick:r,className:"p-2 text-gray-400 hover:text-white hover:bg-slate-700 rounded-lg transition-colors",children:e.jsx(h,{className:"w-5 h-5"})})]}),e.jsx("p",{className:"mt-4 text-gray-300",children:t.description}),e.jsx("div",{className:"mt-4 flex flex-wrap gap-2",children:t.workflowKeywords.map(n=>e.jsx("span",{className:"px-2 py-1 text-xs bg-slate-700 text-gray-300 rounded",children:n},n))})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-slate-800 rounded-xl p-5 border border-slate-700",children:[e.jsx("p",{className:"text-3xl font-bold text-white",children:t.stats.todayTotal}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"今日任务"})]}),e.jsxs("div",{className:"bg-slate-800 rounded-xl p-5 border border-emerald-800",children:[e.jsx("p",{className:"text-3xl font-bold text-emerald-400",children:t.stats.todaySuccess}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"成功"})]}),e.jsxs("div",{className:"bg-slate-800 rounded-xl p-5 border border-red-800",children:[e.jsx("p",{className:"text-3xl font-bold text-red-400",children:t.stats.todayError}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"失败"})]}),e.jsxs("div",{className:"bg-slate-800 rounded-xl p-5 border border-blue-800",children:[e.jsxs("p",{className:"text-3xl font-bold text-blue-400",children:[t.stats.successRate,"%"]}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"成功率"})]})]}),e.jsxs("div",{className:"bg-slate-800 rounded-xl border border-slate-700",children:[e.jsx("div",{className:"px-6 py-4 border-b border-slate-700",children:e.jsx("h2",{className:"font-semibold text-white",children:"执行历史"})}),t.recentTasks&&t.recentTasks.length>0?e.jsx("div",{className:"divide-y divide-slate-700",children:t.recentTasks.map(n=>e.jsx("div",{className:"px-6 py-4 hover:bg-slate-700/50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[u(n.status),e.jsx("span",{className:"text-white",children:n.workflowName})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsx("span",{children:w(n.duration)}),e.jsx("span",{children:g(n.startedAt)})]})]})},n.id))}):e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(f,{className:"w-12 h-12 text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-400",children:"暂无执行记录"})]})]})]})}export{Z as default};
