import{r as c,j as e,R as u,Z as p,C as I,k as P,h as _,aL as F,ab as M,z as S}from"./index-X_gQAix8.js";const f=.015;function D(){const[o,N]=c.useState([]),[v,b]=c.useState([]),[m,w]=c.useState(!0),[h,y]=c.useState("7d"),d=async()=>{try{const[s,t]=await Promise.all([fetch("/api/cecelia/overview?limit=200"),fetch("/api/cecelia/projects")]),n=await s.json(),i=await t.json();n.success&&N(n.recent_runs||[]),i.success&&b(i.projects||[])}catch(s){console.error(s)}finally{w(!1)}};c.useEffect(()=>{d();const s=setInterval(d,15e3);return()=>clearInterval(s)},[]);const k=s=>{switch(s){case"24h":return 24;case"72h":return 72;case"7d":return 168}},l=o.filter(s=>{const t=Date.now()-k(h)*60*60*1e3;return new Date(s.started_at).getTime()>=t}),a={total:l.length,completed:l.filter(s=>s.status==="completed").length,running:l.filter(s=>s.status==="running").length,failed:l.filter(s=>s.status==="failed").length,tokens:l.reduce((s,t)=>s+(t.token_usage||0),0)},j=a.total*5e4,R=j/1e3*f,r=new Map;v.forEach(s=>r.set(s.name,{info:s,running:0,completed:0,failed:0,total:0})),l.forEach(s=>{let t=r.get(s.project);t||(t={running:0,completed:0,failed:0,total:0},r.set(s.project,t)),t.total++,s.status==="running"&&t.running++,s.status==="completed"&&t.completed++,s.status==="failed"&&t.failed++});const x=Array.from(r.entries()).filter(([,s])=>s.total>0).sort((s,t)=>t[1].running*10+t[1].total-(s[1].running*10+s[1].total));if(m&&!o.length)return e.jsx("div",{className:"min-h-screen bg-[#191919] flex items-center justify-center",children:e.jsx(u,{className:"w-5 h-5 text-gray-400 animate-spin"})});const C=a.total>0?Math.round(a.completed/a.total*100):0;return e.jsx("div",{className:"min-h-screen bg-[#191919]",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-6 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-10",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-white tracking-tight",children:"Engine"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"自动化开发工作流"})]}),e.jsx("button",{onClick:d,className:"p-3 text-gray-500 hover:text-white rounded-xl hover:bg-white/5 transition",children:e.jsx(u,{className:`w-5 h-5 ${m?"animate-spin":""}`})})]}),e.jsxs("div",{className:"bg-gradient-to-br from-[#1a1a2e] to-[#16213e] rounded-3xl p-6 border border-[#2a2a4a] mb-8",children:[e.jsx("div",{className:"flex items-center gap-2 mb-6",children:["24h","72h","7d"].map(s=>e.jsx("button",{onClick:()=>y(s),className:`px-4 py-2 rounded-xl text-sm font-medium transition ${h===s?"bg-blue-500 text-white shadow-lg shadow-blue-500/25":"bg-white/5 text-gray-400 hover:text-white hover:bg-white/10"}`,children:s==="24h"?"24h":s==="72h"?"3 天":"7 天"},s))}),e.jsxs("div",{className:"grid grid-cols-6 gap-4",children:[e.jsxs("div",{className:"col-span-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-xs mb-1",children:[e.jsx(p,{className:"w-3 h-3"})," 任务"]}),e.jsx("div",{className:"text-3xl font-bold text-white",children:a.total})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs mb-1",children:[e.jsx(I,{className:"w-3 h-3 text-blue-400"}),e.jsx("span",{className:"text-blue-400",children:"运行中"})]}),e.jsx("div",{className:"text-3xl font-bold text-blue-400",children:a.running})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs mb-1",children:[e.jsx(P,{className:"w-3 h-3 text-green-400"}),e.jsx("span",{className:"text-green-400",children:"完成"})]}),e.jsx("div",{className:"text-3xl font-bold text-green-400",children:a.completed})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-xs mb-1",children:[e.jsx(_,{className:"w-3 h-3"})," 成功率"]}),e.jsxs("div",{className:"text-3xl font-bold text-white",children:[C,"%"]})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-xs mb-1",children:[e.jsx(p,{className:"w-3 h-3"})," Tokens"]}),e.jsx("div",{className:"text-2xl font-bold text-gray-300",children:a.tokens>0?a.tokens>1e6?`${(a.tokens/1e6).toFixed(1)}M`:`${(a.tokens/1e3).toFixed(0)}K`:`~${(j/1e6).toFixed(1)}M`}),e.jsx("div",{className:"text-xs text-gray-500",children:a.tokens>0?"":"估算"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-xs mb-1",children:[e.jsx(F,{className:"w-3 h-3"})," 成本"]}),e.jsxs("div",{className:"text-2xl font-bold text-yellow-400",children:["$",a.tokens>0?(a.tokens/1e3*f).toFixed(2):R.toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-500",children:a.tokens>0?"":"估算"})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:"项目"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[x.length," 个活跃"]})]}),x.length>0?e.jsx("div",{className:"bg-[#202020] rounded-2xl border border-[#303030] overflow-hidden",children:x.map(([s,{info:t,running:n,completed:i,failed:g,total:E}],$)=>e.jsxs(M,{to:`/cecelia/project/${encodeURIComponent(s)}`,className:`flex items-center justify-between px-6 py-5 hover:bg-white/5 transition ${$<x.length-1?"border-b border-[#303030]":""}`,children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-white font-medium text-lg",children:s}),n>0&&e.jsxs("span",{className:"px-2.5 py-1 text-xs bg-blue-500/20 text-blue-400 rounded-full flex items-center gap-1.5",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-blue-400 rounded-full animate-pulse"}),n," 运行中"]})]}),(t==null?void 0:t.description)&&e.jsx("p",{className:"text-sm text-gray-500 mt-1 truncate",children:t.description})]}),e.jsxs("div",{className:"flex items-center gap-6 ml-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-white font-medium",children:E}),e.jsx("div",{className:"text-xs text-gray-500",children:"任务"})]}),i>0&&e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-green-400 font-medium",children:i}),e.jsx("div",{className:"text-xs text-gray-500",children:"完成"})]}),g>0&&e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-red-400 font-medium",children:g}),e.jsx("div",{className:"text-xs text-gray-500",children:"失败"})]}),e.jsx(S,{className:"w-5 h-5 text-gray-600"})]})]},s))}):e.jsx("div",{className:"bg-[#202020] rounded-2xl border border-[#303030] p-10 text-center text-gray-500",children:"该时间段内暂无活跃项目"})]})]})})}export{D as default};
