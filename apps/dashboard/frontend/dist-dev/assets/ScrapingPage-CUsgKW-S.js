import{r as d,j as e,D as g,R as f,a0 as C,a1 as v,L as w,C as R,a9 as T}from"./index-D0DF2d61.js";const A="",E="http://localhost:5678/webhook",m=[{id:"xiaohongshu-scraper",platform:"xiaohongshu",name:"小红书采集",description:"采集小红书热门笔记和用户数据",webhookPath:"/webhook/xiaohongshu-scraper",status:"idle",stats:{totalRuns:0,successRuns:0,dataCollected:0}},{id:"douyin-scraper",platform:"douyin",name:"抖音采集",description:"采集抖音热门视频和创作者数据",webhookPath:"/webhook/douyin-scraper",status:"idle",stats:{totalRuns:0,successRuns:0,dataCollected:0}},{id:"weibo-scraper",platform:"weibo",name:"微博采集",description:"采集微博热搜和用户动态",webhookPath:"/webhook/weibo-scraper",status:"idle",stats:{totalRuns:0,successRuns:0,dataCollected:0}},{id:"bilibili-scraper",platform:"bilibili",name:"B站采集",description:"采集B站热门视频和UP主数据",webhookPath:"/webhook/bilibili-scraper",status:"idle",stats:{totalRuns:0,successRuns:0,dataCollected:0}}];let x=new Map;async function O(){try{const t=await fetch(`${A}/api/v1/scraping/tasks`);if(t.ok)return(await t.json()).tasks||m}catch{}return m.map(t=>({...t,...x.get(t.id)}))}async function P(t){const l=m.find(s=>s.id===t);if(!l)return{success:!1,error:"任务不存在"};x.set(t,{status:"running",lastExecutedAt:new Date().toISOString()});try{const s=await fetch(`${E}${l.webhookPath}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({triggeredAt:new Date().toISOString(),source:"dashboard"})});if(s.ok){const r=await s.json();return x.set(t,{status:"success",lastExecutedAt:new Date().toISOString(),lastResult:{success:!0,dataCount:r.dataCount||0}}),{success:!0,executionId:r.executionId,message:"任务已触发"}}else{const r=await s.text();return x.set(t,{status:"error",lastExecutedAt:new Date().toISOString(),lastResult:{success:!1,error:r}}),{success:!1,error:`触发失败: ${s.status}`}}}catch(s){const r=s instanceof Error?s.message:"网络错误";return x.set(t,{status:"error",lastExecutedAt:new Date().toISOString(),lastResult:{success:!1,error:r}}),{success:!1,error:r}}}const j={xiaohongshu:{color:"text-red-600",bgColor:"bg-red-50 dark:bg-red-900/30"},douyin:{color:"text-black dark:text-white",bgColor:"bg-gray-100 dark:bg-gray-800"},weibo:{color:"text-orange-500",bgColor:"bg-orange-50 dark:bg-orange-900/30"},bilibili:{color:"text-pink-500",bgColor:"bg-pink-50 dark:bg-pink-900/30"}},$={idle:{label:"空闲",icon:R,color:"text-gray-500",bgColor:"bg-gray-100 dark:bg-gray-700"},running:{label:"运行中",icon:w,color:"text-blue-500",bgColor:"bg-blue-100 dark:bg-blue-900/30"},success:{label:"成功",icon:v,color:"text-green-500",bgColor:"bg-green-100 dark:bg-green-900/30"},error:{label:"失败",icon:C,color:"text-red-500",bgColor:"bg-red-100 dark:bg-red-900/30"}};function D(t){return t?new Date(t).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"}function I({task:t,onTrigger:l,triggering:s}){const r=j[t.platform]||j.xiaohongshu,o=$[t.status],c=o.icon,i=t.status==="running"||s;return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 p-6 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl ${r.bgColor} flex items-center justify-center`,children:e.jsx(g,{className:`w-6 h-6 ${r.color}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-800 dark:text-white",children:t.name}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:t.description})]})]}),e.jsxs("div",{className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium ${o.bgColor} ${o.color}`,children:[e.jsx(c,{className:`w-4 h-4 ${i?"animate-spin":""}`}),o.label]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4 py-3 border-y border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"最后执行"}),e.jsx("p",{className:"text-sm font-medium text-slate-700 dark:text-slate-200",children:D(t.lastExecutedAt)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"执行次数"}),e.jsxs("p",{className:"text-sm font-medium text-slate-700 dark:text-slate-200",children:[t.stats.totalRuns," 次"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"采集数据"}),e.jsxs("p",{className:"text-sm font-medium text-slate-700 dark:text-slate-200",children:[t.stats.dataCollected.toLocaleString()," 条"]})]})]}),t.lastResult&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"最近结果"}),t.lastResult.success?e.jsxs("p",{className:"text-sm text-green-600 dark:text-green-400",children:["成功采集 ",t.lastResult.dataCount||0," 条数据"]}):e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:t.lastResult.error||"执行失败"})]}),e.jsx("button",{onClick:l,disabled:i,className:`w-full flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg font-medium transition-colors ${i?"bg-slate-100 dark:bg-slate-700 text-slate-400 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600 text-white"}`,children:i?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"w-4 h-4 animate-spin"}),"执行中..."]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-4 h-4"}),"立即执行"]})})]})}function F(){const[t,l]=d.useState([]),[s,r]=d.useState(!0),[o,c]=d.useState(null),[i,k]=d.useState(null),[N,h]=d.useState(new Set),u=async()=>{r(!0),c(null);try{const a=await O();l(a),k(new Date)}catch(a){c("加载数据失败，请稍后重试"),console.error("Failed to load scraping tasks:",a)}finally{r(!1)}};d.useEffect(()=>{u();const a=setInterval(u,3e4);return()=>clearInterval(a)},[]);const y=async a=>{h(n=>new Set(n).add(a));try{const n=await P(a);n.success?await u():c(n.error||"触发任务失败")}catch(n){c("触发任务失败，请稍后重试"),console.error("Failed to trigger task:",n)}finally{h(n=>{const p=new Set(n);return p.delete(a),p})}},S=t.length,b=t.filter(a=>a.status==="running").length;return e.jsxs("div",{className:"px-4 sm:px-0 pb-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-semibold text-slate-800 dark:text-white mb-1 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-purple-50 dark:bg-purple-900/30 flex items-center justify-center",children:e.jsx(g,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),"数据采集"]}),e.jsxs("p",{className:"text-slate-500 dark:text-slate-400 ml-13",children:["管理爬虫任务 · ",S," 个任务",b>0&&` · ${b} 个运行中`]})]}),e.jsxs("button",{onClick:u,disabled:s,className:"flex items-center gap-2 px-4 py-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-xl text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors disabled:opacity-50",children:[e.jsx(f,{className:`w-4 h-4 ${s?"animate-spin":""}`}),"刷新"]})]}),i&&e.jsxs("p",{className:"text-xs text-slate-400 dark:text-slate-500 ml-13",children:["最后更新: ",i.toLocaleTimeString("zh-CN")]})]}),o&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl text-red-600 dark:text-red-400",children:o}),s&&t.length===0&&e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(f,{className:"w-8 h-8 text-purple-500 animate-spin"}),e.jsx("p",{className:"text-slate-500 dark:text-slate-400",children:"加载中..."})]})}),(!s||t.length>0)&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:t.map(a=>e.jsx(I,{task:a,onTrigger:()=>y(a.id),triggering:N.has(a.id)},a.id))}),!s&&t.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(g,{className:"w-16 h-16 mx-auto text-gray-400 dark:text-gray-500 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"暂无采集任务"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"配置 N8N 工作流后即可在此管理"})]})]})}export{F as default};
