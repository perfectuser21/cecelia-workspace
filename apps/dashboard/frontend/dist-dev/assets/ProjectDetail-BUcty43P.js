import{a7 as L,r as d,j as e,R as w,ab as u,G as W,bn as z,C as D,k as g,a0 as f,a9 as M,ai as I,z as y,av as J}from"./index-X_gQAix8.js";function A(){const{name:o}=L(),[n,k]=d.useState([]),[l,C]=d.useState(null),[p,$]=d.useState(!0),[b,j]=d.useState(new Set),[N,R]=d.useState(!1),h=async()=>{try{const[s,a]=await Promise.all([fetch("/api/cecelia/overview?limit=100"),fetch("/api/cecelia/projects")]),i=await s.json(),r=await a.json();i.success&&k(i.recent_runs.filter(c=>c.project===o)),r.success&&C(r.projects.find(c=>c.name===o)||null)}catch(s){console.error(s)}finally{$(!1)}};d.useEffect(()=>{h();const s=setInterval(h,1e4);return()=>clearInterval(s)},[o]);const v=(s,a)=>{const i=s.toLowerCase(),r=a.toLowerCase();if(i.startsWith(`cp-${r}-`)||i.startsWith(`feature/${r}-`)||i.startsWith(`feat/${r}-`))return!0;const c=i.match(/^cp-\d+-(.+)/);if(c){const t=c[1];if(t.startsWith(`${r}-`)||t===r)return!0}return!1},S=s=>n.filter(a=>v(a.feature_branch,s)),x=d.useMemo(()=>l!=null&&l.features?l.features.map(s=>({...s,runs:S(s.id)})).filter(s=>s.runs.length>0):[],[l,n]),m=d.useMemo(()=>l?n.filter(s=>!l.features.some(a=>v(s.feature_branch,a.id))):n,[l,n]);d.useEffect(()=>{!N&&x.length>0&&(j(new Set(x.map(s=>s.id))),R(!0))},[x,N]);const _=s=>{const a=new Set(b);a.has(s)?a.delete(s):a.add(s),j(a)};if(p)return e.jsx("div",{className:"min-h-screen bg-[#191919] flex items-center justify-center",children:e.jsx(w,{className:"w-5 h-5 text-gray-400 animate-spin"})});const E=n.filter(s=>s.status==="running"),P=n.filter(s=>s.status==="completed"),F=n.filter(s=>s.status==="failed");return e.jsx("div",{className:"min-h-screen bg-[#191919]",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-6 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs(u,{to:"/cecelia",className:"text-gray-400 hover:text-white flex items-center gap-2 text-sm",children:[e.jsx(W,{className:"w-4 h-4"})," Engine 工作台"]}),e.jsx("button",{onClick:h,className:"p-2 text-gray-500 hover:text-white rounded-lg hover:bg-white/5",children:e.jsx(w,{className:`w-4 h-4 ${p?"animate-spin":""}`})})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-white tracking-tight mb-2",children:o}),(l==null?void 0:l.description)&&e.jsx("p",{className:"text-gray-400",children:l.description}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 mt-6",children:[e.jsxs("div",{className:"bg-[#202020] rounded-xl p-4 border border-[#303030]",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-sm mb-1",children:[e.jsx(z,{className:"w-4 h-4"})," 总任务"]}),e.jsx("div",{className:"text-2xl font-bold text-white",children:n.length})]}),e.jsxs("div",{className:"bg-[#202020] rounded-xl p-4 border border-[#303030]",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-400 text-sm mb-1",children:[e.jsx(D,{className:"w-4 h-4"})," 运行中"]}),e.jsx("div",{className:"text-2xl font-bold text-blue-400",children:E.length})]}),e.jsxs("div",{className:"bg-[#202020] rounded-xl p-4 border border-[#303030]",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-400 text-sm mb-1",children:[e.jsx(g,{className:"w-4 h-4"})," 完成"]}),e.jsx("div",{className:"text-2xl font-bold text-green-400",children:P.length})]}),e.jsxs("div",{className:"bg-[#202020] rounded-xl p-4 border border-[#303030]",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-400 text-sm mb-1",children:[e.jsx(f,{className:"w-4 h-4"})," 失败"]}),e.jsx("div",{className:"text-2xl font-bold text-red-400",children:F.length})]})]})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsxs("div",{className:"col-span-8",children:[x.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(M,{className:"w-5 h-5 text-blue-400"}),e.jsx("h2",{className:"text-lg font-semibold text-white",children:"活跃 Features"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",x.length,")"]})]}),e.jsx("div",{className:"bg-[#202020] rounded-2xl border border-[#303030] overflow-hidden",children:x.map((s,a)=>{const i=s.runs.filter(t=>t.status==="running"),r=s.runs.filter(t=>t.status==="completed"),c=b.has(s.id);return e.jsxs("div",{className:a<x.length-1?"border-b border-[#303030]":"",children:[e.jsxs("button",{onClick:()=>_(s.id),className:"w-full flex items-center justify-between px-5 py-4 hover:bg-white/5 transition text-left",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{className:`w-4 h-4 text-gray-500 transition-transform ${c?"":"-rotate-90"}`}),e.jsx("span",{className:"text-white font-medium",children:s.name}),e.jsxs("span",{className:"text-xs text-gray-500 font-mono",children:["v",s.version]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[i.length>0&&e.jsxs("span",{className:"px-2 py-0.5 text-xs bg-blue-500/20 text-blue-400 rounded-full flex items-center gap-1",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-blue-400 rounded-full animate-pulse"}),i.length]}),r.length>0&&e.jsxs("span",{className:"text-xs text-green-400",children:[r.length," 完成"]})]})]}),c&&e.jsx("div",{className:"px-5 pb-4",children:e.jsx("div",{className:"ml-7 space-y-2",children:s.runs.map(t=>e.jsxs(u,{to:`/cecelia/runs/${t.id}`,className:`flex items-center justify-between p-3 rounded-xl transition ${t.status==="running"?"bg-blue-500/10 hover:bg-blue-500/15":t.status==="completed"?"bg-white/5 hover:bg-white/10":"bg-red-500/10 hover:bg-red-500/15"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[t.status==="running"&&e.jsx("span",{className:"w-2 h-2 bg-blue-400 rounded-full animate-pulse"}),t.status==="completed"&&e.jsx(g,{className:"w-4 h-4 text-green-400"}),t.status==="failed"&&e.jsx(f,{className:"w-4 h-4 text-red-400"}),e.jsx("span",{className:t.status==="completed"?"text-gray-300":"text-white",children:t.prd_title||t.feature_branch})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.status==="running"&&t.current_step&&e.jsxs("span",{className:"text-xs text-blue-400 font-mono",children:["Step ",t.current_step,"/9"]}),e.jsx(y,{className:"w-4 h-4 text-gray-600"})]})]},t.id))})})]},s.id)})})]}),n.length===0&&e.jsx("div",{className:"bg-[#202020] rounded-2xl border border-[#303030] p-8 text-center text-gray-500",children:"暂无任务记录"})]}),e.jsxs("div",{className:"col-span-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(J,{className:"w-5 h-5 text-gray-400"}),e.jsx("h2",{className:"text-lg font-semibold text-white",children:"其他任务"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",m.length,")"]})]}),m.length>0?e.jsx("div",{className:"bg-[#202020] rounded-2xl border border-[#303030] overflow-hidden",children:m.map((s,a)=>e.jsxs(u,{to:`/cecelia/runs/${s.id}`,className:`flex items-center justify-between px-4 py-3 hover:bg-white/5 transition ${a<m.length-1?"border-b border-[#303030]":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[s.status==="running"&&e.jsx("span",{className:"w-2 h-2 bg-blue-400 rounded-full animate-pulse flex-shrink-0"}),s.status==="completed"&&e.jsx(g,{className:"w-4 h-4 text-green-400 flex-shrink-0"}),s.status==="failed"&&e.jsx(f,{className:"w-4 h-4 text-red-400 flex-shrink-0"}),e.jsx("span",{className:`truncate ${s.status==="completed"?"text-gray-400":"text-white"}`,children:s.prd_title||s.feature_branch})]}),e.jsx(y,{className:"w-4 h-4 text-gray-600 flex-shrink-0 ml-2"})]},s.id))}):e.jsx("div",{className:"bg-[#202020] rounded-2xl border border-[#303030] p-6 text-center text-gray-500 text-sm",children:"所有任务已归类"})]})]})]})})}export{A as default};
