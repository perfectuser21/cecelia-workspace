import{j as e,a8 as p,r as x,B as g,R as b,z as j}from"./index-CruRp6au.js";import{g as u,b as h,c as m,a as f,L as y,E as N,f as k}from"./formatters-CzHz6mtw.js";function v({status:r,showIcon:s=!1,showLabel:n=!0,label:o,size:a="sm",variant:i="filled",className:d=""}){const l=o||u(r),t={sm:"px-2 py-0.5 text-xs",md:"px-2.5 py-1 text-sm",lg:"px-3 py-1.5 text-base"},c={sm:"w-3 h-3",md:"w-4 h-4",lg:"w-5 h-5"};return i==="dot"?e.jsxs("span",{className:`inline-flex items-center gap-1.5 ${d}`,children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${r.toLowerCase().includes("online")||r.toLowerCase().includes("success")||r.toLowerCase().includes("running")?"bg-green-500":r.toLowerCase().includes("error")||r.toLowerCase().includes("offline")?"bg-red-500":"bg-gray-400"}`}),n&&e.jsx("span",{className:`text-${a==="sm"?"xs":a==="md"?"sm":"base"} ${h(r)}`,children:l})]}):i==="outline"?e.jsxs("span",{className:`
          inline-flex items-center gap-1 font-medium rounded-lg border
          ${t[a]}
          ${h(r)}
          border-current/30
          ${d}
        `,children:[s&&m(r,c[a]),n&&l]}):e.jsxs("span",{className:`
        inline-flex items-center gap-1 font-medium rounded-lg
        ${t[a]}
        ${f(r)}
        ${d}
      `,children:[s&&m(r,c[a]),n&&l]})}const w="";function _(){const r=p(),[s,n]=x.useState(null),[o,a]=x.useState(!0),[i,d]=x.useState(null),l=async()=>{try{const c=await(await fetch(`${w}/api/cecelia/overview`)).json();c.success?(n(c),d(null)):d(c.error)}catch(t){d(t instanceof Error?t.message:"Unknown error")}finally{a(!1)}};return x.useEffect(()=>{l();const t=setInterval(l,5e3);return()=>clearInterval(t)},[]),o?e.jsx(y,{height:"h-64"}):i?e.jsx(N,{message:`连接 Cecelia API 失败: ${i}`,onRetry:l,height:"h-64"}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-violet-500 to-purple-600 rounded-xl",children:e.jsx(g,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Cecelia"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"AI 代码执行器任务追踪"})]})]}),e.jsx("button",{onClick:l,className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:e.jsx(b,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-5 border border-gray-200 dark:border-slate-700",children:[e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:(s==null?void 0:s.total_runs)||0}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"总任务"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-5 border border-blue-200 dark:border-blue-800",children:[e.jsx("p",{className:"text-3xl font-bold text-blue-600 dark:text-blue-400",children:(s==null?void 0:s.running)||0}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"运行中"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-5 border border-emerald-200 dark:border-emerald-800",children:[e.jsx("p",{className:"text-3xl font-bold text-emerald-600 dark:text-emerald-400",children:(s==null?void 0:s.completed)||0}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"已完成"})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-5 border border-red-200 dark:border-red-800",children:[e.jsx("p",{className:"text-3xl font-bold text-red-600 dark:text-red-400",children:(s==null?void 0:s.failed)||0}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"失败"})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl border border-gray-200 dark:border-slate-700",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-slate-700",children:e.jsx("h2",{className:"font-semibold text-gray-900 dark:text-white",children:"最近任务"})}),s!=null&&s.recent_runs&&s.recent_runs.length>0?e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-slate-700",children:s.recent_runs.map(t=>e.jsxs("div",{onClick:()=>r(`/cecelia/runs/${t.id}`),className:"p-6 hover:bg-gray-50 dark:hover:bg-slate-700/50 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[m(t.status,"w-5 h-5"),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:t.project}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.feature_branch})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{status:t.status,size:"sm"}),e.jsx(j,{className:"w-5 h-5 text-gray-400"})]})]}),e.jsxs("div",{className:"ml-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"flex-1 h-2 bg-gray-200 dark:bg-slate-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-emerald-500 rounded-full transition-all",style:{width:`${t.completed_checkpoints/t.total_checkpoints*100}%`}})}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400 whitespace-nowrap",children:[t.completed_checkpoints,"/",t.total_checkpoints]})]}),t.current_checkpoint&&e.jsxs("p",{className:"text-sm text-blue-600 dark:text-blue-400 mb-1",children:["当前: ",t.current_checkpoint]}),e.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:k(t.updated_at)})]})]},t.id))}):e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(g,{className:"w-12 h-12 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"暂无任务"}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-gray-500 mt-1",children:"通过 N8N 工作流触发 Cecelia 执行 PRD"})]})]})]})}export{_ as default};
