import{r as g,j as e,aq as U,x as G,K as q,aJ as M,_ as Q,aO as H,bg as _,C as J,R as K,a5 as V,af as Z,aS as Y}from"./index-DDAi5NSp.js";import{g as ee}from"./github.api-vN1f_k_u.js";import"./index-B9ygI19o.js";const r={main:"#10b981",develop:"#3b82f6",feature:"#f59e0b",merge:"#8b5cf6",node:"#ffffff",text:"#64748b",version:"#059669",grid:"#e2e8f0"},l={width:800,height:320,padding:{top:40,right:40,bottom:60,left:80},rowHeight:50,nodeRadius:5,versionRadius:8};function te({data:s,loading:d}){const n=g.useMemo(()=>{if(!s)return null;const{dateRange:t,main:x,develop:X,features:y,merges:B}=s,k=new Date(t.start),N=new Date(t.end),w=N.getTime()-k.getTime(),$=l.width-l.padding.left-l.padding.right,R=l.height-l.padding.top-l.padding.bottom,p=i=>{const O=(new Date(i).getTime()-k.getTime())/w;return l.padding.left+O*$},f=l.padding.top+30,a=f+l.rowHeight,m=a+l.rowHeight,A=x.commits.filter(i=>i.date).map(i=>({...i,x:p(i.date),y:f})),D=X.commits.filter(i=>i.date).map(i=>({...i,x:p(i.date),y:a})),W=y.slice(0,4).map((i,T)=>({...i,y:m+T*35,startX:p(i.startDate),endX:i.endDate?p(i.endDate):p(t.end)})),z=B.map(i=>({...i,x:p(i.date),fromY:a,toY:f})),L=24*60*60*1e3,j=Math.ceil(w/L),I=j>20?7:j>10?3:1,P=[];for(let i=new Date(k);i<=N;i.setDate(i.getDate()+I))P.push({x:p(i.toISOString()),label:`${i.getMonth()+1}/${i.getDate()}`});return{mainNodes:A,developNodes:D,featureRows:W,mergeLines:z,ticks:P,graphWidth:$,graphHeight:R,mainY:f,developY:a}},[s]);if(d)return e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"h-[280px] bg-slate-100 dark:bg-slate-700/50 rounded-lg"})});if(!n||!s)return e.jsx("div",{className:"h-[280px] flex items-center justify-center text-slate-400 dark:text-slate-500",children:e.jsx("p",{children:"No timeline data"})});const{mainNodes:h,developNodes:c,featureRows:b,mergeLines:o,ticks:C,mainY:v,developY:u}=n;return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("svg",{width:l.width,height:l.height,className:"min-w-full",viewBox:`0 0 ${l.width} ${l.height}`,children:[e.jsx("line",{x1:l.padding.left,y1:l.height-l.padding.bottom+20,x2:l.width-l.padding.right,y2:l.height-l.padding.bottom+20,stroke:r.grid,strokeWidth:1}),C.map((t,x)=>e.jsxs("g",{children:[e.jsx("line",{x1:t.x,y1:l.padding.top,x2:t.x,y2:l.height-l.padding.bottom+25,stroke:r.grid,strokeWidth:1,strokeDasharray:"2 4",opacity:.5}),e.jsx("text",{x:t.x,y:l.height-l.padding.bottom+38,fill:r.text,fontSize:10,textAnchor:"middle",children:t.label})]},x)),e.jsx("text",{x:l.padding.left-10,y:v,fill:r.main,fontSize:11,fontWeight:600,textAnchor:"end",dominantBaseline:"middle",children:"main"}),e.jsx("text",{x:l.padding.left-10,y:u,fill:r.develop,fontSize:11,fontWeight:600,textAnchor:"end",dominantBaseline:"middle",children:"develop"}),h.length>1&&e.jsx("line",{x1:Math.min(...h.map(t=>t.x)),y1:v,x2:Math.max(...h.map(t=>t.x)),y2:v,stroke:r.main,strokeWidth:3,strokeLinecap:"round"}),c.length>1&&e.jsx("line",{x1:Math.min(...c.map(t=>t.x)),y1:u,x2:Math.max(...c.map(t=>t.x)),y2:u,stroke:r.develop,strokeWidth:3,strokeLinecap:"round"}),b.map((t,x)=>e.jsxs("g",{children:[e.jsx("text",{x:l.padding.left-10,y:t.y,fill:r.feature,fontSize:10,textAnchor:"end",dominantBaseline:"middle",opacity:.8,children:t.name}),e.jsx("line",{x1:t.startX,y1:t.y,x2:t.endX,y2:t.y,stroke:r.feature,strokeWidth:2,strokeLinecap:"round",opacity:.7}),e.jsx("path",{d:`M ${t.startX} ${u} Q ${t.startX} ${(u+t.y)/2} ${t.startX} ${t.y}`,fill:"none",stroke:r.feature,strokeWidth:1.5,strokeDasharray:"3 2",opacity:.5}),t.endDate&&e.jsx("path",{d:`M ${t.endX} ${t.y} Q ${t.endX} ${(u+t.y)/2} ${t.endX} ${u}`,fill:"none",stroke:r.feature,strokeWidth:1.5,strokeDasharray:"3 2",opacity:.5}),e.jsx("circle",{cx:t.startX+15,cy:t.y,r:8,fill:r.feature,opacity:.2}),e.jsx("text",{x:t.startX+15,y:t.y,fill:r.feature,fontSize:8,fontWeight:600,textAnchor:"middle",dominantBaseline:"middle",children:t.prs.length})]},t.name)),o.map((t,x)=>e.jsx("g",{children:e.jsx("path",{d:`M ${t.x} ${t.fromY} L ${t.x} ${t.toY}`,fill:"none",stroke:r.merge,strokeWidth:2,markerEnd:"url(#arrowhead)"})},x)),e.jsx("defs",{children:e.jsx("marker",{id:"arrowhead",markerWidth:"6",markerHeight:"6",refX:"5",refY:"3",orient:"auto",children:e.jsx("polygon",{points:"0 0, 6 3, 0 6",fill:r.merge})})}),h.map((t,x)=>e.jsxs("g",{className:"cursor-pointer",children:[e.jsx("title",{children:`${t.version||t.sha}: ${t.message}`}),t.isRelease?e.jsxs(e.Fragment,{children:[e.jsx("circle",{cx:t.x,cy:t.y,r:l.versionRadius,fill:r.version,stroke:r.node,strokeWidth:2}),e.jsx("text",{x:t.x,y:t.y-16,fill:r.version,fontSize:10,fontWeight:700,textAnchor:"middle",className:"font-mono",children:t.version})]}):e.jsx("circle",{cx:t.x,cy:t.y,r:l.nodeRadius,fill:r.main,stroke:r.node,strokeWidth:1.5})]},`main-${x}`)),c.map((t,x)=>e.jsxs("g",{className:"cursor-pointer",children:[e.jsx("title",{children:`${t.sha}: ${t.message}`}),e.jsx("circle",{cx:t.x,cy:t.y,r:l.nodeRadius,fill:r.develop,stroke:r.node,strokeWidth:1.5})]},`develop-${x}`)),e.jsxs("g",{transform:`translate(${l.width-130}, 12)`,children:[e.jsx("circle",{cx:0,cy:0,r:4,fill:r.main}),e.jsx("text",{x:8,y:4,fontSize:9,fill:r.text,children:"main"}),e.jsx("circle",{cx:0,cy:14,r:4,fill:r.develop}),e.jsx("text",{x:8,y:18,fontSize:9,fill:r.text,children:"develop"}),e.jsx("circle",{cx:0,cy:28,r:4,fill:r.feature}),e.jsx("text",{x:8,y:32,fontSize:9,fill:r.text,children:"feature"}),e.jsx("circle",{cx:50,cy:0,r:5,fill:r.version}),e.jsx("text",{x:58,y:4,fontSize:9,fill:r.text,children:"release"}),e.jsx("line",{x1:45,y1:14,x2:55,y2:14,stroke:r.merge,strokeWidth:2}),e.jsx("text",{x:58,y:18,fontSize:9,fill:r.text,children:"merge"})]})]})})}const se=({state:s})=>{const d={merged:{icon:_,color:"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400"},open:{icon:H,color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400"},closed:{icon:Q,color:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"}},{icon:n,color:h}=d[s]||d.closed;return e.jsx("span",{className:`inline-flex items-center gap-1 px-1.5 py-0.5 text-xs font-medium rounded ${h}`,children:e.jsx(n,{className:"w-3 h-3"})})},ae=({feature:s})=>{const[d,n]=g.useState(!1),h=o=>new Date(o).toLocaleDateString("zh-CN",{month:"short",day:"numeric"}),c=s.prs.filter(o=>o.state==="merged").length,b=s.prs.filter(o=>o.state==="open").length;return e.jsxs("div",{className:"border-b border-slate-200 dark:border-slate-700 last:border-b-0",children:[e.jsxs("button",{onClick:()=>n(!d),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-slate-50 dark:hover:bg-slate-700/30 transition-colors text-left",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[d?e.jsx(U,{className:"w-4 h-4 text-slate-400"}):e.jsx(G,{className:"w-4 h-4 text-slate-400"}),e.jsx("span",{className:"font-medium text-slate-800 dark:text-white",children:s.displayName}),e.jsxs("span",{className:"text-sm text-slate-500 dark:text-slate-400",children:["[",s.prs.length," PR",s.prs.length>1?"s":"","]"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[c>0&&e.jsxs("span",{className:"px-2 py-0.5 bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400 rounded-full",children:[c," merged"]}),b>0&&e.jsxs("span",{className:"px-2 py-0.5 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded-full",children:[b," open"]})]})]}),!d&&s.latestPr&&e.jsx("div",{className:"px-4 pb-3 pl-11",children:e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 truncate",children:["Latest: ",s.latestPr.title]})}),d&&e.jsx("div",{className:"pb-2",children:s.prs.map(o=>e.jsx(le,{pr:o,formatDate:h},o.number))})]})},le=({pr:s,formatDate:d})=>e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",className:"block mx-4 mb-2 ml-11 p-3 bg-slate-50 dark:bg-slate-700/50 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg border border-slate-200 dark:border-slate-600 transition-colors group",children:e.jsx("div",{className:"flex items-start justify-between gap-2",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"text-xs font-mono text-slate-500 dark:text-slate-400",children:["#",s.number]}),e.jsx(se,{state:s.state}),e.jsx(q,{className:"w-3 h-3 text-slate-400 opacity-0 group-hover:opacity-100 transition-opacity"})]}),e.jsx("p",{className:"text-sm font-medium text-slate-800 dark:text-white truncate",children:s.title}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-xs text-slate-500 dark:text-slate-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(M,{className:"w-3 h-3"}),s.headBranch]}),e.jsx("span",{children:d(s.mergedAt||s.createdAt)})]})]})})});function re({features:s,loading:d}){return d?e.jsx("div",{className:"animate-pulse space-y-3",children:[1,2,3].map(n=>e.jsx("div",{className:"h-16 bg-slate-100 dark:bg-slate-700/50 rounded-lg"},n))}):!s||s.length===0?e.jsx("div",{className:"h-[200px] flex items-center justify-center text-slate-400 dark:text-slate-500",children:e.jsx("p",{children:"暂无 Feature 数据"})}):e.jsx("div",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:s.map(n=>e.jsx(ae,{feature:n},n.name))})}const F=["zenithjoy-engine","zenithjoy-core","zenithjoy-autopilot"],S=({children:s,className:d=""})=>e.jsx("div",{className:`
      rounded-2xl
      bg-white dark:bg-slate-800/80
      backdrop-blur-xl
      border border-slate-200 dark:border-slate-700
      shadow-lg shadow-slate-200/50 dark:shadow-black/30
      transition-all duration-300 ease-out
      ${d}
    `,children:s}),ne=({repo:s,active:d,onClick:n})=>e.jsx("button",{onClick:n,className:`
      px-4 py-2 text-sm font-medium rounded-lg transition-all duration-200
      ${d?"bg-slate-800 dark:bg-white text-white dark:text-slate-800 shadow-md":"text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700"}
    `,children:s}),E=({icon:s,title:d})=>e.jsxs("div",{className:"flex items-center gap-2 px-5 py-3 border-b border-slate-200 dark:border-slate-700",children:[e.jsx(s,{className:"w-4 h-4 text-slate-500 dark:text-slate-400"}),e.jsx("h3",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300",children:d})]});function ce(){var k,N,w,$,R,p,f;const[s,d]=g.useState(F[0]),[n,h]=g.useState(null),[c,b]=g.useState(!0),[o,C]=g.useState(null),[v,u]=g.useState(null),t=g.useCallback(async a=>{try{b(!0),C(null);const m=await ee(a);m.success&&m.data?h(m.data):h(null),u(new Date)}catch(m){C("Failed to connect to server"),console.error("Fetch error:",m)}finally{b(!1)}},[]);g.useEffect(()=>{t(s)},[s,t]),g.useEffect(()=>{const a=setInterval(()=>t(s),3e5);return()=>clearInterval(a)},[s,t]);const x=()=>{t(s)},X=a=>{a!==s&&d(a)},y={mainCommits:((N=(k=n==null?void 0:n.main)==null?void 0:k.commits)==null?void 0:N.length)||0,developCommits:(($=(w=n==null?void 0:n.develop)==null?void 0:w.commits)==null?void 0:$.length)||0,features:((R=n==null?void 0:n.features)==null?void 0:R.length)||0,totalPrs:((p=n==null?void 0:n.features)==null?void 0:p.reduce((a,m)=>a+m.prs.length,0))||0},B=((f=n==null?void 0:n.features)==null?void 0:f.map(a=>{var m,A,D,W,z,L;return{name:a.name,displayName:a.name.charAt(0).toUpperCase()+a.name.slice(1),prs:a.prs.map(j=>({number:j.number,title:j.title,state:j.state,author:"Unknown",createdAt:a.startDate,updatedAt:j.mergedAt||a.startDate,mergedAt:j.mergedAt,headBranch:`feat/${a.name}`,baseBranch:"develop",additions:0,deletions:0,changedFiles:0,url:`https://github.com/perfectuser21/${s}/pull/${j.number}`})),latestPr:{number:((m=a.prs[0])==null?void 0:m.number)||0,title:((A=a.prs[0])==null?void 0:A.title)||"",state:((D=a.prs[0])==null?void 0:D.state)||"closed",author:"Unknown",createdAt:a.startDate,updatedAt:((W=a.prs[0])==null?void 0:W.mergedAt)||a.startDate,mergedAt:((z=a.prs[0])==null?void 0:z.mergedAt)||null,headBranch:`feat/${a.name}`,baseBranch:"develop",additions:0,deletions:0,changedFiles:0,url:`https://github.com/perfectuser21/${s}/pull/${((L=a.prs[0])==null?void 0:L.number)||0}`}}}))||[];return e.jsx("div",{className:"min-h-screen -m-8 -mt-8 p-8",children:e.jsxs("div",{className:"space-y-6 p-2",children:[e.jsxs(S,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:"VPS 全景视图"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"分支结构 + Feature 进化路径"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[v&&e.jsxs("span",{className:"text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1",children:[e.jsx(J,{className:"w-3 h-3"}),v.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"})]}),e.jsx("button",{onClick:x,disabled:c,className:"p-2 text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors disabled:opacity-50",title:"刷新",children:e.jsx(K,{className:`w-5 h-5 ${c?"animate-spin":""}`})})]})]}),e.jsx("div",{className:"mt-4 flex items-center gap-2 p-1 bg-slate-100 dark:bg-slate-700/50 rounded-xl",children:F.map(a=>e.jsx(ne,{repo:a,active:a===s,onClick:()=>X(a)},a))})]}),o&&e.jsx(S,{className:"p-6 border-red-200 dark:border-red-800/50",children:e.jsxs("div",{className:"flex items-center gap-3 text-red-600 dark:text-red-400",children:[e.jsx(V,{className:"w-5 h-5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"加载失败"}),e.jsx("p",{className:"text-sm opacity-75",children:o})]})]})}),!o&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[{label:"仓库",value:s.replace("zenithjoy-",""),icon:Z,color:"text-slate-600 dark:text-slate-400",bg:"bg-slate-500/10"},{label:"Main Commits",value:y.mainCommits,icon:M,color:"text-emerald-600 dark:text-emerald-400",bg:"bg-emerald-500/10"},{label:"Features",value:y.features,icon:Y,color:"text-purple-600 dark:text-purple-400",bg:"bg-purple-500/10"},{label:"总 PRs",value:y.totalPrs,icon:H,color:"text-blue-600 dark:text-blue-400",bg:"bg-blue-500/10"}].map(a=>e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2.5 rounded-xl ${a.bg}`,children:e.jsx(a.icon,{className:`w-5 h-5 ${a.color}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:a.label}),e.jsx("p",{className:"text-xl font-semibold text-slate-800 dark:text-white",children:a.value})]})]})},a.label))}),!o&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(S,{className:"overflow-hidden",children:[e.jsx(E,{icon:M,title:"时间轴"}),e.jsx("div",{className:"p-5",children:e.jsx(te,{data:n,loading:c})})]}),e.jsxs(S,{className:"overflow-hidden",children:[e.jsx(E,{icon:Y,title:"Feature 进化路径"}),e.jsx("div",{className:"max-h-[400px] overflow-y-auto",children:e.jsx(re,{features:B,loading:c})})]})]})]})})}export{ce as default};
