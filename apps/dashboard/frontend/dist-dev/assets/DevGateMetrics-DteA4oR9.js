import{r as i,j as e,R as w,aE as f,ai as y,C,a4 as _,aO as D,a1 as S,aP as j}from"./index-DWmptck8.js";function M(){const t=[],l=new Date;for(let r=0;r<6;r++){const n=new Date(l.getFullYear(),l.getMonth()-r,1),o=n.getFullYear(),d=String(n.getMonth()+1).padStart(2,"0");t.push(`${o}-${d}`)}return t}function $(){const[t,l]=i.useState(null),[r,n]=i.useState(null),[o,d]=i.useState(!0),[m,h]=i.useState(null),[c,N]=i.useState(()=>{const s=new Date;return`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}`}),v=M(),g=async s=>{d(!0),h(null);try{const[a,b]=await Promise.all([fetch(`/api/devgate/metrics?month=${s}`),fetch("/api/devgate/log")]),u=await a.json(),p=await b.json();u.data?l(u.data):l(null),p.lastUpdate?n(p.lastUpdate):n(null)}catch(a){h(a instanceof Error?a.message:"Unknown error")}finally{d(!1)}};i.useEffect(()=>{g(c)},[c]);const x=s=>new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});return o?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(w,{className:"w-8 h-8 animate-spin text-blue-500"})}):m?e.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/30 rounded-lg",children:e.jsx("p",{className:"text-red-400",children:m})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx(f,{className:"w-7 h-7"}),"DevGate Metrics"]}),e.jsx("p",{className:"text-gray-400 mt-1",children:r?`Last updated: ${x(r.received_at)}`:"No updates yet"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:c,onChange:s=>N(s.target.value),className:"appearance-none bg-white/5 border border-white/10 rounded-lg px-4 py-2 pr-8 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:v.map(s=>e.jsx("option",{value:s,className:"bg-gray-900",children:s},s))}),e.jsx(y,{className:"absolute right-2 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"})]}),e.jsx("button",{onClick:()=>g(c),className:"p-2 rounded-lg bg-white/5 hover:bg-white/10 transition-colors",children:e.jsx(w,{className:"w-5 h-5 text-gray-400"})})]})]}),t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[e.jsx(_,{className:"w-4 h-4 text-red-400"}),e.jsx("span",{children:"P0 Issues"})]}),e.jsx("div",{className:`text-3xl font-bold mt-1 ${t.summary.p0_count>0?"text-red-400":"text-emerald-400"}`,children:t.summary.p0_count})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[e.jsx(D,{className:"w-4 h-4 text-yellow-400"}),e.jsx("span",{children:"P1 Issues"})]}),e.jsx("div",{className:`text-3xl font-bold mt-1 ${t.summary.p1_count>0?"text-yellow-400":"text-emerald-400"}`,children:t.summary.p1_count})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[e.jsx(S,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{children:"RCI Coverage"})]}),e.jsxs("div",{className:"text-3xl font-bold text-white mt-1",children:[t.summary.rci_coverage.pct.toFixed(1),"%"]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[t.summary.rci_coverage.covered," / ",t.summary.rci_coverage.total]})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[e.jsx(j,{className:"w-4 h-4 text-purple-400"}),e.jsx("span",{children:"Manual Tests"})]}),e.jsx("div",{className:"text-3xl font-bold text-white mt-1",children:t.summary.manual_tests})]})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-4 border border-white/10",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400 mb-2",children:"Time Window"}),e.jsxs("p",{className:"text-white",children:[x(t.window.since)," - ",x(t.window.until)]})]}),t.new_rci&&t.new_rci.length>0&&e.jsxs("div",{className:"bg-white/5 rounded-lg border border-white/10 overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-white/10",children:[e.jsxs("h3",{className:"text-lg font-medium text-white",children:["New RCI (",t.new_rci.length,")"]}),e.jsx("p",{className:"text-sm text-gray-400",children:"Recently added to Required Code Investigation list"})]}),e.jsx("div",{className:"divide-y divide-white/5",children:t.new_rci.map((s,a)=>e.jsx("div",{className:"px-4 py-3 hover:bg-white/5",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(j,{className:"w-4 h-4 text-blue-400 mt-1 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-mono text-sm text-white truncate",children:s.file}),e.jsx("div",{className:"text-sm text-blue-400 mt-0.5",children:s.function}),e.jsx("div",{className:"text-sm text-gray-400 mt-1",children:s.reason})]})]})},a))})]})]}):e.jsxs("div",{className:"bg-white/5 rounded-lg border border-white/10 p-8 text-center",children:[e.jsx(C,{className:"w-12 h-12 text-gray-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No metrics yet"}),e.jsx("p",{className:"text-gray-400",children:"Waiting for nightly push from engine..."})]})]})}export{$ as default};
