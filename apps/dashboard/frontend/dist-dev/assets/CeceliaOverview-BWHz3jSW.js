import{r as d,j as e,R as j,B as C,A as R,a1 as $,a0 as k,Z as D,ab as b,aA as _,z as T}from"./index-A9akftxR.js";function S(){const[n,x]=d.useState(null),[i,u]=d.useState(!0),[a,m]=d.useState("24h"),h=async()=>{try{const t=await(await fetch("/api/cecelia/overview?limit=100")).json();t.success&&x(t)}catch(s){console.error(s)}finally{u(!1)}};d.useEffect(()=>{h();const s=setInterval(h,1e4);return()=>clearInterval(s)},[]);const v=s=>{const w=Date.now()-(a==="24h"?24:a==="72h"?72:168)*60*60*1e3;return s.filter(y=>new Date(y.started_at).getTime()>=w)};if(i&&!n)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(j,{className:"w-6 h-6 text-violet-400 animate-spin"})});const N=(n==null?void 0:n.recent_runs)||[],l=v(N),g=new Map;for(const s of l){const t=g.get(s.project);t?(t.features.push(s),s.status==="running"&&t.runningCount++,s.status==="completed"&&t.completedCount++,s.status==="failed"&&t.failedCount++):g.set(s.project,{name:s.project,runningCount:s.status==="running"?1:0,completedCount:s.status==="completed"?1:0,failedCount:s.status==="failed"?1:0,features:[s]})}const c=Array.from(g.values()),r={running:l.filter(s=>s.status==="running").length,completed:l.filter(s=>s.status==="completed").length,failed:l.filter(s=>s.status==="failed").length,total:l.length},f=[...l].sort((s,t)=>s.status==="running"&&t.status!=="running"?-1:s.status!=="running"&&t.status==="running"?1:new Date(t.updated_at).getTime()-new Date(s.updated_at).getTime()).slice(0,6),p=a==="24h"?"24小时":a==="72h"?"72小时":"7天";return e.jsxs("div",{className:"space-y-5 max-w-5xl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-violet-600 rounded-lg",children:e.jsx(C,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-white",children:"Cecelia v3"}),e.jsxs("p",{className:"text-xs text-gray-500",children:["近",p," · ",c.length,"个项目 · ",l.length,"个任务"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex bg-slate-800 rounded border border-slate-700",children:["24h","72h","7d"].map(s=>e.jsx("button",{onClick:()=>m(s),className:`px-2 py-1 text-xs ${a===s?"bg-violet-600 text-white":"text-gray-400 hover:text-white"}`,children:s},s))}),e.jsx("button",{onClick:h,className:"p-1.5 text-gray-400 hover:text-white hover:bg-slate-700 rounded",children:e.jsx(j,{className:`w-4 h-4 ${i?"animate-spin":""}`})})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsx(o,{icon:e.jsx(R,{className:"w-4 h-4"}),label:"运行中",value:r.running,color:"blue",pulse:r.running>0}),e.jsx(o,{icon:e.jsx($,{className:"w-4 h-4"}),label:"成功",value:r.completed,color:"emerald"}),e.jsx(o,{icon:e.jsx(k,{className:"w-4 h-4"}),label:"失败",value:r.failed,color:"red"}),e.jsx(o,{icon:e.jsx(D,{className:"w-4 h-4"}),label:"总数",value:r.total,color:"violet"})]}),f.length>0&&e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700 p-3",children:[e.jsx("h2",{className:"text-xs text-gray-400 mb-2",children:"近期工作"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:f.map(s=>e.jsxs(b,{to:`/cecelia/runs/${s.id}`,className:`px-2 py-1 rounded text-xs flex items-center gap-1.5 ${s.status==="running"?"bg-blue-500/20 text-blue-400 hover:bg-blue-500/30":s.status==="completed"?"bg-emerald-500/10 text-emerald-400 hover:bg-emerald-500/20":"bg-slate-700 text-gray-400 hover:bg-slate-600"}`,children:[s.status==="running"&&e.jsx("span",{className:"w-1.5 h-1.5 bg-blue-400 rounded-full animate-pulse"}),s.prd_title||s.feature_branch]},s.id))})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xs text-gray-400 mb-2",children:["项目 (",c.length,")"]}),c.length>0?e.jsx("div",{className:"space-y-2",children:c.map(s=>e.jsx(b,{to:`/cecelia/project/${encodeURIComponent(s.name)}`,className:"block bg-slate-800 rounded-lg border border-slate-700 p-3 hover:border-violet-500/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-white font-medium",children:s.name}),s.runningCount>0&&e.jsxs("span",{className:"px-1.5 py-0.5 text-xs bg-blue-500/20 text-blue-400 rounded",children:[s.runningCount," 运行中"]})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(_,{className:"w-3 h-3"}),s.features.length," features"]}),e.jsxs("span",{children:[s.completedCount," 完成"]}),s.failedCount>0&&e.jsxs("span",{className:"text-red-400",children:[s.failedCount," 失败"]})]})]}),e.jsx(T,{className:"w-4 h-4 text-gray-500"})]})},s.name))}):e.jsx("div",{className:"bg-slate-800 rounded-lg border border-slate-700 p-6 text-center",children:e.jsxs("p",{className:"text-gray-500 text-sm",children:["近",p,"暂无任务"]})})]})]})}function o({icon:n,label:x,value:i,color:u,pulse:a}){const m={blue:"bg-blue-500/20 text-blue-400",emerald:"bg-emerald-500/20 text-emerald-400",red:"bg-red-500/20 text-red-400",violet:"bg-violet-500/20 text-violet-400"};return e.jsx("div",{className:"bg-slate-800 rounded-lg border border-slate-700 p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-7 h-7 rounded flex items-center justify-center ${m[u]} ${a?"animate-pulse":""}`,children:n}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-500",children:x}),e.jsx("div",{className:"text-base font-semibold text-white",children:i})]})]})})}export{S as default};
