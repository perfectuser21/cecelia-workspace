import{a7 as v,r as m,j as e,ab as k,G as w,R as y,aA as b,aH as j,W as C,ai as B,z as S,C as R,aQ as $,aS as D}from"./index-A9akftxR.js";import{b as L,c as P}from"./github.api-OHZvbO3D.js";import"./index-B9ygI19o.js";const N=({children:a,className:l=""})=>e.jsx("div",{className:`
      rounded-2xl
      bg-white dark:bg-slate-800/80
      backdrop-blur-xl
      border border-slate-200 dark:border-slate-700
      shadow-lg shadow-slate-200/50 dark:shadow-black/30
      ${l}
    `,children:a}),E=({branches:a})=>{const[l,h]=m.useState(new Set(["main","develop"])),i=s=>{const n=new Set(l);n.has(s)?n.delete(s):n.add(s),h(n)},t=s=>new Date(s).toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),c=s=>s==="main"?"border-emerald-500 bg-emerald-50 dark:bg-emerald-900/20":s==="develop"?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":s.startsWith("feature/")?"border-purple-500 bg-purple-50 dark:bg-purple-900/20":s.startsWith("cp-")?"border-amber-500 bg-amber-50 dark:bg-amber-900/20":"border-slate-300 bg-slate-50 dark:bg-slate-700/50",u=s=>s==="main"||s==="develop"?e.jsx(b,{className:"w-4 h-4 text-slate-500"}):e.jsx(D,{className:"w-4 h-4 text-slate-400"}),o=a.find(s=>s.name==="main"),g=a.find(s=>s.name==="develop"),x=a.filter(s=>s.name.startsWith("feature/")),r=a.filter(s=>s.name.startsWith("cp-")),d=a.filter(s=>!["main","develop"].includes(s.name)&&!s.name.startsWith("feature/")&&!s.name.startsWith("cp-")),p=(s,n=0)=>{const f=l.has(s.name);return e.jsxs("div",{className:"relative",children:[n>0&&e.jsx("div",{className:"absolute left-4 top-0 w-px h-full bg-slate-200 dark:bg-slate-700",style:{marginLeft:`${(n-1)*24}px`}}),e.jsxs("div",{className:`
            relative flex items-start gap-3 p-3 rounded-lg border-l-4 cursor-pointer
            transition-all hover:shadow-md
            ${c(s.name)}
          `,style:{marginLeft:`${n*24}px`},onClick:()=>i(s.name),children:[e.jsx("div",{className:"mt-0.5",children:f?e.jsx(B,{className:"w-4 h-4 text-slate-400"}):e.jsx(S,{className:"w-4 h-4 text-slate-400"})}),e.jsx("div",{className:"mt-0.5",children:u(s.name)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono text-sm font-medium text-slate-800 dark:text-white",children:s.name}),s.protected&&e.jsx("span",{className:"px-1.5 py-0.5 text-xs bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400 rounded",children:"protected"})]}),f&&e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsxs("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:[e.jsx("span",{className:"font-mono text-slate-500",children:s.sha.slice(0,7)}),e.jsx("span",{className:"mx-2",children:"·"}),s.lastCommit.message]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-slate-500 dark:text-slate-400",children:[e.jsx("span",{children:s.lastCommit.author}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(R,{className:"w-3 h-3"}),t(s.lastCommit.date)]})]})]})]})]})]},s.name)};return e.jsxs("div",{className:"space-y-2",children:[o&&p(o),g&&p(g,1),x.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("p",{className:"text-xs font-medium text-slate-500 dark:text-slate-400 mb-2 ml-12",children:["Feature 分支 (",x.length,")"]}),x.map(s=>p(s,2))]}),r.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("p",{className:"text-xs font-medium text-slate-500 dark:text-slate-400 mb-2 ml-12",children:["Checkpoint 分支 (",r.length,")"]}),r.map(s=>p(s,2))]}),d.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("p",{className:"text-xs font-medium text-slate-500 dark:text-slate-400 mb-2 ml-12",children:["其他分支 (",d.length,")"]}),d.map(s=>p(s,2))]})]})},W=({prs:a})=>{const l=t=>new Date(t).toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),h=t=>{switch(t){case"merged":return"bg-purple-500";case"open":return"bg-green-500";case"closed":return"bg-red-500";default:return"bg-slate-500"}},i=t=>{switch(t){case"merged":return e.jsx($,{className:"w-4 h-4 text-white"});case"open":return e.jsx(j,{className:"w-4 h-4 text-white"});default:return e.jsx(j,{className:"w-4 h-4 text-white"})}};return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-5 top-0 bottom-0 w-0.5 bg-slate-200 dark:bg-slate-700"}),e.jsx("div",{className:"space-y-4",children:a.map((t,c)=>e.jsxs("div",{className:"relative flex gap-4",children:[e.jsx("div",{className:`relative z-10 flex items-center justify-center w-10 h-10 rounded-full ${h(t.state)} shadow-lg`,children:i(t.state)}),e.jsx("div",{className:"flex-1 p-4 bg-slate-50 dark:bg-slate-700/50 rounded-xl border border-slate-200 dark:border-slate-600",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"text-xs font-mono text-slate-500",children:["#",t.number]}),e.jsx("span",{className:`px-2 py-0.5 text-xs rounded-full ${t.state==="merged"?"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400":t.state==="open"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"}`,children:t.state})]}),e.jsxs("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"text-sm font-medium text-slate-800 dark:text-white hover:text-blue-600 dark:hover:text-blue-400 transition-colors flex items-center gap-1",children:[t.title,e.jsx(C,{className:"w-3 h-3"})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-4 text-xs text-slate-500 dark:text-slate-400",children:[e.jsx("span",{children:t.author}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(b,{className:"w-3 h-3"}),t.headBranch," → ",t.baseBranch]}),t.changedFiles>0&&e.jsxs("span",{children:[e.jsxs("span",{className:"text-green-600 dark:text-green-400",children:["+",t.additions]}),e.jsx("span",{className:"mx-1",children:"/"}),e.jsxs("span",{className:"text-red-600 dark:text-red-400",children:["-",t.deletions]}),e.jsxs("span",{className:"ml-1",children:["(",t.changedFiles," files)"]})]})]})]}),e.jsx("span",{className:"text-xs text-slate-400 whitespace-nowrap",children:l(t.mergedAt||t.updatedAt)})]})})]},t.number))})]})};function A(){const{repoName:a}=v(),[l,h]=m.useState([]),[i,t]=m.useState([]),[c,u]=m.useState(!0),[o,g]=m.useState("branches");return m.useEffect(()=>{if(!a)return;(async()=>{u(!0);try{const[r,d]=await Promise.all([L(a),P(a,{state:"all",limit:20})]);r.success&&r.data&&h(r.data),d.success&&d.data&&t(d.data)}catch(r){console.error("Fetch error:",r)}finally{u(!1)}})()},[a]),e.jsx("div",{className:"min-h-screen -m-8 -mt-8 p-8",children:e.jsxs("div",{className:"space-y-6 p-2",children:[e.jsxs(N,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(k,{to:"/panorama",className:"p-2 text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",children:e.jsx(w,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-800 dark:text-white",children:a}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400",children:[l.length," 个分支 · ",i.length," 个 PR"]})]})]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"p-2 text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors",children:e.jsx(y,{className:`w-5 h-5 ${c?"animate-spin":""}`})})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsxs("button",{onClick:()=>g("branches"),className:`px-4 py-2 text-sm font-medium rounded-lg transition-colors ${o==="branches"?"bg-slate-800 text-white dark:bg-white dark:text-slate-800":"text-slate-600 hover:bg-slate-100 dark:text-slate-400 dark:hover:bg-slate-700"}`,children:[e.jsx(b,{className:"w-4 h-4 inline-block mr-2"}),"分支树"]}),e.jsxs("button",{onClick:()=>g("prs"),className:`px-4 py-2 text-sm font-medium rounded-lg transition-colors ${o==="prs"?"bg-slate-800 text-white dark:bg-white dark:text-slate-800":"text-slate-600 hover:bg-slate-100 dark:text-slate-400 dark:hover:bg-slate-700"}`,children:[e.jsx(j,{className:"w-4 h-4 inline-block mr-2"}),"PR 时间线"]})]})]}),e.jsx(N,{className:"p-6",children:c?e.jsx("div",{className:"animate-pulse space-y-4",children:[1,2,3,4,5].map(x=>e.jsx("div",{className:"h-16 bg-slate-100 dark:bg-slate-700/50 rounded-lg"},x))}):o==="branches"?e.jsx(E,{branches:l}):e.jsx(W,{prs:i})})]})})}export{A as default};
