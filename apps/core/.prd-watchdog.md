---
id: watchdog-agent-monitor
version: 1.0.0
created: 2026-01-29
updated: 2026-01-29
changelog:
  - 1.0.0: Initial version
---

# Agent Watchdog

## Overview

Implement a pure event-driven monitoring system for AI agents. When an agent has no output for more than 2 minutes, automatically trigger patrol.

## Core Logic

**"Activity" = modification time of output file**

```bash
# Agent output file location
/tmp/claude-*/*/*.output

# Check modification time
stat -c %Y /tmp/xxx.output

# If (now - mtime) > 120 seconds -> stuck
```

## API Endpoints

```
POST   /api/watchdog/register           # Register agent for monitoring
GET    /api/watchdog/status             # Get all monitoring status
GET    /api/watchdog/:agent_id          # Get specific agent status
DELETE /api/watchdog/:agent_id          # Unregister agent
POST   /api/watchdog/trigger/:agent_id  # Manually trigger patrol
POST   /api/watchdog/monitor/start      # Start background monitor
POST   /api/watchdog/monitor/stop       # Stop background monitor
POST   /api/watchdog/check              # Manual check all agents
```

## Data Structure

```typescript
interface WatchedAgent {
  agent_id: string;
  output_file: string;
  timeout_seconds: number;
  registered_at: string;
  last_activity: string;  // From file mtime
  status: 'healthy' | 'stale' | 'triggered';
}
```

## Background Monitor

- Check interval: 10 seconds (configurable)
- Default timeout: 120 seconds (2 minutes)
- Auto-starts when server starts
- Triggers `cecelia-patrol --task-id <agent_id>` when agent is stale

## Non-Goals

- Database persistence (in-memory only for now)
- Cron-based scheduling
