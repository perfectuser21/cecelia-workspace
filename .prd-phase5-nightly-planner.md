---
id: prd-phase5-nightly-planner
version: 1.0.0
created: 2026-01-30
---

# PRD: Phase 5.4 - Nightly Planner（节律系统）

## 背景

Phase 5.3 实现了计划生成和落库，但需要手动触发。为实现"有节律的系统"，需要自动化的日常规划。

## 功能描述

建立自动化的每日规划系统，让系统每天凌晨自动生成次日计划，并通过 Dashboard 展示和执行。

## 成功标准

- N8N workflow 每天 6:00 自动触发生成 daily plan
- Dashboard 展示今日计划卡片
- 一键 commit P0 top 3 任务

## 交付物

### 5.4a: Nightly Planner API

新增端点支持自动规划：

```
POST /api/system/plan/nightly
```

功能：
- 生成 daily plan
- 自动 commit P0 top 3 任务
- 记录到 episodic memory（event: nightly_plan）
- 返回计划摘要

响应：
```json
{
  "success": true,
  "plan_id": "plan_daily_20260131",
  "committed_count": 3,
  "summary": "生成 5 个任务，已落库 3 个 P0 任务",
  "next_review": "2026-01-31T06:00:00Z"
}
```

### 5.4b: N8N Workflow

创建 `nightly-planner` workflow：

- Trigger: Schedule (每天 6:00 UTC+8)
- Action: POST /api/system/plan/nightly
- Notification: 记录结果到 memory

### 5.4c: Dashboard 今日计划卡片

在 Dashboard 添加组件：

- 显示当前 active plan
- 任务列表（带 why/expected_evidence）
- 进度条（completed/total）
- 一键 commit 按钮

## 验收清单

- [ ] POST /api/system/plan/nightly 能自动生成+commit
- [ ] N8N workflow 配置完成
- [ ] Dashboard 显示今日计划卡片
- [ ] nightly 执行记录可在 memory 中查询

## 依赖

- Phase 5.1 Memory Schema (已合并 #92)
- Phase 5.2 Planning Engine (已合并 #93)
- Phase 5.3 Plan Commit (已合并 #94)
